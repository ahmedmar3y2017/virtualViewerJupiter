/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/*! https://mths.be/startswith v0.2.0 by @mathias */

define("3rdparty/domReady",[],function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](u)}function t(){var t=d;l&&t.length&&(d=[],e(t))}function a(){l||(l=!0,r&&clearInterval(r),t())}function n(e){return l?e(u):d.push(e),n}var i,o,r,s="undefined"!=typeof window&&window.document,l=!s,u=s?document:null,d=[];if(s){if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1);else if(window.attachEvent){window.attachEvent("onload",a),o=document.createElement("div");try{i=null===window.frameElement}catch(e){}o.doScroll&&i&&window.external&&(r=setInterval(function(){try{o.doScroll(),a()}catch(e){}},30))}"complete"===document.readyState&&a()}return n.version="2.0.1",n.load=function(e,t,a,i){i.isBuild?a(null):n(a)},n}),define("vvPoint",[],function(){function e(e,t){this.x=e,this.y=t}return e.prototype.getX=function(){return this.x},e.prototype.setX=function(e){this.x=e},e.prototype.getY=function(){return this.y},e.prototype.setY=function(e){this.y=e},e.prototype.rotate=function(e,t,a){var n=this.getX(),i=this.getY(),o=e;e===-90?o=270:e===-180?o=180:e===-270&&(o=90),90===o?(this.setX(t-i),this.setY(n)):180===o?(this.setX(t-n),this.setY(a-i)):270===o&&(this.setX(i),this.setY(a-n))},e.prototype.unrotate=function(e,t,a){var n=e;90===e?n=270:180===e?n=180:270===e&&(n=90),this.rotate(n,t,a)},e}),define("vvUtility",["user-config/config","vvDefines","vvPoint"],function(e,t,a){!function(){String.prototype.startsWith||!function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,a=t(e,e,e)&&t}catch(e){}return a}(),t={}.toString,a=function(e){if(null==this)throw TypeError();var a=String(this);if(e&&"[object RegExp]"==t.call(e))throw TypeError();var n=a.length,i=String(e),o=i.length,r=arguments.length>1?arguments[1]:void 0,s=r?Number(r):0;s!=s&&(s=0);var l=Math.min(Math.max(s,0),n);if(o+l>n)return!1;for(var u=-1;++u<o;)if(a.charCodeAt(l+u)!=i.charCodeAt(u))return!1;return!0};e?e(String.prototype,"startsWith",{value:a,configurable:!0,writable:!0}):String.prototype.startsWith=a}(),Array.prototype.includes||(Array.prototype.includes=function(e){"use strict";var t=Object(this),a=parseInt(t.length)||0;if(0===a)return!1;var n,i=parseInt(arguments[1])||0;i>=0?n=i:(n=a+i,n<0&&(n=0));for(var o;n<a;){if(o=t[n],e===o||e!==e&&o!==o)return!0;n++}return!1}),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&this.indexOf(e,t)!==-1}),function(){"use strict";var e=/[-\/\\^$*+?.()|[\]{}]/g;RegExp.escape=function(t){return t.replace(e,"\\$&")}}()}();var n=function(e){"use strict";return e*(Math.PI/180)},i=function(e){"use strict";return e*(180/Math.PI)},o=function(e){1===e.nodeType&&e.setAttribute("unselectable","on");for(var t=e.firstChild;t;)o(t),t=t.nextSibling},r=function(e){"use strict";for(var a=t.fontSizes,n=0;n<a.length;n+=1){if(e===a[n])return e;if(e<a[n]&&n>0){var i=Math.abs(e-a[n-1]),o=Math.abs(e-a[n]);return i>o?a[n]:a[n-1]}if(e>a[n]&&n===a.length-1)return a[n]}},s=function(){"use strict";return Modernizr.touchevents?e.polygonNubSizeTouch||40:e.polygonNubSize||10},l=function(e){"use strict";return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},u=function(){"use strict";if(e.imageScrollBars===!1){v();var t=$("#vvSplitPaneDiv");t.addClass("grabCursorOpen")}},d=function(){"use strict";if(e.imageScrollBars===!1){v();var t=$("#vvSplitPaneDiv");t.addClass("grabCursorClosed")}},c=function(){"use strict";v();var e=$("#vvSplitPaneDiv");e.addClass("selectTextCursor")},g=function(){"use strict";v();var e=$("#vvSplitPaneDiv");e.addClass("guidesCursor")},v=function(){"use strict";var e=$("#vvSplitPaneDiv");e.removeClass("guidesCursor selectTextCursor grabCursorClosed grabCursorOpen")},p=function(e,t){"use strict";var a,n,i,o;for(a=e.split(/\./),n=$.localize.data.vv,i=0,o=a.length;i<o;i++)e=a[i],n=n?n[e]:null;return!n&&t&&(n=t),$("<div />").html(n).text()},h=function(e,t,a){"use strict";return{r:e,g:t,b:a}},f=function(e){"use strict";var t=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16);return h(t,a,n)},m=function(e,t){"use strict";var a=f(e),n=a.r,i=a.g,o=a.b;return t?"rgba("+n+","+i+","+o+","+t+")":"rgb("+n+","+i+","+o+")"},y=function(e){"use strict";var t=document.createElement("canvas"),a=e.width,n=e.height;t.width=a,t.height=n;var i=t.getContext("2d");i.drawImage(e,0,0,a,n);for(var o=i.getImageData(0,0,a,n),r=o.data,s=0,l=1,u=2,d=3,c=0;c<r.length;c+=4)255===r[c+s]&&255===r[c+l]&&255===r[c+u]&&(r[c+d]=0);return i.putImageData(o,0,0),t.toDataURL("image/png")},b=function(e){"use strict";return!(!e||"true"!==e)},A=function(e){"use strict";var t=[];if(e){e=e.split(";");for(var n=0;n<e.length;n+=1){var i=e[n].split(",");t[n]=new a(parseInt(i[0],10),parseInt(i[1],10))}}return t},P=function(e){"use strict";for(var t="",a=0;a<e.length;a+=1)t+=e[a].getX(),t+=",",t+=e[a].getY(),a!==e.length-1&&(t+=";");return t},T=function(e){"use strict";for(var t=[],a=e.getElementsByTagName("Note").length,n=0;n<a;n++){var i=e.getElementsByTagName("Note")[n],o={userId:decodeURIComponent($(i.getElementsByTagName("userId")[0]).text()),createDate:$(i.getElementsByTagName("createDate")[0]).text(),editDate:$(i.getElementsByTagName("modifyDate")[0]).text(),text:decodeURIComponent($(i.getElementsByTagName("noteText")[0]).text()),idxFlag:$(i.getElementsByTagName("idxFlag")[0]).text()};t.push(o)}return t},S=function(e){"use strict";for(var t=[],a=e.getElementsByTagName("tag").length,n=0;n<a;n++){var i=e.getElementsByTagName("tag")[n];t.push(decodeURIComponent($(i).text()))}return t},w=function(e,t){"use strict";var a=e.getElementsByTagName(t)[0];return a?$(a).text():null},I=function(e){"use strict";return""===e?0:parseFloat(e.substring(0,e.length-2))},C=function(e,t){"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9?"collapse"===t||"hidden"===t?e.style.display="none":e.style.display="":e.style.visibility=t},D=function(e){"use strict";e||(e=window.event),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},x=function(e,t,a,n){this.left=e,this.top=t,this.right=a,this.bottom=n,this.intersects=function(e){return!(e.left>this.right||e.right<this.left||e.top>this.bottom||e.bottom<this.top)},this.width=function(){return this.right-this.left},this.height=function(){return this.bottom-this.top}},M=function(e){"use strict";var t=e.replace(/\&/g,"&amp;");return t},N={SIXTY_FOUR_CHARS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",REVERSE_MAPPING:[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,63,void 0,void 0,void 0,64,53,54,55,56,57,58,59,60,61,62,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,void 0,void 0,void 0,void 0,void 0,void 0,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],encode:function(e){var t="";if(!e)return null;e=this.stringToBytes(e);for(var a=e.length,n=0,i=0;i<a;i+=3){for(var o=Math.min(3,a-i),r=(255&e[i])<<16|(o<=1?0:255&e[i+1])<<8|(o<=2?0:255&e[i+2]),s=0;s<4;s++)t+=o+1>s?this.SIXTY_FOUR_CHARS.charAt(63&r>>6*(3-s)):"=";(n+=4)%76===0&&t&&(t+="\n")}return t.toString()},decode:function(e){var t=[];if(!e)return null;for(var a=0;a<e.length;a+=4){"\n"===e.charAt(a)&&(a+=1);for(var n=[this.mapCharToInt(e.charAt(a)),this.mapCharToInt(e.charAt(a+1)),this.mapCharToInt(e.charAt(a+2)),this.mapCharToInt(e.charAt(a+3))],i=(63&n[0])<<18|(63&n[1])<<12|(63&n[2])<<6|63&n[3],o=0;o<3;o++)n[o+1]>=0&&t.push(255&i>>8*(2-o))}for(var r="",s=0;s<t.length;s+=2)r+=this.fixedFromCharCode(this.getWordAt(t,s));return r},mapCharToInt:function(e){if(!e)return-1;var t=this.REVERSE_MAPPING[e.charCodeAt(0)];return 0!==t?t-1:-1},fixedFromCharCode:function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e))):String.fromCharCode(e)},getWordAt:function(e,t){return(e[t+0]<<8)+e[t+1]},stringToBytes:function(e){for(var t,a,n=[],i=0;i<e.length;i++)if(t=e.charCodeAt(i),a=[],t>255){do a.push(255&t),t>>=8;while(t);n=n.concat(a.reverse())}else n.push(0),n.push(t);return n}},L=function(e){"use strict";var t="vvTextAnnotation-"+e.getLayerName().replace(/[\W]/g,"")+"-"+e.page+"-"+e.getOrdinal();return t},V=function(e){"use strict";return moment(e).format("YYYY-MM-DDTHH:mm:ss.SSZZ")},k=function(e){"use strict";var t={};if(null===e)return null;if(void 0!==e){if(e.vvDeadEnd===!0||"object"==typeof e&&"string"==typeof e.jquery)return null;if("object"==typeof e){"undefined"!=typeof e.length&&(t=[]);for(var a in e)"object"==typeof e[a]?t[a]=k(e[a]):"string"==typeof e[a]?t[a]=e[a]:"number"==typeof e[a]?t[a]=e[a]:"boolean"==typeof e[a]?e[a]===!0?t[a]=!0:t[a]=!1:"function"==typeof e[a]&&(t[a]=e[a])}return t}},B=function(e,t,a){"use strict";if(!a)return"State object is required";var n=a.getPageCount();if("complex"===e){if(!t)return p("errors.complexRangeEmpty","Blank complex page range");for(var i=t.split(","),o=0;o<i.length;o++)for(var r=i[o],s=r.split("-"),l=0;l<s.length;l++){var u=+s[l];if(isNaN(u))return p("errors.complexRangeInvalidCharacter","Invalid character in complex page range:")+" "+u;if(u>n||u<1)return p("errors.complexRangePageOutOfBounds","One or more of the pages in the selected range are out of bounds");if(l<s.length-1&&u>+s[l+1])return p("errors.complexRangeUnsupportedSyntax","Incorrect syntax for the pages, make sure the lower number is on the left side of the dash.")}}return"OK"},R=function(e,t,a){"use strict";if(!a)return"State object is required";var n=a.getPageCount(),i=[];if("complex"===e)for(var o=t.split(","),r=0;r<o.length;r++){var s=o[r],l=s.split("-");if(1===l.length)i.push(+s-1);else for(var u=+l[0],d=+l[1],c=u;c<=d;c+=1)i.push(+c-1)}else if("all"===e)for(var g=0;g<n;g+=1)i.push(+g);else"current"===e&&i.push(+a.getPageNumber());return i},F=function(e){"use strict";for(var t=$(e).serializeArray(),a={},n=0;n<t.length;n++){var i=t[n];"true"===i.value?a[i.name]=!0:"false"===i.value?a[i.name]=!1:a[i.name]=i.value}return a},E=function(e,t){var a=t[0].x,n=t[0].y,i=t[1].x,o=t[1].y;if(i===a)return Math.abs(e.x-a);if(o===n)return Math.abs(e.y-n);var r=(o-n)/(i-a),s=o-r*i,l=Math.abs(s+r*e.x-e.y),u=Math.sqrt(1+Math.pow(r,2));return l/u},O=function(e){"use strict";return moment(e).format("ddd MMM D YYYY h:mm:ss A")},_=function(e){if(!e.canvas)throw"A canvas is required";if(!e.image)throw"Image is required";var t=e.canvas,a=t.getContext("2d"),n=e.image,i=e.srcx||0,o=e.srcy||0,r=e.srcw||n.naturalWidth,s=e.srch||n.naturalHeight,l=e.desx||i,u=e.desy||o,d=e.desw||r,c=e.desh||s,g=e.auto,v=window.devicePixelRatio||1,p=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1,h=v/p;if("undefined"==typeof g&&(g=!0),g&&v!==p){var f=t.width,m=t.height;t.width=f*h,t.height=m*h,t.style.width=f+"px",t.style.height=m+"px",a.scale(h,h)}a.drawImage(n,i,o,r,s,l,u,d,c)},U=function(e){"use strict";return!("Explorer"===BrowserDetect.browser&&BrowserDetect.version<=8)&&(e&&e.length||(e=$('[data-toggle="tooltip"]')),e.tooltip({trigger:"hover",show:!1,hide:!1}),!0)},W=function(e){"use strict";return"string"==typeof e&&0===e.indexOf(t.redactionLayerPrefix)||(!(!e.displayName||0!==e.displayName.indexOf(t.redactionLayerPrefix))||(!(!e.layerName||0!==e.layerName.indexOf(t.redactionLayerPrefix))||!(!e.annotationId||0!==e.annotationId.indexOf(t.redactionLayerPrefix))))},z=function(e){"use strict";return 0===e.indexOf("VirtualDocument:")},H=function(e){"use strict";var t=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,a=new RegExp(t);return a.test(e)},Q=function(e){"use strict";if(!e||e.length<=0)return"";for(var t=e.sort(function(e,t){return e-t}),a="",n=null,i=0;i<t.length;i++)i+1<t.length&&t[i+1]-t[i]===1?null===n&&(n=t[i]):null!==n?(a+=n+1+" - "+(t[i]+1)+", ",n=null):a+=t[i]+1+", ";return a.length>2&&(a=a.substr(0,a.length-2)),a},j=function(e,t){"use strict";var a=[];try{e=e.replace(/\s/g,"");for(var n=e.split(","),i=0;i<n.length;i++){var o=n[i];if(o.includes("-"))for(var r=o.indexOf("-"),s=o.substring(0,r),l=o.substring(r+1),u=parseInt(s)-1,d=parseInt(l)-1,c=u;c<=d;c++)a.push(c);else{var g=parseInt(o)-1;if(!(g<t)){var v="Page "+g+" does not exist.";throw v}a.push(g)}}}catch(e){"string"==typeof e?console.log(e):console.log("Invalid Complex Range")}return a},q=function(){"use strict";var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},G=function(e){if(!e||e.length<4)return!1;e=e.toUpperCase();var t=e.substring(e.length-4);switch(t){case".MOV":case".MP4":case".OGG":case"WEBM":case".MKV":case".M4V":case".OGV":return!0;default:return!1}},Y=function(e){"use strict";var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"," ":"&nbsp;"};return String(e).replace(/[&<> \/"'`=]/g,function(e){return t[e]})};return{degreesToRadians:n,radiansToDegrees:i,findClosestFontSize:r,getNubSize:s,toTitleCase:l,Color:h,getColor:f,parseColorString:m,whiteToTransparent:y,fixBooleanString:b,parsePointArray:A,generatePointArrayString:P,parseAnnNotes:T,parseAnnTags:S,getValue:w,stripPx:I,setElementVisibility:C,cursorGrabOpen:u,cursorGrabClosed:d,cursorSelectText:c,cursorGuides:g,cursorAnnotate:g,cursorNormal:v,cancelEventBubbling:D,xmlEncodeEntities:M,deepObjCopy:k,getLocalizedValue:p,validatePageRangeInput:B,normalizePageRangeInput:R,getFormData:F,Base64:N,getTextAnnDOMId:L,toSnowDateString:V,createAnnTimeStamp:O,drawImage:_,enableTooltips:U,isRedactionLayer:W,isVirtualDocument:z,isValidEmailAddress:H,createComplexPageString:Q,parseComplexPageString:j,vvGUID:q,dumbVideoExtensionCheck:G,encodeForHTML:Y,makeUnselectable:o,ImageRect:x,getDistanceFromPointToLine:E}}),define("vvWidgets",["vvUtility","vvDefines"],function(e,t){function a(){}return a.expandColorPicker=function(e){var t=$(e).find(".vvColorInputPreview").css("height");$(e).find(".vvColorPickerSquare").css("height",t),$(e).find(".vvColorPickerSquare").css("width",t),$(e).find(".vvColorSquaresContainer").show()},a.shrinkColorPicker=function(e){$(e).find(".vvColorSquaresContainer").hide(),$(e).find(".vvColorPickerSquareSelected").removeClass("vvColorPickerSquareSelected"),$(e).find(".vvColorInputBox").attr("aria-invalid",!1)},a.setColorPickerColor=function(e,t){a.validateHexColor(t)&&($(e).find(".vvColorInputBox").attr("aria-invalid",!1),$(e).find(".vvColorInputPreview").css("background-color","#"+t),$(e).find(".vvColorInputBox").val(t))},a.createColorPicker=function(n,i){if(n){$(n).addClass("vvColorPickerOuterWrapper");var o=$("<div></div>").addClass("vvColorPickerContainer form-group");$(n).append(o);var r=$("<div></div>").addClass("input-group vvColorInputGroup");$(o).append(r);var s=$("<span></span>").addClass("input-group-addon vvColorInputPreview").attr("aria-label","Preview of the selected color.");$(r).append(s);var l=$("<input>").addClass("form-control vvColorInputBox").attr({type:"text",maxlength:"6",size:"6"});$(r).append(l);var u=null,d=null,c=$("<div></div>").addClass("vvColorSquaresContainer").attr("aria-label","Dropdown list of colors to choose from.");$(o).append(c);for(var g=0;g<t.annColors.length;g+=1){d=$("<div></div>");var v=t.annColors[g];$(d).css("background-color","#"+v).data("hex-color",v).addClass("vvColorPickerSquare"),$(c).append(d)}u=$("<div></div>").addClass("vvCustomColorRow vvColorChooserRow"),$(c).append(u);var p=$("<div></div>").text(e.getLocalizedValue("userPreferencesDialog.custom","Custom:")).addClass("vvCurrentCustomColorLabel");$(u).append(p),d=$("<div></div>").addClass("vvColorPickerSquare vvCustomColorPickerSquare").css("background-color","#C3C3C3").data("hex-color","C3C3C3"),$(u).append(d),$(c).hide(),$(c).find(".vvColorPickerSquare").on("click",function(){var e=$(this).data("hex-color"),t=$(this).parentsUntil(".vvColorPickerOuterWrapper",".vvColorPickerContainer")[0];$(t).find(".vvColorPickerSquareSelected").removeClass("vvColorPickerSquareSelected"),$(this).addClass("vvColorPickerSquareSelected"),$(t).find(".vvColorInputPreview").css("background-color","#"+e),$(t).find(".vvColorInputBox").val(e),i&&i(n,e)}),$(l).on("focus",function(){var e=$(this).parentsUntil(".vvColorPickerOuterWrapper",".vvColorPickerContainer")[0];a.expandColorPicker(e)}),$(s).on("click",function(){var e=$(this).parentsUntil(".vvColorPickerOuterWrapper",".vvColorPickerContainer")[0];"none"===$(e).find(".vvColorSquaresContainer").css("display")?a.expandColorPicker(e):a.shrinkColorPicker(e)}),$(l).on("change",function(){var e=$(this).val();if(!a.validateHexColor(e))return void $(this).attr("aria-invalid",!0);$(this).attr("aria-invalid",!1);var t=$(this).parentsUntil(".vvColorPickerOuterWrapper",".vvColorPickerContainer")[0];$(t).find(".vvColorInputPreview").css("background-color","#"+e);var n=$(t).find(".vvCustomColorPickerSquare");$(n).css("background-color","#"+e).data("hex-color",e),$(t).find(".vvColorPickerSquareSelected").removeClass("vvColorPickerSquareSelected"),i&&i(e)})}},a.validateHexColor=function(e){var t=/^([a-fA-F0-9]{6})$/;return!!t.test(e)},a}),define("vvDocViewStateElement",[],function(){function e(e){this.flipHorizontal=!1,this.flipVertical=!1,this.annotationLayers=void 0,this.dpi=void 0,this.bitDepth=0,this.compressionType="N/A",this.isSVGable=!0,this.isBad=!1,this.isModified=!1,this.imageFormat="N/A",this.tiffTagHash={},this.originalWidth=0,this.originalHeight=0,this.requestedWidth=0,this.requestedHeight=0,this.scrollLeft=null,this.scrollTop=null,this.searchResults=null,this.pageText=null,this.undoObject={unchangedAnn:void 0,modifiedAnn:void 0,referenceAnn:void 0,layer:void 0,type:void 0},this.undoObjectArray=[],this.undoIndex=-1,this.poppedObjectArray=[],this.poppedIndex=-1,this.newTextAnn=!1,this.imageInfoRequested=!1,this.imageInfoLoaded=!1}return e.prototype.initPageStateFromObject=function(e){this.flipHorizontal=e.flipHorizontal,this.flipVertical=e.flipVertical,this.annotationLayers=e.annotationLayers,this.dpi=e.dpi,this.bitDepth=e.bitDepth,this.compressionType=e.compressionType,this.isSVGable=e.isSVGable,this.isBad=e.isBad,this.imageFormat=e.imageFormat,this.tiffTagHash=e.tiffTagHash,this.originalWidth=e.originalWidth,this.originalHeight=e.originalHeight,this.requestedWidth=e.requestedWidth,this.requestedHeight=e.requestedHeight,this.scrollLeft=e.scrollLeft,this.scrollTop=e.scrollTop,this.searchResults=e.searchResults,this.pageText=e.pageText,this.undoObject=e.undoObject,this.undoObjectArray=e.undoObjectArray,this.undoIndex=e.undoIndex,this.poppedObjectArray=e.poppedObjectArray,this.poppedIndex=e.poppedIndex,this.newTextAnn=e.newTextAnn,this.imageInfoRequested=e.imageInfoRequested,this.imageInfoLoaded=e.imageInfoLoaded},e}),define("vvBoundingBox",["vvPoint","vvUtility","vvDefines"],function(e,t,a){function n(t,a,n,i){this.one=new e(t,a),this.two=new e(t+n,a+i)}return n.prototype.getX1=function(){return this.one.getX()},n.prototype.getY1=function(){return this.one.getY()},n.prototype.getPoint1=function(){return this.one},n.prototype.getPoint2=function(){return this.two},n.prototype.getX2=function(){return this.two.getX()},n.prototype.getY2=function(){return this.two.getY()},n.prototype.getWidth=function(){return this.getX2()-this.getX1()},n.prototype.getHeight=function(){return this.getY2()-this.getY1()},n.prototype.contains=function(e,a,n,i){var o=t.getNubSize()/2/a;i&&(o=0);var r=e.getX()/a,s=e.getY()/n;return r>=this.getX1()-o&&r<=this.getX2()+o&&s>=this.getY1()-o&&s<=this.getY2()+o},n.prototype.intersects=function(e){return!(e.getX1()>this.getX2()||e.getX2()<this.getX1()||e.getY1()>this.getY2()||e.getY2()<this.getY1())},n.prototype.findCorner=function(e,n,i){var o=t.getNubSize()/2/n,r=t.getNubSize()/2/i,s=e.getX()/n,l=e.getY()/i;return s>=this.getX1()-o&&s<=this.getX1()+o&&l>=this.getY1()-r&&l<=this.getY1()+r?a.corners.upperLeft:s>=this.getX2()-o&&s<=this.getX2()+o&&l>=this.getY1()-r&&l<=this.getY1()+r?a.corners.upperRight:s>=this.getX1()-o&&s<=this.getX1()+o&&l>=this.getY2()-r&&l<=this.getY2()+r?a.corners.lowerLeft:s>=this.getX2()-o&&s<=this.getX2()+o&&l>=this.getY2()-r&&l<=this.getY2()+r?a.corners.lowerRight:null},n.prototype.rotate=function(e,t,a){this.one.rotate(e,t,a),this.two.rotate(e,t,a)},n.prototype.unrotate=function(e,t,a){this.one.unrotate(e,t,a),this.two.unrotate(e,t,a)},n.prototype.copyFrom=function(t){this.one=new e(t.one.x,t.one.y),this.two=new e(t.two.x,t.two.y)},n});var diff_match_patch=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff=function(e,t){this[0]=e,this[1]=t},diff_match_patch.Diff.prototype.length=2,diff_match_patch.Diff.prototype.toString=function(){return this[0]+","+this[1]},diff_match_patch.prototype.diff_main=function(e,t,a,n){if("undefined"==typeof n&&(n=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout),null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[new diff_match_patch.Diff(DIFF_EQUAL,e)]:[];"undefined"==typeof a&&(a=!0);var i=a,o=this.diff_commonPrefix(e,t);a=e.substring(0,o),e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var r=e.substring(e.length-o);return e=e.substring(0,e.length-o),t=t.substring(0,t.length-o),e=this.diff_compute_(e,t,i,n),a&&e.unshift(new diff_match_patch.Diff(DIFF_EQUAL,a)),r&&e.push(new diff_match_patch.Diff(DIFF_EQUAL,r)),this.diff_cleanupMerge(e),e},diff_match_patch.prototype.diff_compute_=function(e,t,a,n){if(!e)return[new diff_match_patch.Diff(DIFF_INSERT,t)];if(!t)return[new diff_match_patch.Diff(DIFF_DELETE,e)];var i=e.length>t.length?e:t,o=e.length>t.length?t:e,r=i.indexOf(o);return-1!=r?(a=[new diff_match_patch.Diff(DIFF_INSERT,i.substring(0,r)),new diff_match_patch.Diff(DIFF_EQUAL,o),new diff_match_patch.Diff(DIFF_INSERT,i.substring(r+o.length))],e.length>t.length&&(a[0][0]=a[2][0]=DIFF_DELETE),a):1==o.length?[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)]:(i=this.diff_halfMatch_(e,t))?(t=i[1],o=i[3],e=i[4],i=this.diff_main(i[0],i[2],a,n),a=this.diff_main(t,o,a,n),i.concat([new diff_match_patch.Diff(DIFF_EQUAL,e)],a)):a&&100<e.length&&100<t.length?this.diff_lineMode_(e,t,n):this.diff_bisect_(e,t,n)},diff_match_patch.prototype.diff_lineMode_=function(e,t,a){var n=this.diff_linesToChars_(e,t);e=n.chars1,t=n.chars2,n=n.lineArray,e=this.diff_main(e,t,!1,a),this.diff_charsToLines_(e,n),this.diff_cleanupSemantic(e),e.push(new diff_match_patch.Diff(DIFF_EQUAL,""));for(var i=n=t=0,o="",r="";t<e.length;){switch(e[t][0]){case DIFF_INSERT:i++,r+=e[t][1];break;case DIFF_DELETE:n++,o+=e[t][1];break;case DIFF_EQUAL:if(1<=n&&1<=i){for(e.splice(t-n-i,n+i),t=t-n-i,n=this.diff_main(o,r,!1,a),i=n.length-1;0<=i;i--)e.splice(t,0,n[i]);t+=n.length}n=i=0,r=o=""}t++}return e.pop(),e},diff_match_patch.prototype.diff_bisect_=function(e,t,a){for(var n=e.length,i=t.length,o=Math.ceil((n+i)/2),r=2*o,s=Array(r),l=Array(r),u=0;u<r;u++)s[u]=-1,l[u]=-1;s[o+1]=0,l[o+1]=0,u=n-i;for(var d=0!=u%2,c=0,g=0,v=0,p=0,h=0;h<o&&!((new Date).getTime()>a);h++){for(var f=-h+c;f<=h-g;f+=2){for(var m=o+f,y=f==-h||f!=h&&s[m-1]<s[m+1]?s[m+1]:s[m-1]+1,b=y-f;y<n&&b<i&&e.charAt(y)==t.charAt(b);)y++,b++;if(s[m]=y,y>n)g+=2;else if(b>i)c+=2;else if(d&&(m=o+u-f,0<=m&&m<r&&-1!=l[m])){var A=n-l[m];if(y>=A)return this.diff_bisectSplit_(e,t,y,b,a)}}for(f=-h+v;f<=h-p;f+=2){for(m=o+f,A=f==-h||f!=h&&l[m-1]<l[m+1]?l[m+1]:l[m-1]+1,y=A-f;A<n&&y<i&&e.charAt(n-A-1)==t.charAt(i-y-1);)A++,y++;if(l[m]=A,A>n)p+=2;else if(y>i)v+=2;else if(!d&&(m=o+u-f,0<=m&&m<r&&-1!=s[m]&&(y=s[m],b=o+y-m,A=n-A,y>=A)))return this.diff_bisectSplit_(e,t,y,b,a)}}return[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)]},diff_match_patch.prototype.diff_bisectSplit_=function(e,t,a,n,i){var o=e.substring(0,a),r=t.substring(0,n);return e=e.substring(a),t=t.substring(n),o=this.diff_main(o,r,!1,i),i=this.diff_main(e,t,!1,i),o.concat(i)},diff_match_patch.prototype.diff_linesToChars_=function(e,t){function a(e){for(var t="",a=0,r=-1,s=n.length;r<e.length-1;){r=e.indexOf("\n",a),-1==r&&(r=e.length-1);var l=e.substring(a,r+1);(i.hasOwnProperty?i.hasOwnProperty(l):void 0!==i[l])?t+=String.fromCharCode(i[l]):(s==o&&(l=e.substring(a),r=e.length),t+=String.fromCharCode(s),i[l]=s,n[s++]=l),a=r+1}return t}var n=[],i={};n[0]="";var o=4e4,r=a(e);o=65535;var s=a(t);return{chars1:r,chars2:s,lineArray:n}},diff_match_patch.prototype.diff_charsToLines_=function(e,t){for(var a=0;a<e.length;a++){for(var n=e[a][1],i=[],o=0;o<n.length;o++)i[o]=t[n.charCodeAt(o)];e[a][1]=i.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var a=0,n=Math.min(e.length,t.length),i=n,o=0;a<i;)e.substring(o,i)==t.substring(o,i)?o=a=i:n=i,i=Math.floor((n-a)/2+a);return i},diff_match_patch.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var a=0,n=Math.min(e.length,t.length),i=n,o=0;a<i;)e.substring(e.length-i,e.length-o)==t.substring(t.length-i,t.length-o)?o=a=i:n=i,i=Math.floor((n-a)/2+a);return i},diff_match_patch.prototype.diff_commonOverlap_=function(e,t){var a=e.length,n=t.length;if(0==a||0==n)return 0;if(a>n?e=e.substring(a-n):a<n&&(t=t.substring(0,a)),a=Math.min(a,n),e==t)return a;n=0;for(var i=1;;){var o=e.substring(a-i);if(o=t.indexOf(o),-1==o)return n;i+=o,0!=o&&e.substring(a-i)!=t.substring(0,i)||(n=i,i++)}},diff_match_patch.prototype.diff_halfMatch_=function(e,t){function a(e,t,a){for(var n,i,r,s,l=e.substring(a,a+Math.floor(e.length/4)),u=-1,d="";-1!=(u=t.indexOf(l,u+1));){var c=o.diff_commonPrefix(e.substring(a),t.substring(u)),g=o.diff_commonSuffix(e.substring(0,a),t.substring(0,u));d.length<g+c&&(d=t.substring(u-g,u)+t.substring(u,u+c),n=e.substring(0,a-g),i=e.substring(a+c),r=t.substring(0,u-g),s=t.substring(u+c))}return 2*d.length>=e.length?[n,i,r,s,d]:null}if(0>=this.Diff_Timeout)return null;var n=e.length>t.length?e:t,i=e.length>t.length?t:e;if(4>n.length||2*i.length<n.length)return null;var o=this,r=a(n,i,Math.ceil(n.length/4));if(n=a(n,i,Math.ceil(n.length/2)),!r&&!n)return null;if(r=n?r&&r[4].length>n[4].length?r:n:r,e.length>t.length){n=r[0],i=r[1];var s=r[2],l=r[3]}else s=r[0],l=r[1],n=r[2],i=r[3];return[n,i,s,l,r[4]]},diff_match_patch.prototype.diff_cleanupSemantic=function(e){for(var t=!1,a=[],n=0,i=null,o=0,r=0,s=0,l=0,u=0;o<e.length;)e[o][0]==DIFF_EQUAL?(a[n++]=o,r=l,s=u,u=l=0,i=e[o][1]):(e[o][0]==DIFF_INSERT?l+=e[o][1].length:u+=e[o][1].length,i&&i.length<=Math.max(r,s)&&i.length<=Math.max(l,u)&&(e.splice(a[n-1],0,new diff_match_patch.Diff(DIFF_DELETE,i)),e[a[n-1]+1][0]=DIFF_INSERT,n--,n--,o=0<n?a[n-1]:-1,u=l=s=r=0,i=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;)e[o-1][0]==DIFF_DELETE&&e[o][0]==DIFF_INSERT&&(t=e[o-1][1],a=e[o][1],n=this.diff_commonOverlap_(t,a),i=this.diff_commonOverlap_(a,t),n>=i?(n>=t.length/2||n>=a.length/2)&&(e.splice(o,0,new diff_match_patch.Diff(DIFF_EQUAL,a.substring(0,n))),e[o-1][1]=t.substring(0,t.length-n),e[o+1][1]=a.substring(n),o++):(i>=t.length/2||i>=a.length/2)&&(e.splice(o,0,new diff_match_patch.Diff(DIFF_EQUAL,t.substring(0,i))),e[o-1][0]=DIFF_INSERT,e[o-1][1]=a.substring(0,a.length-i),e[o+1][0]=DIFF_DELETE,e[o+1][1]=t.substring(i),o++),o++),o++},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var a=e.charAt(e.length-1),n=t.charAt(0),i=a.match(diff_match_patch.nonAlphaNumericRegex_),o=n.match(diff_match_patch.nonAlphaNumericRegex_),r=i&&a.match(diff_match_patch.whitespaceRegex_),s=o&&n.match(diff_match_patch.whitespaceRegex_);a=r&&a.match(diff_match_patch.linebreakRegex_),n=s&&n.match(diff_match_patch.linebreakRegex_);var l=a&&e.match(diff_match_patch.blanklineEndRegex_),u=n&&t.match(diff_match_patch.blanklineStartRegex_);return l||u?5:a||n?4:i&&!r&&s?3:r||s?2:i||o?1:0}for(var a=1;a<e.length-1;){if(e[a-1][0]==DIFF_EQUAL&&e[a+1][0]==DIFF_EQUAL){var n=e[a-1][1],i=e[a][1],o=e[a+1][1],r=this.diff_commonSuffix(n,i);if(r){var s=i.substring(i.length-r);n=n.substring(0,n.length-r),i=s+i.substring(0,i.length-r),o=s+o}r=n,s=i;for(var l=o,u=t(n,i)+t(i,o);i.charAt(0)===o.charAt(0);){n+=i.charAt(0),i=i.substring(1)+o.charAt(0),o=o.substring(1);var d=t(n,i)+t(i,o);d>=u&&(u=d,r=n,s=i,l=o)}e[a-1][1]!=r&&(r?e[a-1][1]=r:(e.splice(a-1,1),a--),e[a][1]=s,l?e[a+1][1]=l:(e.splice(a+1,1),a--))}a++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,a=[],n=0,i=null,o=0,r=!1,s=!1,l=!1,u=!1;o<e.length;)e[o][0]==DIFF_EQUAL?(e[o][1].length<this.Diff_EditCost&&(l||u)?(a[n++]=o,r=l,s=u,i=e[o][1]):(n=0,i=null),l=u=!1):(e[o][0]==DIFF_DELETE?u=!0:l=!0,i&&(r&&s&&l&&u||i.length<this.Diff_EditCost/2&&3==r+s+l+u)&&(e.splice(a[n-1],0,new diff_match_patch.Diff(DIFF_DELETE,i)),e[a[n-1]+1][0]=DIFF_INSERT,n--,i=null,r&&s?(l=u=!0,n=0):(n--,o=0<n?a[n-1]:-1,l=u=!1),t=!0)),o++;t&&this.diff_cleanupMerge(e)},diff_match_patch.prototype.diff_cleanupMerge=function(e){e.push(new diff_match_patch.Diff(DIFF_EQUAL,""));for(var t,a=0,n=0,i=0,o="",r="";a<e.length;)switch(e[a][0]){case DIFF_INSERT:i++,r+=e[a][1],a++;break;case DIFF_DELETE:n++,o+=e[a][1],a++;break;case DIFF_EQUAL:1<n+i?(0!==n&&0!==i&&(t=this.diff_commonPrefix(r,o),0!==t&&(0<a-n-i&&e[a-n-i-1][0]==DIFF_EQUAL?e[a-n-i-1][1]+=r.substring(0,t):(e.splice(0,0,new diff_match_patch.Diff(DIFF_EQUAL,r.substring(0,t))),a++),r=r.substring(t),o=o.substring(t)),t=this.diff_commonSuffix(r,o),0!==t&&(e[a][1]=r.substring(r.length-t)+e[a][1],r=r.substring(0,r.length-t),o=o.substring(0,o.length-t))),a-=n+i,e.splice(a,n+i),o.length&&(e.splice(a,0,new diff_match_patch.Diff(DIFF_DELETE,o)),a++),r.length&&(e.splice(a,0,new diff_match_patch.Diff(DIFF_INSERT,r)),a++),a++):0!==a&&e[a-1][0]==DIFF_EQUAL?(e[a-1][1]+=e[a][1],e.splice(a,1)):a++,n=i=0,r=o=""}for(""===e[e.length-1][1]&&e.pop(),n=!1,a=1;a<e.length-1;)e[a-1][0]==DIFF_EQUAL&&e[a+1][0]==DIFF_EQUAL&&(e[a][1].substring(e[a][1].length-e[a-1][1].length)==e[a-1][1]?(e[a][1]=e[a-1][1]+e[a][1].substring(0,e[a][1].length-e[a-1][1].length),e[a+1][1]=e[a-1][1]+e[a+1][1],e.splice(a-1,1),n=!0):e[a][1].substring(0,e[a+1][1].length)==e[a+1][1]&&(e[a-1][1]+=e[a+1][1],e[a][1]=e[a][1].substring(e[a+1][1].length)+e[a+1][1],e.splice(a+1,1),n=!0)),a++;n&&this.diff_cleanupMerge(e)},diff_match_patch.prototype.diff_xIndex=function(e,t){var a,n=0,i=0,o=0,r=0;for(a=0;a<e.length&&(e[a][0]!==DIFF_INSERT&&(n+=e[a][1].length),e[a][0]!==DIFF_DELETE&&(i+=e[a][1].length),!(n>t));a++)o=n,r=i;return e.length!=a&&e[a][0]===DIFF_DELETE?r:r+(t-o)},diff_match_patch.prototype.diff_prettyHtml=function(e){for(var t=[],a=/&/g,n=/</g,i=/>/g,o=/\n/g,r=0;r<e.length;r++){var s=e[r][0],l=e[r][1].replace(a,"&amp;").replace(n,"&lt;").replace(i,"&gt;").replace(o,"&para;<br>");switch(s){case DIFF_INSERT:t[r]='<ins style="background:#e6ffe6;">'+l+"</ins>";break;case DIFF_DELETE:t[r]='<del style="background:#ffe6e6;">'+l+"</del>";break;case DIFF_EQUAL:t[r]="<span>"+l+"</span>"}}return t.join("")},diff_match_patch.prototype.diff_text1=function(e){for(var t=[],a=0;a<e.length;a++)e[a][0]!==DIFF_INSERT&&(t[a]=e[a][1]);return t.join("")},diff_match_patch.prototype.diff_text2=function(e){for(var t=[],a=0;a<e.length;a++)e[a][0]!==DIFF_DELETE&&(t[a]=e[a][1]);return t.join("")},diff_match_patch.prototype.diff_levenshtein=function(e){
for(var t=0,a=0,n=0,i=0;i<e.length;i++){var o=e[i][1];switch(e[i][0]){case DIFF_INSERT:a+=o.length;break;case DIFF_DELETE:n+=o.length;break;case DIFF_EQUAL:t+=Math.max(a,n),n=a=0}}return t+=Math.max(a,n)},diff_match_patch.prototype.diff_toDelta=function(e){for(var t=[],a=0;a<e.length;a++)switch(e[a][0]){case DIFF_INSERT:t[a]="+"+encodeURI(e[a][1]);break;case DIFF_DELETE:t[a]="-"+e[a][1].length;break;case DIFF_EQUAL:t[a]="="+e[a][1].length}return t.join("\t").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(e,t){for(var a=[],n=0,i=0,o=t.split(/\t/g),r=0;r<o.length;r++){var s=o[r].substring(1);switch(o[r].charAt(0)){case"+":try{a[n++]=new diff_match_patch.Diff(DIFF_INSERT,decodeURI(s))}catch(e){throw Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var l=parseInt(s,10);if(isNaN(l)||0>l)throw Error("Invalid number in diff_fromDelta: "+s);s=e.substring(i,i+=l),"="==o[r].charAt(0)?a[n++]=new diff_match_patch.Diff(DIFF_EQUAL,s):a[n++]=new diff_match_patch.Diff(DIFF_DELETE,s);break;default:if(o[r])throw Error("Invalid diff operation in diff_fromDelta: "+o[r])}}if(i!=e.length)throw Error("Delta length ("+i+") does not equal source text length ("+e.length+").");return a},diff_match_patch.prototype.match_main=function(e,t,a){if(null==e||null==t||null==a)throw Error("Null input. (match_main)");return a=Math.max(0,Math.min(a,e.length)),e==t?0:e.length?e.substring(a,a+t.length)==t?a:this.match_bitap_(e,t,a):-1},diff_match_patch.prototype.match_bitap_=function(e,t,a){function n(e,n){var i=e/t.length,r=Math.abs(a-n);return o.Match_Distance?i+r/o.Match_Distance:r?1:i}if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var i=this.match_alphabet_(t),o=this,r=this.Match_Threshold,s=e.indexOf(t,a);-1!=s&&(r=Math.min(n(0,s),r),s=e.lastIndexOf(t,a+t.length),-1!=s&&(r=Math.min(n(0,s),r)));var l=1<<t.length-1;s=-1;for(var u,d,c,g=t.length+e.length,v=0;v<t.length;v++){for(u=0,d=g;u<d;)n(v,a+d)<=r?u=d:g=d,d=Math.floor((g-u)/2+u);g=d,u=Math.max(1,a-d+1);var p=Math.min(a+d,e.length)+t.length;for(d=Array(p+2),d[p+1]=(1<<v)-1;p>=u;p--){var h=i[e.charAt(p-1)];if(d[p]=0===v?(d[p+1]<<1|1)&h:(d[p+1]<<1|1)&h|(c[p+1]|c[p])<<1|1|c[p+1],d[p]&l&&(h=n(v,p-1),h<=r)){if(r=h,s=p-1,!(s>a))break;u=Math.max(1,2*a-s)}}if(n(v+1,a)>r)break;c=d}return s},diff_match_patch.prototype.match_alphabet_=function(e){for(var t={},a=0;a<e.length;a++)t[e.charAt(a)]=0;for(a=0;a<e.length;a++)t[e.charAt(a)]|=1<<e.length-a-1;return t},diff_match_patch.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var a=t.substring(e.start2,e.start2+e.length1),n=0;t.indexOf(a)!=t.lastIndexOf(a)&&a.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)n+=this.Patch_Margin,a=t.substring(e.start2-n,e.start2+e.length1+n);n+=this.Patch_Margin,(a=t.substring(e.start2-n,e.start2))&&e.diffs.unshift(new diff_match_patch.Diff(DIFF_EQUAL,a)),(n=t.substring(e.start2+e.length1,e.start2+e.length1+n))&&e.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,n)),e.start1-=a.length,e.start2-=a.length,e.length1+=a.length+n.length,e.length2+=a.length+n.length}},diff_match_patch.prototype.patch_make=function(e,t,a){if("string"==typeof e&&"string"==typeof t&&"undefined"==typeof a){var n=e;t=this.diff_main(n,t,!0),2<t.length&&(this.diff_cleanupSemantic(t),this.diff_cleanupEfficiency(t))}else if(e&&"object"==typeof e&&"undefined"==typeof t&&"undefined"==typeof a)t=e,n=this.diff_text1(t);else if("string"==typeof e&&t&&"object"==typeof t&&"undefined"==typeof a)n=e;else{if("string"!=typeof e||"string"!=typeof t||!a||"object"!=typeof a)throw Error("Unknown call format to patch_make.");n=e,t=a}if(0===t.length)return[];a=[],e=new diff_match_patch.patch_obj;for(var i=0,o=0,r=0,s=n,l=0;l<t.length;l++){var u=t[l][0],d=t[l][1];switch(i||u===DIFF_EQUAL||(e.start1=o,e.start2=r),u){case DIFF_INSERT:e.diffs[i++]=t[l],e.length2+=d.length,n=n.substring(0,r)+d+n.substring(r);break;case DIFF_DELETE:e.length1+=d.length,e.diffs[i++]=t[l],n=n.substring(0,r)+n.substring(r+d.length);break;case DIFF_EQUAL:d.length<=2*this.Patch_Margin&&i&&t.length!=l+1?(e.diffs[i++]=t[l],e.length1+=d.length,e.length2+=d.length):d.length>=2*this.Patch_Margin&&i&&(this.patch_addContext_(e,s),a.push(e),e=new diff_match_patch.patch_obj,i=0,s=n,o=r)}u!==DIFF_INSERT&&(o+=d.length),u!==DIFF_DELETE&&(r+=d.length)}return i&&(this.patch_addContext_(e,s),a.push(e)),a},diff_match_patch.prototype.patch_deepCopy=function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a],i=new diff_match_patch.patch_obj;i.diffs=[];for(var o=0;o<n.diffs.length;o++)i.diffs[o]=new diff_match_patch.Diff(n.diffs[o][0],n.diffs[o][1]);i.start1=n.start1,i.start2=n.start2,i.length1=n.length1,i.length2=n.length2,t[a]=i}return t},diff_match_patch.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var a=this.patch_addPadding(e);t=a+t+a,this.patch_splitMax(e);for(var n=0,i=[],o=0;o<e.length;o++){var r=e[o].start2+n,s=this.diff_text1(e[o].diffs),l=-1;if(s.length>this.Match_MaxBits){var u=this.match_main(t,s.substring(0,this.Match_MaxBits),r);-1!=u&&(l=this.match_main(t,s.substring(s.length-this.Match_MaxBits),r+s.length-this.Match_MaxBits),-1==l||u>=l)&&(u=-1)}else u=this.match_main(t,s,r);if(-1==u)i[o]=!1,n-=e[o].length2-e[o].length1;else if(i[o]=!0,n=u-r,r=-1==l?t.substring(u,u+s.length):t.substring(u,l+this.Match_MaxBits),s==r)t=t.substring(0,u)+this.diff_text2(e[o].diffs)+t.substring(u+s.length);else if(r=this.diff_main(s,r,!1),s.length>this.Match_MaxBits&&this.diff_levenshtein(r)/s.length>this.Patch_DeleteThreshold)i[o]=!1;else{this.diff_cleanupSemanticLossless(r),s=0;var d;for(l=0;l<e[o].diffs.length;l++){var c=e[o].diffs[l];c[0]!==DIFF_EQUAL&&(d=this.diff_xIndex(r,s)),c[0]===DIFF_INSERT?t=t.substring(0,u+d)+c[1]+t.substring(u+d):c[0]===DIFF_DELETE&&(t=t.substring(0,u+d)+t.substring(u+this.diff_xIndex(r,s+c[1].length))),c[0]!==DIFF_DELETE&&(s+=c[1].length)}}}return t=t.substring(a.length,t.length-a.length),[t,i]},diff_match_patch.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,a="",n=1;n<=t;n++)a+=String.fromCharCode(n);for(n=0;n<e.length;n++)e[n].start1+=t,e[n].start2+=t;n=e[0];var i=n.diffs;if(0==i.length||i[0][0]!=DIFF_EQUAL)i.unshift(new diff_match_patch.Diff(DIFF_EQUAL,a)),n.start1-=t,n.start2-=t,n.length1+=t,n.length2+=t;else if(t>i[0][1].length){var o=t-i[0][1].length;i[0][1]=a.substring(i[0][1].length)+i[0][1],n.start1-=o,n.start2-=o,n.length1+=o,n.length2+=o}return n=e[e.length-1],i=n.diffs,0==i.length||i[i.length-1][0]!=DIFF_EQUAL?(i.push(new diff_match_patch.Diff(DIFF_EQUAL,a)),n.length1+=t,n.length2+=t):t>i[i.length-1][1].length&&(o=t-i[i.length-1][1].length,i[i.length-1][1]+=a.substring(0,o),n.length1+=o,n.length2+=o),a},diff_match_patch.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,a=0;a<e.length;a++)if(!(e[a].length1<=t)){var n=e[a];e.splice(a--,1);for(var i=n.start1,o=n.start2,r="";0!==n.diffs.length;){var s=new diff_match_patch.patch_obj,l=!0;for(s.start1=i-r.length,s.start2=o-r.length,""!==r&&(s.length1=s.length2=r.length,s.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,r)));0!==n.diffs.length&&s.length1<t-this.Patch_Margin;){r=n.diffs[0][0];var u=n.diffs[0][1];r===DIFF_INSERT?(s.length2+=u.length,o+=u.length,s.diffs.push(n.diffs.shift()),l=!1):r===DIFF_DELETE&&1==s.diffs.length&&s.diffs[0][0]==DIFF_EQUAL&&u.length>2*t?(s.length1+=u.length,i+=u.length,l=!1,s.diffs.push(new diff_match_patch.Diff(r,u)),n.diffs.shift()):(u=u.substring(0,t-s.length1-this.Patch_Margin),s.length1+=u.length,i+=u.length,r===DIFF_EQUAL?(s.length2+=u.length,o+=u.length):l=!1,s.diffs.push(new diff_match_patch.Diff(r,u)),u==n.diffs[0][1]?n.diffs.shift():n.diffs[0][1]=n.diffs[0][1].substring(u.length))}r=this.diff_text2(s.diffs),r=r.substring(r.length-this.Patch_Margin),u=this.diff_text1(n.diffs).substring(0,this.Patch_Margin),""!==u&&(s.length1+=u.length,s.length2+=u.length,0!==s.diffs.length&&s.diffs[s.diffs.length-1][0]===DIFF_EQUAL?s.diffs[s.diffs.length-1][1]+=u:s.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,u))),l||e.splice(++a,0,s)}}},diff_match_patch.prototype.patch_toText=function(e){for(var t=[],a=0;a<e.length;a++)t[a]=e[a];return t.join("")},diff_match_patch.prototype.patch_fromText=function(e){var t=[];if(!e)return t;e=e.split("\n");for(var a=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<e.length;){var i=e[a].match(n);if(!i)throw Error("Invalid patch string: "+e[a]);var o=new diff_match_patch.patch_obj;for(t.push(o),o.start1=parseInt(i[1],10),""===i[2]?(o.start1--,o.length1=1):"0"==i[2]?o.length1=0:(o.start1--,o.length1=parseInt(i[2],10)),o.start2=parseInt(i[3],10),""===i[4]?(o.start2--,o.length2=1):"0"==i[4]?o.length2=0:(o.start2--,o.length2=parseInt(i[4],10)),a++;a<e.length;){i=e[a].charAt(0);try{var r=decodeURI(e[a].substring(1))}catch(e){throw Error("Illegal escape in patch_fromText: "+r)}if("-"==i)o.diffs.push(new diff_match_patch.Diff(DIFF_DELETE,r));else if("+"==i)o.diffs.push(new diff_match_patch.Diff(DIFF_INSERT,r));else if(" "==i)o.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,r));else{if("@"==i)break;if(""!==i)throw Error('Invalid patch mode "'+i+'" in: '+r)}a++}}return t},diff_match_patch.patch_obj=function(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0},diff_match_patch.patch_obj.prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case DIFF_INSERT:e="+";break;case DIFF_DELETE:e="-";break;case DIFF_EQUAL:e=" "}t[a+1]=e+encodeURI(this.diffs[a][1])+"\n"}return t.join("").replace(/%20/g," ")},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL,define("3rdparty/diff_match_patch",function(){}),define("vvDiffManager",["vvUtility","3rdparty/diff_match_patch"],function(e){function t(){this.newDocument={state:null,ignore:[],diffReadableText:[],highlightRects:[]},this.oldDocument={state:null,ignore:[],diffReadableText:[],highlightRects:[]},this.changeObjects=[],this.showHighlights=!0,this.readyToDiff=!1,this.diffDisabled=!1,this.diffDisabledUntilSave=!1,this.diffIsComplete=!1,this.diffReportCallback=null,this.changeInFocus={added:{page:void 0,rects:[]},removed:{page:void 0,rects:[]}}}var a=new diff_match_patch;t.prototype.init=function(e,t){this.oldDocument.state=e,this.newDocument.state=t,this.processTextForDiff()},t.prototype.setDiffDisabled=function(e){this.diffDisabled=!!e},t.prototype.setDiffComplete=function(e){var t=this.diffIsComplete!==!!e;this.diffIsComplete=!!e,t&&this.diffIsComplete&&this.diffReportCallback&&this.diffReportCallback(this.getChangeReport())},t.prototype.getOldDocHighlightRects=function(e){if(this.diffDisabled||this.diffDisabledUntilSave)return[];if(this.oldDocument.highlightRects[e])return this.oldDocument.highlightRects[e];var t=n(this.oldDocument,this.changeObjects,DIFF_DELETE,e);return this.oldDocument.highlightRects[e]=t,t},t.prototype.getNewDocHighlightRects=function(e){if(this.diffDisabled||this.diffDisabledUntilSave)return[];if(this.newDocument.highlightRects[e])return this.newDocument.highlightRects[e];var t=n(this.newDocument,this.changeObjects,DIFF_INSERT,e);return this.newDocument.highlightRects[e]=t,t},t.prototype.focusOnChange=function(e,t){var a=this.changeObjects[e][t];return a[0]===DIFF_INSERT?(this.changeInFocus.added.page=e,this.changeInFocus.added.rects=this.getAllRectsOfChangeObject(e,t),this.changeInFocus.added.rects):(this.changeInFocus.removed.page=e,this.changeInFocus.removed.rects=this.getAllRectsOfChangeObject(e,t),this.changeInFocus.removed.rects)},t.prototype.getAllRectsOfChangeObject=function(e,t){this.newDocument.highlightRects[e]&&this.oldDocument.highlightRects[e]||(this.getNewDocHighlightRects(e),this.getOldDocHighlightRects(e));for(var a=this.changeObjects[e],n=a[t],i=0,o=0;o<t;o++){var r=a[o];r[0]===n[0]&&i++}return n[0]===DIFF_INSERT?this.newDocument.highlightRects[e][i]:this.oldDocument.highlightRects[e][i]};var n=function(e,t,a,n){var o=[],r=t[n];if(!r)return o;for(var s=0,l=0;l<r.length;l++){var u=r[l],d=s+u[1].length;if(u[0]===a){var c=e.state.pageStates[n].pageText.wordRects.slice(s,d),g=i(c);o.push(g),s=d}else u[0]===DIFF_EQUAL&&(s=d)}return o};t.prototype.allChangeObjectsToRects=function(e){if(!this.changeObjects[e])return[];for(var t=[],a=0,n=0,o=0;o<this.changeObjects[e].length;o++){var r,s,l=this.changeObjects[e][o];l[0]===DIFF_EQUAL?(r=a+l[1].length,s=this.oldDocument.state.pageStates[e].pageText.wordRects.slice(a,r),a=r,n+=l[1].length):l[0]===DIFF_INSERT?(r=n+l[1].length,s=this.newDocument.state.pageStates[e].pageText.wordRects.slice(n,r),n=r):l[0]===DIFF_DELETE&&(r=a+l[1].length,s=this.oldDocument.state.pageStates[e].pageText.wordRects.slice(a,r),a=r),l[2]=s,l[3]=i(s),t.push(l)}return t};var i=function(t){var a=null,n=[];if(!t||!t.length)return n;for(var i=0,o=0;o<t.length;o++)a?a.top!==t[o].top?(n.push(a),i++,a=new e.ImageRect(t[o].left,t[o].top,t[o].right,t[o].bottom)):a.right=t[o].right:(i++,a=new e.ImageRect(t[o].left,t[o].top,t[o].right,t[o].bottom));return!n.length!==i&&n.push(a),n};t.prototype.processPageTextForDiff=function(e){this.newDocument.state&&this.oldDocument.state&&!this.diffDisabled&&!this.diffDisabledUntilSave&&(o(this.newDocument,e),o(this.oldDocument,e))},t.prototype.processTextForDiff=function(){if(this.newDocument.state&&this.oldDocument.state&&this.newDocument.state.pageStates&&this.oldDocument.state.pageStates&&!this.diffDisabled&&!this.diffDisabledUntilSave){for(var e=0;e<this.newDocument.state.pageStates.length;e++)o(this.newDocument,e);for(e=0;e<this.oldDocument.state.pageStates.length;e++)o(this.oldDocument,e)}};var o=function(e,t){if(e.state&&e.state.pageStates[t]&&!(!e.state.getPageCount()>t)){if(null===e.state.getPageText(t))return void(e.diffReadableText[t]="");var a=e.state.getPageText(t).wordRects,n=a.map(function(e){var t=e.word,a=t.indexOf(";");return a>-1?t.slice(0,a+1):"&#"+t.charCodeAt(0)+";"}).join(""),i=$("<div></div>").html(n).text();e.diffReadableText[t]=i}};t.prototype.startDiff=function(){if(!this.diffDisabled&&!this.diffDisabledUntilSave)for(var e=0;e<Math.max(this.oldDocument.state.getPageCount(),this.newDocument.state.getPageCount());e++)this.diffPage(e)},t.prototype.diffPage=function(e){if(!this.diffDisabled&&!this.diffDisabledUntilSave){var t=this.oldDocument.diffReadableText[e]||"",n=this.newDocument.diffReadableText[e]||"";this.changeObjects[e]=a.diff_main(t,n),a.diff_cleanupSemantic(this.changeObjects[e]),this.changeObjects[e]&&this.changeObjects[e].length&&(this.oldDocument.highlightRects[e]=null,this.newDocument.highlightRects[e]=null)}},t.prototype.getChangeReport=function(){var e=$.templates("#documentCompareReportTemplate"),t=e.render(this.changeObjects),a=$("<div></div>").attr("id","vvDocumentCompareReport").append(t);return a[0]},t.prototype.displayChangeObjects=function(e,t){if(this.diffDisabled||this.diffDisabledUntilSave)return null;var a;e=e||0;for(var n=0;n<this.changeObjects.length;n++)if(a=r(n),n<e)a.children().length||($("<img />").attr("src","resources/loader.gif").appendTo(a),a.addClass("diffPageLoading").attr("aria-expanded","true"),this.setDiffComplete(!1));else{if(null===this.newDocument.state.getPageText(n)||null===this.oldDocument.state.getPageText(n))return a.empty(),$("<img />").attr("src","resources/loader.gif").appendTo(a),a.addClass("diffPageLoading").attr("aria-expanded","true"),this.setDiffComplete(!1),!1;this.fillPageChangeObjects(n,a),a.find(".vvChangeObject").on("click",t)}var i=0===$(".diffPageLoading").length;return this.setDiffComplete(i),i},t.prototype.fillDiffPane=function(t,a){return this.diffDisabledUntilSave?($("#vvDocCompareInternal").empty(),$("<div></div>").addClass("vvCannotDiffMessage").text(e.getLocalizedValue("documentCompare.cannotCompareUntilSave","Document compare will resume when cropped or reordered documents have been saved.")).appendTo("#vvDocCompareInternal"),!0):this.diffDisabled?($("#vvDocCompareInternal").empty(),$("<div></div>").addClass("vvCannotDiffMessage").text(e.getLocalizedValue("documentCompare.cannotCompare","These documents cannot be compared. One or more of them contains no text.")).appendTo("#vvDocCompareInternal"),!0):t||0===t?($("#vvLoadMoreButton").remove(),this.displayChangeObjects(t,a)):($("#vvDocCompareInternal").empty(),this.displayChangeObjects(0,a))};var r=function(t){var a=$("#vvDocCompareInternal .diffPageContainer[pageNumber='"+t+"']");return a.length||($("<a></a>").text(e.getLocalizedValue("thumbPageLabel","Page ")+(t+1)).attr({href:".diffPageContainer[pageNumber='"+t+"']",role:"button","data-toggle":"collapse",pageNumber:t}).addClass("vvDiffPageCollapseButton btn").on("dragstart",function(){return!1}).append("<span class='caret'></span>").appendTo("#vvDocCompareInternal"),a=$("<div></div>").addClass("diffPageContainer collapse").attr("pageNumber",t),a.appendTo("#vvDocCompareInternal"),$("<div></div>").addClass("vvDocComparePageDivider").appendTo("#vvDocCompareInternal")),a};t.prototype.fillPageChangeObjects=function(t,a){if(!this.changeObjects[t])return a;if(a.empty().removeClass("diffPageLoading"),1===this.changeObjects[t].length&&this.changeObjects[t][0][0]===DIFF_EQUAL){var n=$("<div></div").addClass("vvNoChangesObject");return $("<div></div>").addClass("vvChangedText").append($("<span></span>").text(e.getLocalizedValue("documentCompare.noChangesOnPage","No changes to display"))).appendTo(n),n.appendTo(a),a}for(var i=0;i<this.changeObjects[t].length;i++)if(this.changeObjects[t][i][0]!==DIFF_EQUAL&&13!==this.changeObjects[t][i][1].charCodeAt(0)){var o=s(this.changeObjects[t][i],i);o&&a.append(o)}return a};var s=function(t,a){var n=$("<div></div").addClass("vvChangeObject").data("changeIndex",a);$("<label></label>").addClass("vvChangeType").appendTo(n);var i=$("<div></div>").addClass("vvChangedText").addClass("ellipsis").append($("<span></span>").text(t[1])).appendTo(n),o=t[1];if(o=o.replace(/\u200B/g,""),0!==o.length)return 0===o.trim().length&&i.find("span").css("white-space","pre"),t[0]===DIFF_INSERT?(n.find(".vvChangeType").text(e.getLocalizedValue("documentCompare.changeTypes.added","Added")),n.addClass("vvChangeAdded"),n):t[0]===DIFF_DELETE?(n.find(".vvChangeType").text(e.getLocalizedValue("documentCompare.changeTypes.removed","Removed")),n.addClass("vvChangeRemoved"),n):void 0};return t}),define("vvLayerManager",["require","vvUtility","user-config/config","vvDefines","vvAnnotationManager","vvStateManager"],function(e,t,a,n){function i(){this.invisibleLayers=[],this.imageLayerVisibilityHasChanged=!1}var o="imageLayer-",r="annLayer-";i.prepareLayerDialog=function(){$("#vvImageLayersVisibleAll").on("click",function(e){e.stopPropagation(),P($("#vvImageLayersList").hasClass("vvAllLayerVisibilityNotSet"))}),$("#vvAnnLayersVisibleAll").on("click",function(e){e.stopPropagation(),P($("#vvAnnotationLayersList").hasClass("vvAllLayerVisibilityNotSet"),!0)}),a.enableConsolidateAnnotationLayer?$("#vvConsolidateLayersButton").on("click",function(){if("true"!==$(this).prop("disabled")){$(this).prop("disabled",!0);var e={layerName:"Master Layer",visibility:!0};$("#vvAnnotationLayersList .activeAnnLayer").removeClass("activeAnnLayer");var t=c(e,!0);t.addClass("vvConsolidatedLayerItem vvAnnLayerAdded"),$("#vvAnnotationLayersList").append(t)}}):$("#vvConsolidateLayersButton").remove(),$("#vvAnnLayersAdd").on("click",function(){var e=$("#vvAnnotationLayersList");return e.hasClass("vvAddingNewLayer")?void $("#vvAddNewLayerListItem input").focus():(e.addClass("vvAddingNewLayer"),void $("#vvAddNewLayerListItem input").focus())}),$("#vvAddNewLayerListItem .okButton").on("click",l),$("#vvAddNewLayerListItem .cancelButton").on("click",s),$("#vvLayerManagerOK").on("click",function(){d(),u(),$("#vvLayerManagerDiv").modal("hide")}),$("#vvLayerManagerCancel").on("click",function(){$("#vvLayerManagerDiv").modal("hide")})};var s=function(e){e.stopPropagation(),x(),$("#vvAnnotationLayersList").removeClass("vvAddingNewLayer")},l=function(e){e&&e.stopPropagation();var t=$("#vvAddNewLayerListItem input"),a=t.val();if(!C(a))return void A(t,!0);A(t,!1),t.val("");var n=$("#vvAnnotationLayersList");n.removeClass("vvAddingNewLayer vvEmptyOfLayers");var i={layerName:a,visibility:!0};$("#vvAnnotationLayersList .activeAnnLayer").removeClass("activeAnnLayer");var o=c(i,!0);o.addClass("vvAnnLayerAdded").appendTo(n),$("#vvAnnotationLayersList .vvConsolidatedLayerItem").length||$("#vvConsolidateLayersButton").prop("disabled",!1)},u=function(){var t=e("vvStateManager").getActivePaneState(),n=!1;if(!a.oneLayerPerAnnotation){$("#vvAnnotationLayersList .vvConsolidatedLayerItem").length&&($("#vvAnnotationLayersList .vvConsolidatedLayerItem").remove(),n=!0);for(var i=$(".vvLayerMarkedForDeletion"),o=0;o<i.length;o++){var s=$(i[o]).attr("id").slice(r.length);I(s,t),$(i[o]).remove()}for(var u=$(".vvLayerListItemEditing"),d=0;d<u.length;d++)h(null,$(u[d]));var c=$("#vvAnnotationLayersList");c.hasClass("vvAddingNewLayer")&&(l(),$("#vvAddNewLayerListItem input").val(""),c.removeClass("vvAddingNewLayer"));for(var g=t.getPageNumber(),v=$("#vvAnnotationLayersList .vvLayerListItem").not("#vvAddNewLayerListItem, .vvEmptyLayerItem"),p=!1,f=null,m=v.length,y=0;y<m;y++){var b=$(v[y]),A=$(b).attr("id");if(A){var P,T=A.slice(r.length),C=b.find(".vvLayerNameText").text().trim();if(b.hasClass("vvAnnLayerAdded")?(T=C,P=e("vvAnnotationManager").createLayer(T,g,t),D(P,t)):P=t.getLayerFromPage(g,T),P){var x=$(b).hasClass("vvLayerVisible")&&!c.hasClass("vvAllLayersInvisible");x!==P.visibility&&S(T,x,t),C===T||$(b).hasClass(".vvLayerListItemEditing")||w(T,C,t),p&&D(P),b.hasClass("activeAnnLayer")&&(f=P)}}}f&&t.setCurrentLayer(f),n&&m&&virtualViewer.consolidateAnnotationLayers(),virtualViewer.fillAnnotationList(),virtualViewer.delayedPaintCanvases()}},d=function(){var t=e("vvStateManager"),a=t.getActivePaneState().getLayerManager();if(t.getActivePaneState().imageLayers&&t.getActivePaneState().imageLayers.length){for(var n=$("#vvImageLayersList .vvLayerListItem.vvLayerInvisible"),i=[],r=a.invisibleLayers.length,s=0;s<n.length;s++){var l=n.eq(s).attr("id");if(l){var u=l.slice(o.length),d=a.invisibleLayers.indexOf(u);d>-1&&a.invisibleLayers.splice(d,1),i.push(u)}}return a.invisibleLayers.length||i.length>r?(a.invisibleLayers=i,a.imageLayerVisibilityHasChanged=!0,void virtualViewer.paintCanvases()):void(a.invisibleLayers=i)}};i.prototype.showLayerDialog=function(e){this.clearLayerDialog(),this.fillLayerDialog(e),$("#vvLayerManagerDiv").modal("show")},i.prototype.clearLayerDialog=function(){$(".vvLayerListItem").remove(),$(".vvLayerMarkedForDeletion").remove(),x()},i.prototype.fillLayerDialog=function(e){T(!1,!0);var t=this.fillAnnotationLayers(e),a=this.fillImageLayers(e);a&&t?($("#vvLayerManagerTabs").show(),$("#vvImageLayersTab a").tab("show")):a&&!t?($("#vvImageLayersTab a").tab("show"),$("#vvLayerManagerTabs").hide()):($("#vvAnnotationLayersTab a").tab("show"),$("#vvLayerManagerTabs").hide())},i.prototype.fillImageLayers=function(t){t||(t=e("vvStateManager").getActivePaneState());var a=t.imageLayers;if(!a||!a.length)return!1;for(var n=0;n<a.length;n++)$("#vvImageLayersList").append(this.imageLayerItem(a[n].layer,a[n].color));return!0},i.prototype.imageLayerItem=function(e,a){if(!e)return $();var n=e;$.isNumeric(e)&&(n=t.getLocalizedValue("layerManager.numericLayerLabel","Layer ")+e);var i={color:a||"white",layerName:n,canHide:!0,layerHidden:this.invisibleLayers.indexOf(e)>-1},r=$.templates("#singleLayerItemTemplate"),s=$(r.render(i));return s.attr("id",o+e),s.find(".vvLayerVisButton").on("click",function(e){e.stopPropagation(),$(this).parents(".vvLayerListItem").toggleClass("vvLayerVisible").toggleClass("vvLayerInvisible"),T(!1)}),s},i.prototype.fillAnnotationLayers=function(i){var o=$("#vvAnnotationLayersList");if(a.oneLayerPerAnnotation)return o.addClass("vvEmptyOfLayers"),$("#vvAnnLayersHeadButtons .btn").attr("disabled",!0),!1;$("#vvAnnLayersHeadButtons .btn").attr("disabled",!1),i=i||e("vvStateManager").getActivePaneState();var r=i.getLayerNames(),s=!1,l=0,u=i.getPageNumber(),d="";e("vvAnnotationManager").getCurrentLayer()&&(d=e("vvAnnotationManager").getCurrentLayer().layerName);for(var g=0;g<r.length;g++){var v=r[g],p=i.getLayerFromPage(u,v);if(p&&(!t.isRedactionLayer(p)||!n.hideRedactionLayerFromManager)){"Master Layer"===v&&(s=!0);var h=!1;p.layerName===d&&(h=!0),p&&p.permissionLevel>n.permissionLevels.PERM_VIEW&&(o.append(c(p,h)),l+=1)}}return l?o.removeClass("vvEmptyOfLayers"):o.addClass("vvEmptyOfLayers"),s||!l?$("#vvConsolidateLayersButton").prop("disabled",!0):$("#vvConsolidateLayersButton").prop("disabled",!1),!0};var c=function(a,i){var o=a.layerName,s=o.indexOf("Master Layer")>-1;s&&$("#vvConsolidateLayersButton").prop("disabled",!0);var l=o;$.isNumeric(o)&&(l=t.getLocalizedValue("layerManager.numericLayerLabel","Layer ")+o);var u={layerName:l,canEdit:e("vvAnnotationManager").checkLayerPermission(a,n.permissionLevels.PERM_EDIT)&&!s,canDelete:e("vvAnnotationManager").checkLayerPermission(a,n.permissionLevels.PERM_DELETE),canHide:!t.isRedactionLayer(a),layerHidden:!a.visibility||$("#vvAnnotationLayersList").hasClass("vvAllLayersInvisible")},d=$.templates("#singleLayerItemTemplate"),c=$(d.render(u));return c.attr("id",r+o),c.find(".vvLayerText").on("click",v),c.on("click",f),c.find(".vvLayerVisButton").on("click",g),c.find(".vvAnnDeleteLayerButton").on("click",m),c.find(".vvEditLayerNameDiv .okButton").on("click",h),c.find(".vvEditLayerNameDiv .cancelButton").on("click",p),c.find(".vvDeleteLayerConfirmation .okButton").on("click",y),c.find(".vvDeleteLayerConfirmation .cancelButton").on("click",b),i&&c.addClass("activeAnnLayer"),c},g=function(e){e.stopPropagation(),$(this).parents(".vvLayerListItem").toggleClass("vvLayerVisible").toggleClass("vvLayerInvisible"),T(!0)},v=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");$(t).addClass("vvLayerListItemEditing"),$(t).find(".vvEditLayerNameDiv input").focus()},p=function(e){e.stopPropagation(),x();var t=$(this).parents(".vvLayerListItem");t.removeClass("vvLayerListItemEditing");var a=t.find(".vvEditLayerNameDiv input");A(a,!1),a.val("")},h=function(e,t){var a=null;e?(e.stopPropagation(),a=$(this).parents(".vvLayerListItem")):a=t;var n=a.find(".vvEditLayerNameDiv input"),i=a.find(".vvLayerNameText"),o=n.val(),r=i.text();return o===r||C(o)?(A(n,!1),n.val(""),a.removeClass("vvLayerListItemEditing"),void i.text(o)):void A(n,!0)},f=function(e){$("#vvAnnotationLayersList .activeAnnLayer").removeClass("activeAnnLayer"),$(this).addClass("activeAnnLayer")},m=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");t.addClass("vvLayerDeletionInquiry")},y=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");if(t.addClass("vvLayerMarkedForDeletion"),t.removeClass("vvLayerDeletionInquiry"),t.removeClass("vvLayerListItem"),$(t).hasClass("activeAnnLayer")){$(t).removeClass("activeAnnLayer");var a=$("#vvAnnotationLayersList .vvLayerListItem");a.length?$($(a)[0]).addClass("activeAnnLayer"):($("#vvAnnotationLayersList").addClass("vvEmptyOfLayers"),$("#vvConsolidateLayersButton").prop("disabled",!0))}var n=$(t).get(0).id.indexOf("Master Layer")>-1;($(t).hasClass("vvConsolidatedLayerItem")||n)&&$("#vvConsolidateLayersButton").prop("disabled",!1),t.hasClass("vvAnnLayerAdded")&&t.remove()},b=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");t.removeClass("vvLayerDeletionInquiry")},A=function(e,a){return a?($(e).attr("aria-invalid",!0),void x(t.getLocalizedValue("errors.invalidLayerName","Invalid layer name. Please choose a new layer name."))):($(e).attr("aria-invalid",!1),void x())},P=function(e,t){var a;a=t?$("#vvAnnotationLayersList"):$("#vvImageLayersList"),a.toggleClass("vvAllLayerVisibilityNotSet",!e).toggleClass("vvAllLayersInvisible",e),a.find(".vvLayerListItem").toggleClass("vvLayerInvisible",e).toggleClass("vvLayerVisible",!e)},T=function(e,t){var a;a=t?$("#vvImageLayersList, #vvAnnotationLayersList"):e?$("#vvAnnotationLayersList"):$("#vvImageLayersList"),a.toggleClass("vvAllLayerVisibilityNotSet",!0).toggleClass("vvAllLayersInvisible",!1)};i.prototype.toggleAllAnnotationLayersVisibility=function(e,t){t||(t=virtualViewer.getActivePaneState());var a=t.getLayerNames();if("undefined"==typeof e&&a.length>0){var n=t.getLayerFromPage(0,a[0]);e=!n.visibility}for(var i=0;i<a.length;i++)S(a[i],e,t);virtualViewer.delayedPaintCanvases()};var S=function(t,a,n){n||(n=e("vvStateManager").getActivePaneState());for(var i=0;i<n.getPageCount();i++){var o=n.getLayerFromPage(i,t);o&&(o.visibility=a)}virtualViewer.setPreviousAnnObject(virtualViewer.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null)},w=function(t,a,n){n||(n=e("vvStateManager").getActivePaneState()),e("vvAnnotationManager").renameLayerCore(t,a),n.renameLayer(t,a),n.getDocumentModel().renameLayer(t,a)},I=function(t,a){a||(a=e("vvStateManager").getActivePaneState());var n=a.getLayerNames(),i=n.indexOf(t);n.splice(i,1),a.setLayerNames(n),a.deleteLayer(t)},C=function(e){if(!e)return!1;if(e.length>50)return!1;for(var t=$(".vvLayerNameText"),a=0;a<t.length;a++)if(t.eq(a).text()===e)return!1;return!0},D=function(t,a){a||(a=e("vvStateManager").getActivePaneState()),a.getDocumentModel().markLayerDirty(t)},x=function(e){return e?($("#vvLayerManagerErrorBanner").show(),void $("#vvLayerManagerErrorBanner > span").text(e)):($("#vvLayerManagerErrorBanner > span").empty(),void $("#vvLayerManagerErrorBanner").hide())};return i.prototype.getHiddenImageLayers=function(e){if(!this.invisibleLayers.length)return null;if(!e)return this.invisibleLayers.join(",");for(var t=[],a=0;a<this.invisibleLayers.length;a++)t.push(encodeURIComponent(this.invisibleLayers[a]));return t.join(",")},i}),!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("3rdparty/pica.min",[],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pica=e()}(function(){return function e(t,a,n){function i(r,s){if(!a[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var d=a[r]={exports:{}};t[r][0].call(d.exports,function(e){var a=t[r][1][e];return i(a||e)},d,d.exports,e,t,a,n)}return a[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}({1:[function(e,t,a){"use strict";function n(e){var t=e||[],a={js:0<=t.indexOf("js"),wasm:0<=t.indexOf("wasm")};o.call(this,a),this.features={js:a.js,wasm:a.wasm&&this.has_wasm},this.use(r),this.use(s)}var i=e("inherits"),o=e("multimath"),r=e("multimath/lib/unsharp_mask"),s=e("./mm_resize");i(n,o),n.prototype.resizeAndUnsharp=function(e,t){var a=this.resize(e,t);return e.unsharpAmount&&this.unsharp_mask(a,e.toWidth,e.toHeight,e.unsharpAmount,e.unsharpRadius,e.unsharpThreshold),a},t.exports=n},{"./mm_resize":4,inherits:15,multimath:16,"multimath/lib/unsharp_mask":19}],2:[function(e,t,a){"use strict";function n(e){return e<0?0:255<e?255:e}t.exports={convolveHorizontally:function(e,t,a,i,o,r){var s,l,u,d,c,g,v,p,h,f,m,y=0,b=0;for(h=0;h<i;h++){for(f=c=0;f<o;f++){for(g=r[c++],v=r[c++],p=y+4*g|0,s=l=u=d=0;0<v;v--)d=d+(m=r[c++])*e[p+3]|0,u=u+m*e[p+2]|0,l=l+m*e[p+1]|0,s=s+m*e[p]|0,p=p+4|0;t[b+3]=n(d+8192>>14),t[b+2]=n(u+8192>>14),t[b+1]=n(l+8192>>14),t[b]=n(s+8192>>14),b=b+4*i|0}b=4*(h+1)|0,y=(h+1)*a*4|0}},convolveVertically:function(e,t,a,i,o,r){var s,l,u,d,c,g,v,p,h,f,m,y=0,b=0;for(h=0;h<i;h++){for(f=c=0;f<o;f++){for(g=r[c++],v=r[c++],p=y+4*g|0,s=l=u=d=0;0<v;v--)d=d+(m=r[c++])*e[p+3]|0,u=u+m*e[p+2]|0,l=l+m*e[p+1]|0,s=s+m*e[p]|0,p=p+4|0;t[b+3]=n(d+8192>>14),t[b+2]=n(u+8192>>14),t[b+1]=n(l+8192>>14),t[b]=n(s+8192>>14),
b=b+4*i|0}b=4*(h+1)|0,y=(h+1)*a*4|0}}}},{}],3:[function(e,t,a){"use strict";t.exports="AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw=="},{}],4:[function(e,t,a){"use strict";t.exports={name:"resize",fn:e("./resize"),wasm_fn:e("./resize_wasm"),wasm_src:e("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(e,t,a){"use strict";var n=e("./resize_filter_gen"),i=e("./convolve").convolveHorizontally,o=e("./convolve").convolveVertically;t.exports=function(e){var t=e.src,a=e.width,r=e.height,s=e.toWidth,l=e.toHeight,u=e.scaleX||e.toWidth/e.width,d=e.scaleY||e.toHeight/e.height,c=e.offsetX||0,g=e.offsetY||0,v=e.dest||new Uint8Array(s*l*4),p=void 0===e.quality?3:e.quality,h=e.alpha||!1,f=n(p,a,s,u,c),m=n(p,r,l,d,g),y=new Uint8Array(s*r*4);return i(t,y,a,r,s,f),o(y,v,r,s,l,m),h||function(e,t,a){for(var n=3,i=t*a*4|0;n<i;)e[n]=255,n=n+4|0}(v,s,l),v}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(e,t,a){"use strict";function n(e){return Math.round(e*((1<<o)-1))}var i=e("./resize_filter_info"),o=14;t.exports=function(e,t,a,o,r){var s,l,u,d,c,g,v,p,h,f,m,y,b,A,P,T,S,w=i[e].filter,I=1/o,C=Math.min(1,o),D=i[e].win/C,x=Math.floor(2*(D+1)),M=new Int16Array((x+2)*a),N=0,L=!M.subarray||!M.set;for(s=0;s<a;s++){for(l=(s+.5)*I+r,u=Math.max(0,Math.floor(l-D)),c=(d=Math.min(t-1,Math.ceil(l+D)))-u+1,g=new Float32Array(c),v=new Int16Array(c),h=u,f=p=0;h<=d;h++,f++)p+=m=w((h+.5-l)*C),g[f]=m;for(f=y=0;f<g.length;f++)y+=b=g[f]/p,v[f]=n(b);for(v[a>>1]+=n(1-y),A=0;A<v.length&&0===v[A];)A++;if(A<v.length){for(P=v.length-1;0<P&&0===v[P];)P--;if(T=u+A,S=P-A+1,M[N++]=T,M[N++]=S,L)for(f=A;f<=P;f++)M[N++]=v[f];else M.set(v.subarray(A,P+1),N),N+=S}else M[N++]=0,M[N++]=0}return M}},{"./resize_filter_info":7}],7:[function(e,t,a){"use strict";t.exports=[{win:.5,filter:function(e){return-.5<=e&&e<.5?1:0}},{win:1,filter:function(e){if(e<=-1||1<=e)return 0;if(-1.1920929e-7<e&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*(.54+.46*Math.cos(t/1))}},{win:2,filter:function(e){if(e<=-2||2<=e)return 0;if(-1.1920929e-7<e&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/2)/(t/2)}},{win:3,filter:function(e){if(e<=-3||3<=e)return 0;if(-1.1920929e-7<e&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/3)/(t/3)}}]},{}],8:[function(e,t,a){"use strict";function n(e,t,a){if(o)t.set((n=e,new Uint8Array(n.buffer,0,n.byteLength)),a);else for(var n,i=a,r=0;r<e.length;r++){var s=e[r];t[i++]=255&s,t[i++]=s>>8&255}}var i=e("./resize_filter_gen"),o=!0;try{o=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(e){}t.exports=function(e){var t=e.src,a=e.width,o=e.height,r=e.toWidth,s=e.toHeight,l=e.scaleX||e.toWidth/e.width,u=e.scaleY||e.toHeight/e.height,d=e.offsetX||0,c=e.offsetY||0,g=e.dest||new Uint8Array(r*s*4),v=void 0===e.quality?3:e.quality,p=e.alpha||!1,h=i(v,a,r,l,d),f=i(v,o,s,u,c),m=this.__align(0+Math.max(t.byteLength,g.byteLength)),y=this.__align(m+o*r*4),b=this.__align(y+h.byteLength),A=b+f.byteLength,P=this.__instance("resize",A),T=new Uint8Array(this.__memory.buffer),S=new Uint32Array(this.__memory.buffer),w=new Uint32Array(t.buffer);return S.set(w),n(h,T,y),n(f,T,b),(P.exports.convolveHV||P.exports._convolveHV)(y,b,m,a,o,r,s),new Uint32Array(g.buffer).set(new Uint32Array(this.__memory.buffer,0,s*r)),p||function(e,t,a){for(var n=3,i=t*a*4|0;n<i;)e[n]=255,n=n+4|0}(g,r,s),g}},{"./resize_filter_gen":6}],9:[function(e,t,a){"use strict";function n(e,t){this.create=e,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=t||2e3}n.prototype.acquire=function(){var e=this,t=void 0;return 0!==this.available.length?t=this.available.pop():((t=this.create()).id=this.lastId++,t.release=function(){return e.release(t)}),this.acquired[t.id]=t},n.prototype.release=function(e){var t=this;delete this.acquired[e.id],e.lastUsed=Date.now(),this.available.push(e),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return t.gc()},100))},n.prototype.gc=function(){var e=this,t=Date.now();this.available=this.available.filter(function(a){return!(t-a.lastUsed>e.idle&&(a.destroy(),1))}),0!==this.available.length?this.timeoutId=setTimeout(function(){return e.gc()},100):this.timeoutId=0},t.exports=n},{}],10:[function(e,t,a){"use strict";t.exports=function(e,t,a,n,i,o){var r=a/e,s=n/t,l=(2*o+2+1)/i;if(.5<l)return[[a,n]];var u=Math.ceil(Math.log(Math.min(r,s))/Math.log(l));if(u<=1)return[[a,n]];for(var d=[],c=0;c<u;c++){var g=Math.round(Math.pow(Math.pow(e,u-c-1)*Math.pow(a,c+1),1/u)),v=Math.round(Math.pow(Math.pow(t,u-c-1)*Math.pow(n,c+1),1/u));d.push([g,v])}return d}},{}],11:[function(e,t,a){"use strict";function n(e){var t=Math.round(e);return Math.abs(e-t)<o?t:Math.floor(e)}function i(e){var t=Math.round(e);return Math.abs(e-t)<o?t:Math.ceil(e)}var o=1e-5;t.exports=function(e){var t,a,o,r,s,l,u=e.toWidth/e.width,d=e.toHeight/e.height,c=n(e.srcTileSize*u)-2*e.destTileBorder,g=n(e.srcTileSize*d)-2*e.destTileBorder;if(c<1||g<1)throw new Error("Internal error in pica: target tile width/height is too small.");var v,p=[];for(r=0;r<e.toHeight;r+=g)for(o=0;o<e.toWidth;o+=c)(t=o-e.destTileBorder)<0&&(t=0),t+(s=o+c+e.destTileBorder-t)>=e.toWidth&&(s=e.toWidth-t),(a=r-e.destTileBorder)<0&&(a=0),a+(l=r+g+e.destTileBorder-a)>=e.toHeight&&(l=e.toHeight-a),v={toX:t,toY:a,toWidth:s,toHeight:l,toInnerX:o,toInnerY:r,toInnerWidth:c,toInnerHeight:g,offsetX:t/u-n(t/u),offsetY:a/d-n(a/d),scaleX:u,scaleY:d,x:n(t/u),y:n(a/d),width:i(s/u),height:i(l/d)},p.push(v);return p}},{}],12:[function(e,t,a){"use strict";function n(e){return Object.prototype.toString.call(e)}t.exports.isCanvas=function(e){var t=n(e);return"[object HTMLCanvasElement]"===t||"[object Canvas]"===t},t.exports.isImage=function(e){return"[object HTMLImageElement]"===n(e)},t.exports.limiter=function(e){function t(){a<e&&n.length&&(a++,n.shift()())}var a=0,n=[];return function(e){return new Promise(function(i,o){n.push(function(){e().then(function(e){i(e),a--,t()},function(e){o(e),a--,t()})}),t()})}},t.exports.cib_quality_name=function(e){switch(e){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},t.exports.cib_support=function(){return Promise.resolve().then(function(){if("undefined"==typeof createImageBitmap||"undefined"==typeof document)return!1;var e=document.createElement("canvas");return e.width=100,e.height=100,createImageBitmap(e,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(t){var a=10===t.width;return t.close(),e=null,a})}).catch(function(){return!1})}},{}],13:[function(e,t,a){"use strict";t.exports=function(){var t=e("./mathlib"),a=void 0;onmessage=function(e){var n=e.data.opts;a||(a=new t(e.data.features));var i=a.resizeAndUnsharp(n);postMessage({result:i},[i.buffer])}}},{"./mathlib":1}],14:[function(e,t,a){function n(e,t,a,n,i,o){var r,s,l,u,d,c,g,v,p,h,f,m,y,b;for(p=0;p<o;p++){for(v=0,u=d=(r=e[c=(g=p)*i])*n[6],f=n[0],m=n[1],y=n[4],b=n[5],h=0;h<i;h++)l=(s=e[c])*f+r*m+u*y+d*b,d=u,u=l,r=s,a[v]=u,v++,c++;for(v--,g+=o*(i-1),u=d=(r=e[--c])*n[7],s=r,f=n[2],m=n[3],h=i-1;0<=h;h--)l=s*f+r*m+u*y+d*b,d=u,u=l,r=s,s=e[c],t[g]=a[v]+u,c--,v--,g-=o}}var i,o,r,s,l,u;t.exports=function(e,t,a,d){if(d){var c=new Uint16Array(e.length),g=new Float32Array(Math.max(t,a)),v=function(e){e<.5&&(e=.5);var t=Math.exp(.527076)/e,a=Math.exp(-t),n=Math.exp(-2*t),d=(1-a)*(1-a)/(1+2*t*a-n);return o=(i=d)*(t-1)*a,r=d*(t+1)*a,s=-d*n,l=2*a,u=-n,new Float32Array([i,o,r,s,l,u,(i+o)/(1-l-u),(r+s)/(1-l-u)])}(d);n(e,c,g,v,t,a),n(c,e,g,v,a,t)}}},{}],15:[function(e,t,a){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var a=function(){};a.prototype=t.prototype,e.prototype=new a,e.prototype.constructor=e}},{}],16:[function(e,t,a){"use strict";function n(e){if(!(this instanceof n))return new n(e);var t=i({},s,e||{});if(this.options=t,this.__cache={},this.has_wasm=r(),this.__init_promise=null,this.__modules=t.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}var i=e("object-assign"),o=e("./lib/base64decode"),r=e("./lib/wa_detect"),s={js:!0,wasm:!0};n.prototype.use=function(e){return this.__modules[e.name]=e,this.has_wasm&&this.options.wasm&&e.wasm_fn?this[e.name]=e.wasm_fn:this[e.name]=e.fn,this},n.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm)return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var e=this;return this.__init_promise=Promise.all(Object.keys(e.__modules).map(function(t){var a=e.__modules[t];return e.has_wasm&&e.options.wasm&&a.wasm_fn?e.__wasm[t]?null:WebAssembly.compile(e.__base64decode(a.wasm_src)).then(function(a){e.__wasm[t]=a}):null})).then(function(){return e}),this.__init_promise},n.prototype.__base64decode=o,n.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/65536)),this.__memory},n.prototype.__instance=function(e,t,a){if(t&&this.__reallocate(t),!this.__wasm[e]){var n=this.__modules[e];this.__wasm[e]=new WebAssembly.Module(this.__base64decode(n.wasm_src))}if(!this.__cache[e]){var o={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:i(o,a||{})})}return this.__cache[e]},n.prototype.__align=function(e,t){var a=e%(t=t||8);return e+(a?t-a:0)},t.exports=n},{"./lib/base64decode":17,"./lib/wa_detect":23,"object-assign":24}],17:[function(e,t,a){"use strict";t.exports=function(e){for(var t=e.replace(/[\r\n=]/g,""),a=t.length,n=new Uint8Array(3*a>>2),i=0,o=0,r=0;r<a;r++)r%4==0&&r&&(n[o++]=i>>16&255,n[o++]=i>>8&255,n[o++]=255&i),i=i<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(t.charAt(r));var s=a%4*6;return 0===s?(n[o++]=i>>16&255,n[o++]=i>>8&255,n[o++]=255&i):18===s?(n[o++]=i>>10&255,n[o++]=i>>2&255):12===s&&(n[o++]=i>>4&255),n}},{}],18:[function(e,t,a){"use strict";t.exports=function(e,t,a){for(var n,i,o,r,s,l=t*a,u=new Uint16Array(l),d=0;d<l;d++)n=e[4*d],i=e[4*d+1],o=e[4*d+2],s=i<=n&&o<=n?n:o<=i&&n<=i?i:o,r=n<=i&&n<=o?n:i<=o&&i<=n?i:o,u[d]=257*(s+r)>>1;return u}},{}],19:[function(e,t,a){"use strict";t.exports={name:"unsharp_mask",fn:e("./unsharp_mask"),wasm_fn:e("./unsharp_mask_wasm"),wasm_src:e("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":20,"./unsharp_mask_wasm":21,"./unsharp_mask_wasm_base64":22}],20:[function(e,t,a){"use strict";var n=e("glur/mono16"),i=e("./hsl_l16");t.exports=function(e,t,a,o,r,s){var l,u,d,c,g,v,p,h,f,m,y,b,A;if(!(0===o||r<.5)){2<r&&(r=2);var P=i(e,t,a),T=new Uint16Array(P);n(T,t,a,r);for(var S=o/100*4096+.5|0,w=257*s|0,I=t*a,C=0;C<I;C++)b=2*(P[C]-T[C]),Math.abs(b)>=w&&(l=e[A=4*C],u=e[A+1],d=e[A+2],v=257*((h=u<=l&&d<=l?l:l<=u&&d<=u?u:d)+(p=l<=u&&l<=d?l:u<=l&&u<=d?u:d))>>1,p===h?c=g=0:(g=v<=32767?4095*(h-p)/(h+p)|0:4095*(h-p)/(510-h-p)|0,c=l===h?65535*(u-d)/(6*(h-p))|0:u===h?21845+(65535*(d-l)/(6*(h-p))|0):43690+(65535*(l-u)/(6*(h-p))|0)),65535<(v+=S*b+2048>>12)?v=65535:v<0&&(v=0),0===g?l=u=d=v>>8:(f=2*v-(m=v<=32767?v*(4096+g)+2048>>12:v+((65535-v)*g+2048>>12))>>8,m>>=8,l=43690<=(y=c+21845&65535)?f:32767<=y?f+(6*(m-f)*(43690-y)+32768>>16):10922<=y?m:f+(6*(m-f)*y+32768>>16),u=43690<=(y=65535&c)?f:32767<=y?f+(6*(m-f)*(43690-y)+32768>>16):10922<=y?m:f+(6*(m-f)*y+32768>>16),d=43690<=(y=c-21845&65535)?f:32767<=y?f+(6*(m-f)*(43690-y)+32768>>16):10922<=y?m:f+(6*(m-f)*y+32768>>16)),e[A]=l,e[A+1]=u,e[A+2]=d)}}},{"./hsl_l16":18,"glur/mono16":14}],21:[function(e,t,a){"use strict";t.exports=function(e,t,a,n,i,o){if(!(0===n||i<.5)){2<i&&(i=2);var r=t*a,s=4*r,l=2*r,u=2*r,d=4*Math.max(t,a),c=s,g=c+l,v=g+u,p=v+u,h=p+d,f=this.__instance("unsharp_mask",s+l+2*u+d+32,{exp:Math.exp}),m=new Uint32Array(e.buffer);new Uint32Array(this.__memory.buffer).set(m);var y=f.exports.hsl_l16||f.exports._hsl_l16;y(0,c,t,a),(y=f.exports.blurMono16||f.exports._blurMono16)(c,g,v,p,h,t,a,i),(y=f.exports.unsharp||f.exports._unsharp)(0,0,c,g,t,a,n,o),m.set(new Uint32Array(this.__memory.buffer,0,r))}}},{}],22:[function(e,t,a){"use strict";t.exports="AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL"},{}],23:[function(e,t,a){"use strict";var n;t.exports=function(){if(void 0!==n)return n;if(n=!1,"undefined"==typeof WebAssembly)return n;try{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)&&(n=!0),n}catch(e){}return n}},{}],24:[function(e,t,a){"use strict";var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},a=0;a<10;a++)t["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var a,r,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var u in a=Object(arguments[l]))i.call(a,u)&&(s[u]=a[u]);if(n){r=n(a);for(var d=0;d<r.length;d++)o.call(a,r[d])&&(s[r[d]]=a[r[d]])}}return s}},{}],25:[function(e,t,a){var n=arguments[3],i=arguments[4],o=arguments[5],r=JSON.stringify;t.exports=function(e,t){for(var a,s=Object.keys(o),l=0,u=s.length;l<u;l++){var d=s[l],c=o[d].exports;if(c===e||c&&c.default===e){a=d;break}}if(!a){a=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var g={};for(l=0,u=s.length;l<u;l++)g[d=s[l]]=d;i[a]=["function(require,module,exports){"+e+"(self); }",g]}var v=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[a]=a,i[v]=["function(require,module,exports){var f = require("+r(a)+");(f.default ? f.default : f)(self);}",p];var h={};!function e(t){h[t]=!0;for(var a in i[t][1]){var n=i[t][1][a];h[n]||e(n)}}(v);var f="("+n+")({"+Object.keys(h).map(function(e){return r(e)+":["+i[e][0]+","+r(i[e][1])+"]"}).join(",")+"},{},["+r(v)+"])",m=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([f],{type:"text/javascript"});if(t&&t.bare)return y;var b=m.createObjectURL(y),A=new Worker(b);return A.objectURL=b,A}},{}],"/":[function(e,t,a){"use strict";function n(){return{value:s(c),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){var e=window.URL||window.webkitURL||window.mozURL||window.msURL;e&&e.revokeObjectURL&&this.value.objectURL&&e.revokeObjectURL(this.value.objectURL)}}}}function i(e){if(!(this instanceof i))return new i(e);this.options=r({},m,e||{});var t="lk_"+this.options.concurrency;this.__limit=p[t]||d.limiter(this.options.concurrency),p[t]||(p[t]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}var o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,i=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=e("object-assign"),s=e("webworkify"),l=e("./lib/mathlib"),u=e("./lib/pool"),d=e("./lib/utils"),c=e("./lib/worker"),g=e("./lib/stepper"),v=e("./lib/tiler"),p={},h=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(h=0<=navigator.userAgent.indexOf("Safari"))}catch(e){}var f=1;"undefined"!=typeof navigator&&(f=Math.min(navigator.hardwareConcurrency||1,4));var m={tile:1024,concurrency:f,features:["js","wasm","ww"],idle:2e3},y={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},b=void 0,A=void 0;i.prototype.init=function(){var t=this;if(this.__initPromise)return this.__initPromise;if(!1!==b&&!0!==b&&(b=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),b=!0}catch(e){}!1!==A&&!0!==A&&(A=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?A=!0:this.debug("ImageBitmap does not support .close(), disabled")));var a=this.options.features.slice();if(0<=a.indexOf("all")&&(a=["cib","wasm","js","ww"]),this.__requested_features=a,this.__mathlib=new l(a),0<=a.indexOf("ww")&&"undefined"!=typeof window&&"Worker"in window)try{e("webworkify")(function(){}).terminate(),this.features.ww=!0;var i="wp_"+JSON.stringify(this.options);p[i]?this.__workersPool=p[i]:(this.__workersPool=new u(n,this.options.idle),p[i]=this.__workersPool)}catch(e){}var o=this.__mathlib.init().then(function(e){r(t.features,e.features)}),s=void 0;return s=A?d.cib_support().then(function(e){t.features.cib&&a.indexOf("cib")<0?t.debug("createImageBitmap() resize supported, but disabled by config"):0<=a.indexOf("cib")&&(t.features.cib=e)}):Promise.resolve(!1),this.__initPromise=Promise.all([o,s]).then(function(){return t}),this.__initPromise},i.prototype.resize=function(e,t,a){var n=this;this.debug("Start resize...");var i=r({},y);isNaN(a)?a&&(i=r(i,a)):i=r(i,{quality:a}),i.toWidth=t.width,i.toHeight=t.height,i.width=e.naturalWidth||e.width,i.height=e.naturalHeight||e.height,2<i.unsharpRadius&&(i.unsharpRadius=2);var s=!1,l=null;i.cancelToken&&(l=i.cancelToken.then(function(e){throw s=!0,e},function(e){throw s=!0,e}));var u=Math.ceil(Math.max(3,2.5*i.unsharpRadius|0));return this.init().then(function(){if(s)return l;if(n.features.cib){var a=t.getContext("2d",{alpha:Boolean(i.alpha)});return n.debug("Resize via createImageBitmap()"),createImageBitmap(e,{resizeWidth:i.toWidth,resizeHeight:i.toHeight,resizeQuality:d.cib_quality_name(i.quality)}).then(function(e){if(s)return l;if(!i.unsharpAmount)return a.drawImage(e,0,0),e.close(),a=null,n.debug("Finished!"),t;n.debug("Unsharp result");var o=document.createElement("canvas");o.width=i.toWidth,o.height=i.toHeight;var r=o.getContext("2d",{alpha:Boolean(i.alpha)});r.drawImage(e,0,0),e.close();var u=r.getImageData(0,0,i.toWidth,i.toHeight);return n.__mathlib.unsharp(u.data,i.toWidth,i.toHeight,i.unsharpAmount,i.unsharpRadius,i.unsharpThreshold),a.putImageData(u,0,0),u=r=o=a=null,n.debug("Finished!"),t})}var c={},p=function(e,t,a){var i=void 0,o=void 0,r=void 0,g=function(t){return n.__limit(function(){if(s)return l;var u=void 0;if(d.isCanvas(e))n.debug("Get tile pixel data"),u=i.getImageData(t.x,t.y,t.width,t.height);else{n.debug("Draw tile imageBitmap/image to temporary canvas");var g=document.createElement("canvas");g.width=t.width,g.height=t.height;var v=g.getContext("2d",{alpha:Boolean(a.alpha)});v.globalCompositeOperation="copy",v.drawImage(o||e,t.x,t.y,t.width,t.height,0,0,t.width,t.height),n.debug("Get tile pixel data"),u=v.getImageData(0,0,t.width,t.height),v=g=null}var p={src:u.data,width:t.width,height:t.height,toWidth:t.toWidth,toHeight:t.toHeight,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:t.offsetX,offsetY:t.offsetY,quality:a.quality,alpha:a.alpha,unsharpAmount:a.unsharpAmount,unsharpRadius:a.unsharpRadius,unsharpThreshold:a.unsharpThreshold};return n.debug("Invoke resize math"),Promise.resolve().then(function(){return e=p,Promise.resolve().then(function(){return n.features.ww?new Promise(function(t,a){var i=n.__workersPool.acquire();l&&l.catch(function(e){return a(e)}),i.value.onmessage=function(e){i.release(),e.data.err?a(e.data.err):t(e.data.result)},i.value.postMessage({opts:e,features:n.__requested_features,preload:{wasm_nodule:n.__mathlib.__}},[e.src.buffer])}):n.__mathlib.resizeAndUnsharp(e,c)});var e}).then(function(e){if(s)return l;u=null;var a=void 0;if(n.debug("Convert raw rgba tile result to ImageData"),b)a=new ImageData(new Uint8ClampedArray(e),t.toWidth,t.toHeight);else if((a=r.createImageData(t.toWidth,t.toHeight)).data.set)a.data.set(e);else for(var i=a.data.length-1;0<=i;i--)a.data[i]=e[i];return n.debug("Draw tile"),h?r.putImageData(a,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth+1e-5,t.toInnerHeight+1e-5):r.putImageData(a,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth,t.toInnerHeight),null})})};return Promise.resolve().then(function(){if(r=t.getContext("2d",{alpha:Boolean(a.alpha)}),d.isCanvas(e))return i=e.getContext("2d",{alpha:Boolean(a.alpha)}),null;if(d.isImage(e))return A?(n.debug("Decode image via createImageBitmap"),createImageBitmap(e).then(function(e){o=e})):null;throw new Error('".from" should be image or canvas')}).then(function(){function e(){o&&(o.close(),o=null)}if(s)return l;n.debug("Calculate tiles");var i=v({width:a.width,height:a.height,srcTileSize:n.options.tile,toWidth:a.toWidth,toHeight:a.toHeight,destTileBorder:u}).map(function(e){return g(e)});return n.debug("Process tiles"),Promise.all(i).then(function(){return n.debug("Finished!"),e(),t},function(t){throw e(),t})})};return function e(t,a,n,i){if(s)return l;var u=t.shift(),d=o(u,2),c=d[0],g=d[1],v=0===t.length;i=r({},i,{toWidth:c,toHeight:g,quality:v?i.quality:Math.min(1,i.quality)});var h=void 0;return v||((h=document.createElement("canvas")).width=c,h.height=g),p(a,v?n:h,i).then(function(){v||(i.width=c,i.height=g,e(t,h,n,i))})}(g(i.width,i.height,i.toWidth,i.toHeight,n.options.tile,u),e,t,i)})},i.prototype.resizeBuffer=function(e){var t=this,a=r({},y,e);return this.init().then(function(){return t.__mathlib.resizeAndUnsharp(a)})},i.prototype.toBlob=function(e,t,a){return t=t||"image/png",new Promise(function(n){if(e.toBlob)e.toBlob(function(e){return n(e)},t,a);else{for(var i=atob(e.toDataURL(t,a).split(",")[1]),o=i.length,r=new Uint8Array(o),s=0;s<o;s++)r[s]=i.charCodeAt(s);n(new Blob([r],{type:t}))}})},i.prototype.debug=function(){},t.exports=i},{"./lib/mathlib":1,"./lib/pool":9,"./lib/stepper":10,"./lib/tiler":11,"./lib/utils":12,"./lib/worker":13,"object-assign":24,webworkify:25}]},{},[])("/")}),define("vvImageManager",["vvUtility","user-config/config","vvDefines","3rdparty/pica.min"],function(e,t,a,n){function i(e){this.state=e,this.scaleThrottleTimeoutId=0,this.thumbnailImageBuffer=[],this.originalImageBuffer=[],this.scaledImageBuffer=[],this.manipulatedImageBuffer=[],this.errorFallbackImageBuffer=[],this.imageCompletionTimeoutBuffer=[],this.upcomingQueue=[],this.picaID=0,this.requestTimeout=0,this.serverScale=t.serverScaling,this.forceBrowserScaling=t.useBrowserScaling,this.pica=new n({idle:a.picaCacheTimeout||2e3}),this.overlayImage=null,this.overlayDataArray=[],this.overlayDocumentId=null,this.pageLockOverlayOffset={offsetX:0,offsetY:0,locked:!0},this.overlayImageStripped=!1}i.prototype.setThumbnailOnPage=function(e,t){this.thumbnailImageBuffer[e]=t},i.prototype.getThumbnailFromPage=function(e){return this.thumbnailImageBuffer[e]},i.prototype.setOriginalOnPage=function(e,t){this.originalImageBuffer[e]=t},i.prototype.getOriginalFromPage=function(e){return this.originalImageBuffer[e]},i.prototype.setFallbackImageOnPage=function(e,t){this.errorFallbackImageBuffer[e]=t},i.prototype.setScaledOnPage=function(e,t){this.scaledImageBuffer[e]=t},i.prototype.getScaledFromPage=function(e){return this.scaledImageBuffer[e]},i.prototype.getManipulatedFromPage=function(e){return this.manipulatedImageBuffer[e]},i.prototype.setManipulatedOnPage=function(e,t){this.manipulatedImageBuffer[e]=t},i.prototype.setForceBrowserScaling=function(e){this.forceBrowserScaling=e},i.prototype.cleanOverlayOffset=function(){this.overlayDataArray=[],this.pageLockOverlayOffset&&(this.pageLockOverlayOffset={offsetX:0,offsetY:0,locked:!0})},i.prototype.getOverlayOffsetForPage=function(e){return e=e||0,e<0?null:null===this.overlayDataArray[e]?null:this.pageLockOverlayOffset.locked?this.pageLockOverlayOffset:(this.overlayDataArray[e]||(this.overlayDataArray[e]={offsetX:this.pageLockOverlayOffset.offsetX||0,offsetY:this.pageLockOverlayOffset.offsetY||0}),this.overlayDataArray[e])},i.prototype.getBestImageFromPage=function(e,a){var n,i=this.state;if(i.pageStates){i.getLayerManager().imageLayerVisibilityHasChanged&&(i.getLayerManager().imageLayerVisibilityHasChanged=!1,u(i,!1,e,!0));var r=this.originalImageBuffer&&this.originalImageBuffer[e],s=!!r&&o(this.originalImageBuffer[e]),l=!!s&&this.checkIsOriginalImageValidOnIE(e),d=s||o(this.errorFallbackImageBuffer[e]),c=t.enableSVGSupport&&i.getSVGableForPage(e)&&Modernizr.svg;if(c&&s&&l)n=this.originalImageBuffer[e];else if(i.isPageCropped(e)&&d)n=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e],i.isPageManipulated(e)&&(this.scaledImageBuffer[e]&&this.scaledImageBuffer[e].width===this.originalImageBuffer[e].width?this.scaledImageBuffer[e]&&!this.manipulatedImageBuffer[e]?this.createManipulatedPage(e,i):this.manipulatedImageBuffer&&this.manipulatedImageBuffer[e]&&(n=this.manipulatedImageBuffer[e]):this.scalePageByPercentage(0,1));else if(this.manipulatedImageBuffer&&o(this.manipulatedImageBuffer[e]))n=this.manipulatedImageBuffer[e];else if(i.isPageManipulated(e)&&d&&o(this.scaledImageBuffer[e]))this.createManipulatedPage(e,i),n=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e];else if(this.scaledImageBuffer&&o(this.scaledImageBuffer[e]))n=this.scaledImageBuffer[e];else if(d){var g=i.getZoomDecimal();this.scaleDocumentByPercentage(g),n=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e]}else this.thumbnailImageBuffer&&o(this.thumbnailImageBuffer[e])&&(n=this.thumbnailImageBuffer[e]);return r||this.errorFallbackImageBuffer[e]||(a?u(i,!1,e):this.throttledRequestImageBatch(i)),n}},i.prototype.cacheImages=function(e){var a=this.state;e=e||a.pageNumber;var n=t.continuousScrollBufferBeforeSize||1,i=t.continuousScrollBufferAfterSize||3,o=e-n;o<0&&(o=0);var r=e+i;r>a.pageCount&&(r=a.pageCount);for(var s=o;s<r;s++)this.originalImageBuffer[s]||this.getBestImageFromPage(s)},i.prototype.invalidateImageObject=function(e){e&&($(e).off("load"),$(e).off("error"),e.src=a.bogusImageURL)},i.prototype.usePica=function(){return!(this.serverScale||this.state.getZoom()>=100||this.forceBrowserScaling)},i.prototype.proceedWithScale=function(e,t,a){if(this.upcomingQueue=this.upcomingQueue||[],!this.originalImageBuffer||!this.originalImageBuffer[e])return this.upcomingQueue[0]&&this.upcomingQueue[0].page===e&&this.upcomingQueue.shift(),!1;if(this.cleanQueue(),!this.usePica())return!0;var n={page:e,width:t,height:a};if(0===this.picaID){if(!this.upcomingQueue.length)return this.upcomingQueue.push(n),!0;if(this.upcomingQueue[0].page===e)return!0}for(var i=0;i<this.upcomingQueue.length;i++)if(this.upcomingQueue[i].page===e)return this.upcomingQueue[i].width=t,this.upcomingQueue[i].height=a,!1;return this.upcomingQueue.push(n),!1},i.prototype.cleanQueue=function(){if(!this.originalImageBuffer)return void(this.upcomingQueue=[]);for(var e=0;this.upcomingQueue.length&&e<this.upcomingQueue.length;){var t=this.upcomingQueue[e].page;this.originalImageBuffer[t]||this.errorFallbackImageBuffer[t]?e++:this.upcomingQueue.splice(e,1)}},i.prototype.scalePageToDimensions=function(e,t,n){if(0!==t&&0!==n&&this.proceedWithScale(e,t,n)){var i=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e];if(o(i)){if(this.scaledImageBuffer&&this.scaledImageBuffer[e]){var r=this.scaledImageBuffer[e];if(r.width===t&&r.height===n)return}var s=document.createElement("canvas"),l=s.getContext("2d");s.width=i.width,s.height=i.height;try{l.drawImage(i,0,0,i.width,i.height)}catch(e){return}if(!this.usePica())return void this.setScaledOnPage(e,s);var u=document.createElement("canvas");u.width=t,u.height=n;var d=this;this.picaID=1,this.pica.resize(s,u,{quality:a.picaQuality,alpha:a.picaAlpha,unsharpAmount:a.picaUnsharpAmount,unsharpRadius:a.picaUnsharpRadius,unsharpThreshold:a.picaUnsharpThreshold}).then(function(){if(d.setScaledOnPage(e,u),d.upcomingQueue[0].page===e&&d.upcomingQueue.shift(),
d.manipulatedImageBuffer[e]&&d.createManipulatedPage(e,d.state),virtualViewer.delayedPaintCanvases(),d.picaID=0,d.upcomingQueue.length>0){var t=d.upcomingQueue[0];d.scalePageToDimensions(t.page,t.width,t.height)}}).catch(function(){if(d.picaID=0,d.upcomingQueue[0]&&d.upcomingQueue[0].page===e&&d.upcomingQueue.shift(),d.upcomingQueue.length>0){var t=d.upcomingQueue[0];d.scalePageToDimensions(t.page,t.width,t.height)}})}}},i.prototype.scalePageByPercentage=function(e,t){var a=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e],n=this.scaledImageBuffer[e];if(o(a)){var i=Math.round(this.state.getOriginalWidthForPage(e)*t),r=Math.round(this.state.getOriginalHeightForPage(e)*t);(!n||n.width!==i&&n.height!==r)&&this.scalePageToDimensions(e,i,r)}},i.prototype.scaleDocumentByPercentage=function(e){this.scaleThrottleTimeoutId&&clearTimeout(this.scaleThrottleTimeoutId);var a=t.zoomTimeout||500,n=(t.continuousScrollBufferBeforeSize||1,t.continuousScrollBufferAfterSize||3,this);this.scaleThrottleTimeoutId=setTimeout(function(){for(var a=n.state,i=t.continuousScrollBufferBeforeSize||t.continuousScrollBufferSize,o=t.continuousScrollBufferAfterSize||t.continuousScrollBufferSize,r=Math.max(a.pageNumber-i,0),s=Math.min(a.getPageCount()-1,a.pageNumber+o),l=r;l<=s;l++)n.serverScale&&!t.enableSVGSupport?u(a,!1,l,!0):n.scalePageByPercentage(l,e)},a)},i.prototype.requestOverlayImage=function(n){var i=virtualViewer.getActivePaneState();if(!i||!n)return!1;var o="getImage",r=!1,s=0;this.cleanOverlayOffset(),this.overlayImageStripped=!1;var l=new Image;this.overlayImage=l,this.overlayDocumentId=n,t.enableSVGSupport&&i.getSVGableForPage(s)&&Modernizr.svg&&(t.enableSVGSupportForIE||"Explorer"!==BrowserDetect.browser)&&(t.enableSVGSupportForEdge||"Edge"!==BrowserDetect.browser)&&(r=!0);var u=this.serverScale;this.serverScale=!1;var d=h(i,o,!1,s,r,n);this.serverScale=u,Modernizr.cors&&a.imageCrossOriginAttributeValue&&(l.crossOrigin=a.imageCrossOriginAttributeValue),$(l).on("load",function(){l.fromObjectURL&&URL.revokeObjectURL(l.src),virtualViewer.getCallbackManager().call("overlayImageLoadCompleted",{val:!0,documentId:i.documentId,overlayDocumentID:n});var e=50;"Explorer"!==BrowserDetect.browser||9!==BrowserDetect.version&&10!==BrowserDetect.version&&11!==BrowserDetect.version||(e=a.ie9DrawDelay),virtualViewer.delayedPaintCanvases(i,e),virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1),virtualViewer.setDragMode(a.dragModes.overlay)});var c=this;$(l).on("error",function(){virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1);var t=e.getLocalizedValue("errors.imageFailedToLoad","Image failed to load.");i.markBadPage(s,!0),c.currentExceptionDialog=$("#vvCurrentExceptionDialog"),$("#vvCurrentExceptionDialog").modal("show"),$("#vvCurrentExceptionText").html(t),$("#vvCurrentExceptionOKButton").click(function(){c.currentExceptionDialog=null}),virtualViewer.positionCanvases(i)});var v=virtualViewer.getCallbackManager();v.call("imageLoadRequested",{val:!0}),a.alwaysRequestImageViaXHR||t.enableCacheObfuscation?g(d,l,{imageManager:c,page:null,overlay:!0}):l.src=d},i.prototype.stripWhite=function(t){this.overlayImageStripped||(t.src=e.whiteToTransparent(t),this.overlayImageStripped=!0)},i.prototype.checkIsImageComplete=function(e){return o(e)},i.prototype.checkIsOriginalImageValidOnIE=function(e){var t=this.originalImageBuffer[e];if(!o(t))return!1;var a=this.state.getDPIForPage(e);if(("Explorer"===BrowserDetect.browser||"Edge"===BrowserDetect.browser)&&t.width>1e3&&a>=300){var n=document.createElement("canvas");n.width=t.width,n.height=t.height;try{n.getContext("2d").drawImage(t)}catch(e){return!1}}return!0};var o=function(e){if(!e)return!1;var t=e.naturalWidth||e.width;return!("CANVAS"!==e.tagName||!t)||(!(!t||!e.complete)||!!e.complete&&(!("Explorer"!==BrowserDetect.browser&&"Edge"!==BrowserDetect.browser||t)&&e.complete))},r=function(e,t,a,n){return o(t)?(e.imageCompletionTimeoutBuffer[a]=null,void l(e,t,a,n)):!e.originalImageBuffer[a]&&e.imageCompletionTimeoutBuffer[a]?(clearTimeout(e.imageCompletionTimeoutBuffer[a].timeoutId),void(e.imageCompletionTimeoutBuffer[a]=null)):(e.imageCompletionTimeoutBuffer[a]||(e.imageCompletionTimeoutBuffer[a]={timeoutId:0,polls:0}),e.imageCompletionTimeoutBuffer[a].polls++,void(e.imageCompletionTimeoutBuffer[a].timeoutId=setTimeout(function(){r(e,t,a,n)},50)))},s=function(e,t,a,n){t.fromObjectURL&&URL.revokeObjectURL(t.src),r(e,t,a,n),virtualViewer.getAllText(a,n)},l=function(e,n,i,o){n.width&&n.height||(n.width=o.getOriginalWidthForPage(i),n.height=o.getOriginalHeightForPage(i)),(!o.pageStates[i].isSVGable||t.serverScaling&&!t.enableSVGSupport)&&e.scalePageByPercentage(i,o.getZoomDecimal()),o.setViewedForPage(i,!0);var r=50;"Explorer"!==BrowserDetect.browser||9!==BrowserDetect.version&&10!==BrowserDetect.version&&11!==BrowserDetect.version||(r=a.ie9DrawDelay),virtualViewer.delayedPaintCanvases(o,r);var s={state:o};t.positionLastBetweenDocuments&&0===i&&(s.applyAndResetCachedScroll=!0),virtualViewer.sizeScroller(s),virtualViewer.updateImageInfoDialog(),virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1),virtualViewer.getCallbackManager().call("imageLoadCompleted",{documentId:o.documentId,page:i,val:!0})},u=function(e,n,i,o,r){var l="getImage",u=!1;if(e&&e.pageStates[i].imageInfoLoaded&&(i||0===i||(i=e.getPageNumber()),!e.isBadDocument()&&!e.isBadPage(i))){var v=e.getImageManager(),p=v.getOriginalFromPage(i);if((!v.errorFallbackImageBuffer[i]||o)&&((!p||n||r)&&(p=new Image,r?v.setFallbackImageOnPage(i,p):v.setOriginalOnPage(i,p)),t.enableSVGSupport&&e.getSVGableForPage(i)&&Modernizr.svg&&(t.enableSVGSupportForIE||"Explorer"!==BrowserDetect.browser)&&(t.enableSVGSupportForEdge||"Edge"!==BrowserDetect.browser)&&(u=!0),!virtualViewer.validImageObject(p)&&!$(p).data("awaitingBlob")||o)){if(v.cleanBuffers(),!Modernizr.webworkers)switch(t.singleThreadedScalingMode){case"browser":case"js":this.serverScale=!1;break;default:this.serverScale=!0}var f=h(e,l,!1,i,u,"",r),m={imageManager:v,recoveringFromError:n,page:i};Modernizr.cors&&a.imageCrossOriginAttributeValue&&(p.crossOrigin=a.imageCrossOriginAttributeValue),$(p).on("load",function(){s(v,p,i,e)}),$(p).on("error",function(){!p.fromObjectURL&&!p.complete||"Explorer"!==BrowserDetect.browser&&"Edge"!==BrowserDetect.browser?d(m):c(m)}),virtualViewer.getCallbackManager().call("imageLoadRequested",{documentId:e.documentId,page:i,val:!0}),a.alwaysRequestImageViaXHR||t.enableCacheObfuscation?g(f,p,m):p.src=f}}};i.prototype.throttledRequestImageBatch=function(e){clearTimeout(this.requestTimeout);var t=this;this.requestTimeout=setTimeout(function(){t.requestCurrentBufferOfImages(e)},"number"==typeof a.imageRequestThrottle?a.imageRequestThrottle:20)},i.prototype.requestCurrentBufferOfImages=function(e){var a=t.continuousScrollBufferBeforeSize||t.continuousScrollBufferSize,n=t.continuousScrollBufferAfterSize||t.continuousScrollBufferSize;"number"==typeof a&&"number"==typeof n||(a=1,n=2);for(var i=Math.max(e.pageNumber-a,0),o=Math.min(e.getPageCount()-1,e.pageNumber+n),r=i;r<=o;r++)u(e,!1,r)},i.prototype.requestFullImage=function(e,t,a){e=e||this.state,u(e,t,a)};var d=function(t){if(t=t||{},!t.thumbnail&&!t.overlay&&t.imageManager){var a=t.imageManager.state;if(virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1),t.imageManager.imageCompletionTimeoutBuffer[t.page]&&clearTimeout(t.imageManager.imageCompletionTimeoutBuffer[t.page].timeoutId),t.recoveringFromError){var n=e.getLocalizedValue("errors.imageFailedToLoad","Image failed to load.");a.markBadPage(t.page,!0),virtualViewer.displayExceptionMessage(n)}else console.log("Error requesting page "+t.page+" of document "+a.getDocumentId()+". Retrying with a bitmap display."),a.setSVGableForPage(t.page,!1),u(a,!0,t.page);virtualViewer.positionCanvases(a)}},c=function(t){var a=t.imageManager,n=a.state;a.imageCompletionTimeoutBuffer[t.page]&&(clearTimeout(a.imageCompletionTimeoutBuffer[t.page].timeoutId),a.imageCompletionTimeoutBuffer[t.page]=null),t.recoveringFromError||a.checkIsOriginalImageValidOnIE(t.page)||a.errorFallbackImageBuffer[t.page]?virtualViewer.displayExceptionMessage(e.getLocalizedValue("imageLoading.IEImageLoadError","Internet Explorer has failed to load the requested image due to memory limitations.")):(console.log("Internet Explorer has failed to load the image on page "+t.page+" due to a memory issue. Falling back to a lower-resolution image."),a.originalImageBuffer[t.page].src="",a.originalImageBuffer[t.page]=null,u(n,!0,t.page,!1,!0))},g=function(e,a,n){$(a).data("awaitingBlob",!0);var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){var e=i.response,o=new Uint8Array(e);t.enableCacheObfuscation&&(o=v(o));var r=p(o),s=new Blob([e],{type:r}),l=URL.createObjectURL(s);a.fromObjectURL=!0,a.src=l,$(a).data("awaitingBlob",!1)}else $(a).data("awaitingBlob",!1),d(n)},i.send()};i.prototype.requestImageViaXHR=function(e,t,a){g(e,t,a)};var v=function(e){for(var t=[13,3,9,11,15,6,8,14,4,0,11,3,4,2,13,6,9,4,8,9,4,3,7,10,7,2,11,3,11,7,5,10],a=0;a<e.length;a+=1)e[a]=e[a]^t[a%t.length];return e},p=function(e){for(var t=[60,63,120,109,108],a=[137,80,78,71],n=!0,i=!0,o=0;o<4;o+=1)e[o]!==t[o]&&(i=!1),e[o]!==a[o]&&(n=!1);return n?"image/png":i?"image/svg+xml":"image/jpeg"},h=function(e,n,i,o,r,s,l){o||0!==o&&(o=e.pageNumber);var u=document.getElementById("vvOuterDiv"),d=new URI(t.servletPath);if(d.addQuery("action",n),s||(s=virtualViewer.getDocumentIdForPage(o,e)),i===!0?(d.addQuery("documentId",encodeURIComponent(s)),d.addQuery("clientInstanceId",encodeURIComponent(virtualViewer.getClientInstanceId())),d.addQuery("hiddenImageLayers",e.getLayerManager().getHiddenImageLayers(!0))):(d.addQuery("documentId",s),d.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.addQuery("hiddenImageLayers",e.getLayerManager().getHiddenImageLayers())),d.addQuery("preferSvg",r),d.addQuery("pageCount",e.getPageCount()),d.addQuery("zoomPercent",Math.round(e.getZoom())),d.addQuery("pageNumber",virtualViewer.getPageIndexForPage(o,e)),d.addQuery("flipHorizontal",!1),d.addQuery("flipVertical",!1),d.addQuery("invertImage",!1),d.addQuery("brightness",0),d.addQuery("contrast",0),d.addQuery("gamma",100),d.addQuery("despeckle",e.getDespeckleForPage(o)),d.addQuery("antiAliasOff",e.getAntiAliasOffForPage(o)),this.serverScale)d.addQuery("requestedHeight",Math.round(e.pageStates[o].requestedHeight)),d.addQuery("requestedWidth",Math.round(e.pageStates[o].requestedWidth));else if(l&&0!==e.getDPIForPage(o)){var c=72/e.getDPIForPage(o);d.addQuery("requestedHeight",Math.round(e.getOriginalHeightForPage()*c)),d.addQuery("requestedWidth",Math.round(e.getOriginalWidthForPage()*c))}else d.addQuery("requestedHeight",-1),d.addQuery("requestedWidth",-1);return d.addQuery("clientWidth",u.clientWidth),d.addQuery("clientHeight",u.clientHeight),null!==virtualViewer.getOverlayPath()&&d.addQuery("overlayPath",virtualViewer.getOverlayPath()),a.cacheBuster===!0&&d.addQuery("cacheBuster",Math.random()),d.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),d.toString()};return i.prototype.cutPages=function(e){var t=[];e.sort(function(e,t){return e-t});for(var a=0,n=0;n<e.length;n+=1){var i=e[n]-a,o={thumb:this.thumbnailImageBuffer.splice(i,1)[0],original:this.originalImageBuffer.splice(i,1)[0],scaled:this.scaledImageBuffer.splice(i,1)[0],errorFallback:this.errorFallbackImageBuffer.splice(i,1)[0]};t.push(o),a+=1}return t},i.prototype.copyPages=function(e){var t=this,a=[];e.sort(function(e,t){return e-t});for(var n=0;n<e.length;n+=1){var i={thumb:t.thumbnailImageBuffer[e[n]],original:t.originalImageBuffer[e[n]],scaled:t.scaledImageBuffer[e[n]],errorFallback:t.errorFallbackImageBuffer[e[n]]};a.push(i)}return a},i.prototype.getPastedPages=function(e,t){for(var a=t;a<t+e;a++)this.cleanPageFromBuffers(a),this.getBestImageFromPage(a,!0)},i.prototype.createManipulatedPage=function(e,t){t||(t=virtualViewer.getCurrentState()),e||0===e||(e=t.pageNumber);var a=document.createElement("canvas"),n=a.getContext("2d");if(!this.scaledImageBuffer||!this.scaledImageBuffer[e])return a.width=0,a.height=0,this.manipulatedImageBuffer[e]=a,this.getBestImageFromPage(e,!0),!1;var i=t.getContrastForPage(e),o=t.getBrightnessForPage(e),r=t.getGammaForPage(e),s=!1,l=t.getInvertImageForPage(e),u=this.scaledImageBuffer[e],d=u.getContext("2d").getImageData(0,0,u.width,u.height),c=this.processImageManipulations(d,i,o,r,s,l);return a.width=u.width,a.height=u.height,n.putImageData(c,0,0),this.manipulatedImageBuffer[e]=a,virtualViewer.delayedPaintCanvases(),!0},i.prototype.processImageManipulations=function(e,t,a,n,i,o){var r=e.data;n/=100;var s=1/n;t*=2;for(var l=259*(t+255)/(255*(259-t)),u=0;u<r.length;u+=4){if(0!==t&&(r[u]=this.truncate(l*(r[u]-128)+128),r[u+1]=this.truncate(l*(r[u+1]-128)+128),r[u+2]=this.truncate(l*(r[u+2]-128)+128)),0!==a&&(r[u]=r[u]+a,r[u+1]=r[u+1]+a,r[u+2]=r[u+2]+a),n>1&&n<4&&(r[u]=255*Math.pow(r[u]/255,s),r[u+1]=255*Math.pow(r[u+1]/255,s),r[u+2]=255*Math.pow(r[u+2]/255,s)),i){var d=.299*r[u]+.587*r[u+1]+.114*r[u+2];r[u]=d,r[u+1]=d,r[u+2]=d}o&&(r[u]=255-r[u],r[u+1]=255-r[u+1],r[u+2]=255-r[u+2])}return e.data=r,e},i.prototype.truncate=function(e){return e>255?e=255:e<0&&(e=0),Math.floor(e)},i.prototype.processContrast=function(e,t){var a=t.data;e*=2;for(var n=259*(e+255)/(255*(259-e)),i=0;i<a.length;i+=4)a[i]=this.truncate(n*(a[i]-128)+128),a[i+1]=this.truncate(n*(a[i+1]-128)+128),a[i+2]=this.truncate(n*(a[i+2]-128)+128);return t},i.prototype.processBrightness=function(e,t){for(var a=t.data,n=0;n<a.length;n+=4)a[n]=a[n]+e,a[n+1]=a[n+1]+e,a[n+2]=a[n+2]+e;return t.data=a,t},i.prototype.processGamma=function(e,t){var a=t.data;e/=100;for(var n=1/e,i=0;i<a.length;i+=4)a[i]=255*Math.pow(a[i]/255,n),a[i+1]=255*Math.pow(a[i+1]/255,n),a[i+2]=255*Math.pow(a[i+2]/255,n);return t.data=a,t},i.prototype.processGreyscaleWeighted=function(e){for(var t=e.data,a=0;a<t.length;a+=4){var n=.299*t[a]+.587*t[a+1]+.114*t[a+2];t[a]=n,t[a+1]=n,t[a+2]=n}return e.data=t,e},i.prototype.processGreyscaleMean=function(e){for(var t=e.data,a=0;a<t.length;a+=4){var n=(t[a]+t[a+1]+t[a+2])/3;t[a]=n,t[a+1]=n,t[a+2]=n}return e.data=t,e},i.prototype.processInvert=function(e){for(var t=e.data,a=0;a<t.length;a+=4)t[a]=255-t[a],t[a+1]=255-t[a+1],t[a+2]=255-t[a+2];return e.data=t,e},i.prototype.nukeBuffers=function(){this.originalImageBuffer=[],this.scaledImageBuffer=[],this.manipulatedImageBuffer=[],this.thumbnailImageBuffer=[],this.errorFallbackImageBuffer=[]},i.prototype.cleanPageFromBuffers=function(e){this.originalImageBuffer[e]=null,this.scaledImageBuffer[e]=null,this.manipulatedImageBuffer[e]=null,this.errorFallbackImageBuffer[e]=null},i.prototype.cleanBuffers=function(e){var a=this.state;e||(e=a.pageNumber);var n,i,o=virtualViewer.scrollPageFinder(a),r=t.continuousScrollBufferBeforeSize||1,s=t.continuousScrollBufferAfterSize||3,l=a.getPageCount();n=e<o?e-r:o-r,i=e>o?e+s:o+s;for(var u=0;u<l;u++)u>=n&&u<=i||this.cleanPageFromBuffers(u)},i}),define("vvVideoManager",["user-config/config"],function(e){function t(e){this.videoDiv=document.createElement("div"),this.videoDiv.className="vvVideoDiv",this.outerDiv=virtualViewer.getOuterDivFromState(e),this.outerDiv.append(this.videoDiv),this.documentId=e.documentId,this.isVideoShown=!1}return t.prototype.getVideo=function(){var t,a,n,i=this;return i.videoPlayer?(i.showVideoDiv(),void i.resizeVideo()):(t="getMedia",i.videoPlayer=document.createElement("video"),i.videoPlayer.preload="auto",i.videoDiv.appendChild(this.videoPlayer),a=new URI(e.servletPath),n=virtualViewer.getClientInstanceId(),a.addQuery("action",t),a.addQuery("documentId",i.documentId),a.addQuery("clientInstanceId",n),void i.fetchVideo(a,i))},t.prototype.fetchVideo=function(e,t){var a=t.videoPlayer;a.addEventListener("loadstart",function(){t.setUpVideo({player:t.videoPlayer,self:t})}),a.addEventListener("progress",function(e){var t=Math.ceil(100*(e.loaded/e.total));$("#waitIndicatorProgressBar").show(),$("#waitIndicatorProgressBar").attr("aria-valuenow",t).css("width",t+"%")}),a.addEventListener("error",function(){virtualViewer.displayExceptionMessage("Video Unavailable"),virtualViewer.closeTab(t.documentId)}),virtualViewer.displayWaitIndicator(!0),a.src=e},t.prototype.setUpVideo=function(e){var t=e.self||this,a=e.player||this.videoPlayer,n=virtualViewer.getUserPreferences().videoPreferences;return null==n.autoplay?void virtualViewer.getCallbackManager().setCallback("postLoadPreferencesVideo",this.setUpVideo):(a.controls=n.controls,a.autoplay=n.autoplay,a.muted=n.mute,a.preload="auto",t.showVideoDiv(),t.resizeVideo(),void virtualViewer.displayWaitIndicator(!1))},t.prototype.fixVideoDivs=function(e){e&&!$(this.videoDiv).parent().length&&(this.outerDiv=virtualViewer.getOuterDivFromState(e),this.outerDiv.append(this.videoDiv),this.documentId=e.documentId)},t.prototype.hideVideoDiv=function(e){e=e||this.outerDiv.find(".vvInner"),$(this.videoDiv).hide(),this.videoPlayer.pause(),$(this.videoPlayer).hide(),$(e).show(),this.outerDiv.find(".vvCanvas").show(),$(this.outerDiv).css({overflow:"auto"}),virtualViewer.getEventManager().eventSwitch(!0),this.isVideoShown=!1},t.prototype.showVideoDiv=function(e){e=e||this.outerDiv.find(".vvInner"),$(this.videoDiv).show(),this.videoPlayer.autoplay&&this.videoPlayer.play(),$(this.videoPlayer).show(),$(e).hide(),this.outerDiv.find(".vvCanvas").hide(),$(this.outerDiv).css({overflow:"hidden"}),virtualViewer.getEventManager().eventSwitch(!1),this.isVideoShown=!0},t.prototype.applyVideoPreferences=function(e){if(!e||null===e.mute)return!1;var t=this.videoPlayer;return t.autoplay=e.autoplay,t.muted=e.mute,t.controls=e.controls,this.resizeVideo(),!0},t.prototype.resizeVideo=function(e,t,a){a||(a=this);var n=virtualViewer.getUserPreferences().videoPreferences;if(null!==n.mute){var i=$(this.outerDiv).width(),o=$(this.outerDiv).height();n.stretch?a.resizeVideoStretch(e,t,i,o):a.resizeVideoTheater(e,t,i,o)}},t.prototype.resizeVideoStretch=function(e,t,a,n){e||(e=a),t||(t=n),this.videoPlayer.width=e,this.videoPlayer.height=t,"fixed"===$(this.videoDiv).css("position")&&$(this.videoDiv).css({top:0,left:0,position:"relative"})},t.prototype.resizeVideoTheater=function(e,t,a,n){(!e||e>a)&&(e=a),(!t||t>n)&&(t=n),e>this.videoPlayer.videoWidth&&(e=this.videoPlayer.videoWidth),t>this.videoPlayer.videoHeight&&(t=this.videoPlayer.videoHeight),this.videoPlayer.width=e,this.videoPlayer.height=t;var i=(a-e)/2+35,o=(n-t)/2+75;$(this.videoDiv).css({top:o,left:i,position:"fixed"})},t}),define("vvThumbs",["require","vvUtility","user-config/config","vvDefines","vvImageManager","vvStateManager"],function(e,t,a,n,i){var o=function(){var o=null,r=function(e){virtualViewer.openInTab($(this).data("thumbInfo").documentId)},s=function(e){var t=$(e.target).offset();$(e.target).closest(".vvThumbBox").trigger($.Event("contextmenu",{pageX:t.left-100,pageY:t.top}))},l=function(e){e.preventDefault(),virtualViewer.addPageToSelection($(e.target).closest(".vvThumbBox").data("thumb-info").pageNumber)},u=function(e){if(e.tapCount>1)return void l(e);virtualViewer.draggingPage=!0;var t=virtualViewer.getDocumentModel(),a=$(this).data("thumbInfo");a||(a=$(e.target).closest(".vvThumbBox").data("thumbInfo"));var n=a.pageNumber;e.ctrlKey===!0||e.metaKey===!0?virtualViewer.checkPageManipulationsEnabled()&&t.togglePageSelection(n):e.shiftKey===!0?virtualViewer.checkPageManipulationsEnabled()&&t.selectRange(n):(virtualViewer.checkPageManipulationsEnabled()&&(t.clearPageSelection(),t.addPageToSelection(n)),virtualViewer.currentMatch=0,virtualViewer.setPage(n),virtualViewer.skipScrollEvent=!0,$("#vvOuterDiv").scrollTop(virtualViewer.findPagePosition(n)))},d=function(e){this.src="resources/pageNotFound.png",$(this).parents(".vvThumbBox").find(".vvLoadingGif").remove(),$(this).removeClass(".vvImageLoading"),$(this).show(),$(this).addClass("displayedThumb");var t=parseInt($(this).css("width"),10),a=parseInt($(this).css("height"),10),i=n.thumbnailSize;t>a?($(this).css("height",a/(t/i)+"px"),$(this).css("width",i+"px")):($(this).css("width",t/(a/i)+"px"),$(this).css("height",i+"px"));var o=$(this).parents(".vvThumbBox").find(".vvThumbFooter");$(this).parents(".vvThumbBox").find(".vvThumbFooterNoImage").removeClass("vvThumbFooterNoImage"),o.width($(this).width()-2*parseInt(o.css("padding-left"),10))},c=function(t){var a=e("vvStateManager").getCurrentState(),n=$(this).closest(".vvThumbBox");if(n.find(".vvLoadingGif").remove(),$(this).removeClass("vvImageLoading"),a&&$(this).parents("#vvPageThumbs").length){var i=a.getImageManager();i.setThumbnailOnPage(n.data("thumbInfo").pageNumber,this)}$(this).addClass("displayedThumb vvImgLoaded"),$(this).show(),V(n)},g=function(e){var t=$(e).closest(".vvThumbBox"),a=t.data("thumbInfo").pageNumber;return 0===a||a?a:-1},v=function(t){if(virtualViewer.cleanupDrag(),virtualViewer.checkPageManipulationsEnabled()&&t.originalEvent&&t.originalEvent.dataTransfer){t.preventDefault();var a=g(this),n=t.originalEvent.dataTransfer.getData("text");if(n){var i=JSON.parse(n);if(!virtualViewer.clipIsVVObject(i))return D($("#vvPageThumbs")),M(),void y($("#vvPageThumbs"));var o=a;if(p($(this),t.clientY)||(o=a+1),virtualViewer.fixClipState(i),virtualViewer.draggingPage&&i.sessionGUID===virtualViewer.viewerSessionID){if(i.pageNums.indexOf(a)>-1||!virtualViewer.deleteSelection(i))return!1;for(var r=0;r<=i.pageNums.length-1&&i.pageNums[r]<=o;r++)o-=1}virtualViewer.draggingPage=!1,o>e("vvStateManager").getCurrentState().pageCount&&(o=e("vvStateManager").getCurrentState().pageCount),virtualViewer.pasteClip(i,null,o)}}},p=function(e,t){var a=e.height(),n=e.offset().top,i=n+a/2;return t<=i},h=function(e){var t=g(e.target);if(t>=0){var a=e.clientY;f(t,p($(this),a))}},f=function(e,t){var a=$("#vvPageThumbs .vvThumbBox").eq(e);$(".vvThumbDivider").remove(),t?$(a).before($("<div></div>").addClass("vvThumbDivider")):$(a).after($("<div></div>").addClass("vvThumbDivider"))},m=function(t){if(virtualViewer.checkPageManipulationsEnabled()&&t.originalEvent&&t.originalEvent.dataTransfer){var a=g(t.target);if(!(a<0)){virtualViewer.draggingPage=!0;var n=e("vvStateManager").getCurrentState().getDocumentModel();t.ctrlKey?n.addPageToSelection(a):t.shiftKey||t.metaKey===!0?n.selectRange(a):n.isPageSelected(a)||(n.clearPageSelection(),n.addPageToSelection(a));var i=t.originalEvent.dataTransfer;i.setData("text",JSON.stringify(virtualViewer.createClipObject())),i.dropEffect="move",i.effectAllowed="move"}}},y=function(t){if(t=t||B(),t.length){if(a.doNotLoadPageThumbs&&"vvDocThumbs"!==t.attr("id"))return void V(t.find(".vvThumbBox"));for(var o=k(t),r=0;r<o.length;r++){var s=$(o[r]),l=s.find("img.vvLoadingGif"),u=s.find("img.vvImageLoading");if(l.length&&!u.length){var g=F(s.data("thumbInfo")),v=new Image;if($(v).on("load",c),$(v).on("error",d),$(v).insertBefore(l).hide(),$(v).addClass("vvThumbImage vvImageLoading"),s.hasClass("activeThumbBox")&&($(v).addClass("activeThumb"),s.find(".vvThumbFooter").addClass("activeThumb")),s.hasClass("selectedThumbBox")&&($(v).addClass("selectedThumb"),s.find(".vvThumbFooter").addClass("selectedThumb")),v.draggable="true"===s.attr("draggable"),Modernizr.touchevents&&(Hammer(v).on("press",function(e){e.preventDefault()}),Hammer(s[0]).on("pressup",function(e){e.preventDefault()})),n.alwaysRequestImageViaXHR||a.enableCacheObfuscation){var p,h=e("vvStateManager").getCurrentState();h&&(p=h.getImageManager()),p||(p=new i),p.requestImageViaXHR(g,v,{thumbnail:!0})}else v.src=g}}}},b=function(e,t){var a=$("#vvPageThumbs .vvThumbBox").eq(e);return t?(a.addClass("selectedThumbBox"),void a.find(".vvThumbImage, .vvThumbFooter").addClass("selectedThumb")):(a.removeClass("selectedThumbBox"),void a.find(".vvThumbImage, .vvThumbFooter").removeClass("selectedThumb"))},A=function(e,t,a){var n=$("#vvPageThumbs .vvThumbBox").slice(e,t);return a?(n.addClass("selectedThumbBox"),void n.find(".vvThumbImage, .vvThumbFooter").addClass("selectedThumb")):(n.removeClass("selectedThumbBox"),void n.find(".selectedThumb").removeClass("selectedThumb"))},P=function(t){$(".activeThumbBox").removeClass("activeThumbBox"),$(".activeThumb").removeClass("activeThumb");var a;if(t=t||e("vvStateManager").getCurrentState()){var n=t.getPageNumber();a=$("#vvPageThumbs .vvThumbBox").eq(n),a.addClass("activeThumbBox"),a.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb"),a=$("#vvSearchResults .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").pageNumber===n}),a.addClass("activeThumbBox"),a.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb")}var i=virtualViewer.getDocumentId(0);a=$("#vvDocThumbs .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").documentId===i}),a.addClass("activeThumbBox"),a.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb")},T=function(t){t=t||e("vvStateManager").getCurrentState();var a=0;t&&(a=t.getPageNumber());var n=$("#vvPageThumbs .vvThumbBox").eq(a);L($("#vvPageThumbs"),n)},S=function(e){e=e||virtualViewer.getDocumentId(0);var t=$("#vvDocThumbs .vvThumbBox").filter(function(t){return $(this).data("thumbInfo").documentId===e});t.length||(t=$("#vvDocThumbs .vvThumbBox").eq(0)),L($("#vvDocThumbs"),t)},w=function(t){t=t||e("vvStateManager").getCurrentState();var a=0;t&&(a=t.getPageNumber());var n=$("#vvSearchResults .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").pageNumber===a});L($("#vvSearchResults"),n)},I=function(e){e?($("#vvImagePanel").removeClass("noThumbs"),$("#vvThumbs").show(),M(),x(virtualViewer.documentList),y($("#vvPageThumbs")),y($("#vvDocThumbs")),virtualViewer.showAllAnnotationIndicators()):($("#vvImagePanel").addClass("noThumbs"),$("#vvThumbs").hide()),virtualViewer.processWindowResize()},C=function(){$(".thumbPanel, #vvSearchResults").click(function(e){var t=virtualViewer.getDocumentModel(),a=$(e.target).closest("div.vvThumbBox, div.thumbStandIn");!a.length||a.hasClass("vvThumbBox")||a.hasClass("thumbStandIn")||t&&t.clearPageSelection()})},D=function(e){e=e||B(),e.find(".vvThumbBox, .vvThumbDivider").tooltip("hide").remove()},x=function(e){var t=$("#vvDocThumbs");if(D(t),e=e||virtualViewer.documentList,e.length){var a={thumbList:e,useImage:!0,isDocThumb:!0};R(t,a);var n=t.children(".vvThumbBox");if(n.on("click",r),n.contextMenu("vvDocThumbContextMenu",virtualViewer.docThumbContextMenu),Modernizr.touchevents)for(var i=0;i<n.length;i++){var l=new Hammer(n[i]);l.get("press").set({enable:!0}),l.on("press",s)}_(n,o)}},M=function(t){if(t=t||e("vvStateManager").getCurrentState(),t&&t.pageStates){var n=$("#vvPageThumbs");D(n);var i=virtualViewer.getDocumentModel(t).model.pageData,o={thumbList:i,useImage:!a.doNotLoadPageThumbs,pageCount:t.getPageCount()},r=R(n,o);if(r.on("dragstart",m),r.on("dragover",h),r.on("drop",v),r.contextMenu("vvThumbContextMenu",virtualViewer.pageThumbContextMenuOptions),virtualViewer.showAllAnnotationIndicators(),!Modernizr.touchevents)return void r.on("click",u);for(var l=0;l<r.length;l++){var d=new Hammer(r[l]);d.get("press").set({enable:!0}),d.on("press",s),d.get("doubletap").set({domEvents:!0,enable:!0}),d.get("doubletap").recognizeWith("tap"),d.get("tap").requireFailure("doubletap"),d.on("tap",u)}BrowserDetect.OS&&"i"===BrowserDetect.OS[0]&&r.bind("touchstart",function(e){var t=e.timeStamp,a=$(this).data("lastTouch")||t,n=t-a,i=e.originalEvent.touches.length;$(this).data("lastTouch",t),!n||n>500||i>1||e.preventDefault()})}},N=function(t,n){if(t=t||e("vvStateManager").getCurrentState(),t&&t.pageStates){var i=$("#vvSearchResults"),o=t.getDocumentModel().model.pageData,r=[];n=n||[];for(var s=0;s<n.length;s++){var l=n[s],d={};o[l]&&(d.documentId=o[l].documentId,d.pageNumber=l,d.pageIndex=o[l].pageIndex,r.push(d))}var c={isSearchThumb:!0,thumbList:r,useImage:!a.doNotLoadPageThumbs,pageCount:t.getPageCount()},g=R(i,c,!0);g.on("click",u)}},L=function(e,t){if(t&&t.length&&e&&e.length){var a=e[0].scrollTop,n=a+e[0].clientHeight,i=t[0].offsetTop,o=i+t[0].clientHeight;(o>n||i<a)&&e.scrollTop(i)}},V=function(e){if(e.length){e.find(".vvThumbFooterNoImage").removeClass("vvThumbFooterNoImage");var t=e.find(".vvThumbImage"),a=140;t.length&&(a=t.width()||t[0].width||a),e.find(".vvThumbFooter").width(a),e.find(".vvThumbShadowWrapper").width(a)}},k=function(e){if(!e.length)return[];var t=e.find(".vvThumbBox"),a=$(t[0]).height()||1;a=a+parseInt($(t[0]).css("margin-top"),10)+parseInt($(t[0]).css("margin-bottom"),10);for(var n=e.scrollTop(),i=n+e[0].clientHeight,o=Math.max(parseInt(n/a,10)-2,0),r=[],s=o;s<t.length;s++)if(t[s].offsetTop+t[s].clientHeight>n&&t[s].offsetTop<i&&r.push(t[s]),t[s].offsetTop>i)return r;return r},B=function(){var e=$("#vvPageThumbs.tab-pane.active, #vvDocThumbs.tab-pane.active");return e.length||(e=$("#vvSearch.tab-pane.active > #vvSearchResults")),e},R=function(e,n,i){n.useFooter=!!a.displayThumbFooters,i||e.find(".vvThumbBox").remove();var o=$.templates("#thumbnailPaneTemplate"),r=$(o(n));return r.appendTo(e),t.enableTooltips(r),r},F=function(e){var t=new URI(a.servletPath);return t.addQuery("action","getThumbnail"),t.addQuery("pageNumber",e.subDocumentPageNumber),t.addQuery("searchThumb",!!e.searchThumb),t.addQuery("documentListThumb",!!e.documentListThumb),e.documentListThumb?t.addQuery("documentId",e.documentId):t.addQuery("documentId",decodeURIComponent(e.documentId)),t.addQuery("thumbnailSize",n.thumbnailSize),t.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),t.addQuery("virtualPageNumber",e.pageNumber),t.addQuery("pageCount",e.pageCount||1),virtualViewer.getOverlayPath()&&t.addQuery("overlayPath",virtualViewer.getOverlayPath()),n.cacheBuster!==!0&&"Explorer"!==BrowserDetect.browser||t.addQuery("cacheBuster",Math.random()),t.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),t.toString()},E=function(e,t){var a=$("#vvDocThumbs .vvThumbBox.activeThumbBox");if(!a.length||a.data("thumb-info").documentId!==e)for(var n=$("#vvDocThumbs .vvThumbBox"),i=0;i<n.length;i++)if($(n[i]).data("thumb-info").documentId===e){a=$(n[i]);break}a.attr("data-original-title",t),a.find(".vvThumbFooter > div").text(t)},O=function(e){var t=$("#vvDocThumbs"),a=t.find(".vvThumbBox");_(a,e),o=e,y(t)},_=function(e,t){t?e.each(function(e,a){var n=$(a),i=n.data().thumbInfo,o=i.displayName||i.documentId;o&&o.toLowerCase().indexOf(t.toLowerCase())>=0?n.show():n.hide()}):e.show()};return{prepareThumbPanels:C,fillDocThumbs:x,fillPageThumbs:M,fillSearchThumbs:N,buildThumbURI:F,loadVisibleThumbs:y,removeThumbs:D,setPageRangeThumbSelection:A,setPageThumbSelection:b,highlightActiveThumbnail:P,ensurePageThumbIsVisible:T,ensureDocThumbIsVisible:S,ensureSearchThumbIsVisible:w,setThumbPanelVisibility:I,updateDocumentDisplayName:E,filterDocumentThumbsByDisplayName:O}}();return o}),define("vvDocViewState",["require","vvUtility","vvDocViewStateElement","vvLayerManager","vvImageManager","vvVideoManager","vvDefines","user-config/config","annotations","vvAnnotationManager","vvThumbs"],function(e,t,a,n,i,o,r,s){function l(e,t,a,r,s,l){this.documentId=e,this.documentModel=t,this.documentByteSize=0,this.pageCount=a,this.pageNumber=r,this.tabNumber=s,this.currentPaneIndex=0,this.closedTab=!0,this.currentLayer=null,this.autoLayerCounter=0,this.layerNames=[],this.layerManager=new n,this.imageBuffer=[],this.scaledImageBuffer=[],this.imageManager=new i(this),this.videoManager=new o(this),this.displayName=null,this.isSearchable=null,this.badDocument=!1,this.docFormat=null,this.documentNoteArray=[],this.cachedSearch=null,this.cachedScroll={},this.zoom=100,this.zoomMode=l,this.timeout=-1,this.watermarks=null,a&&this.initPageStatesArray(a,l)}l.prototype.initPageStatesArray=function(e,t){if(!this.pageStates){this.pageStates=new Array(e);for(var n=0;n<e;n+=1)this.pageStates[n]=new a(t)}},l.prototype.cutPages=function(e,t){var a=[];e.sort(function(e,t){return e-t});
for(var n=0,i=0;i<e.length;i+=1){var o=e[i]-n;a.push(this.pageStates.splice(o,1)[0]),n+=1}return this.pageCount-=e.length,this.pageNumber=t,this.fixAnnPages(),a},l.prototype.copyPages=function(e){var a=[];e.sort(function(e,t){return e-t});for(var n=0;n<e.length;n+=1){var i=this.pageStates[e[n]],o=t.deepObjCopy(i);a.push(o)}return a},l.prototype.pastePages=function(e,t){for(var a=0;a<e.length;a++)this.pageStates.splice(t+a,0,e[a])},l.prototype.fixAnnPages=function(){for(var t=0;t<this.pageStates.length;t++){e("vvAnnotationManager").checkLayerIntegrity(t);for(var a=this.pageStates[t].annotationLayers,n=0;n<this.layerNames.length;n++){var i=a[this.layerNames[n]];if(i){for(var o=0;o<i.anns.length;o++)i.anns[o].page=t;i.pageNumber=t,this.getDocumentModel().markLayerDirty(i)}}}},l.prototype.saveAnnotationLayers=function(e){var t=this,a=this.getAnnotationLayers(e,!0,!0);if(a.length>0){var n=new URI(s.servletPath);n.addQuery("action","saveAnnotationModel"),n.addQuery("documentId",t.getDocumentId()),n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),n.addQuery("pageCount",t.getPageCount()),n.addQuery("modelJSON",JSON.stringify(a)),r.cacheBuster===!0&&n.addQuery("cacheBuster",Math.random()),n.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var i=n.query();n.query(""),$.ajax({type:"POST",url:n.toString(),dataType:"json",data:i,success:function(e){var a=virtualViewer.getCallbackManager();if(a.call("saveAnnotation",{documentId:t.getDocumentId(),clientInstanceId:virtualViewer.getClientInstanceId(),documentIdToReload:e.documentIdToReload}),virtualViewer.checkServerException(e)!==!0){for(var n=t.documentModel.model.layerManager.layers,i=0;i<n.length;i+=1)n[i].dirty=!1;0===t.currentPaneIndex&&virtualViewer.updateTabName(t)}},error:function(e){virtualViewer.checkServerException(e)===!0}})}virtualViewer.displaySaveIndicator(!1)};var u=function(t,a){for(var n={},i=Object.keys(t),o=0;o<i.length;o++)n[i[o]]=t[i[o]];n.anns=[];for(var r=a.pageStates[t.pageNumber].originalWidth,s=a.pageStates[t.pageNumber].originalHeight,l=0;l<t.anns.length;l++){var u=(new(e("annotations"))).copyFrom(t.anns[l]),d=r/u.pageWidth;u.pageWidth=r,u.pageHeight=s,u.scaleAnn(d),u.getFontSize()&&u.setFontSize(u.getFontSize(!0)*d,!0),n.anns.push(u)}return n.pageWidth=r,n.pageHeight=s,n.docDPI=72,n};return l.prototype.getAnnotationLayers=function(a,n,i,o,l,d,c){var g=this,v=[];if(!g.pageStates)return v;for(var p=0;p<g.pageStates.length;p+=1){var h=g.pageStates[p];if(h.annotationLayers){n&&g.rotateLayersForPage(p,g.getRotationForPage(p),i);for(var f=0;f<g.layerNames.length;f+=1){var m=g.layerNames[f],y=h.annotationLayers[m],b=g.getDocumentModel().isLayerDirtyByName(m),A=null;if(y){if(e("vvAnnotationManager").checkLayerPermission(y,r.permissionLevels.PERM_EDIT)===!1||s.oneLayerPerAnnotation&&(!y.anns||!y.anns.length))continue;if(b||a){c&&h.dpi&&h.dpi<72&&y.anns.length&&72*y.pageWidth/y.docDPI*(72*y.pageHeight/y.docDPI)>1e9&&(y=u(y,g)),y.pageNumber=p,A='<?xml version="1.0" encoding="ISO-8859-1"?><document xmlns="http://snowbound.com/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://snowbound.com/XMLSchema flexAnn.xsd"><docMeta><docID>DOC_ID</docID><docName>ANNOTATED_FILE_NAME</docName><docDPI>',A+=y.docDPI>0?y.docDPI:h.dpi,A+="</docDPI></docMeta><docLayers><layer/></docLayers><docPages><page><pageMeta><pageNumber>",A+=y.pageNumber+"</pageNumber><pageWidth>",A+=y.pageWidth+"</pageWidth><pageHeight>",A+=y.pageHeight+"</pageHeight><doubleByte>",A+=y.doubleByte+"</doubleByte></pageMeta><pageObjects>";var P=!1;t.isRedactionLayer(y)&&(P=!0);for(var T=!1,S=!1,w=g.getRotationForPage(y.pageNumber),I=0;I<y.anns.length;I++)y.anns[I].getTextString()&&y.anns[I].getTextString().length&&(T=!0),S=P&&o||T&&l,P||T||!d||(S=!0),A+=y.anns[I].toXML(P,S,w),S=!1,T=!1;A+="</pageObjects></page></docPages></document>"}}A&&v.push({layerName:g.layerNames[f],isRedaction:y.isRedaction,pageNumber:y.pageNumber,layerXML:A})}}}return v},l.prototype.validatePageNumber=function(e){return(isNaN(e)||e===1/0||void 0===e||null===e||e<0)&&(e=this.getPageNumber()),e>=this.pageCount&&(e=this.pageCount-1),e},l.prototype.rotateLayersForPage=function(e,t,a){e=this.validatePageNumber(e);var n=this.pageStates[e];if(n.annotationLayers)for(var i=0;i<this.layerNames.length;i+=1){var o=n.annotationLayers[this.layerNames[i]];if(o){for(var r=0;r<o.anns.length;r++)o.anns[r].rotate(t,a);if(0!==t&&this.getDocumentModel().markLayerDirty(o),!a&&(90===Math.abs(t)||270===Math.abs(t))){var s=o.pageWidth,l=o.pageHeight;o.pageHeight=s,o.pageWidth=l}}}},l.prototype.renameLayer=function(e,t){for(var a=0;a<this.layerNames.length;a+=1)if(this.layerNames[a]===e){this.layerNames[a]=t;break}for(var n=0;n<this.pageStates.length;n+=1){var i=this.getLayersForPage(n);if(i){var o=i[e];if(o){for(var r=0;r<o.anns.length;r+=1)o.anns[r].setLayerName(t);o.layerName=t,i[e]=null,i[t]=o}}}},l.prototype.deleteLayer=function(e){for(var t=0;t<this.pageStates.length;t++){var a=this.getLayersForPage(t);a&&delete a[e]}this.documentModel.deleteLayer(e)},l.prototype.deleteAnnotationsOnLayer=function(e){for(var t=this.pageNumber,a=0;a<this.pageStates.length;a+=1){virtualViewer.setPage(a);var n=this.getLayersForPage(a);if(n)for(var i=n[e].anns,o=0;o<i.length;o++)i[o].setDelete(!0)}virtualViewer.setPage(t)},l.prototype.deleteAllLayers=function(){for(var e=0;e<this.layerNames.length;e++)this.deleteAnnotationsOnLayer(this.layerNames[e])},l.prototype.deleteAllAnnsOnPage=function(e){for(var t=this.getLayersForPage(e),a=0;a<this.layerNames.length;a++)for(var n=this.layerNames[a],i=t[n],o=0;o<i.anns.length;o++)i.anns[o].setDelete(!0)},l.prototype.getDocumentId=function(){return this.documentId},l.prototype.isVirtualDocument=function(){return t.isVirtualDocument(this.documentId)},l.prototype.getVirtualDocumentComponents=function(){var e=[];if(this.isVirtualDocument())for(var t=this.documentId.split(":")[1],a=t.split(","),n=0;n<a.length;n+=1)e.push(a[n].split("[")[0]);else e.push(this.documentId);return e},l.prototype.isVideo=function(){return!!this.documentModel&&(this.documentModel.getMediaType()===r.mediaType.video||void 0)},l.prototype.getTabNumber=function(){return this.tabNumber},l.prototype.setTabNumber=function(e){this.tabNumber=e},l.prototype.getClosedTab=function(){return this.closedTab},l.prototype.setClosedTab=function(e){this.closedTab=e},l.prototype.getDisplayName=function(){return this.displayName},l.prototype.setDisplayName=function(e){this.displayName=e,this.documentModel.model.displayName=encodeURIComponent(e)},l.prototype.setPageDisplayNames=function(t){t=t||[];for(var a=this.getDocumentModel().model.pageData,n=0;n<a.length;n++)a[n].displayName=t[n];e("vvThumbs").fillPageThumbs(this),e("vvThumbs").loadVisibleThumbs($("#vvPageThumbs"))},l.prototype.getDocumentByteSize=function(){return this.documentByteSize},l.prototype.setDocumentByteSize=function(e){this.documentByteSize=e},l.prototype.getIsSearchable=function(){return this.isSearchable},l.prototype.setIsSearchable=function(e){this.isSearchable=e},l.prototype.isBadDocument=function(){return this.badDocument},l.prototype.markBadDocument=function(e){this.badDocument=e},l.prototype.setDocFormat=function(e){this.docFormat=e},l.prototype.getDocFormat=function(){return this.docFormat},l.prototype.resetDocFormat=function(){this.docFormat=null},l.prototype.getDocumentModel=function(){return this.documentModel},l.prototype.setDocumentModel=function(e){this.documentModel=e},l.prototype.getPageCount=function(){return this.pageCount},l.prototype.setPageCount=function(e){this.pageCount=e},l.prototype.getPageNumber=function(){return this.pageNumber},l.prototype.setPageNumber=function(e){isNaN(e)&&(e=0),this.pageNumber=e},l.prototype.getLayerNames=function(){return this.layerNames},l.prototype.setLayerNames=function(e){this.layerNames=e},l.prototype.getZoom=function(){return this.zoom},l.prototype.setZoom=function(e){this.zoom=e},l.prototype.getZoomDecimal=function(){return this.zoom/100},l.prototype.setZoomDecimal=function(e){this.zoom=100*e},l.prototype.getZoomMode=function(){return this.zoomMode},l.prototype.setZoomMode=function(e){this.zoomMode=e},l.prototype.getCurrentLayer=function(){var e=this.pageStates[this.getPageNumber()];return this.currentLayer&&e.annotationLayers?e.annotationLayers[this.currentLayer]:null},l.prototype.setCurrentLayer=function(e){e?this.currentLayer=e.layerName:this.currentLayer=void 0},l.prototype.getCurrentLayerOnPage=function(e){var t=this.pageStates[e];return this.currentLayer&&t.annotationLayers?t.annotationLayers[this.currentLayer]:null},l.prototype.setCurrentLayerOnPage=function(e,t){t?this.currentLayer=t.layerName:this.currentLayer=void 0},l.prototype.getLayerManager=function(){return this.layerManager},l.prototype.getVideoManager=function(){return this.videoManager},l.prototype.getImageManager=function(){return this.imageManager},l.prototype.getImageObject=function(){return this.getImageOnPage(this.pageNumber)},l.prototype.getScaledImageObject=function(){return this.getScaledImageOnPage(this.pageNumber)},l.prototype.getImageOnPage=function(e){return this.imageBuffer?this.imageBuffer[e]:null},l.prototype.getVideoManager=function(){if(this.videoManager)return this.videoManager},l.prototype.getVideo=function(){if(this.videoManager)return this.videoManager.getVideo()},l.prototype.getScaledImageOnPage=function(e){return this.scaledImageBuffer?this.scaledImageBuffer[e]:null},l.prototype.setImageOnPage=function(e,t){this.imageBuffer[e]=t},l.prototype.setScaledImageOnPage=function(e,t){this.scaledImageBuffer[e]=t},l.prototype.getImageBuffer=function(){return this.imageBuffer},l.prototype.getScaledImageBuffer=function(){return this.scaledImageBuffer},l.prototype.setImageBuffer=function(e){this.imageBuffer=e},l.prototype.setScaledImageBuffer=function(e){this.scaledImageBuffer=e},l.prototype.deleteImageBufferPage=function(e){this.imageBuffer[e]=null},l.prototype.deleteScaledImageBufferPage=function(e){this.scaledImageBuffer[e]=null},l.prototype.clearImageBuffer=function(){this.imageBuffer=[],this.imageManager.nukeBuffers()},l.prototype.clearScaledImageBuffer=function(){this.scaledImageBuffer=[],this.imageManager.nukeBuffers()},l.prototype.getViewedForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].pageViewed},l.prototype.setViewedForPage=function(e,t){e=this.validatePageNumber(e),t||(t=!0),this.documentModel&&(this.documentModel.model.pageData[e].pageViewed=t)},l.prototype.isBadPage=function(e){return e=this.validatePageNumber(e),this.pageStates[e].isBad},l.prototype.markBadPage=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].isBad=t},l.prototype.getSVGableForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].isSVGable},l.prototype.setSVGableForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].isSVGable=t},l.prototype.setSVGableForDocument=function(e){for(var t=0;t<this.pageStates.length;t+=1)this.pageStates[t].isSVGable=e},l.prototype.resetSVGSupport=function(e){null!==e&&void 0!==e||(e=s.enableSVGSupport),this.setSVGableForDocument(e);var t=this.getImageManager();t.nukeBuffers();var a=this.getImageBuffer()[this.pageNumber];t.invalidateImageObject(a)},l.prototype.getOriginalHeightForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].originalHeight},l.prototype.getOriginalWidthForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].originalWidth},l.prototype.getRequestedHeightForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].requestedHeight},l.prototype.setRequestedHeightForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0&&(this.pageStates[e].requestedHeight=t)},l.prototype.getRequestedWidthForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].requestedWidth},l.prototype.setRequestedWidthForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0&&(this.pageStates[e].requestedWidth=t)},l.prototype.getRotationForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].rotateAngle/100},l.prototype.setRotationForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&this.documentModel.model.pageData[e].rotateAngle!==t&&(this.documentModel.model.pageData[e].rotateAngle=100*t,this.documentModel.setPagesModifiedSinceInit(!0,e))},l.prototype.getHorizontalFlipForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].flipHorizontal},l.prototype.setHorizontalFlipForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].flipHorizontal=t)},l.prototype.getVerticalFlipForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].flipVertical},l.prototype.setVerticalFlipForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].flipVertical=t)},l.prototype.getInvertImageForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].invertImage},l.prototype.setInvertImageForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&this.documentModel.model.pageData[e].invertImage!==t&&(this.documentModel.model.pageData[e].invertImage=t,this.documentModel.setPagesModifiedSinceInit(!0,e),this.imageManager&&this.imageManager.createManipulatedPage(e,this))},l.prototype.getBrightnessForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].brightness},l.prototype.setBrightnessForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&(this.documentModel.model.pageData[e].brightness=t,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&(this.pageStates[e].brightness=t),this.imageManager&&this.imageManager.createManipulatedPage(e,this)},l.prototype.getContrastForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].contrast},l.prototype.setContrastForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&(this.documentModel.model.pageData[e].contrast=t,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&(this.pageStates[e].contrast=t),this.imageManager&&this.imageManager.createManipulatedPage(e,this)},l.prototype.getGammaForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].gamma},l.prototype.setGammaForPage=function(e,t){e=this.validatePageNumber(e),0===t?t=1:400===t&&(t=399),this.documentModel&&(this.documentModel.model.pageData[e].gamma=t,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&(this.pageStates[e].gamma=t),this.imageManager&&this.imageManager.createManipulatedPage(e,this)},l.prototype.getDespeckleForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].despeckle},l.prototype.setDespeckleForPage=function(e){e=this.validatePageNumber(e),this.documentModel&&(this.documentModel.model.pageData[e].despeckle=50,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&this.pageStates[e].despeckle+30<=100&&(this.pageStates[e].despeckle+=30)},l.prototype.getAntiAliasOffForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].antiAliasOff},l.prototype.setAntiAliasOffForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&(this.documentModel.model.pageData[e].antiAliasOff=t,this.documentModel.setPagesModifiedSinceInit(!0,e))},l.prototype.isPageManipulated=function(e){e=this.validatePageNumber(e);var t=!1;if(this.documentModel){var a=this.documentModel.model.pageData[e];(100!==a.gamma||0!==a.brightness||0!==a.contrast||a.invertImage)&&(t=!0)}return t},l.prototype.getAnnotationsForPage=function(t,a){for(var n=this.getLayersForPage(t)||{},i=[],o=Object.keys(n),s=0;s<o.length;s++){var l=n[o[s]]||{anns:[]};if(!a||e("vvAnnotationManager").checkLayerPermission(l,r.permissionLevels.PERM_VIEW))for(var u=0;u<l.anns.length;u++)a&&l.anns[u].annDelete||i.push(l.anns[u])}return i},l.prototype.getLayersForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0&&this.pageStates[e].annotationLayers)return this.pageStates[e].annotationLayers},l.prototype.setImageLayers=function(e){e&&e.length&&(this.imageLayers=e)},l.prototype.getImageLayers=function(){return this.imageLayers},l.prototype.setLayersForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].annotationLayers=t)},l.prototype.getLayerFromPage=function(e,t){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates[e].annotationLayers)return this.pageStates[e].annotationLayers[t]},l.prototype.addLayerToPage=function(e,t){e=this.validatePageNumber(e),this.addLayerToLayerNames(t.layerName),this.pageStates&&(this.pageStates[e].annotationLayers||this.setLayersForPage(e,{}),this.pageStates[e].annotationLayers[t.layerName]=t)},l.prototype.addLayerToLayerNames=function(e){this.layerNames.indexOf(e)<0&&this.layerNames.push(e)},l.prototype.clearAllLayers=function(){this.layerNames=[];for(var e=0;e<this.pageStates.length;e+=1){var t=this.pageStates[e];t.annotationLayers=void 0}this.documentModel.setMetadataModifiedSinceInit(!0,this)},l.prototype.getDPIForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].dpi},l.prototype.setDPIForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].dpi=t)},l.prototype.getCompressionTypeForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].compressionType},l.prototype.setCompressionTypeForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].compressionType=t)},l.prototype.getBitDepthForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].bitDepth},l.prototype.setBitDepthForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].bitDepth=t)},l.prototype.getFormatForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].imageFormat},l.prototype.setFormatForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].imageFormat=t)},l.prototype.getTiffTag=function(e,t){if(e=this.validatePageNumber(e),this.pageStates)return this.pageStates[e].tiffTagHash[t]},l.prototype.setTiffTag=function(e,t,a){e=this.validatePageNumber(e),this.pageStates&&(null===this.pageStates[e].tiffTagHash&&(this.pageStates[e].tiffTagHash={}),this.pageStates[e].tiffTagHash[t]=a)},l.prototype.setTiffTagHashForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].tiffTagHash=t)},l.prototype.getOriginalWidthForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].originalWidth},l.prototype.setOriginalWidthForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].originalWidth=t)},l.prototype.getOriginalHeightForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].originalHeight},l.prototype.setOriginalHeightForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].originalHeight=t)},l.prototype.getCachedScrollLeft=function(){return this.cachedScroll.left},l.prototype.setCachedScrollLeft=function(e){"number"==typeof e&&(this.cachedScroll.left=e)},l.prototype.getCachedScrollTop=function(){return this.cachedScroll.top},l.prototype.setCachedScrollTop=function(e){"number"==typeof e&&(this.cachedScroll.top=e)},l.prototype.clearCachedScroll=function(){this.cachedScroll={}},l.prototype.setDocumentModelProperty=function(e,t){this.documentModel.setProperty(e,t)},l.prototype.getDocumentModelProperty=function(e){return this.documentModel.getProperty(e)},l.prototype.setDocumentModelPropertyHash=function(e){this.documentModel.setPropertyHash(e)},l.prototype.resetAfterSave=function(){for(var e=0;e<this.pageCount;e+=1)this.setRotationForPage(e,0),this.pageStates[e].imageInfoRequested=!1,this.pageStates[e].imageInfoLoaded=!1,this.pageStates[e].requestedWidth=0,this.pageStates[e].requestedHeight=0;this.clearImageBuffer(),this.imageManager.nukeBuffers(),this.removeAllCrop(),this.getDocumentModel().setPagesModifiedSinceInit(!1),this.getDocumentModel().setMetadataModifiedSinceInit(!1),this.getDocumentModel().setAnnotationsModifiedSinceInit(!1),this.getDocumentModel().setBookmarksModifiedSinceInit(!1),this.getDocumentModel().setNotesModifiedSinceInit(!1),this.getDocumentModel().setWatermarksModifiedSinceInit(!1)},l.prototype.isPageCropped=function(e){return e||0===e||(e=this.pageNumber),!this.isVideo()&&this.documentModel.model.pageData[e].cropTop>=0},l.prototype.isDocumentCropped=function(){for(var e=0;e<this.pageCount;e++)if(this.documentModel.model.pageData[e].cropTop>=0)return!0;return!1},l.prototype.removeCropOnPage=function(e){null!==e&&void 0!==e||(e=this.pageNumber),this.documentModel.model.pageData[e].cropTop=-1,this.documentModel.model.pageData[e].cropLeft=-1,this.documentModel.model.pageData[e].cropWidth=-1,this.documentModel.model.pageData[e].cropHeight=-1,this.resetSVGSupport(!0)},l.prototype.removeAllCrop=function(){for(var e=0;e<this.pageCount;e++)this.documentModel.model.pageData[e].cropTop=-1,this.documentModel.model.pageData[e].cropLeft=-1,this.documentModel.model.pageData[e].cropWidth=-1,this.documentModel.model.pageData[e].cropHeight=-1;this.resetSVGSupport(!0)},l.prototype.getAllTextOnPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates[e])return this.pageStates[e].allText},l.prototype.getPageText=function(e){if(this.pageStates&&!(this.pageStates.length<1))return e=this.validatePageNumber(e),this.pageStates[e]?this.pageStates[e].pageText:void 0},l.prototype.addPageText=function(e,t){!this.pageStates||this.pageStates.length<1||(t=this.validatePageNumber(t),this.pageStates[t]&&(this.pageStates[t].pageText=e))},l.prototype.logPageText=function(e){e=this.validatePageNumber(e);var t=this.pageStates[e].pageText,a=t.wordRects;console.log("logPageText"),console.log(a.length)},l.prototype.removePageText=function(e){e=this.validatePageNumber(e),this.pageStates[e].pageText=null},l.prototype.rotatePageTextSelectionBoxes=function(e,t){var a=this.pageStates[e];if(a.pageText&&a.pageText.wordRects)for(var n=0;n<a.pageText.wordRects.length;n++){var i,o=a.pageText.wordRects[n];9e3===t?(i=o.top,o.top=o.left,o.left=a.originalHeight-o.bottom,o.bottom=o.right,o.right=a.originalHeight-i):18e3===t?(i=o.top,o.top=a.originalHeight-o.bottom,o.bottom=a.originalHeight-i,i=o.left,o.left=a.originalWidth-o.right,o.right=a.originalWidth-i):27e3===t&&(i=o.top,o.top=a.originalWidth-o.right,o.right=o.bottom,o.bottom=a.originalWidth-o.left,o.left=i)}},l.prototype.removeDocumentNote=function(e){e=this.documentNoteArray.length-e-1,this.documentNoteArray.splice(e,1)},l.prototype.pushUndoObject=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].undoObjectArray.length=this.pageStates[e].undoIndex+1,this.pageStates[e].undoObjectArray.push(this.cloneUndoObject(t)),this.pageStates[e].undoIndex=this.pageStates[e].undoObjectArray.length-1,this.pageStates[e].poppedObjectArray.length=0},l.prototype.pushPoppedObject=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].poppedObjectArray.length=this.pageStates[e].poppedIndex+1,this.pageStates[e].poppedObjectArray.push(t),this.pageStates[e].poppedIndex=this.pageStates[e].poppedObjectArray.length-1},l.prototype.popPoppedObject=function(e){e=this.validatePageNumber(e);var t=this.pageStates[e].poppedObjectArray.pop();return this.pageStates[e].poppedIndex=this.pageStates[e].poppedObjectArray.length-1,t},l.prototype.resetUndoObject=function(e){e=this.validatePageNumber(e),this.pageStates[e].undoObject.unchangedAnn=void 0,this.pageStates[e].undoObject.modifiedAnn=void 0,this.pageStates[e].undoObject.referenceAnn=void 0,this.pageStates[e].undoObject.layer=void 0,this.pageStates[e].undoObject.type=void 0},l.prototype.getUndoObject=function(e){if(this.pageStates&&!(this.pageStates.length<1))return e=this.validatePageNumber(e),this.pageStates[e].undoObject},l.prototype.cloneUndoObject=function(e){var t={unchangedAnn:e.unchangedAnn,modifiedAnn:e.modifiedAnn,referenceAnn:e.referenceAnn,layer:e.layer,type:e.type};return t},l.prototype.getUndoObjectArray=function(e){return e=this.validatePageNumber(e),this.pageStates[e].undoObjectArray},l.prototype.getPoppedObjectArray=function(e){return e=this.validatePageNumber(e),this.pageStates[e].poppedObjectArray},l.prototype.getUndoIndex=function(e){return e=this.validatePageNumber(e),this.pageStates[e].undoIndex},l.prototype.setUndoIndex=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].undoIndex=t},l.prototype.getPoppedIndex=function(e){return e=this.validatePageNumber(e),this.pageStates[e].poppedIndex},l.prototype.setPoppedIndex=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].poppedIndex=t},l.prototype.setUndoIndexToMax=function(e){e=this.validatePageNumber(e),this.pageStates[e].undoIndex=this.pageStates[e].undoObjectArray.length-1},l}),define("vvStateManager",["vvDiffManager","vvDocViewState"],function(e,t){"use strict";function a(){this.states=[{},{}],this.displayedDocuments=[],this.splitInstance=null,this.activePane=0,this.diffs={}}var n;a.prototype.setSplit=function(e){this.splitInstance=e},a.prototype.getActivePaneState=function(){var e=this.displayedDocuments[this.activePane];if(e)return this.states[this.activePane][e]},a.prototype.getCurrentState=function(e){if(e=e||0,!(e>this.displayedDocuments.length)&&this.displayedDocuments[e]){var t=this.displayedDocuments[e];return this.states[e][t]}},a.prototype.getOpenDocumentId=function(e){return e=e||0,this.displayedDocuments[e]},a.prototype.getOuterDivFromState=function(e){if(!e)return $();var t=e.currentPaneIndex||0;return this.states[t][e.getDocumentId()]?$(".vvOuter").eq(t):$(".vvOuter").eq(this.activePane)},a.prototype.setActivePane=function(e){this.activePane=e},a.prototype.setStateForDocumentId=function(e,t,a){return a=a||0,this.states[a][e]=t,t.currentPaneIndex=a,t},a.prototype.openNewState=function(e){var a=e.paneIndex||0;if(e.documentId){var n=new t(e.documentId,e.documentModel,e.pageCount,e.pageNumber,e.tabNumber,e.zoomMode);return n.displayName=e.displayName,this.setStateForDocumentId(e.documentId,n,a),n}},a.prototype.getStateForDocumentId=function(e,t){var a=t||0;if(this.states[a][e])return this.states[a][e];if(!(t>=0))return this.states[1][e]},a.prototype.getAllStates=function(){for(var e=[],t=0;t<this.states.length;t++)for(var a=Object.keys(this.states[t]),n=0;n<a.length;n++)e.push(this.getStateForDocumentId(a[n],t));return e},a.prototype.removeStateForDocumentId=function(e,t){t=t||0,this.displayedDocuments[t]===e&&(this.displayedDocuments[t]=""),this.states[t][e]&&delete this.states[t][e]},a.prototype.setDisplayedState=function(e,t){t=t||0,this.displayedDocuments[t]=e.getDocumentId()},a.prototype.isVideoOpen=function(){for(var e=!1,t=0;t<this.displayedDocuments.length;t++)if(this.displayedDocuments[t]){var a=this.getStateForDocumentId(this.displayedDocuments[t]);if(!a)return!1;e=e||a.isVideo()}return e},a.prototype.getCurrentDiff=function(){var e=this.displayedDocuments[0],t=this.displayedDocuments[1];if(e&&this.diffs[e]&&t&&!this.states[0][e].closedTab&&!this.states[1][t].closedTab)return this.diffs[e][t]},a.prototype.setDiff=function(e){var t=this.displayedDocuments[0],a=this.displayedDocuments[1];a&&(this.diffs[t]={},this.diffs[t][a]=e)};var i=function(){return n=n||new a};return i()}),define("vvNoteBase",["vvUtility","vvStateManager"],function(e,t){function a(){n=this,this.username="",this.ableToAddNote=!0,this.timestamp=null,this.displayedTimestamp=null,this.createdTag=null,this.note={text:null,createDate:null,editDate:null,idxFlag:null,userId:null}}var n;a.prototype.getAbleToAddNote=function(){return this.ableToAddNote},a.prototype.setAbleToAddNote=function(e){this.ableToAddNote=e},a.prototype.getUsername=function(){return this.username&&e.encodeForHTML(this.username)===$("#vvAnnotationNoteAdderAuthor").html()||n.setUsername(),this.username},a.prototype.setUsername=function(e){e&&0!==e.length?(this.username=e,virtualViewer.getUserPreferences().setUsername(e)):this.username=virtualViewer.getUserPreferences().getUsername()},a.prototype.getNote=function(){return this.note},a.prototype.getTimestamp=function(){return this.timestamp},a.prototype.setTimestamp=function(e){this.timestamp=e},a.prototype.getDisplayedTimestamp=function(){return this.displayedTimestamp},a.prototype.setDisplayedTimestamp=function(e){this.displayedTimestamp=e},a.prototype.createTimestamp=function(){var e=new Date,t=e.toUTCString();t=t.replace(/,/g,""),n.setTimestamp(t);var a=new Date(t);a=a.toDateString()+" "+a.toLocaleTimeString(),n.setDisplayedTimestamp(a)},a.prototype.addNote=function(a,r){if(n.getAbleToAddNote()){n.resetNote();var s,l,u=t.getCurrentState(),d=u.getDocumentModel();if("Document"===a)s="#vvDocumentNoteContentInput",l="#vvDocumentNotesInternal";else{if("Annotation"!==a)return;s="#vvAnnotationNoteContentInput",l="#vvAnnotationNotesInternal",r||(r=virtualViewer.getCurrentAnnObject())}if(""!==$(s).val().trim()){n.createTimestamp();var c=n.getNote();if(c.userId=n.getUsername(),c.text=$(s).val(),c.createDate=n.getTimestamp(),"Document"===a){var g=d.model.documentNotes.notes,v=n.copyNote(c);v.userId=encodeURIComponent(v.userId),v.text=encodeURIComponent(v.text),g.splice(0,0,v)}else"Annotation"===a&&r.noteArray.unshift(n.copyNote(c));d.setNotesModifiedSinceInit(!0,u);var p=$("<div class=\"vvNote\"> <button type ='button' title = '"+e.getLocalizedValue("notes.deleteNote","Delete Note")+"'class='smallClose vvNotesCloseButton' <span aria-hidden='true'>x</span></button> </div>");p.append("<hr>"),p.append('<div class="vvNoteAuthor"> <b>'+e.encodeForHTML(c.userId)+"</b> </div>"),p.append('<div class="vvNoteContent">'+e.encodeForHTML(c.text)+"</div>"),p.append('<div class="vvNoteDate"><span id="vvCreatedOrEdited"></span><span id="vvNoteTimeStamp">'+n.getDisplayedTimestamp()+"</span></div>"),$(l).prepend(p),i(a,r),$("#vvCreatedOrEdited").text(e.getLocalizedValue("notes.created","Created: ")),o(a,r,p),$(s).val(""),n.setAbleToAddNote(!0)}}};var i=function(e,a){$(".vvNotesCloseButton").click(function(){var i=this.parentElement.parentElement;if(i){var o=$(i).children().index(this.parentElement);$($(i).children()[o]).remove();var r=t.getCurrentState(),s=r.getDocumentModel();if("Document"===e){var l=s.model.documentNotes.notes;l.splice(o,1),virtualViewer.docHasNotes()||$("#vvNotesTabSpan").removeClass("docNotesExist"),s.setNotesModifiedSinceInit(!0,r)}else"Annotation"===e&&(a.removeNoteFromArray(o),virtualViewer.getCurrentAnnObject().markRevised(),s.setAnnotationsModifiedSinceInit(!0,r));n.setAbleToAddNote(!0)}})},o=function(e,t,a){if(a&&a.length){var i=function(a){if(1!==a.tapCount){a.tapCount>1&&a.preventDefault();var i=$(".vvNotesInternal").find("input");if(i.length)return void i.focus();var o=$(this);$(this).hasClass("vvNote")||(o=$(a.target).closest(".vvNote")),
n.getAbleToAddNote()&&n.editNote(o,e,t)}};if(Modernizr.touchevents){var o=new Hammer(a[0]);o.on("tap",i)}a.dblclick(i)}};a.prototype.editNote=function(a,i,o){n.setAbleToAddNote(!1),n.resetNote();var l=$(a.children()[4].children[0]).html(),u=$(a.children()[4].children[1]).html();$(a.children()[4]).remove(),$(a.children()[3]).remove();var d,c,g=$(a).parent().children().index($(a));if("Document"===i){var v=t.getCurrentState(),p=v.getDocumentModel(),h=p.model.documentNotes.notes;c=h[g],c.userId=decodeURIComponent(c.userId),c.text=decodeURIComponent(c.text),d="vvDocumentNoteEditContentInput"}else"Annotation"===i&&(c=o.noteArray[g],d="vvAnnotationNoteEditContentInput");var f=c.text;a.append("<input id="+d+' type="text" name="vvNoteEditContentInputName">'),$("#"+d).val(f),a.append('<button id="vvNoteEditButton" type="button"></button>'),a.append('<button id="vvNoteCancelEditButton" type="button"></button>'),$("#vvNoteEditButton").text(e.getLocalizedValue("notes.applyButton","Apply")),$("#vvNoteCancelEditButton").text(e.getLocalizedValue("notes.cancelButton","Cancel")),$("#vvNoteEditButton").attr("title",e.getLocalizedValue("notes.applyButton","Apply")),$("#vvNoteCancelEditButton").attr("title",e.getLocalizedValue("notes.cancelButton","Cancel")),$("#vvNoteEditButton").click(function(){""!==$("#"+d).val().trim()&&r(a,i,o)}),$("#vvNoteCancelEditButton").click(function(){s(a,i,f,l,u)}),n.setAbleToAddNote(!0)};var r=function(e,a,i){var o;if("Document"===a)o="vvDocumentNoteEditContentInput";else{if("Annotation"!==a)return;o="vvAnnotationNoteEditContentInput"}var r=$("#"+o).val();n.createTimestamp();var s,l=t.getCurrentState(),u=l.getDocumentModel(),d=e.parent().children().index(e);if("Document"===a){var c=u.model.documentNotes.notes;s=c[d],s.userId=encodeURIComponent(n.getUsername()),s.text=encodeURIComponent(r),u.setNotesModifiedSinceInit(!0,l)}else{if("Annotation"!==a)return;s=i.noteArray[d],s.userId=n.getUsername(),s.text=r,virtualViewer.getCurrentAnnObject().markRevised(),u.setAnnotationsModifiedSinceInit(!0,l)}s.editDate=n.getTimestamp(),n.setAbleToAddNote(!0),"Document"===a?virtualViewer.getDocumentNotes().loadDocumentNotes():"Annotation"===a&&i.loadAnnotationNotes()},s=function(t,a,i,o,r){var s;if("Document"===a)s="vvDocumentNoteEditContentInput";else{if("Annotation"!==a)return;s="vvAnnotationNoteEditContentInput"}$("#"+s).remove(),$("#vvNoteEditButton").remove(),$("#vvNoteCancelEditButton").remove(),t.append('<div class="vvNoteContent">'+e.encodeForHTML(i)+"</div>"),t.append('<div class="vvNoteDate"><span id="vvCreatedOrEdited">'+o+'</span> <span id="vvNoteTimeStamp">'+r+"</span></div>"),n.setAbleToAddNote(!0)};return a.prototype.addExistingNote=function(t,a,r){var s;n.resetNote();var l=n.getNote();l.userId=t.userId,l.text=t.text;var u="",d="";t.editDate?(u=e.getLocalizedValue("notes.edited","Edited: "),d=t.editDate):(u=e.getLocalizedValue("notes.created","Created: "),d=t.createDate),d=d.replace(/,/g,""),"Document"===a?(s="#vvDocumentNotesInternal",l.userId=decodeURIComponent(l.userId),l.text=decodeURIComponent(l.text)):"Annotation"===a&&(s="#vvAnnotationNotesInternal");var c=new Date(d);c=c.toDateString()+" "+c.toLocaleTimeString();var g=$("<div class=\"vvNote\"> <button type ='button' title = '"+e.getLocalizedValue("notes.deleteNote","Delete Note")+"' class='smallClose vvNotesCloseButton' <span aria-hidden='true'>x</span></button></div>");g.append("<hr>"),g.append('<div class="vvNoteAuthor"> <b>'+e.encodeForHTML(l.userId)+"</b> </div>"),g.append('<div class="vvNoteContent">'+e.encodeForHTML(l.text)+"</div>"),g.append('<div class="vvNoteDate"><span id="vvCreatedOrEdited">'+u+'</span><span id="vvNoteTimeStamp">'+c+"</span></div>"),$(s).append(g),i(a,r),o(a,r,g)},a.prototype.resetNote=function(){this.note={text:null,createDate:null,editDate:null,idxFlag:null,userId:null}},a.prototype.copyNote=function(e){var t={text:e.text,createDate:e.createDate,editDate:e.editDate,idxFlag:e.idxFlag,userId:e.userId};return t},a}),define("annotations",["vvUtility","vvDefines","user-config/config","vvNoteBase","vvBoundingBox","vvPoint","vvStateManager"],function(e,t,a,n,i,o,r){function s(){}s.prototype.init=function(e,i,o,r,s,l,u,d,c,g,v,p){this.page=o,this.pageWidth=r,this.pageHeight=s,this.preview=!1,this.annDelete=!1,this.doubleByte=u,this.index=d,this.docDPI=c,this.isFilenet=g,this.isDaeja=v,this.isIDM=p,this.layerName=l,this.opacity=1,this.revisionHistory=[],this.currentRevision={user:"",date:"",modificationType:""},a.collapseStickiesByDefault&&this.getType()===t.annotationTypes.SANN_POSTIT?this.collapsed=!0:this.collapsed=!1,this.notes=new n,this.wrappedText=[],this.wrappedTextIsStale=!0,this.pasteLocation=null,e&&this.initFromXML(e),i&&this.initFromObject(i)},s.prototype.initFromXML=function(t){this.annId=e.getValue(t,"annID"),this.isDaeja=e.fixBooleanString(e.getValue(t,"isDaeja")),this.createDate=e.getValue(t,"annCreateDate"),this.modifyDate=e.getValue(t,"annModifyDate"),this.fontName=e.getValue(t,"fontName"),this.fontSize=e.getValue(t,"fontSize"),this.fontBold=e.fixBooleanString(e.getValue(t,"fontBold")),this.fontItalic=e.fixBooleanString(e.getValue(t,"fontItalic")),this.fontStrike=e.fixBooleanString(e.getValue(t,"fontStrike")),this.fontUnderline=e.fixBooleanString(e.getValue(t,"fontUnderline")),this.fontColor=e.getValue(t,"fontColor"),this.type=e.getValue(t,"annType"),this.createUser=decodeURIComponent(e.getValue(t,"annCreateUser")),this.revisionHistory=l(t),this.ordinal=parseInt(e.getValue(t,"annOrdinal"),10),this.lineStyle=e.getValue(t,"lineStyle"),this.setRotationAngle(e.getValue(t,"rotationAngle")),this.lineColor=e.getValue(t,"lineColor"),this.fillColor=e.getValue(t,"fillColor"),this.lineWidth=e.getValue(t,"lineWidth"),this.setTextString(e.getValue(t,"textString"),!0),this.bitmapData=e.getValue(t,"bitmapData"),this.annotationTags=e.parseAnnTags(t),this.noteArray=e.parseAnnNotes(t),this.box=new i(parseInt(e.getValue(t,"annStartX"),10),parseInt(e.getValue(t,"annStartY"),10),parseInt(e.getValue(t,"annWidth"),10),parseInt(e.getValue(t,"annHeight"),10));var a=e.getValue(t,"fillTransparent"),n=e.getValue(t,"annLayerID"),o=e.getValue(t,"pointArray");this.fontSize?this.setFontSize(parseInt(this.fontSize,10),!0):this.fontSize=0,o&&(this.pointArray=e.parsePointArray(o),this.fixBoundingBox()),a?"true"===a&&(this.opacity=.5):this.opacity=1,"ANNOTATION_LAYER_ID"!==n&&(this.layerName=n),this.lineWidth?this.lineWidth=parseInt(this.lineWidth,10):this.lineWidth=1,this.rotationAngle?this.setRotationAngle(parseInt(this.rotationAngle,10)):this.setRotationAngle(0)},s.prototype.initFromObject=function(e){if(this.annId=e.annId,this.isDaeja=e.isDaeja,this.annDelete=e.annDelete,this.createDate=e.createDate,this.modifyDate=e.modifyDate,this.fontName=e.fontName,this.fontSize=e.fontSize,this.fontBold=e.fontBold,this.fontItalic=e.fontItalic,this.fontStrike=e.fontStrike,this.fontUnderline=e.fontUnderline,this.fontColor=e.fontColor,this.type=e.type,this.createUser=e.createUser,this.revisionHistory=e.revisionHistory||[],this.ordinal=e.ordinal,this.lineStyle=e.lineStyle,this.setRotationAngle(e.rotationAngle),this.lineColor=e.lineColor,this.fillColor=e.fillColor,this.lineWidth=e.lineWidth,this.setTextString(e.textString,!0),this.bitmapData=e.bitmapData,this.layerTemp=e.layerName,this.annotationTags=e.annotationTags,this.noteArray=e.noteArray,e.pointArray){this.pointArray=[];for(var t=0;t<e.pointArray.length;t++)this.pointArray.push(new o(e.pointArray[t].x,e.pointArray[t].y))}this.box=new i(e.box.one.x,e.box.one.y,e.box.two.x-e.box.one.x,e.box.two.y-e.box.one.y),this.opacity=e.opacity},s.prototype.isSameAs=function(e){var t=this,a=e;if(void 0===t||void 0===a)return!1;if(t.page!==a.page)return!1;if(t.annDelete!==a.annDelete)return!1;var n=t.getBoundingBox(),i=a.getBoundingBox();if(n.one.x!==i.one.x)return!1;if(n.one.y!==i.one.y)return!1;if(n.two.x!==i.two.x)return!1;if(n.two.y!==i.two.y)return!1;if(t.doubleByte!==a.doubleByte)return!1;if(t.fillColor!==a.fillColor)return!1;if(t.fontBold!==a.fontBold)return!1;if(t.fontColor!==a.fontColor)return!1;if(t.fontItalic!==a.fontItalic)return!1;if(t.fontName!==a.fontName)return!1;if(t.fontSize!==a.fontSize)return!1;if(t.fontStrike!==a.fontStrike)return!1;if(t.fontUnderline!==a.fontUnderline)return!1;if(t.index!==a.index)return!1;if(t.layerName!==a.layerName)return!1;if(t.lineColor!==a.lineColor)return!1;if(t.lineStyle!==a.lineStyle)return!1;if(t.lineWidth!==a.lineWidth)return!1;if(t.opacity!==a.opacity)return!1;if(t.ordinal!==a.ordinal)return!1;if(t.pageHeight!==a.pageHeight)return!1;if(t.pageWidth!==a.pageWidth)return!1;var o=t.pointArray,r=a.pointArray;if(o||r){if(!o)return!1;if(!r)return!1;var s=o.length;r.length>o.length&&(s=r.length);for(var l=0;l<s;l+=1){if(o[l].x!==r[l].x)return!1;if(o[l].y!==r[l].y)return!1}}if(t.preview!==a.preview)return!1;if(t.getRotationAngle()!==a.getRotationAngle())return!1;if(t.textString!==a.textString)return!1;if(t.type!==a.type)return!1;for(var u=0;u<t.noteArray.length;u++)if(t.noteArray[u]!==a.noteArray[u])return!1;return!0},s.prototype.copyFrom=function(e){var t=this,a=e;t.annDelete=a.annDelete;var r=a.annotationTags;if(t.annotationTags=[],r)for(var s=0;s<r.length;s+=1)t.annotationTags.push(r[s]);t.bitmapData=a.bitmapData,t.isDaeja=a.isDaeja,t.box=new i,t.box.copyFrom(a.box),t.collapsed=a.collapsed,t.createDate=a.createDate,t.modifyDate=a.modifyDate,t.createUser=a.createUser,t.modifyUser=a.modifyUser,t.docDPI=a.docDPI,t.doubleByte=a.doubleByte,t.fillColor=a.fillColor,t.fontBold=a.fontBold,t.fontColor=a.fontColor,t.fontItalic=a.fontItalic,t.fontName=a.fontName,t.fontSize=a.fontSize,t.fontStrike=a.fontStrike,t.fontUnderline=a.fontUnderline,t.index=a.index,t.layerName=a.layerName,t.annId=a.annId,t.lineColor=a.lineColor,t.lineStyle=a.lineStyle,t.lineWidth=a.lineWidth,t.opacity=a.opacity,t.ordinal=a.ordinal,t.page=a.page,t.pageHeight=a.pageHeight,t.pageWidth=a.pageWidth;var l=a.pointArray;if(t.pointArray=[],l)for(var u=0;u<l.length;u+=1)t.pointArray.push(new o(l[u].x,l[u].y));else t.pointArray=null;t.preview=a.preview,t.setRotationAngle(a.rotationAngle),t.textString=a.textString,t.type=a.type,t.notes=new n,t.revisionHistory=[],a.revisionHistory=a.revisionHistory||[];for(var d=0;d<a.revisionHistory.length;d++){var c={user:a.revisionHistory[d].user,date:a.revisionHistory[d].date,modificationType:a.revisionHistory[d].modificationType};t.revisionHistory.push(c)}t.currentRevision={user:a.currentRevision.user,date:a.currentRevision.date,modificationType:a.currentRevision.modificationType};var g=a.noteArray;if(t.noteArray=[],g)for(var v=0;v<g.length;v+=1)t.noteArray.push(g[v]);else t.noteArray=null;return t};var l=function(t){if(!t)return[];var a=t.getElementsByTagName("annModificationItem");if(!a||!a.length){var n=e.getValue(t,"annModifyDate");return n?[{user:e.getLocalizedValue("annPopUp.annUnknownUser","Unknown User"),date:n,modificationType:""}]:[]}for(var i=[],o=0;o<a.length;o++){var r=a[o];if(r){var s={};s.user=decodeURIComponent(e.getValue(r,"annModifyUser")),s.date=e.getValue(r,"annModifyDate"),s.modificationType=e.getValue(r,"annModifyType"),i.push(s)}}return i};return s.prototype.clone=function(){var e=new s;return e.init(),e.copyFrom(this),e},s.prototype.getType=function(){return this.type},s.prototype.getRefinedType=function(){return this.type===t.annotationTypes.SANN_RECTANGLE&&e.isRedactionLayer(this.layerName)?t.annotationTypes.SANN_REDACTION_RECT:this.type===t.annotationTypes.SANN_RECTANGLE&&this.fillColor&&this.opacity<1?t.annotationTypes.SANN_HIGHLIGHT_RECT:this.type===t.annotationTypes.SANN_LINE&&this.pointArray.length>2?t.annotationTypes.SANN_FREEHAND:this.type},s.prototype.getLocalizedTypeName=function(){var t=this.getRefinedType(),a=e.getLocalizedValue("annotationInfoList.annotationTypes."+t);return a||(a=e.getLocalizedValue("annotationInfoList.annotationTypes.general","Annotation")),a},s.prototype.getDelete=function(){return this.annDelete},s.prototype.setDelete=function(e){this.annDelete=e},s.prototype.getDoubleByte=function(){return this.doubleByte},s.prototype.setDoubleByte=function(e){this.doubleByte=e},s.prototype.setAbleToAddNote=function(e){this.ableToAddNote=e},s.prototype.getAbleToAddNote=function(){return this.ableToAddNote},s.prototype.fixCoordinates=function(){if(this.getWidthRatio()>0&&this.getHeightRatio()>0&&(this.box=new i(Math.round(this.box.getX1()/this.getWidthRatio()),Math.round(this.box.getY1()/this.getHeightRatio()),Math.round(this.box.getWidth()/this.getWidthRatio()),Math.round(this.box.getHeight()/this.getHeightRatio())),this.pointArray))for(var e=0;e<this.pointArray.length;e+=1)this.pointArray[e].setX(Math.round(this.pointArray[e].getX()/this.getWidthRatio())),this.pointArray[e].setY(Math.round(this.pointArray[e].getY()/this.getHeightRatio()))},s.prototype.fixedBox=function(){if(this.getWidthRatio()>0&&this.getHeightRatio()>0){var e=new i(Math.round(this.box.getX1()/this.getWidthRatio()),Math.round(this.box.getY1()/this.getHeightRatio()),Math.round(this.box.getWidth()/this.getWidthRatio()),Math.round(this.box.getHeight()/this.getHeightRatio()));return e}return!1},s.prototype.fixBoundingBox=function(e,a){var n=null,o=null,s=null,l=null,u=this.box;e&&(u=e);var d=this.pointArray;if(a&&(d=a),d&&d.length>1){var c=d[0].getX(),g=d[0].getY(),v=d[0].getX(),p=d[0].getY();if(d)for(var h=0;h<d.length;h+=1)d[h].getX()<c&&(c=d[h].getX()),d[h].getY()<g&&(g=d[h].getY()),d[h].getX()>v&&(v=d[h].getX()),d[h].getY()>p&&(p=d[h].getY());if(n=c,o=g,s=v-c,l=p-g,this.type===t.annotationTypes.SANN_CIRCLE){var f=r.getActivePaneState(),m=f.getRotationForPage(f.getPageNumber());0===m?l=s:90===m?s=l:180===m?(l=s*-1,o=p):270===m&&(s=l*-1,n=v)}return void(e?e=new i(n,o,s,l):this.box=new i(n,o,s,l))}n=u.getX1(),o=u.getY1(),s=u.getWidth(),l=u.getHeight(),s<0&&(s*=-1,n-=s),l<0&&(l*=-1,o-=l),e?e=new i(n,o,s,l):this.box=new i(n,o,s,l)},s.prototype.rotate=function(e,t){this.rotateAnnotation(e,t),this.fixBoundingBox()},s.prototype.rotatePointArray=function(e,t,a,n){if(!this.pointArray&&!t)return null;a||(a=this.pageWidth),n||(n=this.pageHeight);var i;i=t?this.pointArray.length:t.length;for(var o=0;o<i;o+=1)t?t[o].rotate(e,a,n):this.pointArray[o].rotate(e,a,n)},s.prototype.getPointRotatedForAnn=function(e,t){t||(t=r.getActivePaneState());var a,n=this.getRotationAngle(),i=t.pageStates[this.page].requestedWidth,s=t.pageStates[this.page].requestedHeight;return a=90===n?new o(e.y,i-e.x):180===n?new o(i-e.x,s-e.y):270===n?new o(s-e.y,e.x):new o(e.x,e.y)},s.prototype.updatePageDimensions=function(e){e||(e=r.getActivePaneState());var t=e.getOriginalWidthForPage(this.page),a=e.getOriginalHeightForPage(this.page),n=e.getDPIForPage(this.page),i=this.getPageWidth(),o=this.getPageHeight();this.docDPI;if(this.isFilenet&&3300===o&&2550===i){var s=this.docDPI/n;0!==t&&this.setPageWidth(t*s),0!==a&&this.setPageHeight(a*s)}if(0===this.rotationAngle||180===this.rotationAngle){if(t>=a&&this.getPageWidth()>=this.getPageHeight()||t<a&&this.getPageWidth()<this.getPageHeight())return}else if((90===this.rotationAngle||270===this.rotationAngle)&&(t>=a&&this.getPageWidth()<=this.getPageHeight()||t<a&&this.getPageWidth()>this.getPageHeight()))return;var l=this.getPageHeight();this.setPageHeight(this.getPageWidth()),this.setPageWidth(l)},s.prototype.getIndex=function(){return this.index},s.prototype.setIndex=function(e){this.index=e},s.prototype.getOrdinal=function(){return this.ordinal},s.prototype.setCreateDate=function(e){this.createDate=e},s.prototype.getCreateDate=function(){return this.createDate},s.prototype.setModifyDate=function(e){this.modifyDate=e},s.prototype.getModifyDate=function(){return this.modifyDate},s.prototype.getCreateUser=function(){return this.createUser},s.prototype.setCreateUser=function(e){this.createUser=e},s.prototype.getModifyUser=function(){return this.modifyUser},s.prototype.setModifyUser=function(e){this.modifyUser=e},s.prototype.setOrdinal=function(e){this.ordinal=e},s.prototype.getWidthRatio=function(e){e||(e=r.getActivePaneState());var t=this.page;t>=e.pageStates.length&&(t=e.pageNumber);var a=e.pageStates[t].requestedWidth,n=e.pageStates[t].requestedHeight,i=1;return i=a>n&&this.pageWidth>this.pageHeight||a<n&&this.pageWidth<this.pageHeight?a/this.pageWidth:n/this.pageWidth,0===i&&(i=1),i},s.prototype.getHeightRatio=function(e){e||(e=r.getActivePaneState());var t=this.page;t>=e.pageStates.length&&(t=e.pageNumber);var a,n=e.pageStates[t].requestedWidth,i=e.pageStates[t].requestedHeight;return a=n>i&&this.pageWidth>this.pageHeight||n<i&&this.pageWidth<this.pageHeight?i/this.pageHeight:n/this.pageHeight,0===a&&(a=1),a},s.prototype.setHeight=function(e){if(e&&!(e<1)){e=parseInt(e,10);var t=this.box.getY1(),a=t+e;this.updatePageDimensions(),a>this.pageHeight&&(e=this.pageHeight-t);var n=new i(this.box.getX1(),t,this.box.getWidth(),e);this.stretchPointArray(this.box,n),this.box=n}},s.prototype.getHeight=function(){return this.box.getHeight()},s.prototype.getWidth=function(){return this.box.getWidth()},s.prototype.setWidth=function(e){if(e&&!(e<1)){e=parseInt(e,10);var t=this.box.getX1(),a=t+e;this.updatePageDimensions(),a>this.pageWidth&&(e=this.pageWidth-t);var n=new i(t,this.box.getY1(),e,this.box.getHeight());this.stretchPointArray(this.box,n),this.box=n}},s.prototype.scaleAnn=function(e){if(e&&!(e<0)){var t=this.box.getX1()*e,a=this.box.getX2()*e,n=this.box.getY1()*e,o=this.box.getY2()*e,r=a-t,s=o-n,l=new i(t,n,r,s);this.stretchPointArray(this.box,l),this.box=l}},s.prototype.getAdjustedHeight=function(){var e=r.getActivePaneState(),t=(this.getRotationAngle()+e.getRotationForPage(this.page))%360;return 90===t||270===t?parseInt(this.box.getWidth()*this.getWidthRatio(e),10):parseInt(this.box.getHeight()*this.getHeightRatio(e),10)},s.prototype.getAdjustedWidth=function(){var e=r.getActivePaneState(),t=(this.getRotationAngle()+e.getRotationForPage(this.page))%360;return 90===t||270===t?parseInt(this.box.getHeight()*this.getHeightRatio(e),10):parseInt(this.box.getWidth()*this.getWidthRatio(e),10)},s.prototype.getAdjustedTop=function(){var e=r.getActivePaneState(),t=(this.getRotationAngle()+e.getRotationForPage(this.page))%360;return 90===t?this.box.getX1()*this.getWidthRatio(e):180===t?(this.pageHeight-this.box.getY2())*this.getHeightRatio(e):270===t?(this.pageWidth-this.box.getX2())*this.getWidthRatio(e):this.box.getY1()*this.getHeightRatio(e)},s.prototype.getAdjustedLeft=function(){var e,t=r.getActivePaneState(),a=(this.getRotationAngle()+t.getRotationForPage(this.page))%360;return e=90===a?(this.pageHeight-this.box.getY2())*this.getHeightRatio(t):180===a?(this.pageWidth-this.box.getX2())*this.getWidthRatio(t):270===a?this.box.getY1()*this.getHeightRatio(t):this.box.getX1()*this.getWidthRatio(t),parseInt(e,10)},s.prototype.fitBoxToText=function(e){var n=virtualViewer.getActivePane(),i=r.getActivePaneState();if(a.autoResizeTextAnnotations&&this.getType()===t.annotationTypes.SANN_EDIT||a.autoResizeStickyNoteAnnotations&&this.getType()===t.annotationTypes.SANN_POSTIT){var o=0;this.getType()===t.annotationTypes.SANN_POSTIT&&(o=a.annotationDefaults.stickyMargin),e||(e=0===n?$("#vvImageCanvas")[0].getContext("2d"):$("#vvSplitCanvas")[0].getContext("2d")),this.updatePageDimensions(),e.save();var s=this.getFontSize(!0)*this.getHeightRatio(i),l="";this.getFontBold()&&(l+="bold "),this.getFontItalic()&&(l+="italic "),e.font=l+s+"px "+this.getFontName();for(var u=this.pageWidth-this.box.getX1(),d=this.getTextString().split("\n"),c=0,g=0;g<d.length;g++){var v=e.measureText(d[g]+"M").width/this.getWidthRatio();v>c&&(c=Math.round(v))}var p=Math.min(u,c);this.setWidth(p);var h=this.wrapTextString(e,o,i);e.restore();var f=this.getFontSize(!0)/.85,m=f/1.5;if(m+=h.length*f,m=parseInt(m,10),this.getType()===t.annotationTypes.SANN_POSTIT){var y=1.25*virtualViewer.collapsedStickySize(i.getZoomDecimal());m=Math.max(m,y)}this.setHeight(m)}},s.prototype.getPageWidth=function(){return this.pageWidth},s.prototype.setPageWidth=function(e){this.pageWidth=e},s.prototype.getPageHeight=function(){return this.pageHeight},s.prototype.setPageHeight=function(e){this.pageHeight=e},s.prototype.getLayerName=function(){return this.layerName?this.layerName:"ANNOTATION_LAYER_ID"},s.prototype.setLayerName=function(e){this.layerName=e},s.prototype.getBoundingBox=function(e){var t=r.getActivePaneState();if(e){var a=virtualViewer.collapsedStickySize()/this.getWidthRatio(t),n=new i(this.box.getX1(),this.box.getY1(),a,a);return n}return this.box},s.prototype.setBoundingBox=function(e){this.box=e},s.prototype.getLineColor=function(){return this.lineColor&&"NO_COLOR"!==this.lineColor?e.parseColorString(this.lineColor):null},s.prototype.setLineColor=function(e){this.lineColor=e},s.prototype.getFillColor=function(){return this.fillColor?e.parseColorString(this.fillColor,this.opacity):null},s.prototype.setFillColor=function(e){this.fillColor=e},s.prototype.getLineColorRGB=function(){return this.lineColor?this.lineColor:null},s.prototype.setLineColorRGB=function(e){this.lineColor=e},s.prototype.getFillColorRGB=function(){return this.fillColor?this.fillColor:null},s.prototype.setFillColorRGB=function(e){this.fillColor=e},s.prototype.getRotationAngle=function(){return this.rotationAngle?this.rotationAngle:0},s.prototype.setRotationAngle=function(e){e=e||0,this.xmlRotate=e,this.rotationAngle=e,a.rotateTextAnnotations||(this.wrappedTextIsStale=!0)},s.prototype.rotateAnnotation=function(e,t){var a=this.getRotationAngle()+e;a<0?t?this.xmlRotate=360+a%360:this.setRotationAngle(360+a%360):t?this.xmlRotate=a%360:this.setRotationAngle(a%360)},s.prototype.getLineWidth=function(e,t){var a=1/this.getWidthRatio(t);if(e)return this.lineWidth;var n=Math.round(this.lineWidth/a);return n<1&&(n=1),n},s.prototype.setLineWidth=function(e,t){var a=1/this.getWidthRatio();t?this.lineWidth=e:this.lineWidth=e*a},s.prototype.getLineStyle=function(){return this.lineStyle},s.prototype.setLineStyle=function(e){this.lineStyle=e},s.prototype.getOpacity=function(){return this.opacity},s.prototype.setOpacity=function(e){this.opacity=e},s.prototype.getPointArray=function(){return this.pointArray},s.prototype.setPointArray=function(e){this.pointArray=e},s.prototype.getFontName=function(){return this.fontName},s.prototype.setFontName=function(e){this.fontName=e},s.prototype.getFontSize=function(e){var a=Math.max(this.docDPI,t.minimumAnnotationDPI);return e?this.fontSize:this.isIDM?Math.round(7.2*this.fontSize/120):Math.round(72*this.fontSize/a)},s.prototype.setFontSize=function(e,a){var n=Math.max(this.docDPI,t.minimumAnnotationDPI);a?this.fontSize=e:this.isIDM?this.fontSize=120*e/7.2:this.fontSize=e*n/72},s.prototype.getFontBold=function(){return this.fontBold},s.prototype.setFontBold=function(e){this.fontBold=e},s.prototype.getFontItalic=function(){return this.fontItalic},s.prototype.setFontItalic=function(e){this.fontItalic=e},s.prototype.getFontStrike=function(){return this.fontStrike},s.prototype.setFontStrike=function(e){this.fontStrike=e},s.prototype.getFontUnderline=function(){return this.fontUnderline},s.prototype.setFontUnderline=function(e){this.fontUnderline=e},s.prototype.getPreview=function(){return this.preview},s.prototype.setPreview=function(e){this.preview=e},s.prototype.getFontColor=function(){return this.fontColor},s.prototype.setFontColor=function(e){this.fontColor=e},s.prototype.getMinimizeButtonSize=function(e){if(this.type!==t.annotationTypes.SANN_POSTIT)return 0;var a=t.annMinimizeButtonSize,n=e.getZoomDecimal(),i=this.getBoundingBox(this.collapsed),o=i.getWidth()*this.getWidthRatio(e),r=i.getHeight()*this.getHeightRatio(e);return(o/3<a||r/3<a)&&(a=Math.max(t.annMinimizeButtonSize*n,5)),o<=5||r<=5?0:a},s.prototype.getTextString=function(a){return this.type!==t.annotationTypes.SANN_POSTIT&&this.type!==t.annotationTypes.SANN_EDIT?"":a||!this.doubleByte?this.textString:e.Base64.decode(this.textString)},s.prototype.setTextString=function(t,n){if(!t){var i=a.annotationDefaults.textString;return void(i&&this.setTextString(i))}n||!this.doubleByte?this.textString=t:(this.textString=e.Base64.encode(t),this.doubleByte=!0),virtualViewer.updateAnnotationListItem(this)},s.prototype.saveTextString=function(){this.previousTextStrings||(this.previousTextStrings=[]),this.previousTextStrings.push(this.getTextString(!0))},s.prototype.restoreTextString=function(){return this.previousTextStrings?void this.setTextString(this.previousTextString.pop()):void(this.previousTextStrings=[])},s.prototype.wrapTextString=function(e,t,n){var i=virtualViewer.getActivePane();if(e||(e=0===i?$("#vvImageCanvas")[0].getContext("2d"):$("#vvSplitCanvas")[0].getContext("2d")),!this.getTextString())return[];var o=this,r=this.getTextString(),s=r.split("\n"),l=(this.box.getWidth()-2*t)*this.getWidthRatio(n)-this.getMinimizeButtonSize(n);if(!a.rotateTextAnnotations){var u=(this.getRotationAngle()+n.getRotationForPage(this.page))%360;90!==u&&270!==u||(l=(this.box.getHeight()-2*t)*this.getWidthRatio(n))}if(l<1)return[];l-=5,this.wrappedTextIsStale=!1;var d=function(t){for(var a=t.split(""),n="",i=0;i<a.length;i++){var r=n+a[i];e.measureText(r).width>=l&&i>0?(o.wrappedText.push(n),n=a[i]):n+=a[i]}n.trim()&&o.wrappedText.push(n)};this.wrappedText=[];for(var c=0;c<s.length;c++){for(var g=s[c].split(" "),v="",p=0,h=0;h<g.length;h++){var f=v+g[h],m=e.measureText(f).width;m>l?(v.length&&1===p?d(v):v.length&&this.wrappedText.push(v),v=g[h]+" ",p=g[h].trim().length?1:0):(v=f+" ",g[h].trim().length&&(p+=1))}1===p?d(v):this.wrappedText.push(v)}return this.wrappedText},s.prototype.getWrappedText=function(){return this.wrappedText||(this.wrappedText=[]),this.wrappedText},s.prototype.move=function(e){var t=this.box;this.box=new i(Math.round(e.getX()/this.getWidthRatio()),Math.round(e.getY()/this.getHeightRatio()),t.getWidth(),t.getHeight());var a=this.box.getX1()-t.getX1(),n=this.box.getY1()-t.getY1();return this.movePointArray(a,n),0!==a||0!==n},s.prototype.stretchLine=function(e,a,n){var i=Math.round(a/this.getWidthRatio()),r=Math.round(n/this.getHeightRatio());e===t.lineEnds.start?this.pointArray[0]=new o(i,r):e===t.lineEnds.end&&(this.pointArray[1]=new o(i,r))},s.prototype.stretch=function(a,n,o){n>$("#vvDummyScroller").width()?n=$("#vvDummyScroller").width():n<0&&(n=0),o>$("#vvDummyScroller").height()?o=$("#vvDummyScroller").height():o<0&&(o=0);var r=n/this.getWidthRatio(),s=o/this.getHeightRatio(),l=this.box,u=0,d=0,c=0,g=0,v=e.getNubSize();if(this.getType()===t.annotationTypes.SANN_POSTIT){var p=1.25*virtualViewer.collapsedStickySize()/this.getWidthRatio();a===t.corners.upperLeft?(u=r<=l.getX2()-p?r:r>l.getX2()?l.getX1():l.getX1(),d=s<=l.getY2()-p?s:s>l.getY2()?l.getY1():l.getY1(),c=l.getX2()-u,g=l.getY2()-d):a===t.corners.upperRight?(u=l.getX1(),d=s<=l.getY2()-p?s:l.getY1(),c=r-u,g=l.getY2()-d):a===t.corners.lowerLeft?(u=r<=l.getX2()-p?r:l.getX1(),d=l.getY1(),c=l.getX2()-u,g=s-d):a===t.corners.lowerRight&&(u=l.getX1(),d=l.getY1(),c=r-u,g=s-d),g<p&&(g=p),c<p&&(c=p)}else a===t.corners.upperLeft?(u=r,d=s,c=l.getX2()-u,g=l.getY2()-d,c<v&&(c=v,u=l.getX2()-c),g<v&&(g=v,d=l.getY2()-g)):a===t.corners.upperRight?(u=l.getX1(),d=s,c=r-u,g=l.getY2()-d,c<v&&(c=v),g<v&&(g=v,d=l.getY2()-g)):a===t.corners.lowerLeft?(u=r,d=l.getY1(),c=l.getX2()-u,g=s-d,c<v&&(c=v,u=l.getX2()-c),g<v&&(g=v)):a===t.corners.lowerRight&&(u=l.getX1(),d=l.getY1(),c=r-u,g=s-d,c<v&&(c=v),g<v&&(g=v));c>0&&g>0&&(this.box=new i(u,d,c,g),this.pointArray&&this.stretchPointArray(l,this.box)),this.getTextString()&&this.getTextString().length&&(this.wrappedTextIsStale=!0)},s.prototype.movePointArray=function(e,t){if(this.pointArray)for(var a=0;a<this.pointArray.length;a+=1)this.pointArray[a].setX(Math.round(this.pointArray[a].getX()+e)),this.pointArray[a].setY(Math.round(this.pointArray[a].getY()+t))},s.prototype.stretchPointArray=function(e,t){var a=t.getX1(),n=t.getY1(),i=t.getWidth()/e.getWidth(),o=t.getHeight()/e.getHeight();if(this.pointArray)for(var r=0;r<this.pointArray.length;r+=1)this.pointArray[r].setX(Math.round(a+(this.pointArray[r].getX()-e.getX1())*i)),this.pointArray[r].setY(Math.round(n+(this.pointArray[r].getY()-e.getY1())*o))},s.prototype.getRevisionHistory=function(){return this.revisionHistory},s.prototype.getMostRecentModifyDateFormatted=function(){var t;return t=this.currentRevision.date?this.currentRevision.date:this.revisionHistory.length?this.revisionHistory[0].date:this.createDate,t?e.createAnnTimeStamp(t):""},s.prototype.getCreateDateFormatted=function(){return this.createDate?e.createAnnTimeStamp(this.createDate):""},s.prototype.getMostRecentModifyUser=function(){return this.currentRevision.user?this.currentRevision.user:this.revisionHistory.length?this.revisionHistory[0].user:this.createUser},s.prototype.markRevised=function(t){var a=this.currentRevision.user,n=new Date(this.currentRevision.date);this.currentRevision={},this.currentRevision.user=virtualViewer.getUserPreferences().getUsername(),this.currentRevision.date=e.toSnowDateString(new Date);var i=new Date(this.currentRevision.date),o=i-n;(this.currentRevision.user!==a||isNaN(o)||o>500)&&virtualViewer.updateAnnotationListItem(this)},s.prototype.toXML=function(n,r,s){var l=this.getType();if(l===t.annotationTypes.SANN_CIRCLE&&(l=t.annotationTypes.SANN_ELLIPSE),l===t.annotationTypes.SANN_REDACTION_RECT&&(l=t.annotationTypes.SANN_RECTANGLE),this.annDelete===!0)return"";var u=l===t.annotationTypes.SANN_EDIT||l===t.annotationTypes.SANN_BUBBLE||l===t.annotationTypes.SANN_POSTIT||l===t.annotationTypes.SANN_CLOUD_EDIT,d=this.pointArray,c=this.rotationAngle;this.isFilenet&&(c=this.xmlRotate||c);var g=this.getBoundingBox(!1);if(r||this.isFilenet&&!u){if(this.pointArray){d=[];for(var v=0;v<this.pointArray.length;v+=1)d.push(new o(this.pointArray[v].x,this.pointArray[v].y))}g=new i(g.getX1(),g.getY1(),g.getWidth(),g.getHeight()),this.updatePageDimensions();var p=this.pageWidth,h=this.pageHeight;if((90===c||270===c)&&!this.isFilenet){var f=p;p=h,h=f}g.rotate(c,p,h),this.rotatePointArray(c,d,p,h),this.fixBoundingBox(g,d)}var m="";m=this.annId?"<annObject><annMeta><annID>"+this.annId+"</annID>":"<annObject><annMeta><annID>ANN_ID</annID>",this.isDaeja&&(m+="<isDaeja>true</isDaeja>"),m+="<annType>",m+=l+"</annType><annLayerID>",m+=this.getLayerName()+"</annLayerID><annOrdinal>",m+=this.getOrdinal()+"</annOrdinal><annDelete>false</annDelete><annHistory><annCreateDate>",m+=this.getCreateDate()+"</annCreateDate><annModifyDate>",m+=(this.currentRevision.date||this.getModifyDate())+"</annModifyDate>",m+=this.getCreateUser()&&""!==this.getCreateUser()?"<annCreateUser>"+encodeURIComponent(this.getCreateUser())+"</annCreateUser>":"<annCreateUser/>",this.currentRevision&&this.currentRevision.user&&(this.revisionHistory.unshift(this.currentRevision),this.currentRevision={user:"",date:"",modificationType:""}),m+="<annModifications>";for(var v=0;v<this.revisionHistory.length;v++)m+="<annModificationItem>",m+="<annModifyUser>"+encodeURIComponent(this.revisionHistory[v].user)+"</annModifyUser>",m+="<annModifyDate>"+this.revisionHistory[v].date+"</annModifyDate>",m+="<annModifyType />",m+="</annModificationItem>";if(m+="</annModifications>",m+="</annHistory></annMeta>",this.annotationTags.length>0){m+="<annTags>";for(var y=0;y<this.annotationTags.length;y++)m+="<tag>"+encodeURIComponent(this.annotationTags[y])+"</tag>";m+="</annTags>"}else m+="<annTags/>";if(this.noteArray.length>0){m+="<annNotes>";for(var b=0;b<this.noteArray.length;b++){var A=this.noteArray[b];m+="<Note>",m+="<userId>"+encodeURIComponent(A.userId)+"</userId>",m+="<createDate>"+A.createDate+"</createDate>",m+=A.editDate?"<modifyDate>"+A.editDate+"</modifyDate>":"<modifyDate/>",m+="<noteText>"+encodeURIComponent(A.text)+"</noteText>",m+="<idxFlag>"+A.idxFlag+"</idxFlag>",m+="</Note>"}m+="</annNotes>"}else m+="<annNotes/>";m+="<annTransparent>false</annTransparent>",this.bitmapData&&(m+="<bitmapData>"+this.bitmapData+"</bitmapData>"),u&&(m+="<fontInfo><fontName>",m+=this.getFontName()+"</fontName><fontSize>",m+=Math.round(this.getFontSize(!0))+"px</fontSize><fontBold>",m+=this.getFontBold()+"</fontBold><fontItalic>",
m+=this.getFontItalic()+"</fontItalic><fontStrike>",m+=this.getFontStrike()+"</fontStrike><fontUnderline>",m+=this.getFontUnderline()+"</fontUnderline><fontColor>",m+=this.getFontColor()+"</fontColor></fontInfo><textString>",m+=this.getTextString(!0)+"</textString>"),(!this.getFillColor()&&this.getLineColor()||l===t.annotationTypes.SANN_POLYGON)&&(m+="<lineInfo><lineStyle>Solid</lineStyle><lineWidth>",m+=Math.round(this.getLineWidth(!0))+"</lineWidth>",m+=l===t.annotationTypes.SANN_POLYGON&&this.getFillColor()?"<lineColor>NO_COLOR</lineColor>":"<lineColor>"+this.getLineColorRGB()+"</lineColor>",m+="<lineTransparent>false</lineTransparent>",d?(m+="<pointArray>",m+=e.generatePointArrayString(d),m+="</pointArray>"):m+="<pointArray/>",m+="</lineInfo>"),this.getFillColor()&&(m+="<fillInfo><fillColor>",m+=this.getFillColorRGB()+"</fillColor>",1===this.getOpacity()||n?(m+="<fillTransparent>false</fillTransparent>",m+="<fillTransparentPercent />"):(m+="<fillTransparent>true</fillTransparent>",m+="<fillTransparentPercent/>"),m+="</fillInfo>"),r?m+=u&&!a.rotateTextAnnotations?"<rotationAngle>"+(360-s)+"</rotationAngle>":"<rotationAngle>"+c+"</rotationAngle>":"undefined"===this.xmlRotate?(this.xmlRotate=0,m+="<rotationAngle>"+this.xmlRotate+"</rotationAngle>"):m+="<rotationAngle>"+this.xmlRotate+"</rotationAngle>";var P=Math.round(g.getX1()),T=Math.round(g.getY1()),S=Math.round(g.getHeight()),w=Math.round(g.getWidth());return m+="<annStartX>"+P+"</annStartX><annStartY>",m+=T+"</annStartY><annHeight>",m+=S+"</annHeight><annWidth>",m+=w+"</annWidth></annObject>"},s.prototype.lineAnnotationContains=function(t,a,n){var i=Math.max(this.lineWidth,e.getNubSize()/a),r=new o(t.x/a,t.y/n);if(!this.box.contains(t,a,n))return!1;var s=e.getDistanceFromPointToLine(r,this.pointArray);return!(s>i)},s.prototype.drawnAnnotationContains=function(e,a,n){return this.type!==t.annotationTypes.SANN_LINE&&this.type!==t.annotationTypes.SANN_ARROW||2!==this.pointArray.length?this.box.contains(e,a,n,this.collapsed):this.lineAnnotationContains(e,a,n)},s.prototype.findLineEndpoint=function(a,n,i){var o=e.getNubSize()/2/n,r=a.getX()/n,s=a.getY()/i,l=this.pointArray[0].getX(),u=this.pointArray[0].getY(),d=this.pointArray[1].getX(),c=this.pointArray[1].getY();return r>=l-o&&r<=l+o&&s>=u-o&&s<=u+o?t.lineEnds.start:r>=d-o&&r<=d+o&&s>=c-o&&s<=c+o?t.lineEnds.end:null},s.prototype.addNewNote=function(){this.notes.addNote("Annotation",this)},s.prototype.editNote=function(e){this.notes.editNote(e,"Annotation",this)},s.prototype.removeNoteFromArray=function(e){this.noteArray.splice(e,1)},s.prototype.loadAnnotationNotes=function(){$("#vvAnnotationNotesInternal").empty();var e=r.getActivePaneState();if(e&&e.pageStates&&!(e.pageStates.length<1)){this.noteArray.sort(function(e,t){return e=e.editDate?new Date(e.editDate):new Date(e.createDate),t=t.editDate?new Date(t.editDate):new Date(t.createDate),t-e});for(var t=0;t<this.noteArray.length;t++)this.notes.addExistingNote(this.noteArray[t],"Annotation",this)}},s.prototype.loadAnnotationInformation=function(){$("#vvAnnCreateUser").html(e.encodeForHTML(this.createUser));var t=e.createAnnTimeStamp(this.createDate);if($("#vvAnnCreateDate").html(t),$("#vvAnnotationRevisionHistory").empty(),$.views.helpers({createAnnTimeStamp:e.createAnnTimeStamp}),this.revisionHistory&&this.revisionHistory.length){$("#vvAnnViewRevisions").show();var a=$($("#vvAnnPopUpRevisionItemTmpl").render(this.revisionHistory));a.appendTo("#vvAnnotationRevisionHistory")}else $("#vvAnnViewRevisions").hide()},s.prototype.fixDimensionsForPage=function(){var e=this.getWidth()/this.pageWidth,t=this.getHeight()/this.pageHeight,a=Math.max(e,t);if(a>1){var n=new i(this.box.one.x,this.box.one.y,this.box.getWidth()/a,this.box.getHeight()/a);this.stretchPointArray(this.box,n),this.box=n}var r=Math.max(this.box.getX1()*this.getWidthRatio(),0),s=Math.max(this.box.getY1()*this.getHeightRatio(),0);this.box.getX2()>this.pageWidth&&(r=(this.pageWidth-this.box.getWidth())*this.getWidthRatio()),this.box.getY2()>this.pageHeight&&(s=(this.pageHeight-this.box.getHeight())*this.getHeightRatio()),this.move(new o(r,s))},s.prototype.fixForPaste=function(t,a,n){a||(a=r.getActivePaneState()),null!==t&&void 0!==t||(t=a.getPageNumber());var o=a.pageStates[t];if(n||(n=o.annotationLayers[this.getLayerName()]),this.page=t,this.pageWidth=n.pageWidth,this.pageHeight=n.pageHeight,n.docDPI!==this.docDPI){var s=this.getFontSize(),l=new i(this.box.getX1()*(n.docDPI/this.docDPI),this.box.getY1()*(n.docDPI/this.docDPI),this.getWidth()*(n.docDPI/this.docDPI),this.getHeight()*(n.docDPI/this.docDPI));this.stretchPointArray(this.box,l),this.box=l,this.docDPI=n.docDPI||200,s&&this.setFontSize(s,!1)}if(this.fixDimensionsForPage(),this.bitmapData&&!this.bitmapImage){this.bitmapImage=new Image,this.bitmapImage.vvDeadEnd=!0,this.bitmapImage.src="data:image/png;base64,"+this.bitmapData;var u=this;$(this.bitmapImage).on("error",function(){u.bitmapImage=null})}this.revisionHistory=[],this.currentRevision={},this.createDate=e.toSnowDateString(new Date),this.createUser=virtualViewer.getUserPreferences().getUsername()},s}),define("vvAnnotationManager",["vvUtility","annotations","user-config/config","vvDefines","vvPoint"],function(e,t,a,n,i){function o(){}var r=null,s=new Image(14,14);s.src="resources/annMinimize.svg",o.prototype.getCurrentLayer=function(e){var t=virtualViewer.getActivePaneState(),a=t.getLayerNames();e||(e=t.getPageNumber());var i=t.getLayersForPage(e);if(!t.getCurrentLayerOnPage(e)&&a.length>0){if(!i)return;var o=i.Default;if(o&&this.checkLayerPermission(o,n.permissionLevels.PERM_EDIT))t.setCurrentLayer(o);else{for(var r=!1,s=0;s<a.length;s+=1){var l=i[a[s]];if(this.checkLayerPermission(l,n.permissionLevels.PERM_EDIT)){r=!0,t.setCurrentLayer(l);break}}if(!r){var u=this.createLayer("Default "+Math.floor(1024*Math.random()));t.setCurrentLayer(u)}}}return t.getCurrentLayer()},o.prototype.getRedactionLayer=function(t,i){i=i||virtualViewer.getActivePaneState();var o;a.oneLayerPerAnnotation?o=this.createLayer(n.redactionLayerPrefix+"-"+e.vvGUID(),t):(o=i.getLayerFromPage(t,n.redactionLayerPrefix),o||(o=this.createLayer(n.redactionLayerPrefix,t)));var r=i.getDPIForPage(0),s=i.pageStates[0].requestedWidth,l=i.pageStates[0].requestedHeight;return i.pageStates[t]&&i.pageStates[t].imageInfoLoaded?o&&(o.docDPI=i.getDPIForPage(t)||72):(i.setDPIForPage(t,r),0===r&&(r=72),o&&(o.docDPI=r),0===i.getRequestedWidthForPage(t)&&i.setRequestedWidthForPage(t,s),0===i.getRequestedHeightForPage(t)&&i.setRequestedHeightForPage(t,l)),i.setViewedForPage(t,!0),o},o.prototype.staleAnnTextWrapping=function(e,t){if(e&&"number"==typeof t){var a=e.getLayersForPage(t),i=e.getLayerNames();if(a&&i)for(var o=i.length,r=0;r<o;r++){var s=a[i[r]];if(void 0!==s&&s.permissionLevel>=n.permissionLevels.PERM_VIEW&&s.visibility===!0)for(var l=0;l<s.anns.length;l++)s.anns[l].getDelete()!==!0&&s.anns[l].page===t&&(s.anns[l].wrappedTextIsStale=!0)}}},o.prototype.parseLayer=function(n,i,o){var r=n.getElementsByTagName("pageMeta")[0],s=n.getElementsByTagName("annObject"),l=e.fixBooleanString(e.getValue(n,"isFilenet")),u=e.fixBooleanString(e.getValue(n,"isDaeja")),d=e.fixBooleanString(e.getValue(n,"isIDM"));if(r){var c={};c.layerName=e.getValue(n,"annLayerID"),c.pageNumber=parseInt(e.getValue(r,"pageNumber"),10),c.pageWidth=parseInt(e.getValue(r,"pageWidth"),10),c.pageHeight=parseInt(e.getValue(r,"pageHeight"),10),c.doubleByte=e.fixBooleanString(e.getValue(n,"doubleByte")),c.visibility=!0,c.docDPI=parseInt(e.getValue(n,"docDPI"),10)||72,c.isFilenet=l,c.isDaeja=u,c.isIDM=d,null!==o&&void 0!==o?c.pageNumber=o:o=c.pageNumber,d&&(c.docDPI=200);var g=i.getOriginalWidthForPage(o),v=i.getOriginalHeightForPage(o);if(l&&3300===c.pageHeight&&2550===c.pageWidth){var p=i.getDPIForPage(o);if(0!==p){var h=c.docDPI/p;0!==g&&(c.pageWidth=parseInt(g*h,10)),0!==v&&(c.pageHeight=parseInt(v*h,10))}}else u&&0===c.pageWidth&&0===c.pageHeight&&(c.pageWidth=i.getOriginalWidthForPage(o),c.pageHeight=i.getOriginalHeightForPage(o));c.anns=[];var f=virtualViewer.getDocumentModel(i);if(!f)return;for(var m=f.model.layerManager.layers.length,y=0;y<m;y++){var b=f.model.layerManager.layers[y],A=unescape(b.annotationId);if(A===c.layerName){c.displayName=b.displayName,c.isRedaction=b.isRedaction,c.isDeletable=b.isDeletable,c.permissionLevel=b.permissionLevel;break}}for(var P=0;P<s.length;P++){var T=new t;T.init(s[P],null,o,c.pageWidth,c.pageHeight,c.layerName,c.doubleByte,P,c.docDPI,l,u,d),e.isRedactionLayer(c)&&(virtualViewer.showRedactionWarningDialog(),T.setFillColorRGB(a.annotationDefaults.redactionFillColor),T.setOpacity(a.annotationDefaults.redactionOpacity)),c.anns[P]=T}i.addLayerToPage(o,c)}},o.prototype.checkLayerPermission=function(e,t){return!e||!(e.permissionLevel<t)},o.prototype.createLayer=function(e,t,a){if(a=a||virtualViewer.getActivePaneState(),!a.pageStates)return null;var n=a.getDocumentModel();t||0===t||(t=a.getPageNumber());for(var i,o=0;o<a.pageStates.length;o++){var r=a.pageStates[o].annotationLayers;if(!r||!r[e]){var s=this.createAnnotationLayer(e,o,a.pageStates[o]);a.addLayerToPage(o,s),this.addLayerToPageHash(e,o,a),o===t&&(i=s,a.setCurrentLayer(i))}}if(i){var l=this.createModelAnnotationLayer(i);n.model.layerManager.layers.push(l),n.setAnnotationsModifiedSinceInit(!0,a)}return i},o.prototype.addLayerToPageHash=function(e,t,a){a=a||virtualViewer.getActivePaneState();var n=a.getDocumentModel(),i=n.model.pageData[t];i.annotationHash||(i.annotationHash={});var o=i.annotationHash[e];if(o)o.annExists=!0;else{var r={annExists:!0,documentId:a.getDocumentId(),layerAnnotationId:e,layersToMerge:[],pageIndex:t,rotateAngle:a.getRotationForPage()};i.annotationHash[e]=r}},o.prototype.createDefaultLayer=function(e){var t="Default",a=(e.getLayerNames(),e.getLayersForPage(e.getPageNumber())),n=null;return a&&a[t]||(n=this.createLayer(t)),n},o.prototype.createModelAnnotationLayer=function(e){return{newLayer:!0,annotationId:e.layerName,isDeletable:!0,isRedaction:!1,permissionLevel:e.permissionLevel,dirty:!0,visible:!0}},o.prototype.createAnnotationLayer=function(e,t,i){i=i||virtualViewer.getActivePaneState().pageStates[t];var o=i.dpi;void 0===o&&(o=virtualViewer.getActivePaneState().getDPIForPage(0)),0===o&&(o=72);var r={};return r.layerName=e,r.pageNumber=t,r.pageWidth=i.originalWidth,r.pageHeight=i.originalHeight,r.docDPI=o,a.createIDMAnnotations&&(r.pageWidth=1e4,r.pageHeight=1e4,r.docDPI=200,r.isIDM=!0),a.base64EncodeAnnotations?r.doubleByte=!0:r.doubleByte=!1,r.visibility=!0,r.isRedaction=!1,r.isDeletable=!0,r.permissionLevel=n.permissionLevels.PERM_DELETE,r.anns=[],r},o.prototype.renameLayerCore=function(e,t){var i=virtualViewer.getActivePaneState().getDocumentId();if(!i)return null;var o=new URI(a.servletPath);o.addQuery("action","renameAnnotationLayer"),o.addQuery("documentId",i),o.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),o.addQuery("pageCount",virtualViewer.getPageCount()),o.addQuery("oldLayerName",e),o.addQuery("newLayerName",t),n.cacheBuster===!0&&o.addQuery("cacheBuster",Math.random()),o.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var r=o.query();o.query(""),$.ajax({url:o.toString(),type:"POST",data:r,success:function(e){virtualViewer.checkServerException(e)},error:function(e){console.log("error")}})},o.prototype.deleteCurrentLayer=function(){for(var e=virtualViewer.getActivePaneState(),t=e.getLayerNames(),a=this.getCurrentLayer(),n=[],i=0;i<t.length;i+=1){var o=t[i];o!==a.layerName&&this.newLayerNames.push(o)}e.setLayerNames(n),e.deleteLayer(a.layerName),"Master Layer"===a.layerName&&$("#vvLayerManagerConsolidateLayerButton").prop("disabled",!1).css("opacity",1),e.setCurrentLayer(void 0),this.getCurrentLayer(),virtualViewer.delayedPaintCanvases()},o.prototype.renameCurrentLayer=function(e){if(this.getCurrentLayer()){var t=this.getCurrentLayer().layerName;this.renameLayerCore(t,e);var a=virtualViewer.getCurrentState();a.renameLayer(t,e),virtualViewer.getDocumentModel().renameLayer(t,e)}},o.prototype.markCurrentLayerDirty=function(){var e=virtualViewer.getActivePaneState();e.getDocumentModel().markLayerDirty(this.getCurrentLayer())},o.prototype.markLayerDirty=function(e){var t=virtualViewer.getActivePaneState();t.getDocumentModel().markLayerDirty(e)},o.prototype.markLayerWithAnnDirty=function(e){var t=virtualViewer.getActivePaneState();if(t){var a=this.getLayerWithAnn(e);a&&(this.markLayerDirty(a),virtualViewer.getCallbackManager().call("annotationChanged",{documentId:t.getDocumentId(),annotationLayerId:a.layerName,annotationId:e.annId}))}},o.prototype.getLayerWithAnn=function(e){var t=virtualViewer.getActivePaneState();if(!e||!t)return null;var a=t.getLayersForPage(e.page);if(!a)return null;var n=e.layerName;if(!n)return null;var i=a[n];return i?i:null},o.prototype.checkLayerIntegrity=function(e,t){t=t||virtualViewer.getActivePaneState();var a=t.pageStates[e].annotationLayers;a||(a={},t.pageStates[e].annotationLayers=a);for(var n=t.getLayerNames(),i=0;i<n.length;i++)a[n[i]]||(a[n[i]]=this.createLayer(n[i],e,t));t.pageStates[e].annotationLayers=a},o.prototype.getAnnotationAtPoint=function(e,t){t=t||virtualViewer.getActivePaneState();var a=t.getPageNumber(),i=t.getLayersForPage(a),o=t.getLayerNames();if(i){for(var r=null,s=0;s<o.length;s++){var l=i[o[s]];if(this.checkLayerPermission(l,n.permissionLevels.PERM_EDIT)&&l&&l.visibility)for(var u=l.anns.length-1;u>=0;u--){var d=l.anns[u];if(d.getDelete()===!1&&d.page===t.pageNumber){var c=d.getPointRotatedForAnn(e,t);if(d.drawnAnnotationContains(c,d.getWidthRatio(t),d.getHeightRatio(t)))return r=d}}}return r}},o.prototype.isAnnotationAtPoint=function(e,t){var a=this.getAnnotationAtPoint(e,t,!0);return!!a},o.prototype.getAnnotationAtIndex=function(e){return this.getCurrentLayer().anns[e]},o.prototype.getAnnotationCount=function(){return this.getCurrentLayer().anns.length},o.prototype.paintAnnotations=function(e,t,a,i){e=e||virtualViewer.getActivePaneState(),i||0!==i&&(i=e.getPageNumber());var o=e.getLayersForPage(i),r=e.getLayerNames();if(o&&r)for(var s=r.length,l=0;l<s;l++){var u=o[r[l]];if(void 0!==u&&u.permissionLevel>=n.permissionLevels.PERM_VIEW&&u.visibility===!0)for(var d=0;d<u.anns.length;d++)u.anns[d].getDelete()!==!0&&u.anns[d].page===i&&this.paintAnnotation(e,t,a,u.anns[d])}},o.prototype.addAnnotation=function(t,i,o,r,s){var l=virtualViewer.getActivePaneState();if(null!==i&&void 0!==i||(i=l.getPageNumber()),!o){var u=l.getLayersForPage(i),d=l.getLayerNames(),c=d.length;if(!this.areDimensionsValid(t))return null;if(t.getType()===n.annotationTypes.SANN_POSTIT&&t.setLineColor(null),0===c)this.createDefaultLayer(l),c=d.length;else if(this.getCurrentLayer())e.isRedactionLayer(this.getCurrentLayer())&&(u.Default?l.setCurrentLayer(u.Default):this.createDefaultLayer(l));else{for(var g=0;g<c;g+=1){var v=this.checkLayerPermission(u[d[g]],n.permissionLevels.PERM_CREATE);if(v===!0){l.setCurrentLayer(u[d[g]]);break}}this.getCurrentLayer()||this.createDefaultLayer(l)}o=this.getCurrentLayer()}if(this.checkLayerPermission(this.getCurrentLayer(),n.permissionLevels.PERM_CREATE)===!1)return alert(e.getLocalizedValue("errors.createAnnOnLayerPermission","You do not have permission to create annotations on this layer.")),null;var p=-1;0===o.pageWidth&&(o.pageWidth=l.getOriginalWidthForPage(i)),0===o.pageHeight&&(o.pageHeight=l.getOriginalHeightForPage(i)),t.setLayerName(o.layerName),t.setPageWidth(o.pageWidth),t.setPageHeight(o.pageHeight),r||t.fixCoordinates();for(var h=0;h<o.anns.length;h++)o.anns[h].getOrdinal()>p&&(p=o.anns[h].getOrdinal());t.setOrdinal(p+1),t.setIndex(o.anns.length),o.anns.push(t),this.addLayerToPageHash(o.layerName,i),s||l.getDocumentModel().markLayerDirty(o),a.showAnnIndicators&&(virtualViewer.pageContainsAnnotations(i)&&!virtualViewer.pageHasIndicator(i)&&(virtualViewer.showAnnotationIndicator(i),virtualViewer.addToPagesWithAnnotations(i)),virtualViewer.createNavigationOptionsLabels()),virtualViewer.addSingleAnnotationListItem(t);var f=virtualViewer.getCallbackManager();return f.call("annotationCreation",{type:t.type}),t},o.prototype.deleteAnn=function(e){e||(e=virtualViewer.getActivePaneState());var t=virtualViewer.getCurrentAnnObject(),a=e.pageNumber;if(t){var n=e.getUndoObject(a);n.referenceAnn=t,n.unchangedAnn=t.clone(),n.layer=this.getLayerWithAnn(t),t.setDelete(!0),this.markLayerWithAnnDirty(t),n.modifiedAnn=t.clone(),n.type="modify",n.modifiedAnn.isSameAs(n.unchangedAnn)||e.pushUndoObject(a,n),e.resetUndoObject(),virtualViewer.setCurrentAnnObject(null),virtualViewer.updateAnnotationListItem(t)}virtualViewer.pageContainsAnnotations(a)||(virtualViewer.removeAnnotationIndicators(a),virtualViewer.removeFromPagesWithAnnotations(a)),virtualViewer.delayedPaintCanvases()},o.prototype.copyAnn=function(){var e=virtualViewer.getCurrentAnnObject();virtualViewer.setAnnClipboard(e.clone())},o.prototype.cutAnn=function(e){this.copyAnn(),e||(e=virtualViewer.getActivePaneState()),this.deleteAnn(e)},o.prototype.pasteAnn=function(t,n){null!==t&&void 0!==t||(t=virtualViewer.getActivePaneState()),null!==n&&void 0!==n||(n=t.pageNumber);var i=virtualViewer.getAnnClipboard(),o=i.getLayerName(),r=t.getLayersForPage(n),s=null,u=!1;"vvRedaction"===o.substring(0,11)&&(u=!0),a.oneLayerPerAnnotation?(s=virtualViewer.createAutoLayer(u),o=s.layerName,i.setLayerName(o)):r&&r[o]?s=r[o]:(s=this.createLayer(o,n,t),t.addLayerToLayerNames(o),t.addLayerToPage(n,s),this.addLayerToPageHash(o,n,t));var d=i.clone();d.fixForPaste(n,t,s);var c=l(i.pasteLocation,d,t);d.move(c),i.pasteLocation=null,d.revisionHistory=[],d.setCreateUser(virtualViewer.getUserPreferences().getUsername()),d.setCreateDate(e.toSnowDateString(new Date)),this.addAnnotation(d,n,s,!0),virtualViewer.delayedPaintCanvases(t)};var l=function(e,t,a){var n=t.pageWidth*t.getWidthRatio(a),o=t.pageHeight*t.getHeightRatio(a);return e.getX()<0?e=new i(0,e.getY()):e.getX()+t.box.getWidth()*t.getWidthRatio()>n&&(e=new i(n-t.box.getWidth()*t.getWidthRatio(),e.getY())),e.getY()<0?e=new i(e.getX(),0):e.getY()+t.box.getHeight()*t.getHeightRatio()>o&&(e=new i(e.getX(),o-t.box.getHeight()*t.getHeightRatio())),e};return o.prototype.rotateContextForAnnotation=function(t,a,n,i,o,r){i||(i=virtualViewer.getActivePaneState()),o||(o=$("#vvOuterDiv")),r||(r=$("#vvDummyScroller"));var s=i.getRotationForPage(n.page),l=n.getRotationAngle(),u=(i.pageStates[n.page].requestedWidth,i.pageStates[n.page].requestedHeight,{page:n.page,state:i,pageWidth:n.pageWidth*n.getWidthRatio(i),pageHeight:n.pageHeight*n.getHeightRatio(i),rotateAngle:(s+l)%360,dummyScroller:r,outerDiv:o,canvas:t}),d=virtualViewer.getTransformedPageLeft(u),c=virtualViewer.getTransformedPageTop(u),g=Math.sin(e.degreesToRadians(s+l)),v=Math.cos(e.degreesToRadians(s+l));a.setTransform(v,g,-g,v,d,c)},o.prototype.paintAnnotation=function(e,t,a,i){e=e||virtualViewer.getActivePaneState(),a.save();var o=i.getType();i.updatePageDimensions(e),e.currentPaneIndex>0?this.rotateContextForAnnotation(t,a,i,e,$("#vvSplit1Panel"),$("#vvSplitScroller")):this.rotateContextForAnnotation(t,a,i,e,null,null),a.lineWidth=i.getLineWidth(!0,e)*i.getHeightRatio(e),i.getLineColor()&&(a.strokeStyle=i.getLineColor()),i.getFillColor()&&(a.fillStyle=i.getFillColor()),o===n.annotationTypes.SANN_RECTANGLE?i.getFillColor()?this.rectanglePrimitive(a,i,!0,e):i.getLineColor()&&this.rectanglePrimitive(a,i,!1,e):o===n.annotationTypes.SANN_REDACTION_RECT?this.rectanglePrimitive(a,i,!0,e):o===n.annotationTypes.SANN_LINE?this.linePrimitive(a,i,!1,!1,e):o===n.annotationTypes.SANN_ELLIPSE?this.ellipsePrimitive(a,i,e):o===n.annotationTypes.SANN_BITMAP?this.bitmapPrimitive(a,i,e):o===n.annotationTypes.SANN_POSTIT?this.stickyPrimitive(a,i,e):o===n.annotationTypes.SANN_POLYGON?this.linePrimitive(a,i,!1,!0,e):o===n.annotationTypes.SANN_ARROW?this.linePrimitive(a,i,!0,!1,e):o===n.annotationTypes.SANN_EDIT?this.textPrimitive(a,i,0,e):o===n.annotationTypes.SANN_TRANSPARENT_BITMAP||(o===n.annotationTypes.SANN_BUBBLE?this.bubblePrimitive(a,i,e):o===n.annotationTypes.SANN_CLOUD_EDIT?this.cloudPrimitive(a,i,e):o===n.annotationTypes.SANN_CUSTOM_STAMP||o===n.annotationTypes.SANN_CIRCLE),virtualViewer.getCurrentAnnObject()&&i.isSameAs(virtualViewer.getCurrentAnnObject())&&this.addResizeNubs(a,i),a.restore()},o.prototype.addResizeNubs=function(e,t){var a=t.getBoundingBox(t.collapsed),i=virtualViewer.getActivePaneState(),o=t.getPointArray(),r=null,s=null;if(o&&(r=o[0],s=o[1]),t.getType()!==n.annotationTypes.SANN_ARROW&&t.getType()!==n.annotationTypes.SANN_LINE||2!==o.length){var l=a.getX1()*t.getWidthRatio(i),u=a.getY1()*t.getHeightRatio(i),d=a.getWidth()*t.getWidthRatio(i),c=a.getHeight()*t.getHeightRatio(i);e.lineWidth=1,e.strokeStyle="rgb(0,0,0)",e.strokeRect(l,u,d,c),t.collapsed||(this.createNub(e,t,l,u),this.createNub(e,t,l+d,u),this.createNub(e,t,l,u+c),this.createNub(e,t,l+d,u+c))}else this.createNub(e,t,r.getX()*t.getWidthRatio(i),r.getY()*t.getHeightRatio(i)),this.createNub(e,t,s.getX()*t.getWidthRatio(i),s.getY()*t.getHeightRatio(i));virtualViewer.getEventManager().setDragMode(n.dragModes.moveAnnotation)},o.prototype.createNub=function(t,n,i,o){var r=e.getNubSize(),s=r/2;t.fillStyle=a.polygonNubFillColor||"rgba(0, 0, 255, .40)",t.fillRect(i-s,o-s,r,r)},o.prototype.rectanglePrimitive=function(e,t,a,n){n||(n=virtualViewer.getActivePaneState());var o=t.getBoundingBox(t.collapsed);if(a)return e.fillStyle=t.getFillColor(),void e.fillRect(o.getX1()*t.getWidthRatio(n),o.getY1()*t.getHeightRatio(n),o.getWidth()*t.getWidthRatio(n),o.getHeight()*t.getHeightRatio(n));var r=[];r[0]=new i(o.getX1(),o.getY1()),r[1]=new i(o.getX2(),o.getY1()),r[2]=new i(o.getX2(),o.getY2()),r[3]=new i(o.getX1(),o.getY2()),r[4]=new i(o.getX1(),o.getY1()),t.setPointArray(r),this.linePrimitive(e,t,!1,a,n),t.setPointArray(null)},o.prototype.redactionRectanglePrimitive=function(e,t,n){n||(n=virtualViewer.getActivePaneState()),t.setFillColorRGB(a.annotationDefaults.redactionFillColor),t.setOpacity(a.annotationDefaults.redactionOpacity),this.rectanglePrimitive(e,t,!0,n)},o.prototype.bubblePrimitive=function(e,t,a){a=a||virtualViewer.getActivePaneState(),this.textPrimitive(e,t,a)},o.prototype.cloudPrimitive=function(t,a,n){n=n||virtualViewer.getActivePaneState(),this.ellipsePrimitive(t,a,n),this.textPrimitive(t,a,n);var i=e.getTextAnnDOMId(a),o=document.getElementById(i);o.style.textAlign="center"},o.prototype.areDimensionsValid=function(e){if(e.collapsed)return!0;var t=e.getBoundingBox(),i=t.getX1(),o=t.getY1(),r=t.getWidth(),s=t.getHeight();if(isNaN(i)||isNaN(o)||isNaN(r)||isNaN(s))return!1;if((e.getType()===n.annotationTypes.SANN_EDIT||e.getType()===n.annotationTypes.SANN_CLOUD_EDIT)&&(r<n.minTextAnnDrawSize||s<n.minTextAnnDrawSize))return!1;if(e.getType()===n.annotationTypes.SANN_POSTIT){var l=t.getWidth(),u=5,d=a.annotationDefaults.stickyMargin+1;if(l-u-d<n.minTextAnnDrawSize)return!1}return!0},o.prototype.stickyPrimitive=function(e,t,n){if(this.areDimensionsValid(t)){n=n||virtualViewer.getActivePaneState(),e.save(),e.shadowColor="#777777",e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowBlur=2,this.rectanglePrimitive(e,t,!0,n),e.restore();var i=t.getBoundingBox(t.collapsed),o=n.getZoomDecimal(),r=t.getMinimizeButtonSize(n);if(r){var l=Math.ceil(a.annotationDefaults.stickyMargin*o);e.drawImage(s,i.getX2()*t.getWidthRatio(n)-r-l,i.getY1()*t.getHeightRatio(n)+l,r,r)}t.collapsed||this.textPrimitive(e,t,a.annotationDefaults.stickyMargin,n)}},o.prototype.textPrimitive=function(t,n,i,o){o=o||virtualViewer.getActivePaneState();var r=Math.round(n.getFontSize(!0)*n.getHeightRatio(o)),s=n.getFontName();n.isIDM&&"Explorer"===BrowserDetect.browser&&"TIMES ROMAN"===n.getFontName()&&(s="Times New Roman");var l=r/.85,u=0,d=l/1.5;i||(i=0);var c="";n.getFontBold()&&(c+="bold "),n.getFontItalic()&&(c+="italic "),t.save(),t.font=c+r+"px "+s,t.fillStyle="#"+n.getFontColor(),t.translate((n.getBoundingBox().getX1()+i)*n.getWidthRatio(o),(n.getBoundingBox().getY1()+i)*n.getHeightRatio(o));var g=n.getBoundingBox().getHeight()*n.getHeightRatio(o),v=(n.getRotationAngle()+o.getRotationForPage(n.page))%360;a.rotateTextAnnotations||90!==v?a.rotateTextAnnotations||180!==v?a.rotateTextAnnotations||270!==v||(g=n.getBoundingBox().getWidth()*n.getHeightRatio(o),t.rotate(-e.degreesToRadians(v)),t.translate(0,-n.getWidth()*n.getWidthRatio(o))):(t.rotate(-e.degreesToRadians(v)),t.translate(-n.getWidth()*n.getWidthRatio(o),-n.getHeight()*n.getHeightRatio(o))):(g=n.getBoundingBox().getWidth()*n.getHeightRatio(o),t.rotate(-e.degreesToRadians(v)),t.translate(-n.getHeight()*n.getHeightRatio(o),0));var p=n.getWrappedText();p.length&&!n.wrappedTextIsStale||(p=n.wrapTextString(t,i,o));for(var h=0;h<p.length&&!(d>g);h++)t.fillText(p[h],u,d),d+=l;t.restore()},o.prototype.ellipsePrimitive=function(e,t,a){var n=t.getBoundingBox();a=a||virtualViewer.getActivePaneState();var i=n.getX1()*t.getWidthRatio(a),o=n.getY1()*t.getHeightRatio(a),r=n.getX2()*t.getWidthRatio(a),s=n.getY2()*t.getHeightRatio(a),l=4*((Math.sqrt(2)-1)/3),u=(r-i)/2,d=(s-o)/2,c=i+u,g=o+d;e.save(),e.beginPath(),e.moveTo(c,g-d),e.bezierCurveTo(c+l*u,g-d,c+u,g-l*d,c+u,g),e.bezierCurveTo(c+u,g+l*d,c+l*u,g+d,c,g+d),e.bezierCurveTo(c-l*u,g+d,c-u,g+l*d,c-u,g),e.bezierCurveTo(c-u,g-l*d,c-l*u,g-d,c,g-d),t.getFillColor()&&(e.strokeStyle=t.getFillColor(),t.isIDM&&(e.globalAlpha=.5),e.fill()),e.closePath(),e.stroke(),e.restore()},o.prototype.linePrimitive=function(t,i,o,r,s){s=s||virtualViewer.getActivePaneState();var l=i.getFillColor(),u=i.getPointArray();if(u){t.beginPath(),t.moveTo(u[0].getX()*i.getWidthRatio(s),u[0].getY()*i.getHeightRatio(s));for(var d=1;d<u.length;d+=1)t.lineTo(u[d].getX()*i.getWidthRatio(s),u[d].getY()*i.getHeightRatio(s));if(l&&(t.strokeStyle=l,t.fill()),r&&i.getPreview()!==!0&&t.closePath(),t.stroke(),i.getPreview()===!0&&i.getType()===n.annotationTypes.SANN_POLYGON){t.fillStyle=a.polygonNubFillColor||"rgba(0, 0, 255, .40)";var c=e.getNubSize();t.fillRect(u[0].getX()-c/2,u[0].getY()-c/2,c,c)}}if(o===!0){var g=u[0].getX()*i.getWidthRatio(s),v=u[0].getY()*i.getHeightRatio(s),p=u[1].getX()*i.getWidthRatio(s),h=u[1].getY()*i.getHeightRatio(s),f=this.lineAngle(g,v,p,h),m=this.lineLength(g,v,p,h),y=.11*m;y<8&&(y=8),y>25&&(y=25);var b=30;t.save(),t.moveTo(p,h),t.translate(p,h),t.rotate(f),t.rotate(e.degreesToRadians(b)),t.moveTo(0,y),t.lineTo(0,0),t.moveTo(p,h),t.rotate(e.degreesToRadians(2*b*-1)),t.moveTo(0,y),t.lineTo(0,0),t.stroke(),t.restore()}},o.prototype.bitmapPrimitive=function(e,t,n){if(t.bitmapData){var i=new Image;if(t.bitmapImage)this.paintBitmapStamp(e,t,t.bitmapImage,n);else{var o=this;$(i).on("load",function(){t.bitmapImage=this,t.bitmapImage.vvDeadEnd=!0,a.enableSingleClickImageRubberStamp&&o.paintBitmapStamp(null,t,this,n)});var r=t.bitmapData;r.includes("data:image/png;base64")||(r="data:image/png;base64,"+t.bitmapData),i.src=r,$(i).ready(function(){a.enableSingleClickImageRubberStamp||(o.rotateContextForAnnotation(e.canvas,e,t,n),o.paintBitmapStamp(e,t,i,n))})}}},o.prototype.paintBitmapStamp=function(e,t,a,n){var i=t.getBoundingBox(),o=i.getX1()*t.getWidthRatio(n),r=i.getY1()*t.getHeightRatio(n),s=i.getWidth()*t.getWidthRatio(n),l=i.getHeight()*t.getHeightRatio(n),u=!e;if(u){var d=$(".vvOuter").eq(n.currentPaneIndex),c=d.find(".vvCanvas");e=c[0].getContext("2d"),e.save(),n.currentPaneIndex>0?this.rotateContextForAnnotation(c,e,t,n,$("#vvSplit1Panel"),$("#vvSplitScroller")):this.rotateContextForAnnotation(c,e,t,n,null,null)}e.drawImage(a,o,r,s,l),u&&e.restore()},o.prototype.lineLength=function(e,t,a,n){return Math.sqrt(Math.pow(a-e,2)+Math.pow(n-t,2))},o.prototype.lineSlope=function(e,t,a,n){return(n-t)/(a-e)},o.prototype.lineAngle=function(t,a,n,i){var o=t,r=a,s=t,l=i,u=this.lineSlope(t,a,n,i),d=(n-t)*(s-o)+(i-a)*(l-r),c=Math.sqrt(Math.pow(n-t,2)+Math.pow(i-a,2)),g=Math.sqrt(Math.pow(s-o,2)+Math.pow(l-r,2)),v=Math.acos(d/(c*g));return v=isNaN(v)===!0?90:e.radiansToDegrees(v),u>0&&(v=90-v),n>t?u>0&&(v+=90):n===t?v=u<0?0:180:v+=u>0?270:180,e.degreesToRadians(v)},o.getInstance=function(){return null==r&&(r=new o),r},o.getInstance()}),define("vvSearch",["user-config/config"],function(e){function t(){this.documentId="",this.searchCursor={page:0,match:0},this.performOCR=!1,this.searchTerm="",this.pattern="",this.patternIndex=-1,this.inProgress=!1,this.firstPageToSearch=null,this.lastPageToSearch=null,this.firstResultPage=null,this.lastResultPage=null,this.firstPageOfCurrentBatch=0,this.searchCancelled=!1,this.searchAnnotationResults=[],this.searchDocumentResults=[],this.caseSensitive=!!e.searchCaseSensitive,this.exactMatch=!1,this.matchRedactions=[],this.annotationSearch=!1}return t.prototype.clearResults=function(){this.firstResultPage=null,this.lastResultPage=null,this.firstPageOfCurrentBatch=0,this.searchCancelled=!1,this.searchAnnotationResults=[],this.searchDocumentResults=[]},t.prototype.getCurrentMatch=function(){var e=this.getPageResults(this.searchCursor.page);if(!e||!e.matches||!e.matches.length)return null;var t=e.matches;return this.searchCursor.match>t.length||this.searchCursor.match<0?null:t[this.searchCursor.match]},t.prototype.getResults=function(){return this.searchAnnotationResults.length&&this.annotationSearch?this.searchAnnotationResults:this.searchDocumentResults||[]},t.prototype.getMatchedPages=function(){for(var e=this.getResults(),t=[],a=0;a<e.length;a++)e[a]&&e[a].matches&&e[a].matches.length&&t.push(a);return t},t.prototype.getPageResults=function(e){if("number"!=typeof e||e<0)return null;var t=this.getResults();return t[e]||{matches:[]}},t.prototype.noResultsFound=function(){if(!this.searchTerm&&!this.pattern)return!1;var e=this.getPageResults(this.firstResultPage);return!e||!e.matches.length},t.prototype.addAnnotationSearchResultToPage=function(e,t){e&&"number"==typeof t&&(this.searchAnnotationResults[t]=this.searchAnnotationResults[t]||{matches:[]},this.searchAnnotationResults[t].matches.push(e),this.updateFirstOrLastSearchPage(t))},t.prototype.addDocumentSearchResults=function(e,t){var a=[];if(!e)return a;t=t||0;for(var n=0;n<e.length;n++)if(e[n]&&e[n].matches&&e[n].matches.length&&!(e[n].pageNumber<0)){var i=e[n].pageNumber+t;e[n].pageNumber=i,a.push(i),this.searchDocumentResults[i]=e[n],this.updateFirstOrLastSearchPage(i)}return a},t.prototype.updateFirstOrLastSearchPage=function(e){this.firstResultPage||0===this.firstResultPage||(this.firstResultPage=e),this.lastResultPage||0===this.lastResultPage||(this.lastResultPage=e),e<this.firstResultPage&&(this.firstResultPage=e),e>this.lastResultPage&&(this.lastResultPage=e)},t}),define("vvWatermarks",["user-config/config","vvPoint","vvStateManager"],function(e,t,a){var n=function(){var n=function(e){if(e=e||a.getActivePaneState(),e.getDocumentModel().model.watermarks){e.watermarks=e.getDocumentModel().model.watermarks;for(var t=0;t<e.watermarks.length;t++)e.watermarks[t].text=decodeURIComponent(e.watermarks[t].text)}else e.watermarks=[]},i=function(e){e=e||a.getActivePaneState();for(var t=[],n=$("#vvImageCanvas")[0].getContext("2d"),i=0;i<e.watermarks.length;i++){var o=$.extend(!0,{},e.watermarks[i]);if(o.text.indexOf(I.pageNumber.tagText)>=0)o.widthAtTenPx=0;else{var r=S(o,{state:e,pageNumber:0});n.save(),n.font="10px "+o.format.font;for(var s=0,l=0;l<r.length;l++)r[l].length>r[s].length&&(s=l);o.widthAtTenPx=Math.round(n.measureText(r[s]).width),n.restore()}o.text=encodeURIComponent(o.text),o.dynamicData=o.dynamicData||{},o.dynamicData.printTime=I.printTime.callback(),o.dynamicData.username=virtualViewer.getUserPreferences().getUsername(),t.push(o)}e.getDocumentModel().model.watermarks=t},o=function(e,t){h(e).push(t),e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e)},r=function(e,t){e=e||a.getActivePaneState();var n=h(e);if(n&&n.length){var i=function(e,t){return e-t};t=t.sort(i);for(var o=0;o<n.length;o++){var r=n[o];if(!r.allPages&&r.pages){r.pages=r.pages.sort(i);for(var s=[],l=0,u=0;u<t.length;u++)for(var d=l;d<r.pages.length;d++)if(r.pages[d]!==t[u]){if(r.pages[d]>t[u]&&r.pages[d]>t[u+1]){l=d;break}r.pages[d]<t[u]?s.push(r.pages[d]-u):s.push(r.pages[d]-(u+1));
}r.pages=s}}e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e)}},s=function(e,t){var n=a.getActivePaneState().getPageCount(),i=t.pages||[];if(t.allPages)for(var o=n-1;o>=0;o--)i.push(o);var r=i.indexOf(e);r>-1&&i.splice(r,1),t.pages=i},l=function(e){var t=a.getActivePaneState();e||(e=t.getPageNumber());var n=h(t);if(n){for(var i=0;i<n.length;i++){var o=n[i];(o.allPages||o.pages.indexOf(e)>-1)&&(s(e,o),o.allPages=!1)}t.getDocumentModel().setWatermarksModifiedSinceInit(!0,t)}},u=function(e,t,n){e=e||a.getActivePaneState();for(var i=h(e),o=[],r=0;r<i.length;r++){var s=i[r],l=$.extend(!0,{},s);if(n||(l.allPages=!1),s.pages=s.pages||[],l.pages=[],s.allPages)for(var u=0;u<t.length;u++)l.pages.push(u);else for(var d=0;d<s.pages.length;d++)(s.allPages||t.indexOf(s.pages[d])>-1)&&l.pages.push(d);o.push(l)}return o},d=function(e,t,n){e=e||a.getActivePaneState();var i=h(e);i||(i=e.watermarks=[]);for(var o=t.pageNums.length,r=t.watermarks||[],s=0;s<i.length;s++)i[s].pages=i[s].pages.map(function(e){return e>=n?e+o:e});for(var l=0;l<r.length;l++)r[l].pages=r[l].pages.map(function(e){return e+n});r=g(r,i),e.watermarks=r.concat(i),e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e)},c=function(e,t){for(var a,n=[];e.length&&t.length;)a=e.shift(),a===t[0]&&t.shift(),n.push(a);return n=n.concat(e).concat(t),n.sort(function(e,t){return e-t}),n},g=function(e,t){if(!e.length||!t.length)return e;for(var a=0;a<e.length;a++)for(var n=0;n<t.length;n++){var i=v(e[a],t[n]);i&&t[n].allPages?e.splice(a):i&&(t[n].pages=c(e[a].pages,t[n].pages),e.splice(a))}return e},v=function(e,t){return!(!e||!t)&&(e.position.direction===t.position.direction&&(e.position.vertical===t.position.vertical&&e.text===t.text))},p=function(e,t){var a=h(e);return a&&a.length>t?a.splice(t,1):(e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e),null)},h=function(e){return e.watermarks},f=function(e,t,a){if(a&&t&&(e||0===e))for(var n=h(t),i=0;i<n.length;i++){var o=n[i];(o.allPages||o.pages.indexOf(e)>-1)&&y(o,e,t,a)}},m=function(t){e.adminCreated=status},y=function(e,t,a,n){n.save();var i,o=a.pageStates[t].requestedWidth,r=a.pageStates[t].requestedHeight;if(a.isPageCropped(t)){var s=a.pageStates[t].originalWidth/o;o=Math.ceil(a.documentModel.model.pageData[t].cropWidth/s),r=Math.ceil(a.documentModel.model.pageData[t].cropHeight/s),i={cropWidth:o,cropHeight:r,cropLeft:Math.ceil(a.documentModel.model.pageData[t].cropLeft/s),cropTop:Math.ceil(a.documentModel.model.pageData[t].cropTop/s)}}var l=15*a.getZoomDecimal(),u={state:a,pageNumber:t},d=S(e,u),c=P(e,o,r),g=b(o,r,l,e,n,c,d),v=g/.85,p=d.length*v/2,h=A(e,o,r,l,i),f=T(e);n.translate(h.x,h.y),n.rotate(c),n.font=g+"px "+e.format.font,n.textAlign=f,n.fillStyle="#"+e.format.color,e.transparency&&(n.globalAlpha=.4);var m=0,y=0;e.position.vertical===C.TOP&&(n.textBaseline="hanging"),e.position.vertical!==C.CENTER&&"center"!==f||(y-=p,n.textBaseline="top");for(var w=0;w<d.length;w++)n.fillText(d[w],m,y),y+=v;n.restore()},b=function(e,t,a,n,i,o,r){for(var s=0,l=10,u=0;u<r.length;u++)r[u].length>r[s].length&&(s=u);i.font=l+"px "+n.format.font;var d=i.measureText(r[s]).width,c=e*n.stretchPercent,g=t;if(n.position.direction===D.VERTICAL)c=t*n.stretchPercent,g=e;else if(n.position.direction===D.DIAGONAL){n.position.vertical===C.BOTTOM&&(o=2*Math.PI-o);var v=r.length*l*.85/2,p=v/d,h=Math.sqrt(Math.pow(e,2)+Math.pow(t,2)),f=h*p/(Math.pow(Math.tan(o),-1)+2*p);c=h-2*f}c-=2*a,g-=2*a;var m=c/d,y=l*m,b=r.length*y;return b>g&&(y=g/r.length),y},A=function(e,a,n,i,o){var r=new t(i,i),s=new t(a/2,n/2),l=new t(a-i,n-i);o&&(r=new t(i+o.cropLeft,i+o.cropTop),s=new t(o.cropLeft+o.cropWidth/2,o.cropTop+o.cropHeight/2),l=new t(o.cropLeft+o.cropWidth-i,o.cropTop+o.cropHeight-i));var u=r;return e.position.vertical===C.BOTTOM?u.y=l.y:e.position.vertical===C.CENTER&&(u.y=s.y-i),e.position.direction===D.DIAGONAL&&(u=s),u},P=function(e,t,a){var n;return n=e.position.vertical===C.BOTTOM&&e.position.direction===D.DIAGONAL?2*Math.PI-Math.atan(a/t):e.position.vertical===C.TOP&&e.position.direction===D.DIAGONAL?Math.atan(a/t):e.position.direction===D.VERTICAL?Math.PI/2:0},T=function(e){return e.position.direction===D.DIAGONAL?"center":"left"},S=function(e,t){var a=e.text;for(var n in I)if(n&&I[n]&&I[n].tagText){var i=I[n].callback(t),o=I[n].tagText.replace("@@","/@/@").replace("@@","/@/@"),r=new RegExp(I[n].tagText,"ig");a=a.replace(r,i);var s=new RegExp(o,"ig");a=a.replace(s,I[n].tagText)}return a.split("\n")},w="LLL",I={username:{tagText:"@@username@@",callback:function(e){return virtualViewer.getUserPreferences().getUsername()}},totalPages:{tagText:"@@totalPages@@",callback:function(e){return e.state.pageCount}},pageNumber:{tagText:"@@pageNumber@@",callback:function(e){return e.pageNumber+1}},printTime:{tagText:"@@printTime@@",callback:function(e){return moment().format(w)}},serverTime:{tagText:"@@serverTime@@",callback:function(e){return moment().format(w)}},docName:{tagText:"@@documentName@@",callback:function(e){return e.state.getDisplayName()}}},C={TOP:0,CENTER:1,BOTTOM:2},D={HORIZONTAL:0,VERTICAL:1,DIAGONAL:2};return{loadWatermarks:n,saveWatermarks:i,addWatermark:o,removePages:r,copyWatermarksForPageRange:u,pastePagesWithWatermarks:d,removeWatermark:p,removeWatermarksFromPage:l,getWatermarksArray:h,paintPageWatermarks:f,setAdminStatus:m,renderFormattedText:S,tags:I,verticalPositionOptions:C,textDirectionOptions:D}}();return n}),define("vvPrintManager",["vvUtility","vvWatermarks","user-config/config","vvDefines","vvStateManager"],function(e,t,a,n,i){var o=function(){var o=function(a){g(),$("#vvPrintIndicator").modal("hide"),a||(a={});var o=i.getActivePaneState(),s={};if(a.documentId){var l=virtualViewer.getStateForDocumentId(a.documentId);if(!l)return void virtualViewer.displayExceptionMessage(e.getLocalizedValue("errors.printDocumentMustBeOpened","The document you asked to print is not open in VirtualViewer."));o=l,s.state=o}t.saveWatermarks(o);var u=o.getDocumentModel();s.state=o,s.model=u,a.includeAnnotations?(s.includeTextAnnotations=!0,s.includeNonTextAnnotations=!0):(s.includeTextAnnotations=!1,s.includeNonTextAnnotations=!1),s.includeRedactions=a.includeRedactions,s.includeRedactionTags=a.includeRedactionTags,s.includeWatermarks=a.includeWatermarks,s.includeDocumentNotes=a.includeDocumentNotes,null!==a.pageRangeType&&void 0!==a.pageRangeType&&(s.pageRangeType=a.pageRangeType),null!==a.pageRangeValue&&void 0!==a.pageRangeValue&&(s.pageRangeValue=a.pageRangeValue),"current"===s.pageRangeType&&(s.pageRangeValue=o.getPageNumber());var d=e.normalizePageRangeInput(s.pageRangeType,s.pageRangeValue,o);if("Explorer"===BrowserDetect.browser&&d.length>n.printIE11PageLimit){var c="Due to limitations of Internet Explorer, printing of more than %n pages at a time is unsupported.  Please split your print task up into sets of %n or fewer pages.",v=e.getLocalizedValue("errors.printTooManyPagesForIE",c);return v=v.replace(/%n/g,n.printIE11PageLimit),void alert(v)}if("Firefox"===BrowserDetect.browser&&d.length>n.printFirefoxPageLimit){var p="Due to limitations of Firefox, printing of more than %n pages at a time is unsupported.  Please split your print task up into sets of %n or fewer pages.",h=e.getLocalizedValue("errors.printTooManyPagesForFirefox",p);return h=h.replace(/%n/g,n.printFirefoxPageLimit),void alert(h)}return r(s)},r=function(e){var t=e.state;return s(t,e),b(t,e.pageRangeValue),"Printed Via Local Printing"},s=function(e,t){var n=$("<iframe></iframe>").appendTo("#virtualViewerMain").addClass("vvPrintFrame");n.off("load"),n.attr("src","about:blank"),n.addClass("onScreen");var i=new URI(a.servletPath);i.addQuery("action","newExport"),i.addQuery("format","pdf"),i.addQuery("includeTextAnnotations",t.includeTextAnnotations),i.addQuery("includeNonTextAnnotations",t.includeNonTextAnnotations),i.addQuery("includeRedactions",t.includeRedactions),i.addQuery("includeRedactionTags",t.includeRedactionTags),i.addQuery("includeWatermarks",t.includeWatermarks),i.addQuery("includeDocumentNotes",t.includeDocumentNotes),i.addQuery("pageRangeType",t.pageRangeType),i.addQuery("pageRangeValue",t.pageRangeValue),i.addQuery("annotations",JSON.stringify(t.state.getAnnotationLayers(!0,!1,!1,t.includeRedactions,t.includeTextAnnotations,t.includeNonTextAnnotations,t.includeNonTextAnnotations))),i.addQuery("modelJSON",JSON.stringify(t.model.model)),i.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),i.addQuery("asAttachment",!1),i.addQuery("pageCount",t.state.getPageCount()),virtualViewer.getOverlayPath()||i.addQuery("overlayPath",virtualViewer.getOverlayPath());var o=i.query();i.query(""),$("#vvNewPrintDialog").modal("hide"),$("#vvPrintIndicator").modal("show"),f()&&!h(e)?l(i,o,n):u(i,o,p(e),n)},l=function(e,t,a){v(e,t,function(e){a.on("load",function(e){this.contentWindow.print(),c(-1,a)}),a.attr("src",e)})},u=function(t,a,n,i){i.on("load",function(e){v(t,a,function(e){i[0].contentWindow.renderPDF(e,"#vvPDFJSCanvasHolder",n,d,function(e){c(e,i)})})}).on("error",function(t){virtualViewer.displayExceptionMessage(e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing."))}),i.attr("src","resources/print.html")},d=function(e,t){},c=function(e,t){$("#vvPrintIndicator").modal("hide"),setTimeout(function(){t.removeClass("onScreen")},1e4)},g=function(){var e=$(".vvPrintFrame").not(".onScreen");setTimeout(function(){for(var t=0;t<e.length;t++)$(e[t]).remove()},3e3)},v=function(e,t,a){var n=new XMLHttpRequest,i=e.toString();n.open("POST",i,!0),n.responseType="blob",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var e=URL.createObjectURL(n.response);a(e)}},n.send(t)},p=function(e){var t=e.getImageManager();if(!t||!t.overlayImage)return null;var a=t.overlayImage;return t.stripWhite(a),{overlayImage:a,lockedOverlayOffset:t.pageLockOverlayOffset,overlayData:t.overlayDataArray}},h=function(e){var t=e.getImageManager();return!(!t||!t.overlayImage)},f=function(){if(a.disableDirectPDFPrinting)return!1;if("Explorer"!==BrowserDetect.browser)return y("Adobe Acrobat")||y("Chrome PDF Viewer")||y("WebKit built-in PDF");if(BrowserDetect.version<11)return m("AcroPDF.PDF")||m("PDF.PdfCtrl");for(var e=0;e<navigator.plugins.length;e++){var t=navigator.plugins[e];if(t.name.toLowerCase().indexOf("pdf")!==-1)return!0}},m=function(e){try{var t=new ActiveXObject(e);return t}catch(e){}},y=function(e){for(var t=0;t<navigator.plugins.length;t++){var a=navigator.plugins[t];if(a.name===e)return a}},b=function(e,t){virtualViewer.event(e,"VALUE_EVENT_PRINT",{KEY_EVENT_PRINT_PAGE_NUMBERS:t})};return{printDocument:o}}();return o}),define("vvDialogs",["vvUtility","vvWatermarks","vvPrintManager","user-config/config","vvStateManager"],function(e,t,a,n,i){var o=function(){"use strict";var a,n,o=function(e){return{dialogName:e,bodyTemplate:"#"+e+"BodyTemplate",documentName:{},pages:{},format:{},annotations:{},redactions:{}}},v=function(){a=$.templates("#confirmCancelDialogTemplate"),n=$.localize.data.vv,$.views.helpers({localize:e.getLocalizedValue,escapeSingleQuotes:function(e){return"string"==typeof e?e.replace(/'/g,"&apos;"):e},placeholderizeWatermarkText:function(t){var a=t.replace(/@@[A-Z]+@@/gi,function(t){var a=t.replace(/@/g,"");return"["+e.getLocalizedValue("watermarksDialog.editText."+a,a)+"]"});return a.length>45&&(a=a.substr(0,45)+"..."),a}})},p=function(e,t,n){var i=o(e);$.extend(i,t.defaultOptions,n);var s=$(a.render(i));return s.appendTo("body"),t.setup(s),s.modal("show"),"#savePreferencesFooterTemplate"===i.footerTemplate&&(s.find(".preference-button").click(function(){r.saveDialogOptions(s),s.find(".preference-button").hide(),s.find(".preference-saved-button").show()}),s.on("change",function(){var e=s.find(".preference-button"),t=s.find(".preference-saved-button");"none"===e.css("display")&&(e.show(),t.hide())})),s.find(".confirm-button").click(function(){t.confirm(s)&&s.modal("hide")}),s.find(".cancel-button").click(function(){t.cancel&&t.cancel()}),s.on("hidden.bs.modal",function(){s.remove()}),s},h=function(e,t,a){a=a||{},a.footerTemplate="#confirmRefuseCancelDialogFooterTemplate";var n=p(e,t,a);n.find(".refuse-button").click(function(){t.refuse&&(t.refuse(),n.modal("hide"))})},f=function(e){var t={setup:function(){},confirm:function(){return e(),!0}};p("permanentChangeDialog",t)},m=function(e,t){var a={setup:function(){},confirm:function(){return e(),!0},cancel:t};p("ocrDialog",a)},y=function(e,t,a){var n={setup:function(){},confirm:function(){return e(),!0},refuse:t,cancel:a};h("ocrDialogForVirtualDocumentSearch",n)},b=function(e){e.footerTemplate="#savePreferencesFooterTemplate",p("saveAsDialog",s,e)},A=function(t,a,n){var i={useCut:a,documentName:{documentName:t},pages:{allPagesDisabled:a,pageRangeValue:e.createComplexPageString(n)}};p("copyToNewDialog",l,i)},P=function(t){var a={pages:{pageRangeValue:e.createComplexPageString(t)},footerTemplate:"#savePreferencesFooterTemplate"};p("exportDialog",u,a)},T=function(e){e.footerTemplate="#savePreferencesFooterTemplate",p("emailDialog",d,e)},S=function(t){var a={pages:{pageRangeValue:e.createComplexPageString(t)},footerTemplate:"#savePreferencesFooterTemplate"};p("printDialog",c,a)},w=function(e){var a=i.getActivePaneState(),n=t.getWatermarksArray(a);e=$.extend({},e,{existingWatermarks:n}),p("watermarksDialog",g,e)},I=function(e,t,a,n){var i={setup:function(){},confirm:function(){return e(),!0},refuse:t};h("confirmChangesDialog",i,{documentName:a,overwrite:n})},C=function(e,t){var a=e.find(".vvDialogErrorBanner");return t?(a.show(),void a.text(t)):(a.empty(),void a.hide())};return{init:v,permanentChangeDialog:f,ocrDialog:m,ocrDialogForVirtualDocumentSearch:y,saveAsDialog:b,copyToNewDialog:A,exportDialog:P,emailDialog:T,printDialog:S,watermarksDialog:w,confirmChangesDialog:I,toggleErrorBanner:C}}(),r=function(){"use strict";var e=function(e){var t="Original"===e.find("input[name=format]:checked").val();t&&e.find("input[name=pageRangeType][value=all]").prop("checked",!0),e.find("input[name=pageRangeType][value=complex]").prop("disabled",t),e.find("input[name=pageRangeType][value=current]").prop("disabled",t),e.find("input[name=pageRangeValue]").prop("disabled",t),e.find("input[name=includeDocumentNotes]").prop("disabled",t)},t=function(e){var t,a=i.getActivePaneState();e.find("input[name=includeAnnotations]").is(":checked")||e.find("input[name=includeRedactions]").is(":checked")||e.find("input[name=includeWatermarks]").is(":checked")||a.isVirtualDocument()?(t=e.find("input[name=format][value=Original]"),t.prop("disabled",!0),t.closest("label").addClass("vvDialogDisabledText"),t.is(":checked")&&e.find("input[name=format]:first").prop("checked",!0)):(t=e.find("input[name=format][value=Original]"),t.prop("disabled",!1),t.closest("label").removeClass("vvDialogDisabledText"))},a=function(e){e.find("input[name=documentName]").keypress(function(e){13===e.which&&e.preventDefault()}),e.find("input[name=format]").change(function(){if("Original"!==this.value){var t=i.getActivePaneState(),a=t.getDocumentId(),n=t.getDisplayName(),o="PDF"===this.value?"pdf":"tif",r=virtualViewer.getSaveAsDocumentNameGenerator(),s=r(a,n,o);e.find("input[name=documentName]").val(s)}})},o=function(e){e.find("input[name=pageRangeValue]").keypress(function(t){e.find("input[name='pageRangeType'][value='complex']").prop("checked",!0),13===t.which&&t.preventDefault()})},r=function(t){t.find("input[name=format]").change(function(){e(t)})},s=function(a){a.find("input[name=includeAnnotations]").change(function(){t(a),e(a)})},l=function(a){a.find("input[name=includeRedactions]").change(function(){t(a),e(a);var n=$(this).is(":checked"),i=a.find("input[name=includeRedactionTags]");i.prop("disabled",!n),i.closest("label").toggleClass("vvDialogDisabledText",!n)})},u=function(e){var t=function(t){t||(t={allPages:!0,pageRanges:!1,currentPage:!1,fileTypePDF:!0,fileTypeTIFF:!1,fileTypeOriginal:!1,burnAnnotations:n.burnAnnotations,includeRedactions:n.includeRedactions,includeRedactionTags:n.includeRedactionTags,includeDocumentNotes:n.includeDocumentNotes,includeWatermarks:n.includeWatermarks});var a=e.find("input[name=pageRangeType]");a.length>0&&(t.allPages||t.pageRanges||t.currentPage?(a[0].checked=t.allPages,a[1].checked=t.pageRanges,a[2].checked=t.currentPage):a[0].checked=!0);var i=!(t.burnAnnotations||t.includeDocumentNotes||t.includeRedactions||t.includeWatermarks),o=e.find("input[value=Original]");if(i&&(o.prop("disabled",!1),o.closest("label").removeClass("vvDialogDisabledText")),t.fileTypeOriginal&&(0===o.length||o.prop("disabled"))?e.find("input[value=PDF]").prop("checked",!0):(e.find("input[value=PDF]").prop("checked",t.fileTypePDF),e.find("input[value=TIFF]").prop("checked",t.fileTypeTIFF),e.find("input[value=Original]").prop("checked",t.fileTypeOriginal)),e.find("input[name=includeAnnotations]").prop("checked",t.burnAnnotations!==!1),e.find("input[name=includeRedactions]").prop("checked",t.includeRedactions!==!1),e.find("input[name=includeRedactionTags]").prop("checked",t.includeRedactionTags!==!1),e.find("input[name=includeDocumentNotes]").prop("checked",t.includeDocumentNotes!==!1),e.find("input[name=includeWatermarks]").prop("checked",t.includeWatermarks!==!1),t.includeRedactions===!1){var r=e.find("input[name=includeRedactionTags]");r.addClass("vvDialogDisabledText"),r.prop("disabled",!0)}},a=function(){t(null)},i=localforage.getItem("dialogTemplateOptions");i.then(t,a)},d=function(e){var t,a,n,i=e.find("input[name=pageRangeType]");i.length>0&&(t=i[0].checked,a=i[1].checked,n=i[2].checked),t||a||n||(t=!0,a=!1,n=!1);var o=e.find("input[value=PDF]").prop("checked"),r=e.find("input[value=TIFF]").prop("checked"),s=e.find("input[value=Original]").prop("checked"),l=e.find("input[name=includeAnnotations]").prop("checked"),u=e.find("input[name=includeRedactions]").prop("checked"),d=e.find("input[name=includeRedactionTags]").prop("checked"),c=e.find("input[name=includeDocumentNotes]").prop("checked"),g=e.find("input[name=includeWatermarks]").prop("checked"),v={allPages:t,pageRanges:a,currentPage:n,burnAnnotations:l,includeRedactions:u,includeRedactionTags:d,includeDocumentNotes:c,includeWatermarks:g,fileTypePDF:o,fileTypeTIFF:r,fileTypeOriginal:s};localforage.setItem("dialogTemplateOptions",v)},c=function(a){a.find("input[name=includeWatermarks]").change(function(){t(a),e(a)})},g=function(e){e.find("input").keypress(function(e){13===e.which&&e.preventDefault()})};return{setupDocumentNameTemplate:a,setupPagesTemplate:o,setupFormatTemplate:r,setupAnnotationsTemplate:s,setupRedactionsTemplate:l,setupDisableRadioEnter:g,setupWatermarksTemplate:c,loadDialogOptions:u,saveDialogOptions:d}}(),s=function(){"use strict";var t={format:{includeOriginalOption:!1}},a=function(e){r.setupDocumentNameTemplate(e),r.setupPagesTemplate(e),r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.loadDialogOptions(e);var t=i.getActivePaneState(),a=e.find("input[name=pageRangeValue]");t&&!a.val()&&e.find("input[name=pageRangeValue]").val("1 - "+t.getPageCount())},n=function(t){var a=e.getFormData(t.find("form")),n=i.getActivePaneState(),r=n.getDocumentId(),s=$.trim(a.documentName);if(!s)return o.toggleErrorBanner(t,e.getLocalizedValue("saveAsDialog.errors.noDocumentName","Please enter a new document name.")),!1;if(s.includes("%"))return o.toggleErrorBanner(t,e.getLocalizedValue("saveAsDialog.errors.invalidDocumentName","Please enter a valid document name.")),!1;var l=a.pageRangeType,u="undefined";"complex"===l?u=a.pageRangeValue:"current"===l&&(u=n.getPageNumber());var d=e.validatePageRangeInput(l,u,n);return"OK"!==d?(o.toggleErrorBanner(t,d),!1):(o.toggleErrorBanner(t),virtualViewer.saveDocument(r,{newDocumentId:s,newDisplayName:s,burnRedactions:a.includeRedactions,includeRedactionTags:!!a.includeRedactionTags,includeTextAnnotations:!1,includeNonTextAnnotations:!1,copyAnnotations:a.includeAnnotations,includeDocumentNotes:a.includeDocumentNotes,includeWatermarks:!1,saveAsFormat:a.format,pageRangeType:l,pageRangeValue:u,copyWatermarks:a.includeWatermarks}),!0)};return{defaultOptions:t,setup:a,confirm:n}}(),l=function(){"use strict";var t={format:{includeOriginalOption:!1}},a=function(e){r.setupDocumentNameTemplate(e),r.setupPagesTemplate(e),r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e);var t=i.getActivePaneState(),a=e.find("input[name=pageRangeValue]");t&&!a.val()&&e.find("input[name=pageRangeValue]").val("1 - "+t.getPageCount())},n=function(t){var a=e.getFormData(t.find("form")),n=i.getActivePaneState(),r=n.getDocumentId(),s=$.trim(a.documentName);if(!s)return o.toggleErrorBanner(t,e.getLocalizedValue("saveAsDialog.errors.noDocumentName","Please enter a new document name.")),!1;var l=a.pageRangeType,u="undefined",d=null;if("complex"===l){if(u=a.pageRangeValue,d=e.normalizePageRangeInput(l,u,n),a.useCut&&d.length>=n.getPageCount())return o.toggleErrorBanner(t,e.getLocalizedValue("errors.onePageLimit")),!1;o.toggleErrorBanner(t)}else"current"===l&&(u=n.getPageNumber(),d=[u]);var c=e.validatePageRangeInput(l,u,n);return"OK"!==c?(o.toggleErrorBanner(t,c),!1):(o.toggleErrorBanner(t),virtualViewer.saveDocument(r,{newDocumentId:s,newDisplayName:s,burnRedactions:a.includeRedactions,includeRedactionTags:a.includeRedactionTags,includeTextAnnotations:!1,includeNonTextAnnotations:!1,copyAnnotations:a.includeAnnotations,includeDocumentNotes:!1,includeWatermarks:a.includeWatermarks,saveAsFormat:a.format,pageRangeType:l,pageRangeValue:u,copyWatermarks:a.includeWatermarks,useCut:a.useCut,pageNums:d,createNew:!0}),!0)};return{defaultOptions:t,setup:a,confirm:n}}(),u=function(){"use strict";var t={format:{includeOriginalOption:!0}},a=function(e){r.setupPagesTemplate(e),r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.setupWatermarksTemplate(e),r.loadDialogOptions(e);var t=i.getActivePaneState(),a=e.find("input[name=pageRangeValue]");t&&!a.val()&&e.find("input[name=pageRangeValue]").val("1 - "+t.getPageCount())},n=function(t){var a=e.getFormData(t.find("form")),n=e.validatePageRangeInput(a.pageRangeType,a.pageRangeValue,i.getActivePaneState());if("OK"!==n)return o.toggleErrorBanner(t,n),!1;o.toggleErrorBanner(t);var r=s(a);return r&&l(a.format),r},s=function(e){var t=i.getActivePaneState(),a=e.format,n=t.getDocFormat();"PDF"===a?n="pdf":"TIFF"===a&&(n="tif");var o=e.pageRangeType,r="undefined";return"complex"===o?r=e.pageRangeValue:"current"===o&&(r=t.getPageNumber()),virtualViewer.exportDocument({exportFormat:a,fileExtension:n,includeTextAnnotations:e.includeAnnotations,includeNonTextAnnotations:e.includeAnnotations,burnRedactions:e.includeRedactions,includeRedactionTags:e.includeRedactionTags,includeDocumentNotes:e.includeDocumentNotes,includeWatermarks:e.includeWatermarks,pageRangeType:o,pageRangeValue:r})},l=function(e){virtualViewer.event(i.getActivePaneState(),"VALUE_EVENT_EXPORT",{KEY_EVENT_EXPORT_FORMAT_NAME:e})};return{defaultOptions:t,setup:a,confirm:n}}(),d=function(){"use strict";var t={format:{includeOriginalOption:!0}},a=function(t){var a=function(t,a){var n=$(t).val();if(!n)return!a||($(t).attr("aria-invalid",!0),!1);for(var i=n.split(","),o=0;o<i.length;o++)if(!e.isValidEmailAddress(i[o].trim()))return $(t).attr("aria-invalid",!0),!1;return $(t).attr("aria-invalid",!1),!0};return!!a(t.find("input[name=fromAddress]"),!0)&&(!!a(t.find("input[name=toAddresses]"),!0)&&(!!a(t.find("input[name=ccAddresses]"))&&!!a(t.find("input[name=ccAddresses]"))))},n=function(e){e?$("#vvEmailIndicator").modal("show"):$("#vvEmailIndicator").modal("hide")},i=function(e){r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.setupWatermarksTemplate(e),r.loadDialogOptions(e),e.find(".vvEmailAddressEntry").on("input",function(t){var n=a(e);e.find(".confirm-button").prop("disabled",!n)}),a(e)||e.find(".confirm-button").prop("disabled",!0)},o=function(t){if(!a(t))return!1;var i=e.getFormData(t.find("form"));return t.modal("hide"),n(!0),window.setTimeout(function(){var e=s(i);e&&(n(!1),l())},200),!0},s=function(e){var t={format:e.format,includeTextAnnotations:e.includeAnnotations,includeNonTextAnnotations:e.includeAnnotations,burnRedactions:e.includeRedactions,includeRedactionTags:e.includeRedactionTags,includeDocumentNotes:e.includeDocumentNotes,includeWatermarks:e.includeWatermarks,pageRangeType:"all",fromAddress:e.fromAddress||"",toAddresses:e.toAddresses||"",ccAddresses:e.ccAddresses||"",bccAddresses:e.bccAddresses||"",subject:e.subject||"",emailBody:e.message||""};return virtualViewer.emailDocument(t)},l=function(){virtualViewer.event(null,"VALUE_EVENT_EMAIL",null)};return{defaultOptions:t,setup:i,confirm:o}}(),c=function(){"use strict";var t={},s=function(e){r.setupPagesTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.loadDialogOptions(e);var t=i.getActivePaneState(),a=e.find("input[name=pageRangeValue]");t&&!a.val()&&e.find("input[name=pageRangeValue]").val("1 - "+t.getPageCount()),e.find("input[name=includeAnnotations]").prop("checked",n.printBurnAnnotations!==!1)},l=function(t){var a=e.getFormData(t.find("form")),r=e.validatePageRangeInput(a.pageRangeType,a.pageRangeValue,i.getActivePaneState());return"OK"!==r?(o.toggleErrorBanner(t,r),!1):(o.toggleErrorBanner(t),n.printBurnAnnotations=a.includeAnnotations,u(a))},u=function(e){var t=i.getActivePaneState(),n=e.pageRangeType,o="undefined";"complex"===n?o=e.pageRangeValue:"current"===n&&(o=t.getPageNumber());var r={includeAnnotations:e.includeAnnotations,includeRedactions:e.includeRedactions,includeRedactionTags:e.includeRedactionTags,includeWatermarks:e.includeWatermarks,includeDocumentNotes:e.includeDocumentNotes,pageRangeType:n,pageRangeValue:o};return a.printDocument(r)};return{defaultOptions:t,setup:s,confirm:l}}(),g=function(){"use strict";var a,s={horizontalTop:{verticalPosition:t.verticalPositionOptions.TOP,textDirection:t.textDirectionOptions.HORIZONTAL,imageClass:"horizontal-top",allowStretchPercent:!0},horizontalBottom:{verticalPosition:t.verticalPositionOptions.BOTTOM,textDirection:t.textDirectionOptions.HORIZONTAL,imageClass:"horizontal-bottom",allowStretchPercent:!0},horizontalCenter:{verticalPosition:t.verticalPositionOptions.CENTER,textDirection:t.textDirectionOptions.HORIZONTAL,imageClass:"horizontal-center",allowStretchPercent:!0},diagonalTop:{verticalPosition:t.verticalPositionOptions.TOP,textDirection:t.textDirectionOptions.DIAGONAL,imageClass:"diagonal-top",allowStretchPercent:!1},diagonalBottom:{verticalPosition:t.verticalPositionOptions.BOTTOM,textDirection:t.textDirectionOptions.DIAGONAL,imageClass:"diagonal-bottom",allowStretchPercent:!1}},l=s.horizontalCenter,u=null,d={pages:{includePageRangeOption:!0},position:l},c=function(e,a){e.find("input[name=verticalPosition]").val(a.verticalPosition),e.find("input[name=textDirection]").val(a.textDirection),e.find(".watermark-image").removeClass(u.imageClass).addClass(a.imageClass);var n=e.find("select[name=stretchPercent]");n.parent().toggle(a.allowStretchPercent),a.allowStretchPercent||n.find("option:first").prop("selected",!0),g(e,a.textDirection===t.textDirectionOptions.DIAGONAL),u=a},g=function(e,t){var a=e.find(".watermark-image"),n=a.parent().width(),i=!1,o=a.width();if(t){var r=53*(Math.PI/180),s=a.width()/a.height(),l=a.parent().height(),u=Math.sqrt(n*n+l*l),d=u/(2*Math.tan(r)*s+2);n=u-2*d,i=!0}var c=6;n-=2*c;var g=+e.find("select[name=stretchPercent]").val(),v=n*g/o;a.attr("style","");var p=a.css("transform");"none"===p&&(p="");var h="transform: scale("+v+") "+p;i&&(h="transform: "+p+" scale("+v+")"),a.attr("style",h)},v=function(t){var a=e.getLocalizedValue("watermarksDialog.editText."+t,t);return"[["+a+"]]"},p=function(e,t){var a=e.prop("selectionStart"),n=e.prop("selectionEnd"),i=e.val();i=i.substring(0,a)+t+i.substring(n),e.val(i),e.prop("selectionStart",a+t.length),e.prop("selectionEnd",a+t.length),e.focus().trigger("input")},h=function(e,t){var a=v(t);p(e,a)},f=function(e){for(var t=e.find(".watermarks-text-area").val(),n=0;n<a.length;n++)t=t.replace(new RegExp(RegExp.escape(v(a[n])),"g"),"@@"+a[n]+"@@");return t},m=function(e,t){var a=e.find(".watermarks-text-area");t=t.replace(/@@([A-Z]*)@@/gi,function(e,t){var a=v(t);return a}),a.val(t).trigger("input")},y=function(n){var o=n.find(".watermark-text-control-panel .btn");a=o.map(function(){return $(this).attr("data-vvwatermark")}),u=l,r.setupPagesTemplate(n),n.find(".confirm-button").prop("disabled",!0);var d=n.find(".delete-button");d.click(function(){var e=n.find("select[name=selectedWatermark]"),a=+e.val();if(a||0===a){var o=i.getActivePaneState();t.removeWatermark(o,a),virtualViewer.delayedPaintCanvases(o),o.getDocumentModel().setWatermarksModifiedSinceInit(!0,o),e.find(":selected").remove(),e.find("option").not(":first-child").each(function(e){$(this).val(e)}),e.val("createNew").change()}}),n.find("select[name=selectedWatermark]").change(function(){var a=$(this),o={},r=null;if("createNew"===a.val())o={text:"",transparency:!0,allPages:!0,stretch:!0},r=l,d.hide();else{var u=i.getActivePaneState(),g=t.getWatermarksArray(u);o=g[+a.val()],r=null,$.each(s,function(e,t){if(t.verticalPosition===o.position.vertical&&t.textDirection===o.position.direction)return r=t,!1}),d.show()}m(n,o.text),n.find("select[name=stretchPercent]").val(o.stretchPercent).trigger("input"),o.stretchPercent||n.find("select[name=stretchPercent]").find("option:first").prop("selected",!0),n.find("input[name=transparency][value="+o.transparency+"]").prop("checked",!0),o.allPages?n.find("input[name=pageRangeType][value=allPages]").prop("checked",!0):(n.find("input[name=pageRangeType][value=complex]").prop("checked",!0),n.find("input[name=pageRangeValue]").val(e.createComplexPageString(o.pages))),r&&c(n,r)});var p=n.find(".watermarks-text-area");p.highlightWithinTextarea({highlight:$.map(a,function(e){return v(e)})});var f=function(){var e=p.val().trim().length>0;n.find(".confirm-button").prop("disabled",!e)};if("Explorer"===BrowserDetect.browser)var y=setInterval(function(){jQuery.contains(document.documentElement,n[0])?f():clearInterval(y)},1e3);else p.on("input",f);n.find(".watermark-text-control-panel .btn").click(function(){var e=$(this).attr("data-vvwatermark");p.focus(),h(p,e),p.trigger("change")}),n.find(".watermark-position-button").click(function(){var e=$(this).attr("data-vvmovement"),t=s[e];return c(n,t),$(".watermark-position-button").attr("aria-pressed",null),$(this).attr("aria-pressed",!0),!1}),n.find("input[name=transparency]").change(function(){n.find(".watermark-image").toggleClass("transparent","true"===this.value)}),n.find("select[name=stretchPercent]").change(function(){g(n)}),setTimeout(function(){g(n)},300)},b=function(a){var r=i.getActivePaneState(),s=r.getDocumentModel(),l=e.getFormData(a.find("form")),u=f(a).trim(),d={vertical:+l.verticalPosition,direction:+l.textDirection},c=l.pageRangeType,g=l.pageRangeValue,v=e.validatePageRangeInput(c,g,r);if("OK"!==v)return o.toggleErrorBanner(a,v),!1;o.toggleErrorBanner(a);var p=!1,h=null;"all"===c&&(p=!0),"complex"===c?h=e.parseComplexPageString(g,r.getPageCount()):"current"===c&&(h=[r.getPageNumber()]);var m={text:u,image:null,transparency:l.transparency,position:d,allPages:p,stretchPercent:+l.stretchPercent,pages:h,format:{font:"Times New Roman",color:"000000"},adminCreated:n.adminCreated},y=+l.selectedWatermark;return y||0===y?t.getWatermarksArray(r)[y]=m:t.addWatermark(r,m),s.setWatermarksModifiedSinceInit(!0,r),virtualViewer.delayedPaintCanvases(r),!0};return{defaultOptions:d,setup:y,confirm:b}}();return o}),define("vvSearchManager",["vvUtility","vvDefines","vvStateManager","user-config/config","vvSearch","vvThumbs","vvDialogs"],function(e,t,a,n,i,o,r){var s=0,l=new i,u=function(){$("#vvSearchTerm").show(),M(),p($(".vvSearchButton"),!0);var t=$("#vvSearchTermField");
if(t.prop("placeholder",e.getLocalizedValue("search.basicSearchMode.title","Basic Search")),n.searchRedactionTags)for(var i=0;i<n.annotationTags.length;i++){var o=$("<option></option>").text(n.annotationTags[i]);$("#vvAnnTagSearchSelect").append(o)}else $("#vvMainSearchButtons > div").removeClass("col-xs-12").addClass("col-xs-11 col-xs-offset-1"),$("#vvTagAllRedactions").remove();$("#vvDocSearchStart").click(function(e){if("true"!==$(this).attr("aria-disabled")){var t=$("#vvSearchTermField").val(),n=a.getCurrentState();virtualViewer.checkRedactionsEnabled()&&n.isSearchable&&p($("#vvSearchRedactAllMatches, #vvSearchRedactCurrentMatch"),!1),U(t)}}),$("#vvAnnSearchStart").click(function(e){if("true"!==$(this).attr("aria-disabled")){var t="";c()||(t=$("#vvSearchTermField").val()),p($("#vvSearchRedactAllMatches, #vvSearchRedactCurrentMatch"),!0),z(t)}}),$("#vvSearchTermField").on("change",function(){if(!$(this).val()){var e=a.getCurrentState();e&&!e.cacheSearchResults&&(C(),h())}}),$("#vvSearchTermField").on("keyup",function(e){if("true"===$(this).attr("aria-disabled"))return void e.preventDefault();var t=$(this).val();10!==e.which&&13!==e.which||(e.preventDefault(),t.length&&U(t)),t||C(),h()}),$("#vvSearchControls").on("submit",function(e){e.preventDefault()}),$("#vvSearchPrevious").click(function(){"true"!==$(this).attr("aria-disabled")&&w()}),$("#vvSearchNext").click(function(){"true"!==$(this).attr("aria-disabled")&&I()}),$("#vvSearchProgressCancel").click(function(){x()}),$("#vvSearchRedactAllMatches").click(function(){"true"!==$(this).attr("aria-disabled")&&P()}),$("#vvSearchRedactCurrentMatch").click(function(){"true"!==$(this).attr("aria-disabled")&&A()}),$("#vvTagAllRedactions").click(function(){virtualViewer.showTagAllRedactionsDialog()}),d()},d=function(){var a=e.getLocalizedValue("search.basicSearchMode.title","Basic Search");$("#vvSearchPatternOptionNone").text(a).data("pattern-index",-1).on("click",g);for(var n=$("#vvSearchPatternSelect"),i=0;i<t.searchPatterns.length;i++){var o=t.searchPatterns[i],r=$("<a></a>").text(e.getLocalizedValue(o.localizeKey,o.name)).data("pattern-index",i),s=$("<li></li>");r.on("click",g),s.append(r).appendTo(n)}},c=function(){var e=$("#vvSearchTermField"),a="number"==typeof e.data("pattern-index")?e.data("pattern-index"):-1;return a===-1?null:t.searchPatterns[a].pattern},g=function(e){var a=-1;e&&(a=$(e.target).data("pattern-index")),a===-1?l.pattern=null:l.pattern=t.searchPatterns[a].pattern,l.patternIndex=a,v(a),h()},v=function(a){var n=$("#vvSearchTermField");if(n.data("pattern-index",a),a===-1)p(n,!1),n.val("");else{p(n,!0);var i=t.searchPatterns[a];n.val(e.getLocalizedValue(i.localizeKey,i.name))}},p=function(e,t){e&&(t=!!t,e.attr("aria-disabled",t).prop("disabled",t).css("opacity",t?.2:1),t&&e.tooltip("hide"))},h=function(){var e=a.getCurrentState();e&&($("#vvSearchTermField").val()||l.pattern)?((virtualViewer.ocrEnabled||e.getIsSearchable())&&p($("#vvDocSearchStart"),!1),p($("#vvAnnSearchStart"),!1)):p($("#vvDocSearchStart, #vvAnnSearchStart"),!0)},f=function(e){if(e=e||a.getCurrentState()){var t=e.getPageNumber()||0,n=l.firstResultPage,i=l.lastResultPage,o=l.getPageResults(i),r=!n&&0!==n,s=!i&&0!==i;$("#vvSearchTermField").val()||p($("#vvDocSearchStart, #vvAnnSearchStart"),!0);var u=r||n>t||n===t&&0===l.searchCursor.match;p($("#vvSearchPrevious"),u);var d;d=o&&o.matches&&o.matches.length?o.matches.length-1:0,u=s||i<t||i===t&&l.searchCursor.match===d,p($("#vvSearchNext"),u),!virtualViewer.checkRedactionsEnabled()||r&&s?p($(".vvSearchRedactButton, #vvTagAllRedactions"),!0):p($(".vvSearchRedactButton"),!1),l.searchAnnotationResults.length&&p($(".vvSearchRedactButton, #vvTagAllRedactions"),!0)}},m=function(){x(),$("#vvSearchTermField").val(""),C()},y=function(e,t){if(e){var a=require("vvThumbs");x(),a.removeThumbs($("#vvSearch")),$(".vvNoSearchResults").remove(),t&&(t.cachedSearch=l),e.cachedSearch?(l=e.cachedSearch,a.fillSearchThumbs(e,l.getMatchedPages()),a.loadVisibleThumbs($("#vvSearchResults")),L(),v(l.patternIndex),l.searchTerm&&$("#vvSearchTermField").val(l.searchTerm)):(l=new i,v(-1)),f(e),h()}},b=function(e){var t=virtualViewer.getCurrentAnnObject();virtualViewer.hideAnnPopUp(),$("#vvAnnotationNotesArea").collapse("hide"),"Sticky Note"===t.type&&(t.collapsed=!1),(e.tag||e.comment)&&(virtualViewer.annPopUpHandler(null,t),e.comment&&$("#vvAnnotationNotesArea").collapse("show"))},A=function(){if(a.getCurrentState()&&l){var e=l.getCurrentMatch();e||(I(),e=l.getCurrentMatch());var t=l.searchCursor.page,n=[];e.annotation||(n=virtualViewer.redactSearchMatch(e,t)),l.matchRedactions=l.matchRedactions.concat(n)}},P=function(){var e=a.getCurrentState();if(e&&e.pageStates){for(var t=0;t<e.getPageCount();t++)T(t);n.searchRedactionTags&&p($("#vvTagAllRedactions"),!1)}},T=function(e){var t,a=l.getPageResults(e).matches,n=[];if(!a||!a.length)return[];for(var i=0;i<a.length;i++){var o=a[i];t=virtualViewer.redactSearchMatch(o,e),n=n.concat(t)}return l.matchRedactions=l.matchRedactions.concat(n),n},S=function(){return l.matchRedactions||[]},w=function(){var e=a.getCurrentState();if(e&&!a.isVideoOpen()){var t=e.getPageNumber(),n=t!==l.searchCursor.page,i=l.getPageResults(t);if(l.searchCursor.match--,!i||n||l.searchCursor.match<0){for(n||t--;t>=l.firstResultPage;){var o=l.getPageResults(t);if(o&&o.matches.length){virtualViewer.setPage(t),l.searchCursor.match=o.matches.length-1;break}t--}t<l.firstResultPage&&(virtualViewer.setPage(l.lastResultPage),t=l.lastResultPage)}l.searchCursor.page=t;var r=l.getCurrentMatch();r&&(r.annotation&&(virtualViewer.setCurrentAnnObject(r.annotation),b(r)),virtualViewer.delayedPaintCanvases(e),f())}},I=function(){var e=a.getCurrentState();if(e&&!a.isVideoOpen()){var t=e.getPageNumber(),n=t!==l.searchCursor.page,i=l.getPageResults(t);if(l.searchCursor.match++,!i||n||l.searchCursor.match>=i.matches.length){for(l.searchCursor.match=0,n||t++;t<=l.lastResultPage;){var o=l.getPageResults(t);if(o&&o.matches.length){virtualViewer.setPage(t);break}t++}t>l.lastResultPage&&(virtualViewer.setPage(l.firstResultPage),t=l.firstResultPage)}l.searchCursor.page=t;var r=l.getCurrentMatch();r&&(r.annotation&&(virtualViewer.setCurrentAnnObject(r.annotation),b(r)),virtualViewer.delayedPaintCanvases(e),f())}},C=function(){l=new i,o.removeThumbs($("#vvSearch")),$(".vvNoSearchResults").remove();var e=a.getCurrentState();e.cachedSearch=null,f(),virtualViewer.delayedPaintCanvases(e)},D=function(){(l.searchTerm||l.pattern)&&(l.annotationSearch||(l.clearResults(),U(l.searchTerm,l.firstPageToSearch,l.lastPageToSearch,l.performOCR)))},x=function(){l.searchCancelled=!0,l.inProgress=!1,clearTimeout(s),L()},M=function(){$("#vvSearchProgressContainer").hide(),$("#vvSearchProgress").attr("aria-valuenow",0).css("width","0%")},N=function(e,t,a){var n,i=Math.ceil(a/e),o=Math.ceil(t/e);if(i===o)n=100;else{var r=(o+1)/(i+1);n=parseInt(100*r)}$("#vvSearchProgress").attr("aria-valuenow",n).css("width",n+"%")},L=function(){$("#vvSearchTerm").show(),M(),h(),f(),l.noResultsFound()&&k()},V=function(){$("#vvSearchTerm").hide(),$("#vvSearchProgressContainer").show();var e=$("#vvSearchProgress").width();$("#vvSearchProgressText").width(e-2),$("#vvSearchProgressCancel").position({my:"right",at:"right",of:"#vvSearchProgressText"}),p($("#startSearchButtons .btn, #vvSearchRedactButtonsContainer .btn"),!0)},k=function(){$(".vvNoSearchResults").length||$("<div></div>").text(e.getLocalizedValue("search.noResults","This search found no results.")).addClass("vvNoSearchResults").appendTo($("#vvSearchResults"))},B=function(){return!(!l||l.searchCancelled)&&l.inProgress},R=function(t,n,i,o){t=t||a.getCurrentState(),i.lineWidth=2;var r=l.searchDocumentResults[o];if(r&&r.matches)for(var s=r.matches,u=0;u<s.length;u++)for(var d=s[u],c=F(u,o),g=0;g<d.rectangles.length;g+=1){var v=d.rectangles[g],p=new e.ImageRect(v.left/1e3,v.top/1e3,v.right/1e3,v.bottom/1e3);virtualViewer.highlightImageRect(p,i,c)}},F=function(e,a){var i,o=n.searchColors||{};return i=e===l.searchCursor.match&&a===l.searchCursor.page?o.selectedMatchColor||t.searchSelectedColor:o.matchColor||t.searchDefaultColor},E=function(e){var n=a.getCurrentState();if(!l.searchCancelled){var i=l.addDocumentSearchResults(e,l.firstPageOfCurrentBatch);f();var o=l.firstPageOfCurrentBatch,r=o+l.batchSize,u=n.getPageNumber();N(l.batchSize,r,l.lastPageToSearch);var d=require("vvThumbs");d.fillSearchThumbs(n,i),d.loadVisibleThumbs($("#vvSearchResults")),u>=o&&u<=r&&virtualViewer.delayedPaintCanvases(n);var c=r;if(c>=l.lastPageToSearch)return L(),void(l.inProgress=!1);c+l.batchSize>l.lastPageToSearch&&(l.batchSize=l.lastPageToSearch-c),s=setTimeout(function(e){_(l.searchTerm,c,l.batchSize)},t.searchTimeout)}},O=function(e){if(virtualViewer.checkServerException(e))L();else{if(l.performOCR){var t=a.getActivePaneState();t.setIsSearchable(!0),setTimeout(function(){for(var e=0;e<t.getPageCount();e++)virtualViewer.getAllText(e,t)},0)}E(e)}},_=function(e,i,o){var r=a.getCurrentState(),u=r.getDocumentModel().model,d=new URI(n.servletPath);d.escapeQuerySpace(!1),d.addQuery("action","searchDocument"),d.addQuery("documentId",r.getDocumentId()),d.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.addQuery("pageCount",r.getPageCount()),d.addQuery("performOcr",l.performOCR);var c=u.pageData;u.pageData=c.slice(i,i+o),d.addQuery("modelJSON",JSON.stringify(u)),u.pageData=c,l.firstPageOfCurrentBatch=i,null!==virtualViewer.getOverlayPath()&&d.addQuery("overlayPath",virtualViewer.getOverlayPath()),t.cacheBuster===!0&&d.addQuery("cacheBuster",Math.random()),l.pattern?d.addQuery("searchPattern",l.pattern):d.addQuery("searchText",e),d.addQuery("firstPage",i),d.addQuery("lastPage",i+o),l.caseSensitive&&d.addQuery("caseSensitive","true"),l.exactMatch&&d.addQuery("exactMatch","true"),s&&clearTimeout(s),l.performOCR&&virtualViewer.displayOcrWaitIndicator(!0);var g=d.query();d.query(""),$.ajax({url:d.toString(),type:"POST",dataType:"json",data:g}).done(O).fail(function(e){console.log("Search document error")}).always(function(){virtualViewer.displayOcrWaitIndicator(!1)})},U=function(e,t,n,i){var o=a.getCurrentState();if(o&&o.pageStates){var s=!1;if(o.isVirtualDocument()){if(!virtualViewer.ocrEnabled||!i)return void r.ocrDialogForVirtualDocumentSearch(function(){setTimeout(function(){W(e,t,n,o,!0)},0)},function(){setTimeout(function(){W(e,t,n,o,!1)},0)});s=!0}if(o.getIsSearchable())s=!1;else{if(!virtualViewer.ocrEnabled)return;if(!i)return void r.ocrDialog(function(){setTimeout(function(){W(e,t,n,o,!0)},0)});s=!0}W(e,t,n,o,s)}},W=function(e,a,i,o,r){C(o),V(),l.inProgress=!0,("number"!=typeof a||a<0)&&(a=0),("number"!=typeof i||i>o.getPageCount())&&(i=o.getPageCount());var s=n.searchBatchSize||t.searchBatchSize;s>i-a&&(s=i-a),l.batchSize=s,l.documentId=o.getDocumentId(),l.searchTerm=e,l.pattern=c(),l.firstPageToSearch=a,l.lastPageToSearch=i,"boolean"==typeof r&&(l.performOCR=r),_(e,a,s)},z=function(e){if(e||c()){var t,n=e.toUpperCase(),i=a.getActivePaneState();if(!i||a.isVideoOpen())return void p($("#vvAnnSearchStart"),!0);C(),l.searchTerm=e;var o=null;!e&&c()&&(l.pattern=c(),o=new RegExp(l.pattern)),l.annotationSearch=!0;for(var r=i.getPageCount(),s=[],u=null,d=0;d<r;d++){t=i.pageStates[d];var g=!1;for(var v in t.annotationLayers)if(v){var h=t.annotationLayers[v];if(h&&h.anns)for(var m=0;m<h.anns.length;m++){var y=!1,A={annotation:null,text:null,tag:null,comment:null},P=h.anns[m];if(!P.annDelete){if(h.visibility||(h.visibility=!0),"Sticky Note"===P.type||"Rubber Stamp"===P.type){var T=P.getTextString().toUpperCase();(o&&o.test(T)||n&&T.indexOf(n)>-1)&&(A.text=T,y=!0)}for(var S=0;S<P.noteArray.length;S++){var w=P.noteArray[S],I=w.text.toUpperCase();(o&&o.test(I)||n&&I.indexOf(n)>-1)&&(A.comment=I,y=!0)}for(var D=0;D<P.annotationTags.length;D++){var x=P.annotationTags[D].toUpperCase();(o&&o.test(x)||n&&x.indexOf(n)>-1)&&(A.tag=x,y=!0)}y&&(A.annotation=P,g=!0,l.addAnnotationSearchResultToPage(A,d))}}}g&&(s.push(d),null===u&&d>=i.getPageNumber()&&(u=d))}if(L(),s.length){var M=require("vvThumbs");M.fillSearchThumbs(i,s),M.highlightActiveThumbnail(),f(),null!==u?l.searchCursor.page=u:l.searchCursor.page=l.firstResultPage,l.searchCursor.match=0,virtualViewer.setPage(l.searchCursor.page);var N=l.getPageResults(l.searchCursor.page);virtualViewer.setCurrentAnnObject(N.matches[0].annotation),b(N.matches[0]),virtualViewer.delayedPaintCanvases(),M.loadVisibleThumbs($("#vvSearchResults"))}}},H=function(){return l?l.getResults():[]};return{prepareSearch:u,updateSearchButtons:f,handleSearchOnTabSwitch:y,handleSearchOnPageManipulation:m,searchAnnotationText:z,searchDocumentText:U,clearSearchResults:C,paintDocumentSearchResults:R,rerunCurrentSearch:D,getSearchedRedactions:S,searchInProgress:B,nextSearchResult:I,previousSearchResult:w,cancelCurrentSearch:x,getCurrentSearchResults:H}}),define("vvUserPreferences",["vvUtility","user-config/config","user-config/toolbar-config","vvWidgets","vvDefines","vvStateManager"],function(e,t,a,n,i,o){function r(){this.userPrefType={ANNOTATION:0,OPTION:1,STAMP:2,GENERAL:3,NOTE:4},this.JSONBlob=null,this.annotationPreference={userPrefType:0,type:null,localType:null,sticky:null,lineColor:null,lineWidth:null,fillColor:null,fontColor:null,fontFace:null,fontSize:null,fontBold:null,fontItalic:null,displayName:null,text:null},this.toolbarOption={userPrefType:1,annotation:null,name:null,on:!0},this.customTextStamp={userPrefType:2,displayName:null,textString:null,fontColor:null,fontFace:null,fontSize:null,fontBold:null,fontItalic:null,fontUnderline:null,fontStrike:null},this.noteTemplate={userPrefType:4,templateName:null,templateString:null},this.defaultUsername=e.getLocalizedValue("userPreferencesDialog.userNameInput","Undefined User"),this.username="",this.imageControlToolbar=[],this.annotationToolbar=[],this.annotationPropertyArray={},this.fileUploadVisible=!1,this.customStampArray=[],this.noteTemplateArray=[],this.generalPreferencesArray=[],this.zoomPreferences={mode:-1,zoomLevelIndex:-1,zoomLevel:-1},this.defaultTab=-1,this.currentAnnotationProperty=null,this.currentCustomStampIndex=null,this.numOfStamps=1,this.errorDialogTimeoutId=null,this.errorTimeoutTime=5,this.versions={zoomPreferences:3,annotationPreferences:3,imageToolbarPreferences:3,annotationToolbarPreferences:3,customTextStamps:3,noteTemplates:3},this.errorState=!1,this.dynamicUPOptionPrefix="vvUPOption",this.defaultZoomPercentIndex=0,this.videoPreferences={autoplay:null,mute:null,controls:null,stretch:null},this.dialogHasBeenOpened=!1,this.saveButtonHit=!1}var s;r.prototype.init=function(){this.readInCurrentToolbarButtons(),this.loadUserPreferences()},r.prototype.cloneAnnotationPreference=function(e){var t={userPrefType:this.userPrefType.ANNOTATION,type:e.type,localType:e.localType,sticky:e.sticky,lineColor:e.lineColor,lineWidth:e.lineWidth,fillColor:e.fillColor,fontColor:e.fontColor,fontFace:e.fontFace,fontSize:e.fontSize,bold:e.fontBold,italic:e.fontItalic};return t},r.prototype.cloneTextStamp=function(e){var t={userPrefType:this.userPrefType.STAMP,displayName:e.displayName,textString:e.textString,fontColor:e.fontColor,fontFace:e.fontFace,fontSize:e.fontSize,fontBold:e.fontBold,fontItalic:e.fontItalic};return t},r.prototype.createDefaultTextStamp=function(e){var t={userPrefType:this.userPrefType.STAMP,displayName:"Custom Stamp",textString:"Custom Stamp Text",fontColor:"000000",fontFace:"Helvetica",fontSize:18,fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1};return e&&(t.displayName=e,t.textString=e+" Text"),t},r.prototype.cloneNoteTemplate=function(e){var t={userPrefType:this.userPrefType.NOTE,templateName:e.templateName,templateString:e.templateString};return t},r.prototype.createDefaultNoteTemplate=function(e){var t={userPrefType:this.userPrefType.NOTE,templateName:"Template",templateString:"Template Text"};return e&&(t.templateName=e),t},r.prototype.cloneToolbarOption=function(e){var t={userPrefType:this.userPrefType.OPTION,annotation:e.annotation,id:e.id,name:e.name,on:e.on};return t},r.prototype.readInCurrentToolbarButtons=function(){this.imageControlToolbar=[],this.annotationToolbar=[],this.toolbarOption.name="Image Controls",this.toolbarOption.on=!0,this.toolbarOption.annotation=!1,this.toolbarOption.id="",this.imageControlToolbar.push(this.cloneToolbarOption(this.toolbarOption));var t=a(virtualViewer).imageToolbarButtons;for(var n in t)"vvFileUpload"===n&&virtualViewer.disableUploadDocument||t[n]&&(t[n].localizeKey?this.toolbarOption.name=e.getLocalizedValue(t[n].localizeKey):this.toolbarOption.name=t[n].name,this.toolbarOption.iconImage=t[n].iconImage,this.toolbarOption.id=n,this.toolbarOption.on=!0,this.imageControlToolbar.push(this.cloneToolbarOption(this.toolbarOption)));this.toolbarOption.name="Annotation Toolbar",this.toolbarOption.on=!0,this.toolbarOption.annotation=!0,this.toolbarOption.id="",this.annotationToolbar.push(this.cloneToolbarOption(this.toolbarOption));var i=a(virtualViewer).annotationToolbarButtons;for(var o in i)i[o]&&(i[o].localizeKey?this.toolbarOption.name=e.getLocalizedValue(i[o].localizeKey):this.toolbarOption.name=i[o].name,this.toolbarOption.iconImage=i[o].iconImage,this.toolbarOption.id=o,i[o].annType&&(this.toolbarOption.annotation=!0),this.toolbarOption.on=!0,this.annotationToolbar.push(this.cloneToolbarOption(this.toolbarOption)))},r.prototype.initDialog=function(){return t.disableUserPreferences?void $("#vvUserPreferencesDialog").remove():(this.prepareToolbarTab(),this.prepareAnnotationTab(),this.prepareStampsTab(),this.prepareNotesTab(),this.prepareGeneralTab(),this.prepareVideoTab(),$("#vvUserPreferencesDialog form").submit(function(e){return e.preventDefault(),!1}),$("#vvUserPreferencesDialogResetButton").click(function(){s.reset()}),$("#vvUserPreferencesDialogSaveButton").click(function(){s.saveButtonHit=!0,s.save(),$("#vvUserPreferencesDialog").modal("hide")}),void $("#userPreferencesClose").attr("title",e.getLocalizedValue("commonDialog.closeButton","Close")))},r.prototype.updateDialog=function(){this.dialogHasBeenOpened||(this.initDialog(),this.dialogHasBeenOpened=!0),this.updateToolbarConfigurations(),this.updateDialogZoomPreferences(),this.updateDialogDefaultTab(),this.createCustomStampsTable(),this.createNoteTemplateTable(),this.setAnnotationProperties(),this.setUsername(this.username)},r.prototype.reset=function(){localforage.clear(),this.loadDefaults(),t.disableUserPreferences||this.updateDialog()},r.prototype.turnOnErrorState=function(t){this.errorState=!0,t=t||e.getLocalizedValue("errors.failureLoadingUserPreferences","Problem loading User Preferences. Setting User Preferences back to default values."),$("#vvUserPreferencesErrorBanner").text(t),$("#vvUserPreferencesErrorBanner").show(),$("#vvUserPreferencesDialogResetButton").prop("disabled",!0),$("#vvUserPreferencesDialogSaveButton").prop("disabled",!0)},r.prototype.turnOffErrorState=function(){this.errorState=!1,$("#vvUserPreferencesErrorBanner").hide(),$("#vvUserPreferencesDialogResetButton").prop("disabled",!1)},r.prototype.save=function(){if(!t.disableUserPreferences){var e=this.saveZoomPreferences();e=e&&this.saveUsername(),e=e&&this.saveTabPreference(),e=e&&this.saveAnnotationPreferences(),e=e&&this.saveToolbarPreferences(),e=e&&this.saveCustomStamps(),e=e&&this.saveNoteTemplates(),e=e&&this.saveVideoPreferences(),e&&this.applyUserPreferences()}},r.prototype.loadUserPreferences=function(){if(t.disableUserPreferences)return void this.loadDefaults();try{if(!localforage)return this.turnOnErrorState(),void this.loadDefaults()}catch(e){return this.turnOnErrorState(),void this.loadDefaults()}this.turnOffErrorState(),this.loadToolbarPreferences(),this.loadAnnotationPreferences(),this.loadStampPreferences(),this.loadTemplatePreferences(),this.loadZoomPreferences(),this.loadTabPreferences(),this.loadUsername(),this.loadVideoPreferences()},r.prototype.loadTemplatePreferences=function(){var e=function(){s.turnOnErrorState(),l(null)},t=localforage.getItem("noteTemplateArray");t.then(l,e)};var l=function(e){if(e&&e.version===s.versions.noteTemplates)s.noteTemplateArray=e;else{s.noteTemplateArray=[];for(var a=0;a<t.noteTemplates.length;a++){var n=t.noteTemplates[a],i=s.cloneNoteTemplate(s.noteTemplate),o=s.createDefaultNoteTemplate();for(var r in i)r&&n.hasOwnProperty(r)&&(i[r]=n[r],"templateName"===r&&(i[r]=n.templateName),i[r]&&(o[r]=i[r]));s.noteTemplateArray.push(o)}}virtualViewer.createNoteTemplateContextMenuList()};r.prototype.loadStampPreferences=function(){var e=function(){s.turnOnErrorState(),u(null)},t=localforage.getItem("customStampArray");t.then(u,e)};var u=function(e){if(e&&e.version===s.versions.customTextStamps)s.customStampArray=e;else{s.customStampArray=[];for(var a=t.textRubberStamps||[],n=0;n<a.length;n++){var i=a[n],o=s.cloneTextStamp(s.customTextStamp),r=s.createDefaultTextStamp();for(var l in o)l&&(o[l]=i[l],"displayName"===l&&(o[l]=i.textString),o[l]&&(r[l]=o[l]));s.customStampArray.push(r)}}virtualViewer.createTextAnnContextMenuList()};r.prototype.loadUsername=function(){var e=function(){s.turnOnErrorState(),d(null)},t=localforage.getItem("username");t.then(d,e)};var d=function(e){var t={loadedUsername:e,previousUsername:s.username};$("#virtualViewerMain").trigger("onLoadUsername",t),s.username.length&&s.username!==s.defaultUsername||(e&&0!==e.length||s.setUsername(s.defaultUsername),s.setUsername(e))};r.prototype.loadZoomPreferences=function(){var e=function(){s.turnOnErrorState(),c(null)},t=localforage.getItem("zoomPreferences");t.then(c,e)};var c=function(e){e&&e.version===s.versions.zoomPreferences?s.zoomPreferences=e:(s.zoomPreferences.mode=t.defaultZoomMode||i.zoomModes.fitWindow,s.zoomPreferences.zoomLevel=t.defaultZoomLevel||100,s.zoomPreferences.zoomLevelIndex=t.zoomLevels.indexOf(s.zoomPreferences.zoomLevel),s.zoomPreferences.zoomLevelIndex===-1&&(s.zoomPreferences.zoomLevelIndex=s.getMiddleZoomLevel(),s.zoomPreferences.zoomLevel=t.zoomLevels[s.zoomPreferences.zoomLevelIndex])),s.dialogHasBeenOpened||s.applyZoomPreferences()};r.prototype.loadTabPreferences=function(){var e=function(){s.turnOnErrorState(),g(null)},t=localforage.getItem("defaultTab");t.then(g,e)};var g=function(e){"number"!=typeof e&&(e=t.defaultThumbnailTab),s.defaultTab=e;var a=virtualViewer.getActivePaneState();a&&!a.isVideo()||(e=i.thumbnailTabs.document),virtualViewer.openDefaultThumb(e)};r.prototype.loadToolbarPreferences=function(){var e=function(){s.turnOnErrorState(),p(null)},t=localforage.getItem("imageControlToolbar");t.then(p,e);var a=function(){s.turnOnErrorState(),v(null)},n=localforage.getItem("annotationToolbar");n.then(v,a)};var v=function(e){if(e&&e.length&&e.version===s.versions.annotationToolbarPreferences)s.annotationToolbar=e;else if(s.annotationToolbar)for(var t=1;t<s.annotationToolbar.length;t++)s.annotationToolbar[t].on=!0;s.updateToolbarsGeneric(s.annotationToolbar,"vvAnnToolbar")},p=function(e){if(e&&e.length&&e.version===s.versions.imageToolbarPreferences)s.imageControlToolbar=e;else if(s.imageControlToolbar)for(var t=1;t<s.imageControlToolbar.length;t++)s.imageControlToolbar[t].on=!0;s.updateToolbarsGeneric(s.imageControlToolbar,"vvToolbar")};r.prototype.loadAnnotationPreferences=function(){var e=function(){s.turnOnErrorState(),h(null)},t=localforage.getItem("annotationPropertyArray");t.then(h,e)};var h=function(e){if(null===e||e.length<1){e={};for(var a in i.annotationTypes){if(a){var n=i.annotationTypes[a];e[n]=s.cloneAnnotationPreference(t.annotationDefaults),e[n].type=n,e[n].version=s.versions.annotationPreferences}n===i.annotationTypes.SANN_POSTIT&&a&&(e[n].fillColor=t.annotationDefaults.stickyFillColor)}e[i.annotationTypes.SANN_HIGHLIGHT_RECT]&&t.annotationDefaults.highlightFillColor&&(e[i.annotationTypes.SANN_HIGHLIGHT_RECT].fillColor=t.annotationDefaults.highlightFillColor)}s.annotationPropertyArray=e};r.prototype.applyUserPreferences=function(){virtualViewer.setActivePane(0),this.updateToolbarDisplay(),virtualViewer.createTextAnnContextMenuList(),virtualViewer.createNoteTemplateContextMenuList(),virtualViewer.openDefaultThumb(),this.applyZoomPreferences()},r.prototype.loadDefaults=function(e){this.readInCurrentToolbarButtons(),e||this.updateToolbarDisplay(),c(null,this),d(null,this),u(null,this),l(null,this),h(null,this),w(null,this),g(null)},r.prototype.prepareToolbarTab=function(){for(var e=1;e<this.imageControlToolbar.length;e++){var t=this.imageControlToolbar[e].name,a=this.createElmtIDWithPrefix(this.imageControlToolbar[e].id,!1),n=$("<label></label>").attr("for",a+"Check").addClass("list-group-item vvUPToolbarCheckItem");n.append($("<input>").attr({type:"checkbox",id:a+"Check"})),n.append($("<span></span>").attr("id",a).text(t)),$("#vvUPImageControl").append(n)}for(var i=1;i<this.annotationToolbar.length;i++){var o=this.annotationToolbar[i].name,r=this.createElmtIDWithPrefix(this.annotationToolbar[i].id,!1),s=$("<label></label>").attr("for",r+"Check").addClass("list-group-item vvUPToolbarCheckItem");s.append($("<input>").attr({type:"checkbox",id:r+"Check"})),s.append($("<span></span>").attr("id",r).text(o)),$("#vvUPAnnotationToolbar").append(s)}$("#ImageControlsCheck").on("change",function(){$("#vvUPImageControl .vvUPToolbarCheckItem > input").attr("disabled",!$(this).prop("checked"))}),$("#AnnotationToolbarCheck").on("change",function(){$("#vvUPAnnotationToolbar .vvUPToolbarCheckItem > input").attr("disabled",!$(this).prop("checked"))})},r.prototype.updateToolbarDisplay=function(){t.enableCrop||$("#vvCropButton").hide(),this.updateToolbarsGeneric(this.imageControlToolbar,"vvToolbar"),this.updateToolbarsGeneric(this.annotationToolbar,"vvAnnToolbar")},r.prototype.updateToolbarsGeneric=function(e,t){var a,n=!1;a="vvToolbar"===t?$("#vvToolbarItems"):$("#vvAnnToolbar, #vvAnnToolbarHamburgerItems");var i;e.length&&e[0].on?a.removeClass("vvHidden"):(n=!0,a.addClass("vvHidden"));for(var o,r=1;r<e.length;r++)i=e[r],o=$("."+i.id),o.toggle(i.on),o.toggleClass("vvPreferenceDisabled",!i.on),o.toggleClass("vvPreferenceEnabled",!!i.on),"vvFileUpload"===i.id&&(this.fileUploadVisible=i.on);n&&!e[0].on||a.show(),virtualViewer.applyToolbarButtonConfigurations()},r.prototype.updateToolbarConfigurations=function(){var e,t;if(0!==this.imageControlToolbar.length&&0!==this.annotationToolbar.length){e=this.imageControlToolbar[0],t=$("#ImageControlsCheck"),t.prop("checked",e.on),$("#vvUPImageControl .vvUPToolbarCheckItem > input").attr("disabled",!e.on);for(var a=1;a<this.imageControlToolbar.length;a++)e=this.imageControlToolbar[a],t=$("#"+this.createElmtIDWithPrefix(e.id,!0)),t.prop("checked",e.on),"vvFileUpload"===e.id&&virtualViewer.disableUploadDocument&&t.parents(".vvUPToolbarCheckItem").hide();for(e=this.annotationToolbar[0],t=$("#AnnotationToolbarCheck"),t.prop("checked",e.on),$("#vvUPAnnotationToolbar .vvUPToolbarCheckItem > input").attr("disabled",!e.on),a=1;a<this.annotationToolbar.length;a++)e=this.annotationToolbar[a],t=$("#"+this.createElmtIDWithPrefix(e.id,!0)),t.prop("checked",e.on)}},r.prototype.saveToolbarPreferences=function(){for(var e=$("#vvUPImageControl input"),t=0;t<this.imageControlToolbar.length;t++)e[t]&&(this.imageControlToolbar[t].on=$(e[t]).prop("checked"));this.imageControlToolbar.version=this.versions.imageToolbarPreferences,e=$("#vvUPAnnotationToolbar input");for(var a=0;a<this.annotationToolbar.length;a++)e[a]&&(this.annotationToolbar[a].on=$(e[a]).prop("checked"));this.annotationToolbar.version=this.versions.annotationToolbarPreferences;try{localforage.setItem("imageControlToolbar",this.imageControlToolbar),localforage.setItem("annotationToolbar",this.annotationToolbar)}catch(e){return!1}var n=virtualViewer.getCallbackManager(),i={imageControlToolbar:this.imageControlToolbar,annotationToolbar:this.annotationToolbar};return n.call("saveToolbarPreferences",i),!0},r.prototype.prepareAnnotationTab=function(){for(var e=$("#vvUPAnnotationsList"),t=$("#vvUPAnnotationProperties"),o=1;o<this.annotationToolbar.length;o++){var r=this.annotationToolbar[o].id,s=a(virtualViewer).annotationToolbarButtons[r].annType;if(s&&s!==i.annotationTypes.SANN_REDACTION_RECT&&s!==i.annotationTypes.SANN_BITMAP){var l=this.createElmtIDWithPrefix(this.sanitizeName(s),!1),u=l+"Edit",d=$("#vvUPAnnotationEditTemplate").clone().attr("id",u).data("anntype",s);t.append(d),n.createColorPicker(d.find(".vvUPAnnotationLineColorChoices")),n.createColorPicker(d.find(".vvUPAnnotationFillColorChoices")),n.createColorPicker(d.find(".vvUPAnnotationFontColorChoices"));var c=$("<li></li>").attr({id:l,role:"tab"}).addClass("vvUPAnnotationItem nav").data("vvTabTarget",u);c.append($("<a></a>").text(this.annotationToolbar[o].name)),d.attr("aria-labelledby",l),f(s,d),d.hide(),e.append(c)}}$(".vvUPAnnotationItem").on("click",function(){var e=$(this).data("vvTabTarget");$(".vvUPAnnPropPane.active").removeClass("active").hide(),$("#"+e).addClass("active").show(),$(".vvUPSelectedAnnotation.active").removeClass("vvUPSelectedAnnotation active"),$(this).addClass("vvUPSelectedAnnotation active"),$("#vvSelectedAnnotation").text($(this).text())}),$("#vvUPAnnotationEditTemplate").hide();for(var g=0;g<i.fontNames.length;g+=1)$(".vvUPAnnTextFaceSelect").append("<option>"+i.fontNames[g]+"</option>");for(var v=0;v<i.fontSizes.length;v+=1)$(".vvUPAnnTextSizeSelect").append("<option>"+i.fontSizes[v]+"</option>");$(".vvUPAnnThicknessCell").click(function(){var e=$(this).closest(".vvUPAnnotationLineThickness");e.find(".vvUPAnnThicknessCell").attr("aria-pressed","false"),$(this).attr("aria-pressed","true");var t=$(this).data("vvlinewidth");t=parseInt(t,10),e.find(".vvUPAnnLineSizeValue").text(t)});var p=$(".vvUPAnnotationItem")[0];p&&$(p).click()};var f=function(e,t){return e===i.annotationTypes.SANN_POSTIT?void t.find(".vvUPAnnLineColorLabel, .vvUPAnnotationLineThickness").hide():e===i.annotationTypes.SANN_EDIT?void t.find(".vvUPAnnFillColorLabel, .vvUPAnnLineColorLabel, .vvUPAnnotationLineThickness").hide():(t.find(".vvUPTextAnnOptions").hide(),void(e===i.annotationTypes.SANN_FILLED_RECT||e===i.annotationTypes.SANN_FILLED_ELLIPSE||e===i.annotationTypes.SANN_FILLED_POLYGON||e===i.annotationTypes.SANN_HIGHLIGHT_RECT?t.find(".vvUPAnnTextColorLabel, .vvUPAnnLineColorLabel, .vvUPAnnotationLineThickness").hide():t.find(".vvUPAnnTextColorLabel, .vvUPAnnFillColorLabel").hide()))};r.prototype.setAnnotationProperties=function(){for(var e=$("#vvUPAnnotationProperties .vvUPAnnPropPane"),t=0;t<e.length;t++){var a=$(e[t]),o=this.getAnnotationPreference(a.data("anntype"));if(o){var r,s=o.type;if(s===i.annotationTypes.SANN_POSTIT){r=o.fillColor;var l=a.find(".vvUPAnnFillColorLabel");n.setColorPickerColor(l,r),r=o.fontColor;var u=a.find(".vvUPAnnTextFaceSelect");u.val(o.fontFace),u.val()||u.val("Times New Roman");var d=a.find(".vvUPAnnTextSizeSelect");d.val(o.fontSize),a.find(".vvUPAnnTextStyleBold").prop("checked",o.bold),a.find(".vvUPAnnTextStyleItalic").prop("checked",o.italic),a=a.find(".vvUPAnnTextColorLabel")}else if(s===i.annotationTypes.SANN_EDIT){r=o.fontColor;var u=a.find(".vvUPAnnTextFaceSelect");u.val(o.fontFace),u.val()||u.val("Times New Roman");var d=a.find(".vvUPAnnTextSizeSelect");d.val(o.fontSize),a.find(".vvUPAnnTextStyleBold").prop("checked",o.bold),a.find(".vvUPAnnTextStyleItalic").prop("checked",o.italic)}else if(s===i.annotationTypes.SANN_FILLED_RECT||s===i.annotationTypes.SANN_FILLED_ELLIPSE||s===i.annotationTypes.SANN_FILLED_POLYGON||s===i.annotationTypes.SANN_HIGHLIGHT_RECT)r=o.fillColor;else{var c=o.lineWidth;c||(c=1),a.find(".vvUPAnnThicknessCell-"+c).click(),r=o.lineColor}n.setColorPickerColor(a,r)}}},r.prototype.getAnnotationPreference=function(e){if(!e)return this.cloneAnnotationPreference(t.annotationDefaults);var a=this.sanitizeName(e),n=this.annotationPropertyArray[e];if(n){if(n.version!==this.versions.annotationPreferences){var i;i=n.type,n=this.cloneAnnotationPreference(t.annotationDefaults),n.type=i,this.annotationPropertyArray[e]=n}}else{if(this.annotationPropertyArray[a])return n=this.annotationPropertyArray[a],this.annotationPropertyArray[e]=n,this.annotationPropertyArray[a]=null,
n;n=this.cloneAnnotationPreference(t.annotationDefaults),n.type=e,this.annotationPropertyArray[e]=n}return n},r.prototype.saveAnnotationPreferences=function(){for(var e=$("#vvUPAnnotationProperties .vvUPAnnPropPane"),t=function(e,t){var a=e.find(t);return a.find(".vvColorInputBox").val()},a=0;a<e.length;a++){var n=$(e[a]),o=this.getAnnotationPreference(n.data("anntype"));if(o){o.version=this.versions.annotationPreferences;var r=o.type;if(o.lineColor=t(n,".vvUPAnnLineColorLabel")||o.lineColor,o.fillColor=t(n,".vvUPAnnFillColorLabel")||o.fillColor,o.fontColor=t(n,".vvUPAnnTextColorLabel")||o.fontColor,r===i.annotationTypes.SANN_POSTIT||r===i.annotationTypes.SANN_EDIT){var s=n.find(".vvUPAnnTextFaceSelect"),l=s.val();l||(l="Times New Roman"),o.fontFace=l;var u=n.find(".vvUPAnnTextSizeSelect");o.fontSize=u.val(),o.bold=n.find(".vvUPAnnTextStyleBold").prop("checked"),o.italic=n.find(".vvUPAnnTextStyleItalic").prop("checked")}else{var d=parseInt(n.find(".vvUPAnnLineSizeValue").text(),10);d||(d=1),o.lineWidth=d}}}try{localforage.setItem("annotationPropertyArray",this.annotationPropertyArray)}catch(e){return!1}var c=virtualViewer.getCallbackManager(),g={annotationProperties:this.annotationPropertyArray};return c.call("saveAnnotationPreferences",g),!0},r.prototype.returnCurrentStampIndex=function(){var e=0;return e=$(".vvUPCustomStampItem").index($(".vvUPSelectedCustomStamp")[0])},r.prototype.prepareStampsTab=function(){$("#vvUPAddCustomStamp").click(function(){s.createCustomStamp()}),$("#vvUPRemoveCustomStamp").click(function(){s.removeCurrentCustomStamp()})};var m=function(){var e=$("#vvUPCustomStampEdit .active"),t=$("#vvUPCustomStampPreview"),a=e.find(".vvUPCustomStampStampTextInput").val();a||(a=""),t.text(a),"false"===e.find(".vvColorInputBox").attr("aria-invalid")&&t.css("color","#"+e.find(".vvColorInputBox").val()),t.css("font-family",e.find(".vvUPCustomTextFaceSelect").val()),t.css("font-size",e.find(".vvUPCustomTextSizeSelect").val()+"px");var n=parseInt(($("#vvUPCustomStampPreviewWrapper").height()-parseInt(t.css("line-height")))/2);t.css("margin-top",n+"px"),e.find(".vvUPCustomTextStyleBold").prop("checked")?t.css("font-weight","bold"):t.css("font-weight","normal"),e.find(".vvUPCustomTextStyleItalic").prop("checked")?t.css("font-style","italic"):t.css("font-style","normal")};r.prototype.createCustomStampsTable=function(){$("#vvUPSelectedCustomStampName").html(" "),$("#vvUPPreviewWord").html(" "),$("#vvUPCustomStampPreview").html(" "),$("#vvUPCustomStamps").html(" "),$(".vvUPStampEditPane:not(:first)").remove();for(var e=0;e<this.customStampArray.length;e++)this.createCustomStamp(this.customStampArray[e]);if(this.customStampArray.length>0){var t=$(".vvUPCustomStampItem")[0];$(t).click()}else $("#vvUPCustomStampEdit").hide()};var y=function(e){$(e.find(".vvColorPickerContainer ")).on("click",function(){m()}),e.find(".vvUPCustomStampDisplayNameInput").change(function(){var e=$("#"+$(this).closest(".vvUPStampEditPane").attr("aria-labelledby")+" > a");e.text($(this).val()),$("#vvUPSelectedCustomStampName").text($(this).val())}),e.find(".vvUPCustomStampStampTextInput").change(function(){m()}),e.find(".vvUPCustomTextFaceSelect").change(function(){m()}),e.find(".vvUPCustomTextSizeSelect").change(function(){m()}),e.find(".vvUPCustomTextStyleBold").change(function(){$(this).prop("checked")?$("#vvUPCustomStampPreview").css("font-weight","bold"):$("#vvUPCustomStampPreview").css("font-weight","normal")}),e.find(".vvUPCustomTextStyleItalic").change(function(){$(this).prop("checked")?$("#vvUPCustomStampPreview").css("font-style","italic"):$("#vvUPCustomStampPreview").css("font-style","normal")})};r.prototype.createCustomStamp=function(e){var t,a=!0,n=$(".vvUPCustomStampItem").length+1,i="vvUPCustomStamp"+n;if(e)t=e.displayName;else{for(;$("#"+i).length;)n++,i="vvUPCustomStamp"+n;t="Custom Stamp #"+n,a=!1,e=this.createDefaultTextStamp(t)}var o=b(i,e),r=o.attr("id"),s=$("<li></li>").attr({id:i,role:"tab"}).addClass("vvUPCustomStampItem nav").data("vvTabTarget",r);s.append($("<a></a>").text(t)),$("#vvUPCustomStamps").append(s),o.attr("aria-labelledby",i),s.on("click",function(){$("#vvUPSelectedCustomStampName").text($(this).text()),$("#vvUPCustomStampEdit").show(),$("#vvUPCustomStamps .active").removeClass("active vvUPSelectedCustomStamp"),$(this).addClass("active vvUPSelectedCustomStamp");var e=$(this).attr("id")+"Edit";$("#vvUPCustomStampEdit .active").removeClass("active").hide(),$("#"+e).addClass("active").show(),m()}),a||s.click()};var b=function(e,t){var a=$("#vvUPStampEditPaneTemplate").clone();$("#vvUPCustomStampEdit").append(a),a.attr("id",e+"Edit"),n.createColorPicker(a.find(".vvUPStampColorChoices")),n.setColorPickerColor(a,t.fontColor);for(var o=a.find(".vvUPCustomTextFaceSelect"),r=0;r<i.fontNames.length;r+=1)o.append("<option>"+i.fontNames[r]+"</option>");o.val(t.fontFace),null===o.val()&&(o.val("Times New Roman"),t.fontFace="Times New Roman");for(var s=a.find(".vvUPCustomTextSizeSelect"),l=0;l<i.fontSizes.length;l+=1)s.append("<option>"+i.fontSizes[l]+"</option>");return s.val(t.fontSize),null===s.val()&&s.val(18),a.find(".vvUPCustomStampDisplayNameInput").val(t.displayName),a.find(".vvUPCustomStampStampTextInput").val(t.textString),a.find(".vvUPCustomTextStyleBold").prop("checked",!!t.fontBold),a.find(".vvUPCustomTextStyleItalic").prop("checked",!!t.fontItalic),y(a),a};r.prototype.removeCurrentCustomStamp=function(){var e=this.returnCurrentStampIndex();if($(".vvUPCustomStampItem")[e]){if($(".vvUPCustomStampItem").eq(e).remove(),$("#vvUPCustomStampEdit .vvUPStampEditPane").eq(e+1).remove(),!$(".vvUPCustomStampItem").length)return void $("#vvUPCustomStampEdit").hide();0===e&&(e=1),$(".vvUPCustomStampItem")[e-1].click()}},r.prototype.saveCustomStamps=function(){for(var e=[],t=$(".vvUPCustomStampItem"),a=0;a<t.length;a++){var n=this.createDefaultTextStamp(),i=$("#"+$(t[a]).attr("id")+"Edit");n.displayName=i.find(".vvUPCustomStampDisplayNameInput").val(),n.textString=i.find(".vvUPCustomStampStampTextInput").val(),n.fontFace=i.find(".vvUPCustomTextFaceSelect").val(),n.fontSize=i.find(".vvUPCustomTextSizeSelect").val(),n.fontBold=i.find(".vvUPCustomTextStyleBold").prop("checked"),n.fontItalic=i.find(".vvUPCustomTextStyleItalic").prop("checked"),"true"!==i.find(".vvColorInputBox").attr("aria-invalid")&&(n.fontColor=i.find(".vvColorInputBox").val()),e[a]=n}e.version=this.versions.customTextStamps;try{localforage.setItem("customStampArray",e)}catch(e){return!1}var o=virtualViewer.getCallbackManager(),r={stampsPreferences:e};return o.call("saveCustomStamps",r),this.customStampArray=e,!0},r.prototype.returnCurrentTemplateIndex=function(){var e=0;return e=$(".vvUPNoteTemplateItem").index($(".vvUPSelectedNoteTemplate")[0])},r.prototype.prepareNotesTab=function(){$("#vvUPAddNoteTemplate").click(function(){s.createNoteTemplate()}),$("#vvUPRemoveNoteTemplate").click(function(){s.removeCurrentNoteTemplate()})};var A=function(){var e=$("#vvUPNoteTemplateEdit .active"),t=e.find(".vvUPNoteTemplateTextInput").val();t||(t=""),$("#vvUPNoteTemplatePreview").text(t)};r.prototype.createNoteTemplateTable=function(){$("#vvUPSelectedNoteTemplateName").html(" "),$("#vvUPPreviewWord").html(" "),$("#vvUPNoteTemplates").html(" "),$(".vvUPTemplateEditPane:not(:first)").remove();for(var e=0;e<this.noteTemplateArray.length;e++)this.createNoteTemplate(this.noteTemplateArray[e]);if(this.noteTemplateArray.length>0){var t=$(".vvUPNoteTemplateItem")[0];$(t).click()}else $("#vvUPNoteTemplateEdit").hide()};var P=function(e){e.find(".vvUPNoteTemplateDisplayNameInput").change(function(){var e=$("#"+$(this).closest(".vvUPTemplateEditPane").attr("aria-labelledby")+" > a");e.text($(this).val()),$("#vvUPSelectedNoteTemplateName").text($(this).val())}),e.find(".vvUPNoteTemplateTextInput").change(function(){A()})};r.prototype.createNoteTemplate=function(e){var t,a=!0,n=$(".vvUPNoteTemplateItem").length+1,i="vvUPNoteTemplate"+n;if(e)t=e.templateName;else{for(;$("#"+i).length;)n++,i="vvUPNoteTemplate"+n;t="Note Template #"+n,a=!1,e=this.createDefaultNoteTemplate(t)}templateForm=T(i,e);var o=templateForm.attr("id"),r=$("<li></li>").attr({id:i,role:"tab"}).addClass("vvUPNoteTemplateItem nav").data("vvTabTarget",o);r.append($("<a></a>").text(t)),$("#vvUPNoteTemplates").append(r),templateForm.attr("aria-labelledby",i),r.on("click",function(){$("#vvUPSelectedNoteTemplateName").text($(this).text()),$("#vvUPNoteTemplateEdit").show(),$("#vvUPNoteTemplates .active").removeClass("active vvUPSelectedNoteTemplate"),$(this).addClass("active vvUPSelectedNoteTemplate");var e=$(this).attr("id")+"Edit";$("#vvUPNoteTemplateEdit .active").removeClass("active").hide(),$("#"+e).addClass("active").show()}),a||r.click()};var T=function(e,t){var a=$("#vvUPTemplateEditPaneTemplate").clone();return $("#vvUPNoteTemplateEdit").append(a),a.attr("id",e+"Edit"),a.find(".vvUPNoteTemplateDisplayNameInput").val(t.templateName),a.find(".vvUPNoteTemplateTextInput").val(t.templateString),P(a),a};r.prototype.removeCurrentNoteTemplate=function(){var e=this.returnCurrentTemplateIndex();if($(".vvUPNoteTemplateItem")[e]){if($(".vvUPNoteTemplateItem").eq(e).remove(),$("#vVUPNoteTemplateEdit .vvUPTemplateEditPane").eq(e+1).remove(),!$(".vvUPNoteTemplateItem").length)return void $("#vvUPNoteTemplateEdit").hide();0===e&&(e=1),$(".vvUPNoteTemplateItem")[e-1].click()}},r.prototype.saveNoteTemplates=function(){for(var e=[],t=$(".vvUPNoteTemplateItem"),a=0;a<t.length;a++){var n=this.createDefaultNoteTemplate(),i=$("#"+$(t[a]).attr("id")+"Edit");n.templateName=i.find(".vvUPNoteTemplateDisplayNameInput").val(),n.templateString=i.find(".vvUPNoteTemplateTextInput").val(),e[a]=n}e.version=this.versions.noteTemplates;try{localforage.setItem("noteTemplateArray",e)}catch(e){return!1}this.noteTemplateArray=e;var o=virtualViewer.getCallbackManager(),r={notesTemplate:e};return o.call("saveNoteTemplates",r),!0},r.prototype.prepareGeneralTab=function(){$("#vvUPZoomLevelForm").hide();var e=$("#vvUPZoomLevelSelect"),a=0;virtualViewer.validateZoomLevels();for(var n=0;n<t.zoomLevels.length;n++){var i=t.zoomLevels[n];i>=t.zoomLevels[a]&&i<=100&&(a=n),i+="%",$(e).append($("<option/>",{value:n,text:i}))}this.defaultZoomPercentIndex=a,$(e).val(a),this.zoomPreferences.zoomLevelIndex<0&&(this.zoomPreferences.zoomLevelIndex=a,this.zoomPreferences.zoomLevel=t.zoomLevels[a]),$("#vvUPZoomLevelSelect").on("change",function(){$("#vvUPFitCustom").prop("checked",!0)}),$(".vvUPDefaultFitRadio").on("change",function(){if("vvUPFitCustom"!==$(this).attr("id")){var e=$("#vvUPZoomLevelSelect");$(e).val(s.defaultZoomPercentIndex)}}),S(),this.updateDialogZoomPreferences()},r.prototype.applyZoomPreferences=function(e){var t;t=e?[e]:o.getAllStates();for(var a=0;a<t.length;a++)t[a].isVideo()&&t[a].getVideoManager().applyVideoPreferences(this.videoPreferences),this.applyZoomPreferencesCore(t[a]),t[a].clearCachedScroll()},r.prototype.applyZoomPreferencesCore=function(e){if(e)return e.documentId!==o.displayedDocuments[e.currentPaneIndex]?(e.setZoomMode(this.zoomPreferences.mode),void e.setZoom(this.zoomPreferences.zoomLevel)):void(this.zoomPreferences.mode===i.zoomModes.fitWindow?virtualViewer.fitWindowCore(e):this.zoomPreferences.mode===i.zoomModes.fitHeight?virtualViewer.fitHeightCore(e):this.zoomPreferences.mode===i.zoomModes.fitWidth?virtualViewer.fitWidthCore(e):this.zoomPreferences.mode===i.zoomModes.fitCustom&&virtualViewer.setZoomPercentCore(this.zoomPreferences.zoomLevel,e))},r.prototype.saveZoomPreferences=function(){this.setZoomValuesFromHTML(),this.zoomPreferences.version=this.versions.zoomPreferences;try{localforage.setItem("zoomPreferences",this.zoomPreferences)}catch(e){return!1}var e=virtualViewer.getCallbackManager(),t={zoomPreferences:this.zoomPreferences};return e.call("saveZoomPreferences",t),!0},r.prototype.setZoomValuesFromHTML=function(){if($("#vvUPFitToWindow").prop("checked"))this.zoomPreferences.mode=i.zoomModes.fitWindow;else if($("#vvUPFitToHeight").prop("checked"))this.zoomPreferences.mode=i.zoomModes.fitHeight;else if($("#vvUPFitToWidth").prop("checked"))this.zoomPreferences.mode=i.zoomModes.fitWidth;else if($("#vvUPFitCustom").prop("checked")){this.zoomPreferences.mode=i.zoomModes.fitCustom;var e=parseInt($("#vvUPZoomLevelSelect").val());isNaN(e)||void 0===t.zoomLevels[e]?this.zoomPreferences.zoomLevelIndex=this.getMiddleZoomLevel():this.zoomPreferences.zoomLevelIndex=e,this.zoomPreferences.zoomLevel=t.zoomLevels[this.zoomPreferences.zoomLevelIndex]}},r.prototype.updateDialogZoomPreferences=function(){var e=$("#vvUPZoomLevelSelect");if($(e).val(this.defaultZoomPercentIndex),this.zoomPreferences.mode===i.zoomModes.fitWindow)$("#vvUPFitToWindow").prop("checked",!0);else if(this.zoomPreferences.mode===i.zoomModes.fitHeight)$("#vvUPFitToHeight").prop("checked",!0);else if(this.zoomPreferences.mode===i.zoomModes.fitWidth)$("#vvUPFitToWidth").prop("checked",!0);else if(this.zoomPreferences.mode===i.zoomModes.fitCustom){$("#vvUPFitCustom").prop("checked",!0);$(e).val(this.zoomPreferences.zoomLevelIndex)}},r.prototype.getMiddleZoomLevel=function(){var e=t.zoomLevels.length/2;return e-=e%1},r.prototype.getDefaultZoomMode=function(){return this.zoomPreferences.mode},r.prototype.getDefaultZoomLevel=function(){var e=this.zoomPreferences.zoomLevel;return e<0?t.zoomLevels[this.getMiddleZoomLevel()]:e},r.prototype.setUsername=function(t){t?(this.username=t,$("#vvUPUsernameInput").val(t)):this.username=$("#vvUPUsernameInput").val(),$("#vvDocumentNoteAdderAuthor").html(e.encodeForHTML(this.username)),$("#vvAnnotationNoteAdderAuthor").html(e.encodeForHTML(this.username)),this.username&&virtualViewer.addUsersToDropDown(this.username)},r.prototype.getUsername=function(){return this.username},r.prototype.saveUsername=function(e){this.setUsername(e);try{localforage.setItem("username",this.username)}catch(e){return!1}var t=virtualViewer.getCallbackManager(),a={username:this.username};return t.call("saveUsername",a),!0};var S=function(){for(var e=$("#vvUPDefaultTab .form-group"),a=0;a<e.length;a++){var n=$(e[a]).find("input").attr("id");("vvUPPageTab"!==n||t.showPageThumbnails)&&("vvUPDocumentTab"!==n||t.showDocThumbnails)&&("vvUPSearchTab"!==n||t.showSearch)&&("vvUPNoteTab"!==n||t.enableDocumentNotes)&&("vvUPBookmarkTab"!==n||t.showBookmarkThumbnails)?"vvUPAnnotationTab"!==n||t.showAnnotationList||$(e[a]).remove():$(e[a]).remove()}};r.prototype.updateDialogDefaultTab=function(){switch(this.defaultTab){case i.thumbnailTabs.page:$("#vvUPPageTab").prop("checked",!0);break;case i.thumbnailTabs.document:$("#vvUPDocumentTab").prop("checked",!0);break;case i.thumbnailTabs.search:$("#vvUPSearchTab").prop("checked",!0);break;case i.thumbnailTabs.note:$("#vvUPNoteTab").prop("checked",!0);break;case i.thumbnailTabs.bookmark:$("#vvUPBookmarkTab").prop("checked",!0);break;case i.thumbnailTabs.annList:$("#vvUPAnnotationTab").prop("checked",!0)}},r.prototype.setDefaultTabFromHTML=function(){$("#vvUPPageTab").prop("checked")?this.defaultTab=i.thumbnailTabs.page:$("#vvUPDocumentTab").prop("checked")?this.defaultTab=i.thumbnailTabs.document:$("#vvUPSearchTab").prop("checked")?this.defaultTab=i.thumbnailTabs.search:$("#vvUPNoteTab").prop("checked")?this.defaultTab=i.thumbnailTabs.note:$("#vvUPBookmarkTab").prop("checked")?this.defaultTab=i.thumbnailTabs.bookmark:$("#vvUPAnnotationTab").prop("checked")&&(this.defaultTab=i.thumbnailTabs.annList)},r.prototype.saveTabPreference=function(){this.setDefaultTabFromHTML();try{localforage.setItem("defaultTab",this.defaultTab)}catch(e){return!1}var e=virtualViewer.getCallbackManager(),t={defaultTab:this.defaultTab};return e.call("saveTabPreferences",t),!0},r.prototype.getDefaultTab=function(){return(null===this.defaultTab||this.defaultTab<0)&&(this.defaultTab=t.defaultThumbnailTab),this.defaultTab},r.prototype.prepareVideoTab=function(){this.updateVideoTab()},r.prototype.updateVideoTab=function(){this.videoPreferences.autoplay?$("#vvUPVideoAutoplay").prop("checked",!0):$("#vvUPVideoAutoplay").prop("checked",!1),this.videoPreferences.mute?$("#vvUPVideoMute").prop("checked",!0):$("#vvUPVideoMute").prop("checked",!1),this.videoPreferences.controls?$("#vvUPVideoControls").prop("checked",!0):$("#vvUPVideoControls").prop("checked",!1),this.videoPreferences.stretch?$("#vvUPVideoStretch").prop("checked",!0):$("#vvUPVideoStretch").prop("checked",!1)},r.prototype.setVideoValuesFromHTML=function(){$("#vvUPVideoAutoplay").prop("checked")?this.videoPreferences.autoplay=!0:this.videoPreferences.autoplay=!1,$("#vvUPVideoMute").prop("checked")?this.videoPreferences.mute=!0:this.videoPreferences.mute=!1,$("#vvUPVideoControls").prop("checked")?this.videoPreferences.controls=!0:this.videoPreferences.controls=!1,$("#vvUPVideoStretch").prop("checked")?this.videoPreferences.stretch=!0:this.videoPreferences.stretch=!1},r.prototype.loadVideoPreferences=function(){var e=function(){s.turnOnErrorState(),w(null)},t=localforage.getItem("videoPreferences");t.then(w,e)};var w=function(e){e?s.videoPreferences=e:(s.videoPreferences.autoplay=t.autoplay,s.videoPreferences.mute=t.videoMuted,s.videoPreferences.controls=t.videoControls,s.videoPreferences.stretch=t.videoStretch,s.updateVideoTab());var a=virtualViewer.getCallbackManager();if(a){var n=virtualViewer.getActivePaneState();if(n){var i=n.getVideoManager(),o={player:i.videoPlayer,self:i};a.call("postLoadPreferencesVideo",o)}}};return r.prototype.saveVideoPreferences=function(){this.setVideoValuesFromHTML();try{localforage.setItem("videoPreferences",this.videoPreferences)}catch(e){return!1}var e=virtualViewer.getCallbackManager(),t={videoPreferences:this.videoPreferences};return e.call("saveVideoPreferences",t),!0},r.prototype.sanitizeName=function(e){if(e)return e.replace(/([ ;&,\.\+\*\~':"\!\^#$%@\[\]\(\)\\\/=>\|])/gm,"")},r.prototype.createElmtIDWithPrefix=function(e,t){var a=this.dynamicUPOptionPrefix+e;return t&&(a+="Check"),a},function(){return s=s||new r}()}),define("vvMagnifier",["vvUtility","user-config/config","vvDefines","vvPoint","vvStateManager"],function(e,t,a,n,i){function o(){this.magnifierTemporarilyDisabled=!1,this.magnifierEnabled=!1,this.currentPage=null}var r,s=20;return o.prototype.getMagnifierEnabled=function(){return this.magnifierEnabled},o.prototype.setMagnifierEnabled=function(e){this.magnifierTemporarilyDisabled=!1,e&&virtualViewer.setActivePane(0),this.magnifierEnabled=e},o.prototype.initMagnifier=function(){var e=$("#vvMagnifierCanvas");e.hide(),e.css("left",t.magnifierDefaults.x),e.css("top",t.magnifierDefaults.y),e.width(t.magnifierDefaults.width),e.height(t.magnifierDefaults.height);var n=e[0].getContext("2d");if(n.canvas.width=t.magnifierDefaults.width,n.canvas.height=t.magnifierDefaults.height,"number"==typeof a.magnifierCloseButtonSize&&a.magnifierCloseButtonSize>=0){var i=t.collapseStickiesSize||50;s=Math.min(a.magnifierCloseButtonSize,i)}},o.prototype.toggleMagnifier=function(){this.setMagnifierEnabled(!this.magnifierEnabled),this.magnifierHandler(),this.adjustForWindowResize()},o.prototype.magnifierHandler=function(){var e=$("#vvMagnifierCanvas");this.magnifierEnabled?(e.show(),"hidden"===e.css("visibility")&&e.css("visibility","visible"),this.getMagnifiedImage(),this.paintMagnifierCanvas()):e.hide()},o.prototype.adjustForWindowResize=function(){if(this.magnifierEnabled||this.magnifierTemporarilyDisabled){var e=$("#vvImageCanvas"),t=$("#vvMagnifierCanvas"),a=e.width(),n=e.height(),i=t.width(),o=t.height();if(a<50||n<50||(i>$("#vvImagePanel").width()||o>$("#vvImagePanel").height())&&$("#vvThumbs:visible").length)return this.magnifierTemporarilyDisabled=!0,this.magnifierEnabled=!1,void this.magnifierHandler();this.magnifierTemporarilyDisabled&&(this.magnifierTemporarilyDisabled=!1,this.magnifierEnabled=!0,this.magnifierHandler()),i>a&&(i=Math.max(a/2,50),t.width(i),t[0].width=i),o>n&&(o=Math.max(n/2,50),t.height(o),t[0].height=o);var r=Math.max(parseInt(t.css("left"),10),0),s=Math.max(parseInt(t.css("top"),10),0);r+i>a&&(r=a-i),s+o>n&&(s=n-o),t.css({left:r,top:s})}},o.prototype.paintMagnifierCanvas=function(e){this.clearMagnifier(),null!==e&&e||(e=i.getCurrentState());var t=$("#vvMagnifierCanvas")[0],a=$("#vvDummyScroller"),o=$("#vvOuterDiv"),r=t.getContext("2d"),s=o.scrollLeft(),l=t.offsetLeft+t.width/2,u=t.offsetTop+t.height/2,d=new n(l,u),c=virtualViewer.getEventManager().clickPageFinder(e,d,!1);c===-1&&(c=e.pageNumber),this.getMagnifiedImage(e,c),c===this.currentPage&&null!==this.currentPage||(this.currentPage=c,this.getMagnifiedImage(e,c));var g,v=virtualViewer.scrollPageFinder(e,o,a),p=virtualViewer.scrollerToPaint(e,v,o,a);if(v!==c)for(g=e.pageStates[v].requestedHeight-p;v<c-1;)v++,g+=e.pageStates[v].requestedHeight;else g=-p;var h=t.offsetLeft+s,f=t.offsetTop,m=e.getRotationForPage(c),y=e.pageStates[c].requestedWidth;90!==m&&270!==m||(y=e.pageStates[c].requestedHeight);var b=(o.width()-$("#vvDummyScroller").width())/2;b<0&&(b=0);var A=($("#vvDummyScroller").width()-y)/2,P=b+A,T=t.offsetLeft/(o.width()-t.scrollWidth)*(t.scrollWidth/2);h=h-P+T,f-=g;var S=h,w=f;90===m?(h=w,f=e.pageStates[c].requestedHeight-S):180===m?(h=e.pageStates[c].requestedWidth-S,f=e.pageStates[c].requestedHeight-w):270===m&&(h=e.pageStates[c].requestedWidth-w,f=S),this.drawMagnifiedImage(e,r,c,-h,-f,m)},o.prototype.clearMagnifier=function(){var e=$("#vvMagnifierCanvas")[0];e.width=e.width,e.height=e.height},o.prototype.getMagnifiedImage=function(e,t){return e=e||i.getCurrentState(),e.isVideo()?null:(t||0===t||(t=e.pageNumber),e.getImageManager().getBestImageFromPage(t))},o.prototype.drawMagnifiedImage=function(a,n,i,o,r,s){var l=this.getMagnifiedImage(a,i);if(null!==l&&void 0!==l){n.save();var u=Math.sin(e.degreesToRadians(s)),d=Math.cos(e.degreesToRadians(s));n.setTransform(d,u,-u,d,0,0);try{a.getSVGableForPage()&&(a.getHorizontalFlipForPage()&&(n.translate(a.pageStates[i].requestedWidth,0),n.scale(-1,1)),a.getVerticalFlipForPage()&&(n.translate(0,a.pageStates[i].requestedHeight),n.scale(1,-1))),n.fillStyle="#eeeeee",n.fillRect(-1e3,-1e3,5e3,5e3);var c=t.magnifierDefaults.zoomPercent/100,g=a.pageStates[i].requestedWidth*c,v=a.pageStates[i].requestedHeight*c;if(o*=c,r*=c,n.drawImage(l,o,r,g,v),a.getSVGableForPage()&&a.getInvertImageForPage()){for(var p=n.getImageData(0,0,a.pageStates[i].requestedWidth,a.pageStates[i].requestedHeight),h=p.data,f=0;f<h.length;f+=4)h[f]=255-h[f],h[f+1]=255-h[f+1],h[f+2]=255-h[f+2];n.putImageData(p,0,0)}}catch(e){console.log("exception: "+e)}n.restore(),this.drawResizeArea(n),this.drawCloseButton(n)}},o.prototype.drawResizeArea=function(t){t.fillStyle="#000000";var a=$("#vvMagnifierCanvas")[0],n=a.width,i=a.height,o=e.getNubSize();t.beginPath(),t.moveTo(n,i),t.lineTo(n-o,i),t.lineTo(n,i-o),t.lineTo(n,i),t.fill()},o.prototype.drawCloseButton=function(e){e.save(),e.fillStyle="#000000",e.beginPath(),e.moveTo(0,0),e.lineTo(s,0),e.lineTo(s,s),e.lineTo(0,s),e.lineTo(0,0),e.fill(),e.restore(),e.save(),e.fillStyle="#FFFFFF",e.font="20px Arial",e.font=s+"px Arial";var t=s/5;e.fillText("",t,s-t),e.restore()},o.prototype.isMagnifierAtPoint=function(e){var t;if(e.getX)t=e;else{if("number"!=typeof e.clientX)return;t=new n(e.clientX,e.clientY)}var a=$("#vvMagnifierCanvas"),i=a.offset();return t.getX()>i.left&&t.getX()<i.left+a.width()&&t.getY()>i.top&&t.getY()<i.top+a.height()},o.prototype.isCloseButtonAtPoint=function(e){var t;if(e.getX)t=e;else{if("number"!=typeof e.clientX)return;t=new n(e.clientX,e.clientY)}var a=$("#vvMagnifierCanvas"),i=a.offset();return t.getX()>i.left&&t.getX()<i.left+s&&t.getY()>i.top&&t.getY()<i.top+s},o.prototype.stretchMagnifier=function(e,a){var n=0,i=0,o=0,r=0,s=$("#vvMagnifierCanvas");e>$("#vvOuterDiv").width()?e=$("#vvOuterDiv").width():e<0&&(e=0),a>$("#vvOuterDiv").height()?a=$("#vvOuterDiv").height():a<0&&(a=0),n=s[0].offsetLeft,i=s[0].offsetTop;var l=t.collapseStickiesSize||50;if(o=Math.max(e-n,l),r=Math.max(a-i,l),o>0&&r>0){s.width(o),s.height(r);var u=s[0].getContext("2d");u.canvas.width=o,u.canvas.height=r}this.paintMagnifierCanvas()},function(){return r=r||new o}()}),define("vvDocumentNotes",["vvNoteBase"],function(e){function t(){var a=new e;t.prototype.getAbleToAddNote=function(){return a.ableToAddNote},t.prototype.setAbleToAddNote=function(e){a.ableToAddNote=e},t.prototype.getUsername=function(){return a.getUsername()},t.prototype.setUsername=function(e){a.setUsername(e)},t.prototype.addNewNote=function(){a.addNote("Document")},t.prototype.editNote=function(e){a.editNote(e,"Document")};var n=function(e){a.addExistingNote(e,"Document")};t.prototype.loadDocumentNotes=function(){$("#vvDocumentNotesInternal").empty(),$("#vvDocumentNotes").addClass("DisplayedThumb");var e=virtualViewer.getCurrentState();if(e&&e.pageStates&&!(e.pageStates.length<1)){var t=e.getDocumentModel();if(t.model.documentNotes){var a=t.model.documentNotes.notes;a.sort(function(e,t){return e=e.editDate?new Date(e.editDate):new Date(e.createDate),t=t.editDate?new Date(t.editDate):new Date(t.createDate),t-e});for(var i=0;i<a.length;i++)n(a[i]);a.length>0?$("#vvNotesTabSpan").addClass("docNotesExist"):$("#vvNotesTabSpan").removeClass("docNotesExist")}}},t.prototype.clearAllDocumentNotes=function(){for(var e=$("#vvDocumentNotesInternal")[0],t=e.children.length-1;t>=0;t--)$(e.children[t]).remove()},t.prototype.abilityToModifyNotes=function(e){var t;e===!0?($(".vvNotesCloseButton").click(function(){var e=this.parentElement.parentElement;if(e){var t=$(e).children().index(this.parentElement);$($(e).children()[t]).remove();var n=virtualViewer.getCurrentState(),i=n.getDocumentModel(),o=i.model.documentNotes.notes;o.splice(t,1),i.setNotesModifiedSinceInit(!0,n),a.setAbleToAddNote(!0)}}),t=document.getElementsByClassName("vvNote"),$(t).dblclick(function(){var e=$(this);a.getAbleToAddNote()&&virtualViewer.getDocumentNotes().editNote(e)})):($(".vvNotesCloseButton").off("click"),t=document.getElementsByClassName("vvNote"),$(t).off("dblclick"))}}return t}),define("vvDocumentModel",["vvUtility","vvThumbs","vvDefines","user-config/config","vvStateManager"],function(e,t,a,n,i){function o(e){return e?(this.model=e,this.selection=[],this.model.propertyHash={},this.lastSelectedPageNumber=0,this.model.watermarks||(this.model.watermarks=[]),void(this.model.documentNotes||(this.model.documentNotes={},this.model.documentNotes.notes=[]))):null}return o.prototype.init=function(){this.setPagesModifiedSinceInit(!1),this.setMetadataModifiedSinceInit(!1),this.setAnnotationsModifiedSinceInit(!1),this.setBookmarksModifiedSinceInit(!1),this.setNotesModifiedSinceInit(!1),this.setWatermarksModifiedSinceInit(!1),this.selection.length=this.getDocumentLength(),this.resetPageViewed()},o.prototype.addPageToSelection=function(e){this.lastSelectedPageNumber=e,this.selection[e]=!0,t.setPageThumbSelection(e,!0)},o.prototype.removePageFromSelection=function(e){this.selection[e]=!1,t.setPageThumbSelection(e,!1)},o.prototype.togglePageSelection=function(e){this.selection[e]=!this.selection[e],t.setPageThumbSelection(e,this.selection[e])},o.prototype.isPageSelected=function(e){return!!this.selection[e]},o.prototype.isInitialized=function(){return!!(this.model&&this.model.pageData.length>0)},o.prototype.selectRange=function(e){var a=this.lastSelectedPageNumber,n=e+1;n<=a&&(a=e,n=this.lastSelectedPageNumber);for(var i=a;i<n;i+=1)this.selection[i]=!0;t.setPageRangeThumbSelection(a,n,!0)},o.prototype.selectAll=function(){this.lastSelectedPageNumber=0,this.selectRange(this.selection.length-1)},o.prototype.clearPageSelection=function(){this.lastSelectedPageNumber=0,this.selection=[],this.selection.length=this.model.pageData.length,t.setPageRangeThumbSelection(0,this.model.pageData.length,!1)},o.prototype.cleanAfterSave=function(t,n){var i=this.model.pageData,o=encodeURIComponent(t);t&&(this.model.documentId=o),this.setPagesModifiedSinceInit(!1),this.setMetadataModifiedSinceInit(!1),this.setAnnotationsModifiedSinceInit(!1),this.setBookmarksModifiedSinceInit(!1),this.setNotesModifiedSinceInit(!1),this.setWatermarksModifiedSinceInit(!1),this.setAnnotationsAsNotNew();for(var r=0;r<i.length;r+=1){var s=i[r];e.isVirtualDocument(t)||(s.pageIndex=r),t&&!e.isVirtualDocument(t)&&(s.documentId=o,s.annotationHash&&$.each(s.annotationHash,function(e,t){t&&t.documentId&&(t.documentId=o)})),n&&0!==s.rotateAngle&&n.rotatePageTextSelectionBoxes(r,s.rotateAngle),s.rotateAngle=0,s.invertImage=!1,s.brightness=0,s.contrast=0,s.gamma=a.defaultGammaValue,s.despeckle=0}},o.prototype.cutSelection=function(e){var t=[];this.setPagesModifiedSinceInit(!0);for(var a=0;a<this.model.pageData.length;a+=1)e.indexOf(a)<0&&t.push(this.model.pageData[a]);this.model.pageData=t,this.clearPageSelection()},o.prototype.copySelection=function(){for(var t=[],a=0;a<this.selection.length;a+=1)if(this.selection[a]===!0){var n=this.model.pageData[a],i=e.deepObjCopy(n);t.push(i)}return t},o.prototype.paste=function(t,a){var n=0;this.setPagesModifiedSinceInit(!0);for(var i=0;i<t.length;i+=1)this.model.pageData.splice(a+n,0,e.deepObjCopy(t[i])),n+=1;this.clearPageSelection()},o.prototype.getMediaType=function(){return this.model.mediaType},o.prototype.getModifiedSinceInit=function(){return this.model.pagesModifiedSinceInit||this.model.metadataModifiedSinceInit||this.model.annotationsModifiedSinceInit||this.model.bookmarksModifiedSinceInit||this.model.notesModifiedSinceInit||this.model.watermarksModifiedSinceInit},o.prototype.getPagesModifiedSinceInit=function(){return this.model.pagesModifiedSinceInit},o.prototype.setPagesModifiedSinceInit=function(e,t,a){var n=this.model;if(n.pagesModifiedSinceInit=e,"number"==typeof t)n.pageData[t].isModified=e;else if(!e)for(var i=0;i<n.pageData.length;i++)n.pageData[i].isModified=!1;virtualViewer.updateTabName(a)},o.prototype.getMetadataModifiedSinceInit=function(){return this.model.metadataModifiedSinceInit},o.prototype.setMetadataModifiedSinceInit=function(e,t){this.model.metadataModifiedSinceInit=e,virtualViewer.updateTabName(t)},o.prototype.getAnnotationsModifiedSinceInit=function(){return this.model.annotationsModifiedSinceInit},o.prototype.setAnnotationsModifiedSinceInit=function(e,t){if(this.model.annotationsModifiedSinceInit=e,!e)for(var a=this.model.layerManager.layers,n=0;n<a.length;n+=1)a[n].dirty=!1;virtualViewer.updateTabName(t)},o.prototype.getBookmarksModifiedSinceInit=function(){return this.model.bookmarksModifiedSinceInit},o.prototype.setBookmarksModifiedSinceInit=function(e,t){this.model.bookmarksModifiedSinceInit=e,virtualViewer.updateTabName(t)},o.prototype.getNotesModifiedSinceInit=function(){return this.model.notesModifiedSinceInit},o.prototype.setNotesModifiedSinceInit=function(e,t){this.model.notesModifiedSinceInit=e,virtualViewer.updateTabName(t)},o.prototype.getWatermarksModifiedSinceInit=function(){return this.model.watermarksModifiedSinceInit},o.prototype.setWatermarksModifiedSinceInit=function(e,t){this.model.watermarksModifiedSinceInit=e,virtualViewer.updateTabName(t)},o.prototype.setAnnotationsAsNotNew=function(){for(var e=this.model.layerManager.layers,t=0;t<e.length;t+=1)e[t].newLayer=!1},o.prototype.getSelectedPageNumbers=function(){for(var e=[],t=0;t<this.selection.length;t+=1)this.selection[t]===!0&&e.push(t);return e},o.prototype.renameLayer=function(e,t){for(var a=this.model.layerManager.layers,n=null,i=0;i<a.length;i+=1)if(n=a[i],decodeURIComponent(n.annotationId)===e){n.annotationId=t;break}for(var o=this.model.pageData,r=0;r<o.length;r+=1){var s=o[r],l=s.annotationHash;l&&(n=l[e],n&&(n.layerAnnotationId=t,l[t]=n,l[e]=void 0))}},o.prototype.deleteLayer=function(e){for(var t=this.model.layerManager.layers,a=null,i=0;i<t.length;i++)if(a=t[i],decodeURIComponent(a.annotationId)===e){this.markLayerDirty(a),a.annotationId=void 0,t.splice(i,1);break}for(var o=this.model.pageData,r=0;r<o.length;r++){var s=o[r],l=s.annotationHash;l&&(a=l[e],a&&(delete l[e],a.layerAnnotationId=void 0,l[e]=void 0),n.showAnnIndicators&&(virtualViewer.pageContainsAnnotations(r)||virtualViewer.removeAnnotationIndicators(r)))}},o.prototype.getDocumentLength=function(){return this.model.pageData.length;
},o.prototype.pageContainsAnnotations=function(e){if(e<0||e>=this.getDocumentLength())return!1;var t=this.model.layerManager.layers;if(!t||0===t.length)return!1;var a=this.model.pageData[e];if(!a)return!1;var n=a.annotationHash;if(!n)return!1;for(var o=0;o<t.length;o+=1){var r=n[t[o].annotationId];if(r&&r.annExists){var s=i.getActivePaneState(),l=s.getLayersForPage(e);if(!l)return!0;for(var u=l[t[o].annotationId],d=u.anns,c=0;c<d.length;c+=1){var g=d[c];if(!g.annDelete)return!0}}}return!1},o.prototype.documentContainsAnnotations=function(){for(var e=0;e<this.getDocumentLength();e+=1){var t=this.pageContainsAnnotations(e);if(t)return!0}return!1},o.prototype.markLayerDirty=function(e){this.setAnnotationsModifiedSinceInit(!0);for(var t=this.model.layerManager.layers,a=0;a<t.length;a+=1)if(e.layerName===decodeURIComponent(t[a].annotationId)){t[a].dirty=!0;break}},o.prototype.setProperty=function(e,t){null===this.model.propertyHash&&(this.model.propertyHash={}),this.model.propertyHash[e]=t,this.setMetadataModifiedSinceInit(!0)},o.prototype.getProperty=function(e){return null===this.model.propertyHash?null:this.model.propertyHash[e]},o.prototype.setPropertyHash=function(e){this.model.propertyHash=e},o.prototype.isLayerDirty=function(e){this.isLayerDirtyByName(e.layerName)},o.prototype.isLayerDirtyByName=function(e){for(var t=this.model.layerManager.layers,a=0;a<t.length;a+=1)if(e===decodeURIComponent(t[a].annotationId))return!!t[a].dirty},o.prototype.resetPageViewed=function(){for(var e=this.model.pageData,t=0;t<e.length;t+=1)e[t].pageViewed=!1},o.prototype.hasRedactions=function(){for(var e=this.model.layerManager.layers,t=0;t<e.length;t+=1){var n=e[t];if(n&&n.isRedaction&&n.permissionLevel<a.permissionLevels.PERM_VIEW)return!0}return!1},o}),define("vvClickEventManager",["vvUtility","user-config/config","vvDefines","vvPoint","vvAnnotationManager","vvStateManager","vvMagnifier"],function(e,t,a,n,i,o,r){function s(){this.events=!1,this.dragging=!1,this.annDragging=!1,this.endPoint=0,this.selectTextDrag=!1,this.dragMode=a.dragModes.pan,this.dragStartLeft=null,this.dragStopLeft=null,this.dragStartTop=null,this.dragStopTop=null,this.overlayDragOffset=new n(0,0),this.annDragOffsetX=0,this.annDragOffsetY=0,this.errorTimeoutID=-1,this.annLineEnd=null,this.annCorner=null,this.magnifierCorner=null,this.moveTop=0,this.moveLeft=0,this.previousPinchDistance=1}function l(){return u=u||new s}var u,d=!1,c=null,g=null;s.prototype.setDragMode=function(e){this.dragMode=e},s.prototype.getDragMode=function(){return this.dragMode},s.prototype.initEvents=function(e){e&&e.length||(e=$("#vvOuterDiv"));var t=e.find(".vvScroller");e.on("mousedown",v),e.on("mouseup",p),e.on("mousemove",h),e.on("mouseout",f),e.on("click",m),e.on("touchstart",y),e.on("touchmove",b),e.on("touchend",A),e.on("dblclick",P),t.on("contextmenu",T),t.on("mousemove",S),this.events=!0},s.prototype.destroyEvents=function(e){e&&e.length||(e=$("#vvOuterDiv"));var t=e.find(".vvScroller");e.off("mousedown",v),e.off("mouseup",p),e.off("mousemove",h),e.off("mouseout",f),e.off("click",m),e.off("touchstart",y),e.off("touchmove",b),e.off("touchend",A),e.off("dblclick",P),t.off("contextmenu",T),t.off("mousemove",S),this.events=!1},s.prototype.eventSwitch=function(e){if(!(e&&this.events||!e&&!this.events))return e&&!this.events?void this.initEvents():!e&&this.events?void this.destroyEvents():void 0},s.prototype.clean=function(){this.dragging=!1,this.selectTextDrag=!1,this.dragMode=a.dragModes.pan,this.dragStartLeft=null,this.dragStopLeft=null,this.dragStartTop=null,this.dragStopTop=null,this.endPoint=0,this.annDragOffsetX=0,this.annDragOffsetY=0},s.prototype.panMousedown=function(n){var s,l=n.currentTarget||n.target,u=$(l).closest(".split");if(u.length){var d="Split",c=u.attr("id").slice(d.length);virtualViewer.setActivePane(c)}if(s=o.getActivePaneState()){this.annDragging=!1;var g=0;virtualViewer.hideAnnPopUp(),"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&(g=1),n||(n=window.event),Modernizr.touchevents&&(n=this.fixTouchEvent(n));var v=$(l).find(".vvCanvas");v.length||(v=$(l).parent().find(".vvCanvas"));var p=$(v).offset().left+$(v).width(),h=$(v).offset().top+$(v).height();if(!(n.clientX>p||n.clientY>h)){var f=virtualViewer.getActiveOuterDiv(),m=f.find(".vvCanvas"),y=this.clickPointConverter(n),b=i.getAnnotationAtPoint(y,s),A=!0;b||(A=!1);var P=r.isMagnifierAtPoint(n);if(t.imageScrollBars===!1){if(n.button===g)return this.dragStartLeft=n.clientX,this.dragStartTop=n.clientY,P&&r.getMagnifierEnabled()?void this.autoSwitchToMagnifierMode(n):A?(e.cursorNormal(),virtualViewer.setCurrentAnnObject(b),void this.autoSwitchToMoveAnnotationMode(n)):(this.currentDragMode!==a.dragModes.guides&&e.cursorGrabClosed(),this.moveTop=e.stripPx(m[0].style.top),this.moveLeft=e.stripPx(m[0].style.left),this.dragging=!0,!1)}else{if(P&&r.getMagnifierEnabled())return void this.autoSwitchToMagnifierMode(n);if(A)return virtualViewer.setCurrentAnnObject(b),void this.autoSwitchToMoveAnnotationMode(n);if(virtualViewer.pageHasText())return void this.autoSwitchToSelectTextMode(n);this.moveTop=e.stripPx(m[0].style.top),this.moveLeft=e.stripPx(m[0].style.left)}}}},s.prototype.panMouseup=function(a){a.preventDefault(),a||(a=window.event),Modernizr.touchevents&&(a=this.fixTouchEvent(a));var n=o.getActivePaneState();if(n){this.dragging=!1,this.annDragging=!1,this.annCorner=null,this.annLineEnd=null;var r=this.clickPointConverter(a),s=i.getAnnotationAtPoint(r,n);s&&a.preventDefault(),virtualViewer.getCurrentAnnObject()!==s&&virtualViewer.hideAnnPopUp(),s?(this.checkAnnotationMinimize(s,r),e.cursorNormal(),virtualViewer.paintCanvases(),t.stickyAnnButtons[virtualViewer.getCurrentAnnType()]&&virtualViewer.getIsAnnButtonSticky()||virtualViewer.disableStickyAnnotationButton()):(e.cursorGrabOpen(),virtualViewer.hideAnnPopUp()),virtualViewer.getIsAnnButtonSticky()&&$(".selectedAnn").length&&virtualViewer.turnOnAnnotationButton(virtualViewer.getCurrentAnnType(),$(".selectedAnn"),!0)}},s.prototype.panMousemove=function(e){e||(e=window.event),virtualViewer.getCurrentAnnObject()||virtualViewer.hideAnnPopUp(),Modernizr.touchevents&&(e=this.fixTouchEvent(e));var a=o.getActivePaneState();if(a){var n=virtualViewer.getActiveOuterDiv(),i=n.find(".vvScroller");if(t.imageScrollBars===!1){var r=i.height(),s=i.width();if(this.dragging){var l=this.moveTop+(e.clientY-this.dragStartTop),u=this.moveLeft+(e.clientX-this.dragStartLeft);this.dragStartTop=e.clientY,this.dragStartLeft=e.clientX,s<n[0].clientWidth&&(u=n[0].clientWidth/2-s/2),r<n[0].clientHeight&&(l=n[0].clientHeight/2-r/2),t.invertedPanScrollY?n.scrollTop(n.scrollTop()-l):n.scrollTop(n.scrollTop()+l),t.invertedPanScrollX?n.scrollLeft(n.scrollLeft()-u):n.scrollLeft(n.scrollLeft()+u)}}}},s.prototype.panDoubleClick=function(e){t.imageScrollBars===!1&&(virtualViewer.horizontalGuide.visible||virtualViewer.verticalGuide.visible)&&(virtualViewer.enterGuideMode(),this.guideDoubleClick(e))},s.prototype.annotateMousedown=function(r){if(3!==r.which){r.preventDefault();var s=r.currentTarget||r.target,l=$(s).closest(".split");if(l.length){var u="Split",d=l.attr("id").slice(u.length);if(virtualViewer.setActivePane(d)&&virtualViewer.currentPreviewAnnObject&&this.dragging)return virtualViewer.destroyInProgressAnnotation(),void this.setDragMode(a.dragModes.pan)}var c=this.isCurrentAnnPolygon(),g=o.getActivePaneState(),v=this.clickPointConverter(r,g),p=g.pageNumber,h=virtualViewer.getActiveOuterDiv(),f=h.find(".vvCanvas")[0];if(g.isPageCropped(p)&&this.dragMode!==a.dragModes.crop&&this.dragMode!==a.dragModes.zoom){var m=e.getLocalizedValue("errors.cropBlock","Cannot Annotate on Crop Preview. Save the crop then Annotate.");return virtualViewer.displayExceptionMessage(m),this.setDragMode(a.dragModes.pan),e.cursorNormal(),!1}if(virtualViewer.currentPointArray&&virtualViewer.currentPointArray.length&&virtualViewer.currentPointArray[0]||(virtualViewer.currentPointArray=[],this.endpoint=0),r||(r=window.event),Modernizr.touchevents&&(r=this.fixTouchEvent(r)),v.x<0||v.x>g.pageStates[p].requestedWidth||v.y>g.pageStates[p].requestedHeight||v.y<=0){if(c)return;if(virtualViewer.getIsAnnButtonSticky()&&null===virtualViewer.getCurrentAnnObject())return;return e.cursorNormal(),virtualViewer.setDragMode(a.dragModes.pan),void(this.dragging=!1)}var y=g.getUndoObject(p);if(y.referenceAnn=void 0,y.unchangedAnn=void 0,y.layer=i.getCurrentLayer(),this.dragStartLeft=v.getX(),this.dragStartTop=v.getY(),virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_BITMAP&&t.enableSingleClickImageRubberStamp){var b=virtualViewer.createPreviewAnnotation(!0,p,g);virtualViewer.pageContainsAnnotations(g.getPageNumber())||virtualViewer.pageHasIndicator(g.getPageNumber())||(virtualViewer.showAnnotationIndicator(g.getPageNumber()),virtualViewer.addToPagesWithAnnotations(g.getPageNumber())),b.fixDimensionsForPage(),b.setPreview(!1),virtualViewer.currentPreviewAnnObject=null,t.oneLayerPerAnnotation===!0&&virtualViewer.createAutoLayer();var A=i.addAnnotation(b);A&&(y.modifiedAnn=void 0,y.type="add",g.pushUndoObject(g.getPageNumber(),y)),virtualViewer.currentPointArray=[];var P=t.stickyAnnButtons[virtualViewer.getCurrentAnnType()];return P&&virtualViewer.getIsAnnButtonSticky()?(e.cursorAnnotate(),this.setDragMode(a.dragModes.annotate)):(e.cursorNormal(),this.setDragMode(a.dragModes.pan)),this.dragging=!1,virtualViewer.paintCanvases(),virtualViewer.createNavigationOptionsLabels(),!1}if(c){if(virtualViewer.currentPointArray[this.endPoint]=new n(this.dragStartLeft,this.dragStartTop),this.endPoint++,this.canEndCurrentPolygon(v))return;this.moveTop=e.stripPx(f.style.top),this.moveLeft=e.stripPx(f.style.left),this.dragging=!0}else virtualViewer.currentPointArray[0]=new n(this.dragStartLeft,this.dragStartTop),this.endPoint=1,this.moveTop=e.stripPx(f.style.top),this.moveLeft=e.stripPx(f.style.left),this.dragging=!0;return!1}},s.prototype.annotateMouseup=function(n){if(3!==n.which){n.preventDefault();var r=o.getActivePaneState(),s=this.isCurrentAnnPolygon();if(!s||null!==virtualViewer.currentPointArray){n||(n=window.event),Modernizr.touchevents&&(n=this.fixTouchEvent(n)),this.annDragging=!1,this.dragging=!1;var l=r.pageNumber,u=this.clickPointConverter(n,r,!1);if(u.x<0||u.x>r.pageStates[l].requestedWidth||u.y>r.pageStates[l].requestedHeight||u.y<=0){if(s)return void(this.dragging=!0);if(virtualViewer.getIsAnnButtonSticky()&&null===virtualViewer.getCurrentAnnObject()&&0===virtualViewer.currentPointArray.length)return}this.dragStopLeft=u.getX(),this.dragStopTop=u.getY(),this.limitRubberband();var d=virtualViewer.createPreviewAnnotation(!0,l,r),c=d.getType()===a.annotationTypes.SANN_POSTIT||d.getType()===a.annotationTypes.SANN_EDIT;if(d.getType()===a.annotationTypes.SANN_EDIT&&t.enableTextRubberStamp&&(g=virtualViewer.currentStamp,virtualViewer.currentStamp=null,d.isStamp=!0),s){var v=virtualViewer.currentPointArray[this.endPoint-1],p=this.canEndCurrentPolygon(u),h=!1;if(u.x>v.x-1&&u.x<v.x+1&&u.y>v.y-1&&u.y<v.y+1)h=!0;else{virtualViewer.currentPointArray[this.endPoint]=u,this.endPoint++;var f=e.getNubSize();null===virtualViewer.currentPointArray&&(this.annotateMousedown(n),h=!0),(u.x<virtualViewer.currentPointArray[0].getX()-f/2||u.x>virtualViewer.currentPointArray[0].getX()+f/2||u.y<virtualViewer.currentPointArray[0].getY()-f/2||u.y>virtualViewer.currentPointArray[0].getY()+f/2)&&(h=!0)}if(h&&!p)return void(this.dragging=!0)}if(d.setPreview(!1),virtualViewer.currentPreviewAnnObject=null,!(d.box.getHeight()<2&&d.box.getWidth()<2)){if(t.oneLayerPerAnnotation===!0&&d.getType()!==a.annotationTypes.SANN_REDACTION_RECT&&virtualViewer.createAutoLayer(),null===virtualViewer.currentPointArray&&(virtualViewer.currentPointArray=[]),(d.getType()===a.annotationTypes.SANN_ARROW||d.getType()===a.annotationTypes.SANN_LINE)&&virtualViewer.currentPointArray.length<2)return virtualViewer.currentPointArray=[],!1;var m;if(d.getType()===a.annotationTypes.SANN_REDACTION_RECT){var y=r.getPageNumber(),b=i.getRedactionLayer(y);d.type=a.annotationTypes.SANN_RECTANGLE,m=i.addAnnotation(d,y,b)}else virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_BITMAP&&t.enableSingleClickImageRubberStamp||(m=i.addAnnotation(d));if(d.fitBoxToText(),virtualViewer.paintCanvases(),null!==m&&virtualViewer.getCurrentAnnType()!==a.annotationTypes.SANN_BITMAP&&t.enableSingleClickImageRubberStamp||virtualViewer.getCurrentAnnType()!==a.annotationTypes.SANN_EDIT||virtualViewer.getCurrentAnnType()!==a.annotationTypes.SANN_POSTIT){var A=r.getUndoObject(r.getPageNumber());A.modifiedAnn=void 0,A.layer=i.getLayerWithAnn(d),A.type="add",r.pushUndoObject(r.getPageNumber(),A)}virtualViewer.currentPointArray=[],this.endPoint=0;var P=t.stickyAnnButtons[virtualViewer.getCurrentAnnType()],T=P&&virtualViewer.getIsAnnButtonSticky();return this.setDragMode(a.dragModes.pan),e.cursorNormal(),T||virtualViewer.disableStickyAnnotationButton(),t.immediatelyEditTextAnnotations&&c&&null!==m?(virtualViewer.setCurrentAnnObject(d),virtualViewer.annPopUpHandler(null,d),$("#vvAnnPopUpEditTextArea").focus()):T&&(g>-1&&(virtualViewer.currentStamp=g),e.cursorAnnotate(),this.setDragMode(a.dragModes.annotate)),t.showAnnNavToggle&&null!==m&&(virtualViewer.pageHasIndicator(l)||(virtualViewer.addToPagesWithAnnotations(r.pageNumber),virtualViewer.showAnnotationIndicator(r.pageNumber)),virtualViewer.createNavigationOptionsLabels(),"redaction"===$("input[name='radio']:checked").val()?virtualViewer.navigationButtonHandler(!0):virtualViewer.navigationButtonHandler(!1)),virtualViewer.currentPointArray&&(virtualViewer.currentPointArray=[],this.endpoint=0),!1}}}},s.prototype.annotateMousemove=function(e){e.preventDefault(),e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e));var t=o.getActivePaneState();if(this.dragging===!0){var n=this.clickPointConverter(e,null,!1);if(this.dragStopLeft=n.getX(),this.dragStopTop=n.getY(),virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_POSTIT){var i=Math.abs(this.dragStartLeft-this.dragStopLeft),r=Math.abs(this.dragStartTop-this.dragStopTop),s=1.25*virtualViewer.collapsedStickySize(t.getZoomDecimal());i<s&&(this.dragStopLeft<this.dragStartLeft?this.dragStopLeft=this.dragStartLeft-s:this.dragStopLeft=this.dragStartLeft+s),r<s&&(this.dragStopTop<this.dragStartTop?this.dragStopTop=this.dragStartTop-s:this.dragStopTop=this.dragStartTop+s)}this.limitRubberband(),n.setX(this.dragStopLeft),n.setY(this.dragStopTop),virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_FREEHAND?virtualViewer.currentPointArray[virtualViewer.currentPointArray.length]=n:virtualViewer.currentPointArray[this.endPoint]=n,virtualViewer.currentPointArray.length>1?virtualViewer.currentPreviewAnnObject=virtualViewer.createPreviewAnnotation(!1):virtualViewer.currentPreviewAnnObject=null,virtualViewer.paintCanvases()}return!1},s.prototype.zoomMousemove=function(e){if(e||(e=window.event),this.dragging===!0){var t=this.clickPointConverter(e);this.dragStopLeft=t.getX(),this.dragStopTop=t.getY(),this.limitRubberband(),virtualViewer.currentPointArray[this.endPoint]=t,virtualViewer.currentPreviewAnnObject=virtualViewer.createPreviewAnnotation(!1),virtualViewer.paintCanvases()}return!1},s.prototype.zoomMouseup=function(e){var n=o.getActivePaneState(),i=n.getPageNumber(),r=virtualViewer.getActiveOuterDiv();e||(e=window.event);var s=virtualViewer.createPreviewAnnotation(!0,i,n);s.setPreview(!1),virtualViewer.currentPreviewAnnObject=null,virtualViewer.textSelectionAllowed()?this.setDragMode(a.dragModes.selectText):this.setDragMode(a.dragModes.pan),virtualViewer.currentPointArray=[],this.dragging=!1;var l=this.clickPointConverter(e,n,!1);if(this.isCurrentAnnPolygon()&&(l.x<0||l.x>n.pageStates[n.pageNumber].requestedWidth||l.y>n.pageStates[i].requestedHeight||l.y<=0))return void(this.dragging=!0);this.dragStopLeft=l.getX(),this.dragStopTop=l.getY(),this.limitRubberband();var u=Math.abs(this.dragStopTop-this.dragStartTop),d=Math.abs(this.dragStopLeft-this.dragStartLeft);if(!(n.pageStates[i].requestedWidth<1||n.pageStates[i].requestedHeight<1)&&0!==d&&0!==u){var c,g=Math.min(this.dragStopTop,this.dragStartTop),v=Math.min(this.dragStopLeft,this.dragStartLeft),p=g/n.pageStates[i].requestedHeight,h=v/n.pageStates[i].requestedWidth,f=u,m=u/n.pageStates[i].requestedHeight,y=d;90!==n.getRotationForPage(i)&&270!==n.getRotationForPage(i)||(f=y,y=u,m=f/n.pageStates[i].requestedWidth),c=f>=y?r.height()/f:r.width()/y;var b=n.getZoom(),A=Math.round(b*c);n.setZoomMode(a.zoomModes.fitCustom),A>(t.maxZoomPercent||500)&&(A=t.maxZoomPercent||500),n.setZoom(A),virtualViewer.determineEffectiveZoom(i,n),A=n.getZoom(),c=A/b;var P=n.getImageManager();P.scaleDocumentByPercentage(n.getZoomDecimal()),virtualViewer.sizeScroller({state:n}),virtualViewer.zoomCore(n,i);var T=h*n.pageStates[i].requestedWidth,S=virtualViewer.getScrollSpeed(n);180===n.getRotationForPage(i)?(p=1-p-m,T=n.pageStates[i].requestedWidth-h*n.pageStates[i].requestedWidth,T-=y*c):90===n.getRotationForPage(i)?(T=n.pageStates[i].requestedHeight-p*n.pageStates[i].requestedHeight,T-=y*c,p=h):270===n.getRotationForPage(i)&&(T=p*n.pageStates[i].requestedHeight,p=1-h-m);var w=virtualViewer.findPagePosition(i,n)+p*S;r.scrollLeft(0);var I=virtualViewer.getVisualPageLeft({page:i,state:n})+T;return virtualViewer.skipScrollEvent=!0,r.scrollLeft(I),r.scrollTop(w),virtualViewer.getIsAnnButtonSticky()&&virtualViewer.setCurrentAnnType(virtualViewer.getCurrentStickyAnnType()),this.endPoint=0,virtualViewer.currentPointArray=[],!1}},s.prototype.selectTextMousedown=function(t){var a=t.currentTarget||t.target,s=$(a).closest(".split");if(s.length){var l="Split",u=s.attr("id").slice(l.length);virtualViewer.setActivePane(u)}var d=o.getActivePaneState();if(d){t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var c=$(a).find(".vvCanvas"),g=$(c).offset().left+$(c).width(),v=$(c).offset().top+$(c).height();if(!(t.clientX>g||t.clientY>v)){var p=this.clickPointConverter(t),h=i.getAnnotationAtPoint(p,d);if(this.annDragging=!1,this.dragging=!1,r.getMagnifierEnabled()&&r.isMagnifierAtPoint(t))return void this.autoSwitchToMagnifierMode(t);if(h)return e.cursorNormal(),virtualViewer.setCurrentAnnObject(h),void this.autoSwitchToMoveAnnotationMode(t);var f=!1,m=!1;switch(t.which){case 1:f=!0;break;case 2:break;case 3:m=!0}f&&(this.selectTextDrag=!0,p.x=p.x/d.getZoomDecimal(),p.y=p.y/d.getZoomDecimal(),virtualViewer.selectTextStartPoint=new n(p.x,p.y),virtualViewer.selectTextEndPoint=new n(p.x,p.y),virtualViewer.paintCanvases(d))}}},s.prototype.selectTextMousemove=function(e){this.selectTextDrag&&this.selectTextDragUpdate(e)},s.prototype.selectTextDragUpdate=function(e){e||(e=window.event);var t=this.clickPointConverter(e),a=o.getActivePaneState();t.x=t.x/a.getZoomDecimal(),t.y=t.y/a.getZoomDecimal(),virtualViewer.selectTextEndPoint=new n(t.x,t.y),virtualViewer.paintCanvases()},s.prototype.selectTextMouseup=function(){if(this.annDragging||this.selectTextDrag||this.dragging){this.annDragging=this.dragging=!1,virtualViewer.paintCanvases(),this.selectTextDrag=!1;var e=virtualViewer.getCallbackManager(),t={text:virtualViewer.getUserFriendlySelectedText()};e.call("textSelect",t)}if(virtualViewer.getIsAnnButtonSticky())return void($(".selectedAnn").length&&virtualViewer.turnOnAnnotationButton(virtualViewer.getCurrentAnnType(),$(".selectedAnn"),!0))},s.prototype.annotationMoveMousedown=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=o.getActivePaneState();if(3!==e.which){e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e));var n=this.clickPointConverter(e,t);if(r.getMagnifierEnabled()&&r.isMagnifierAtPoint(e))return void this.autoSwitchToMagnifierMode(e);var s=i.getAnnotationAtPoint(n,t);if(virtualViewer.getCurrentAnnObject()!==s&&virtualViewer.hideAnnPopUp(),!s)return virtualViewer.setPreviousAnnObject(virtualViewer.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null),this.autoSwitchToPanMode(e),virtualViewer.delayedPaintCanvases(t),!1;s!==virtualViewer.getCurrentAnnObject()&&virtualViewer.setCurrentAnnObject(s);var l=s.getBoundingBox(s.collapsed),u=s.getPointRotatedForAnn(n),d=u.getX(),c=u.getY(),g=s.getWidthRatio(),v=s.getHeightRatio(),p=i.getLayerWithAnn(s),h=t.getUndoObject(t.getPageNumber());h.referenceAnn=s,h.unchangedAnn=s.clone(),h.layer=p,this.annDragOffsetX=d-s.box.one.getX()*g,this.annDragOffsetY=c-s.box.one.getY()*v,this.annDragging=!0,this.checkAnnotationMinimize(s,u),s.getType()===a.annotationTypes.SANN_ARROW||s.getType()===a.annotationTypes.SANN_LINE?this.annLineEnd=s.findLineEndpoint(u,g,v):this.annCorner=l.findCorner(u,g,v)}},s.prototype.annotationMoveMousemove=function(e){if(e.preventDefault(),e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e)),this.annDragging){var t=virtualViewer.getCurrentAnnObject();if(!t)return;var r=this.clickPointConverter(e,null,!1),s=t.getPointRotatedForAnn(r),l=s.getX(),u=s.getY(),d=new n(l-this.annDragOffsetX,u-this.annDragOffsetY),c=new n(l,u),g=o.getActivePaneState(),v=t.pageWidth*t.getWidthRatio(g),p=t.pageHeight*t.getHeightRatio(g);d.getX()<0?d=new n(0,d.getY()):d.getX()+t.box.getWidth()*t.getWidthRatio()>v&&(d=new n(v-t.box.getWidth()*t.getWidthRatio(),d.getY())),d.getY()<0?d=new n(d.getX(),0):d.getY()+t.box.getHeight()*t.getHeightRatio()>p&&(d=new n(d.getX(),p-t.box.getHeight()*t.getHeightRatio())),c.getX()<0?c=new n(0,c.getY()):c.getX()>v&&(c=new n(v,c.getY())),c.getY()<0?c=new n(c.getX(),0):c.getY()>p&&(c=new n(c.getX(),p));var h=!0;null!==this.annCorner||null!==this.annLineEnd?virtualViewer.getCurrentAnnObject().getType()===a.annotationTypes.SANN_ARROW||virtualViewer.getCurrentAnnObject().getType()===a.annotationTypes.SANN_LINE?virtualViewer.getCurrentAnnObject().stretchLine(this.annLineEnd,c.getX(),c.getY()):virtualViewer.getCurrentAnnObject().stretch(this.annCorner,c.getX(),c.getY()):h=virtualViewer.getCurrentAnnObject().move(d),virtualViewer.hideAnnPopUp(),h&&(virtualViewer.getCurrentAnnObject().markRevised(),i.markLayerWithAnnDirty(virtualViewer.getCurrentAnnObject()),virtualViewer.paintCanvases())}},s.prototype.annotationMoveMouseup=function(t){if(t.preventDefault(),(0!==$("#vvAnnPopUp").filter(":hidden").length||this.annDragging)&&virtualViewer.getCurrentAnnObject()){var n=o.getActivePaneState();t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t)),this.annDragging=!1,this.annCorner=null,this.annLineEnd=null,virtualViewer.getCurrentAnnObject()&&virtualViewer.getCurrentAnnObject().fixBoundingBox();var r=virtualViewer.getCurrentAnnObject(),s=i.getLayerWithAnn(r),l=n.getUndoObject(n.getPageNumber());l.modifiedAnn=r.clone(),l.layer=s,l.type="modify",r&&r.markRevised(),l.modifiedAnn.isSameAs(l.unchangedAnn)||l.unchangedAnn&&n.pushUndoObject(n.getPageNumber(),l),n.resetUndoObject(),i.markLayerWithAnnDirty(virtualViewer.getCurrentAnnObject()),i.checkLayerPermission(i.getCurrentLayer(),a.permissionLevels.PERM_EDIT)===!1&&(alert(e.getLocalizedValue("errors.editAnnOnLayerPermission","You do not have permission to edit annotations on this layer.")),virtualViewer.undoAnnotation()),this.setDragMode(a.dragModes.pan),virtualViewer.paintCanvases()}},s.prototype.magnifierMousedown=function(t){t.preventDefault();var a=o.getActivePaneState();if(a){t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var i=$("#vvMagnifierCanvas"),s=i.offset();virtualViewer.hideAnnPopUp(),t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var l=r.isMagnifierAtPoint(t);if(!l)return virtualViewer.paintCanvases(),this.autoSwitchToPanMode(t),!1;this.dragStartLeft=t.clientX,this.dragStartTop=t.clientY;var u=new n(s.left+i[0].width,s.top+i[0].height),d=e.getNubSize();this.annDragOffsetX=this.dragStartLeft-s.left,this.annDragOffsetY=this.dragStartTop-s.top,this.dragging=!0,this.dragStartLeft>u.x-2*d&&this.dragStartLeft<u.x+2*d&&this.dragStartTop>u.y-2*d&&this.dragStartTop<u.y+2*d&&(this.magnifierCorner=3)}},s.prototype.magnifierMouseup=function(e){return e.preventDefault(),e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e)),this.dragging=!1,this.magnifierCorner=null,this.setDragMode(a.dragModes.pan),r.isCloseButtonAtPoint(e)?void r.toggleMagnifier():void virtualViewer.paintCanvases()},s.prototype.magnifierMousemove=function(e){e.preventDefault();var t=$("#vvMagnifierCanvas"),a=$("#vvImageCanvas");if(e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e)),this.dragging){var i=e.clientX,o=e.clientY,s=a.offset(),l=new n(i-this.annDragOffsetX,o-this.annDragOffsetY),u=new n(i,o),d=a.width(),c=a.height();l.x=Math.max(l.x,s.left),l.x+t.width()>d+s.left&&(l.x=d-t.width()+s.left),l.y=Math.max(l.y,s.top),l.y+t.height()>c+s.top&&(l.y=c-t.height()+s.top),u.x=Math.max(u.x,s.left),u.x=Math.min(u.x,d+s.left),u.y=Math.max(u.y,s.top),u.y=Math.min(u.y,c+s.top),null!==this.magnifierCorner||null!==this.annLineEnd?r.stretchMagnifier(u.x-s.left,u.y-s.top):(t.css("left",l.x-s.left),t.css("top",l.y-s.top)),virtualViewer.hideAnnPopUp(),r.paintMagnifierCanvas()}},s.prototype.cropMousemove=function(e){var t=o.getActivePaneState();if(e||(e=window.event),this.dragging===!0){var a=this.clickPointConverter(e);this.dragStopLeft=a.getX(),this.dragStopTop=a.getY(),this.limitRubberband(),virtualViewer.currentPointArray[this.endPoint]=a,virtualViewer.currentPreviewAnnObject=virtualViewer.createPreviewAnnotation(!1,t.getPageNumber(),t),virtualViewer.paintCanvases(t)}},s.prototype.cropMouseup=function(t){var n=o.getActivePaneState();t.preventDefault(),t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var i=this.clickPointConverter(t,n,!1);this.dragging=!1,this.dragStopLeft=i.getX(),this.dragStopTop=i.getY(),this.limitRubberband();var r=Math.abs(this.dragStartLeft-this.dragStopLeft),s=Math.abs(this.dragStartTop-this.dragStopTop);(r>=2||s>=2)&&this.dragStartLeft>0&&this.dragStartTop>0&&(virtualViewer.showCropDialog(this.dragStartTop,this.dragStartLeft,this.dragStopTop,this.dragStopLeft,n.pageNumber),this.setDragMode(a.dragModes.pan),e.cursorNormal(),virtualViewer.currentPreviewAnnObject=null,virtualViewer.currentPointArray=[])},s.prototype.dummyMousemove=function(t){var n=o.getActivePaneState(),i=virtualViewer.getActiveOuterDiv().find(".vvScroller"),r=this.clickPointConverter(t);if(r){var s=r.getX(),l=r.getY(),u=n.getLayerNames(),g=n.getLayersForPage(n.pageNumber);if(u&&g)for(var v=0;v<u.length;v+=1){var p=g[u[v]];if(p)for(var h=p.anns,f=0;f<h.length;f+=1){var m=h[f];if(m.getType()===a.annotationTypes.SANN_POSTIT){var y=e.getTextAnnDOMId(m),b=m.getBoundingBox(),A=b.getX1()*m.getWidthRatio(),P=b.getY1()*m.getWidthRatio(),T=b.getX2()*m.getWidthRatio(),S=b.getY2()*m.getWidthRatio();if(A<s&&T>s&&P<l&&S>l){if(!d){var w=$("#"+y).attr("title");return i.attr("title",w),c=y,void(d=!0)}}else d&&y===c&&(i.removeAttr("title"),d=!1)}}}}},s.prototype.guideMousedown=function(n){n||(n=window.event);var o=1;if($(n.target).closest("#vvOuterDiv").length&&(o=0),virtualViewer.setActivePane(o),this.dragging=!1,e.cursorGuides(),(virtualViewer.horizontalGuide.locked||!virtualViewer.horizontalGuide.visible)&&(virtualViewer.verticalGuide.locked||!virtualViewer.verticalGuide.visible)){Modernizr.touchevents&&(n=this.fixTouchEvent(n));var r=this.clickPointConverter(n),s=i.isAnnotationAtPoint(r);if(s)return e.cursorNormal(),void this.setDragMode(a.dragModes.pan);if(t.imageScrollBars===!1)return void this.panMousedown(n)}virtualViewer.updateGuidePositions(n),virtualViewer.horizontalGuide.locked=virtualViewer.horizontalGuide.visible,virtualViewer.verticalGuide.locked=virtualViewer.verticalGuide.visible,virtualViewer.paintCanvases()},s.prototype.guideMouseup=function(e){this.dragging=!1},s.prototype.guideDoubleClick=function(t){e.cursorGuides(),this.getDragMode()===a.dragModes.guides&&(virtualViewer.horizontalGuide.locked=!1,virtualViewer.verticalGuide.locked=!1,virtualViewer.updateGuidePositions(t),virtualViewer.paintCanvases())},s.prototype.guideMousemove=function(t){return!virtualViewer.horizontalGuide.locked&&virtualViewer.horizontalGuide.visible||!virtualViewer.verticalGuide.locked&&virtualViewer.verticalGuide.visible||!this.dragging?(e.cursorGuides(),void virtualViewer.updateGuidePositions(t)):(this.setDragMode(a.dragModes.pan),e.cursorGrabClosed(),void this.panMousedown(t))},s.prototype.overlayMousedown=function(e){e||(e=window.event);var t=1;$(e.target).closest("#vvOuterDiv").length&&(t=0),virtualViewer.setActivePane(t);var a=o.getActivePaneState(),i=a.getImageManager();if(!i.overlayImage)return void this.autoSwitchToPanMode(e);r.isMagnifierAtPoint(e)&&this.autoSwitchToMagnifierMode(e);var s=!1,l=!1;switch(e.which){case 1:s=!0;break;case 2:break;case 3:l=!0}if(l)return void this.autoSwitchToPanMode(e);if(s){this.dragging=!0;var u=this.clickPointConverter(e);this.dragStartLeft=u.getX(),this.dragStartTop=u.getY();var d=this.clickPageFinder(a,new n(e.clientX,e.clientY)),c=i.getOverlayOffsetForPage(d);if(c){var g,v=a.getRequestedWidthForPage(d)/i.overlayImage.width,p=a.getRequestedHeightForPage(d)/i.overlayImage.height;g=v<p?v:p,this.overlayDragOffset.x=this.dragStartLeft/g-c.offsetX,this.overlayDragOffset.y=this.dragStartTop/g-c.offsetY}}},s.prototype.overlayMouseup=function(e){this.dragging=!1},s.prototype.overlayMousemove=function(e){if(this.dragging){var t=o.getActivePaneState(),a=t.getImageManager(),i=this.clickPointConverter(e);this.dragStopLeft=i.getX(),this.dragStopTop=i.getY();var r=this.clickPageFinder(t,new n(e.clientX,e.clientY)),s=a.getOverlayOffsetForPage(r);if(s){var l,u=a.overlayImage,d=t.getRequestedWidthForPage(r)/u.width,c=t.getRequestedHeightForPage(r)/u.height;l=d<c?d:c,s.offsetX=this.dragStopLeft/l-this.overlayDragOffset.x,s.offsetY=this.dragStopTop/l-this.overlayDragOffset.y,virtualViewer.paintCanvases()}}},s.prototype.checkAnnotationMinimize=function(e,n){var i=!1;if(e.getType()===a.annotationTypes.SANN_POSTIT){var r=o.getActivePaneState(),s=n.getX(),l=n.getY(),u=e.getBoundingBox(e.collapsed),d=u.getX2()*e.getWidthRatio(),c=u.getY1()*e.getHeightRatio(),g=e.getMinimizeButtonSize(r),v=g+Math.ceil(t.annotationDefaults.stickyMargin*r.getZoomDecimal());if(v<10)return i;v>40&&(g=40),s>=d-v&&s<=d&&l>=c&&l<=c+v&&(e.collapsed=!e.collapsed,virtualViewer.paintCanvases(),i=!0)}return i},s.prototype.fixTouchEvent=function(e){if(Modernizr.touchevents){e&&e.originalEvent&&(e=e.originalEvent);var t=e.changedTouches,a=!1;t&&t.length>0?(e=t[0],a=!0):e.gesture&&e.gesture.touches&&e.gesture.touches.length>0&&(t=e.gesture.touches,t&&t.length>0&&(e=t[0],a=!0)),a&&(e.button=0,e.preventDefault=function(){},e.stopPropagation=function(){})}return e},s.prototype.limitRubberband=function(){var e=o.getActivePaneState(),t=e.pageStates[e.pageNumber];this.dragStopLeft>t.requestedWidth?this.dragStopLeft=t.requestedWidth:this.dragStopLeft<0&&(this.dragStopLeft=0),this.dragStopTop>t.requestedHeight?this.dragStopTop=t.requestedHeight:this.dragStopTop<0&&(this.dragStopTop=0)},s.prototype.clickPointConverter=function(e,t,a){if(t=t||o.getActivePaneState(),!t||!t.pageStates)return null;a!==!1&&(a=!0);var i=o.getOuterDivFromState(t).find(".vvCanvas"),r=i.offset(),s=new n(e.clientX-r.left,e.clientY-r.top),l=this.clickPageFinder(t,s);l===-1&&(l=t.pageNumber||0),l<t.pageCount&&l>=0&&l!==t.pageNumber&&this.dragging===!1&&"mousemove"!==e.type&&"mouseout"!==e.type&&a&&virtualViewer.updatePage(l,t);var u=this.globalPosToLocalPos(s,t.pageNumber,t),d=t.getRotationForPage(t.pageNumber),c=this.rotateLocalizedPoint(u,d);return c},s.prototype.findPos=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);var n=virtualViewer.getActiveOuterDiv();return a-=n.scrollTop(),t-=n.scrollLeft(),[t,a]},s.prototype.clickPageFinder=function(e,n,i,r){if(e=e||o.getActivePaneState(),i=i||virtualViewer.getActiveOuterDiv(),r=r||i.find(".vvScroller"),e.isVideo())return-1;var s=virtualViewer.scrollPageFinder(e,i,r),l=virtualViewer.getVisualPageTop({page:s,state:e,currentZeroPage:s}),u=s+t.continuousScrollBufferAfterSize;u||0===u||(u=s+3);var d;u>=e.pageCount&&(u=e.pageCount-1);
for(var c,g=s;g<=u;g++){if(d=e.getRotationForPage(g),c=0===d||180===d?l+e.pageStates[g].requestedHeight:l+e.pageStates[g].requestedWidth,c+=a.spaceBetweenPages,n.y<=c&&n.y>=l)return g;l=c}return-1},s.prototype.rotateLocalizedPoint=function(e,t,a){var i,r=o.getActivePaneState();if(r&&r.pageStates&&!(r.pageStates.length<1)){a||(a=r.pageNumber),t||(t=r.getRotationForPage(a));var s=r.pageStates[a].requestedWidth,l=r.pageStates[a].requestedHeight;return i=0===t?e:90===t?new n(e.y,l-e.x):180===t?new n(s-e.x,l-e.y):new n(s-e.y,e.x)}},s.prototype.autoSwitchToSelectTextMode=function(e){this.setDragMode(a.dragModes.selectText),this.selectTextMousedown(e)},s.prototype.autoSwitchToMoveAnnotationMode=function(e){this.setDragMode(a.dragModes.moveAnnotation),this.annotationMoveMousedown(e)},s.prototype.autoSwitchToPanMode=function(e){this.setDragMode(a.dragModes.pan),this.panMousedown(e)},s.prototype.autoSwitchToMagnifierMode=function(e){this.setDragMode(a.dragModes.magnifier),this.magnifierMousedown(e)},s.prototype.canEndCurrentPolygon=function(t){var a=e.getNubSize();return t.x>virtualViewer.currentPointArray[0].getX()-a/2&&t.x<virtualViewer.currentPointArray[0].getX()+a/2&&t.y>virtualViewer.currentPointArray[0].getY()-a/2&&t.y<virtualViewer.currentPointArray[0].getY()+a/2&&this.endPoint>1},s.prototype.isCurrentAnnPolygon=function(){var e=virtualViewer.getCurrentAnnType();return e===a.annotationTypes.SANN_POLYGON||e===a.annotationTypes.SANN_FILLED_POLYGON},s.prototype.localPosToGlobalPos=function(e,t,a){a=a||o.getActivePaneState();var i=e[1];i||(i=e.getY());var r=e[0];r||(r=e.getX());var s=o.getOuterDivFromState(a).find(".vvCanvas"),l=s.offset(),u=virtualViewer.getVisualPageTop({page:t,state:a}),d=virtualViewer.getVisualPageLeft({page:t,state:a});return r=r+d+l.left,i=i+u+l.top,new n(r,i)},s.prototype.globalPosToLocalPos=function(e,t,a){if(a=a||o.getActivePaneState(),a&&a.pageStates&&!(a.pageStates.length<1)){var i=e[1];i||(i=e.getY());var r=e[0];r||(r=e.getX()),t=t||a.pageNumber;var s=virtualViewer.getVisualPageTop({page:t,state:a}),l=virtualViewer.getVisualPageLeft({page:t,state:a});return r-=l,i-=s,new n(r,i)}};var v=function(e){var t=l(),n=t.getDragMode();n===a.dragModes.pan?t.panMousedown(e):n===a.dragModes.annotate?t.annotateMousedown(e):n===a.dragModes.moveAnnotation?t.annotationMoveMousedown(e):n===a.dragModes.zoom?t.annotateMousedown(e):n===a.dragModes.selectText?t.selectTextMousedown(e):n===a.dragModes.guides?t.guideMousedown(e):n===a.dragModes.magnifier?t.magnifierMousedown(e):n===a.dragModes.crop?t.annotateMousedown(e):n===a.dragModes.overlay&&t.overlayMousedown(e)},p=function(e){var t=l(),n=t.getDragMode();n===a.dragModes.pan?t.panMouseup(e):n===a.dragModes.annotate?t.annotateMouseup(e):n===a.dragModes.moveAnnotation?t.annotationMoveMouseup(e):n===a.dragModes.zoom?t.zoomMouseup(e):n===a.dragModes.selectText?t.selectTextMouseup(e):n===a.dragModes.guides?t.guideMouseup(e):n===a.dragModes.magnifier?t.magnifierMouseup(e):n===a.dragModes.crop?t.cropMouseup(e):n===a.dragModes.overlay&&t.overlayMouseup(e)},h=function(e){var t=l(),n=t.getDragMode();n===a.dragModes.pan?t.panMousemove(e):n===a.dragModes.annotate?t.annotateMousemove(e):n===a.dragModes.moveAnnotation?t.annotationMoveMousemove(e):n===a.dragModes.zoom?t.zoomMousemove(e):n===a.dragModes.selectText?t.selectTextMousemove(e):n===a.dragModes.guides?t.guideMousemove(e):n===a.dragModes.magnifier?t.magnifierMousemove(e):n===a.dragModes.crop?t.cropMousemove(e):n===a.dragModes.overlay&&t.overlayMousemove(e)},f=function(e){var t=l(),n=t.getDragMode();n===a.dragModes.pan},m=function(e){var t=l();t.getDragMode()},y=function(e){var t=l(),n=t.getDragMode();return n===a.dragModes.pan?(e=t.fixTouchEvent(e),void t.panMousedown(e)):(e.preventDefault(),e=t.fixTouchEvent(e),void(n===a.dragModes.annotate?t.annotateMousedown(e):n===a.dragModes.zoom?t.annotateMousedown(e):n===a.dragModes.moveAnnotation?t.annotationMoveMousedown(e):n===a.dragModes.magnifier?t.magnifierMousedown(e):n===a.dragModes.crop&&t.annotateMousedown(e)))},b=function(e){var t=l(),n=t.getDragMode();n===a.dragModes.pan?(e=t.fixTouchEvent(e),t.panMousemove(e)):n===a.dragModes.annotate?(e=t.fixTouchEvent(e),t.annotateMousemove(e)):n===a.dragModes.zoom?(e=t.fixTouchEvent(e),t.zoomMousemove(e)):n===a.dragModes.moveAnnotation?(e=t.fixTouchEvent(e),t.annotationMoveMousemove(e)):n===a.dragModes.magnifier?(e.preventDefault(),e=t.fixTouchEvent(e),t.magnifierMousemove(e)):n===a.dragModes.crop&&(e=t.fixTouchEvent(e),t.cropMousemove(e))},A=function(e){var t=l(),n=t.getDragMode();e=t.fixTouchEvent(e),n===a.dragModes.pan?t.panMouseup(e):n===a.dragModes.annotate?t.annotateMouseup(e):n===a.dragModes.moveAnnotation?t.annotationMoveMouseup(e):n===a.dragModes.magnifier?t.magnifierMouseup(e):n===a.dragModes.crop?t.cropMouseup(e):n===a.dragModes.zoom&&t.zoomMouseup(e)},P=function(e){var t=l(),n=t.getDragMode();n===a.dragModes.pan?t.panDoubleClick(e):n===a.dragModes.guides&&t.guideDoubleClick(e)},T=function(e){var t=l();Modernizr.touchevents&&(e=t.fixTouchEvent(e));var a=o.getActivePaneState(),n=virtualViewer.getAnnClipboard();a&&n&&(n.pasteLocation=t.clickPointConverter(e,a,!0))},S=function(e){var t=l(),n=t.getDragMode();n===a.dragModes.pan&&t.dummyMousemove(e)};return l()}),define("vvBookmarks",["vvUtility"],function(e){function t(){this.bookmark={page:null,note:null},this.bookmarkArray=[],a=this,this.editingBookmark=null,this.pageToAdd=-1}var a;t.prototype.addBookmark=function(t,a,i,o){try{var r=virtualViewer.getCurrentState();if(r.isVirtualDocument())throw"VirtualDocuments can't use Bookmarks";var s=r.getDocumentModel();if(this.editingBookmark&&(this.editingBookmark=null),null===a||void 0===a)if(this.pageToAdd!==-1)a=this.pageToAdd,this.pageToAdd=-1;else{var l=s.getSelectedPageNumbers();if(l.length>1)throw"Too many pages selected";l.length<1&&(l=[r.pageNumber]),a=l[0]}if(this.bookmarkExists(a)){var u=e.getLocalizedValue("errors.bookmarkExists","Bookmark already exists!");throw u}this.bookmark.page=a,0===t.length?this.bookmark.note=e.getLocalizedValue("bookmarks.bookmarkDefault","Bookmark"):this.bookmark.note=t;var d=this.copyBookmark(this.bookmark);this.bookmarkArray.push(d);var c=e.encodeForHTML(this.bookmark.note),g=$('<div id="page'+this.bookmark.page+'" class="vvBookmark"> ');return g.append("<hr>"),g.append('<div class="vvBookmarkPageNumber"> <a href=<b> Page: '+(this.bookmark.page+1)+"</b></a> <button type ='button' id = 'vvBookmarksCloseButton' class='smallClose vvBookmarksCloseButton' <span aria-hidden='true'>x</span></button></div>"),g.append('<div class="vvBookmarkContent">'+c+"</div></div>"),$("#vvBookmarksInternal").prepend(g),$("#vvBookmarksCloseButton").attr("title",e.getLocalizedValue("bookmarks.deleteButton","Delete Bookmark")),this.addClickEvent(g,a),this.removeClickDefaults(),this.addXButton(a),o||s.setBookmarksModifiedSinceInit(!0,r),i||this.orderBookmarks(),!0}catch(e){return n(!0,e),!1}},t.prototype.updateBookmarkDisplay=function(e){var t="#page"+e,a=$(t+" .vvBookmarkContent");a.text(this.editingBookmark.note)},t.prototype.editBookmark=function(t){try{if(!t&&0!==t)throw e.getLocalizedValue("bookmarkDialog.errors.noPage","Please pass a page number to edit a bookmark");if(virtualViewer.getCurrentState().isVirtualDocument())throw e.getLocalizedValue("bookmarkDialog.errors.virtualDocument","Bookmarks are not supported on Virtual Documents");for(var a,i=0;i<this.bookmarkArray.length;i++)if(this.bookmarkArray[i].page===t){this.editingBookmark=this.copyBookmark(this.bookmarkArray[i]),a=this.bookmarkArray[i];break}if(!a)throw e.getLocalizedValue("bookmarkDialog.errors.noBookmarks","No bookmark exists for the provided page");var o=e.getLocalizedValue("bookmarkDialog.editTitle","Edit Bookmark");$("#vvBookmarkTitle").text(o),$("#vvBookmarkDialogNoteInput").val(a.note),$(".ui-widget-overlay ui-front").onContextMenu=function(){return!1},$("#vvBookmarkDialog").modal("show")}catch(e){return n(!0,e),!1}},t.prototype.saveEditedBookmark=function(t){for(var a=virtualViewer.getCurrentState(),n=a.getDocumentModel(),i=-1,o=0;o<this.bookmarkArray.length;o++)if(this.bookmarkArray[o].page===this.editingBookmark.page){i=o;break}return i===-1?void(this.editingBookmark=null):(this.editingBookmark.note=t,0===this.editingBookmark.note.length&&(this.editingBookmark.note=e.getLocalizedValue("bookmarks.bookmarkDefault","Bookmark")),this.bookmarkArray[o]=this.editingBookmark,this.updateBookmarkDisplay(this.editingBookmark.page),void n.setBookmarksModifiedSinceInit(!0,a))},t.prototype.restoreBookmark=function(){null!==this.deletedBookmark&&(this.addBookmark(this.deletedBookmark.note,this.deletedBookmark.page,!1,!1),this.deletedBookmark=null)},t.prototype.bookmarkExists=function(e){for(var t=0;t<this.bookmarkArray.length;t++)if(this.bookmarkArray[t].page===e)return!0;return!1},t.prototype.removeClickDefaults=function(){$(".vvBookmark").click(function(e){e.preventDefault()}),$(".vvBookmarkPageNumber").click(function(e){e.preventDefault()}),$(".vvBookmarkContent").click(function(e){e.preventDefault()})},t.prototype.addClickEvent=function(e,t){$(e).click(function(e){return 2!==e.button&&(virtualViewer.getSplit()&&virtualViewer.setActivePane(0),virtualViewer.setPage(t),!1)}),$(e).on("contextmenu",function(e){e.preventDefault(),virtualViewer.getBookmarks().editBookmark(t)})},t.prototype.addXButton=function(e){for(var t=$("#vvBookmarksInternal")[0].children,a=0;a<t.length;a++){var n=parseInt(t[a].children[1].children[0].text.substring(7))-1;n===e&&$(t[a].children[1].children[1]).click(function(){return virtualViewer.getBookmarks().deleteBookmark(this,e),this.remove(),!1})}},t.prototype.deleteBookmark=function(t,i,o){try{var r,s=$("#vvBookmarksInternal")[0];if(0===s.children.length)throw r=e.getLocalizedValue("errors.pageHasNoBookmark","Page has no bookmark to delete.");var l=virtualViewer.getCurrentState();if(l.isVirtualDocument())throw"VirtualDocuments can't use Bookmarks";if(null===i||void 0===i){if(!this.bookmark)throw"Invalid Page or Bookmark.";i=this.bookmark.page}for(var u=!1,d=0;d<this.bookmarkArray.length;d++)if(this.bookmarkArray[d].page===i){u=!0;break}if(!u)throw r=e.getLocalizedValue("errors.pageHasNoBookmark","Page has no bookmark to delete.");var c=l.getDocumentModel();if(s&&t){var g=t.parentElement.parentElement,v=$(s).children().index(g);if(v<0||v>$(s).children().length)return;$($(s).children()[v]).remove(),v=this.bookmarkArray.length-(v+1),a.deletedBookmark=this.bookmarkArray.splice(v,1)[0],c.setBookmarksModifiedSinceInit(!0,l)}else if(s){for(var p=s.children,h=0;h<p.length;h++){var f=$(p[h]).html();f=f.substring(f.indexOf("Page:")+5,f.indexOf("</a>"));var m=parseInt(f)-1;if(m===i)break}$($(s).children()[h]).remove(),h=this.bookmarkArray.length-(h+1),a.deletedBookmark=this.bookmarkArray.splice(h,1)[0],this.clearBookmark(),c.setBookmarksModifiedSinceInit(!0,l)}}catch(e){return o||n(!0,e),!1}},t.prototype.cutBookmarks=function(e){var t=[],a=$("#vvBookmarksInternal")[0],n=virtualViewer.getCurrentState(),i=n.getDocumentModel();if(a){if((null===e||void 0===e)&&this.bookmark)return null;for(var o=a.children,r=0;r<e.length;r++){var s=e[r];if(this.bookmarkArray[s]){var l=this.bookmarkArray[s].note;if(null===l)return!1;for(var u=0;u<o.length;u++){var d=o[u].innerText,c=parseInt(d.substring(d.indexOf(":")+1,d.indexOf(l)))-1;if(c===s)break}$($(a).children()[u]).remove(),u=this.bookmarkArray.length-(u+1),t.push(this.bookmarkArray.splice(u,1)[0]),this.clearBookmark(),i.setBookmarksModifiedSinceInit(!0,n)}}return t}return null},t.prototype.clearBookmark=function(){this.bookmark={page:null,note:null}},t.prototype.clearAllBookmarks=function(){this.clearBookmark();for(var e=$("#vvBookmarksInternal")[0],t=e.children.length-1;t>=0;t--)$(e.children[t]).remove();this.bookmarkArray=[]},t.prototype.copyBookmark=function(e){var t={page:e.page,note:e.note};return t},t.prototype.loadBookmarks=function(e){if(null!==e&&void 0!==e||(e=virtualViewer.getCurrentState()),e.isVirtualDocument())return!1;this.clearAllBookmarks();var t=e.getDocumentModel(),a=t.model.bookmarks;for(var n in a)if(n){var i=parseInt(n);this.addBookmark(decodeURIComponent(a[i][0]),i,!0,!0)}this.orderBookmarks()},t.prototype.saveBookmarks=function(e){null!==e&&void 0!==e||(e=virtualViewer.getCurrentState());for(var t=e.getDocumentModel(),a={},n=0;n<this.bookmarkArray.length;n++){var i=this.bookmarkArray[n];a[i.page]=[encodeURIComponent(i.note)]}t.model.bookmarks=a},t.prototype.shiftBookmarks=function(e,t,a){for(var n=0;n<this.bookmarkArray.length;n++){var i=this.bookmarkArray[n].page;if(!(i<e))for(var o=0;o<t.length;o++)if(a)o=t.length,this.bookmarkArray[n].page+=o;else{if(i===t[o])break;this.bookmarkArray[n].page-=o+1}}this.orderBookmarks()},t.prototype.orderBookmarks=function(){for(var e=[],t=virtualViewer.getCurrentState(),a=0;a<t.pageCount;a++)for(var n=0;n<this.bookmarkArray.length;n++)this.bookmarkArray[n].page===a&&e.push(this.copyBookmark(this.bookmarkArray[n]));for(this.clearAllBookmarks(),a=e.length-1;a>=0;a--)this.addBookmark(e[a].note,e[a].page,!0,!0)},t.prototype.copyBookmarksForPageRange=function(e){for(var t=[],a=this.bookmarkArray.length-1;a>=0;a--)for(var n=this.bookmarkArray[a],i=0;i<e.length;i++)n.page===e[i]&&t.push(n);return t},t.prototype.switchTabs=function(e,t){e&&e.getDocumentModel()&&this.saveBookmarks(e),this.clearAllBookmarks(),t&&t.getDocumentModel()&&this.loadBookmarks(t)};var n=function(e,t){this.errorDialogTimeoutId&&clearTimeout(this.errorDialogTimeoutId),e?this.errorDialogTimeoutId=setTimeout(function(){a.currentExceptionDialog||($("#vvErrorIndicator").modal("show"),$("#vvErrorIndicatorText").html(t))},this.errorTimeoutTime):($("#vvErrorIndicator").modal("hide"),$("#vvErrorIndicatorText").html(" "))};return t}),define("vvStampManager",["vvUtility","user-config/config","vvDefines","user-config/toolbar-config"],function(e,t,a,n){function i(e){this.stampArray=[],this.currentImageRubberStamp=-1}return i.prototype.checkStampIntegrity=function(e){return!!e&&(!(!e.stampTitle||"string"!=typeof e.stampTitle)&&!!e.stampData)},i.prototype.getCurrentStamp=function(){return this.stampArray[this.currentImageRubberStamp]},i.prototype.pushStamp=function(e){return!!this.checkStampIntegrity(e)&&(this.stampArray.push(e),!0)},i.prototype.createStampImage=function(e,t,a){if(!e||!t)return null;var n={},i=document.createElement("canvas"),o=i.getContext("2d"),r=new Image;return r.src=e,r.crossOrigin="Anonymous",r.onload=function(){if(!r.complete)return null;n.stampWidth?i.width=n.stampWidth:n.stampWidth=i.width=r.width,n.stampHeight?i.height=n.stampHeight:n.stampHeight=i.height=r.height;try{o.drawImage(r,0,0,n.stampWidth,n.stampHeight);var e=i.toDataURL();n.stampData=e.substr(e.indexOf(",")+1)}catch(e){return null}},n.stampData=r,n.stampTitle=t,a&&(n.stampWidth=a.width,n.stampHeight=a.height),n},i.prototype.processStampArray=function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a];n.url&&n.stampTitle&&t.push(this.createStampImage(n.url,n.stampTitle,{width:n.width,height:n.height}))}return t},i.prototype.pushStampArray=function(e){if(!e)return!1;if(!e.length)return this.pushStamp(e),!0;for(var t=0;t<e.length;t++)this.pushStamp(e[t]);return!0},i.prototype.setStampArray=function(e){for(var t=0;t<e.length;t++)if(!this.checkStampIntegrity(e[t]))return!1;this.stampArray=e},i.prototype.clearStampArray=function(){this.stampArray=[]},i.prototype.clearStampDropdown=function(){$(".vvAnnImageRubberStamp ul.dropdown-menu").empty().hide(),this.clearStampArray()},i.prototype.createStampDropdown=function(e){if(n(virtualViewer).annotationToolbarButtons.vvAnnImageRubberStamp){if("Explorer"===BrowserDetect.browser&&BrowserDetect.version<9||!e||!e.length)return void $(".vvAnnImageRubberStamp").attr("aria-disabled","true");$(".vvAnnImageRubberStamp ul.dropdown-menu").empty(),this.addStampsToDropdown(e)}},i.prototype.addStampsToDropdown=function(e){var t=this;if(e){e.length||0===e.length||(e=[e]);var n;this.stampArray.length&&(n={startIndex:this.stampArray.length},Array.isArray(e)||(e=[e]));var i=$.templates("#vvStampDropdownItemTemplate"),o=$(i.render(e,n));o.appendTo(".vvAnnImageRubberStamp ul.dropdown-menu"),$(".vvAnnImageRubberStamp ul.dropdown-menu li").unbind("click"),$(".vvAnnImageRubberStamp ul.dropdown-menu li").on("click",function(){var e=$(this).data("stamp-row-index");t.currentImageRubberStamp=e,virtualViewer.turnOnAnnotationButton(a.annotationTypes.SANN_BITMAP,$(".vvAnnImageRubberStamp")),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu()}),this.pushStampArray(e),$(".vvAnnImageRubberStamp ul.dropdown-menu").css("display")&&$(".vvAnnImageRubberStamp ul.dropdown-menu").css("display","")}},i}),define("vvPreviewAnnotation",["user-config/config","vvDefines","vvUtility","annotations","vvBoundingBox","vvNoteBase","vvStateManager"],function(e,t,a,n,i,o,r){function s(){}return s.prototype=n.prototype,s.prototype.initPreview=function(n,s,l,u,d,c,g,v,p,h,f,m){var y=r.getActivePaneState(),b=virtualViewer.getUserPreferences();f||(f=y.getPageNumber()),m&&(this.pageHeight=m.pageHeight,this.pageWidth=m.pageWidth),this.pageHeight&&this.pageWidth||(this.pageHeight=y.pageStates[f].requestedHeight,this.pageWidth=y.pageStates[f].requestedWidth),this.type=n,this.box=s,this.lineColor=l,this.preview=!0,this.annDelete=!1,this.index=-1,this.isIDM=h,this.docDPI=p||72,this.page=f,this.annPreference=null,this.rotationAngle=0,this.xmlRotate=0,this.wrappedText=[],this.revisionHistory=[],this.currentRevision={},this.annPreference=b.getAnnotationPreference(this.type),this.createDate=a.toSnowDateString(new Date),this.modifyDate=a.toSnowDateString(new Date),this.createUser=b.username,void 0!==v&&null!==v?this.doubleByte=v:this.doubleByte=e.base64EncodeAnnotations;var A=n.indexOf("Filled");A!==-1&&(this.fillColor=u,this.type=n.slice(6,n.length)),this.type===t.annotationTypes.SANN_HIGHLIGHT_RECT?(this.fillColor=u,this.opacity=c,this.type=n.slice(9,n.length)):this.opacity=1,n===t.annotationTypes.SANN_CIRCLE&&(this.fillColor=u,this.box=new i(s.getX1(),s.getY1(),s.getWidth(),s.getWidth())),n===t.annotationTypes.SANN_FREEHAND&&(this.type=t.annotationTypes.SANN_LINE),n===t.annotationTypes.SANN_FILLED_POLYGON&&(this.type=t.annotationTypes.SANN_POLYGON),this.fontName=null,this.fontSize=0,this.fontBold=!1,this.fontItalic=!1,this.fontStrike=!1,this.fontUnderline=!1,this.fontColor=null,n!==t.annotationTypes.SANN_EDIT&&n!==t.annotationTypes.SANN_BUBBLE&&n!==t.annotationTypes.SANN_CLOUD_EDIT&&n!==t.annotationTypes.SANN_POSTIT||(this.setTextString(e.annotationDefaults.textString),this.setFontName(this.annPreference.fontFace),this.setFontSize(this.annPreference.fontSize),this.setFontBold(this.annPreference.bold),this.setFontItalic(this.annPreference.italic),this.setFontStrike(e.annotationDefaults.fontStrike),this.setFontUnderline(e.annotationDefaults.fontUnderline),this.setFontColor(this.annPreference.fontColor.toString())),n===t.annotationTypes.SANN_POSTIT&&(this.fillColor=this.annPreference.fillColor.toString()),d?this.setLineWidth(parseInt(d,10)):this.setLineWidth(1),g&&(this.pointArray=g,this.fixBoundingBox()),this.annotationTags=[],this.notes=new o,this.noteArray=[]},s}),define("vvCallbackManager",["vvUtility","vvStateManager"],function(e,t){function a(){var e={onDocumentLoad:null,saveDocument:null,saveAsDocument:null,uploadDocument:null,sendDocument:null,switchToTab:null,pageChange:null,pageCopied:null,pagePasted:null,pageDeleted:null,rotation:null,textSelect:null,imageLoadCompleted:null,overlayImageLoadCompleted:null,imageLoadRequested:null,annotationCreation:null,videoLoaded:null,switchBetweenTabs:null,saveDocumentError:null,requestDocumentModelError:null,saveUsername:null,saveTabPreferences:null,saveAnnotationPreferences:null,saveAnnotations:null,saveToolbarPreferences:null,saveCustomStamps:null,saveNoteTemplates:null,saveVideoPreferences:null,saveZoomPreferences:null,postLoadPreferencesVideo:null,onLoadUsername:null,annotationChanged:null,afterTabClosed:null,onShowSelectTextContextMenu:null},n={disableTextContextMenu:null,disablePageManipulationContextMenuOptions:null};a.prototype.init=function(){$("#externalCallbackCenter").length||$("<div id='externalCallbackCenter' style='width=0px; height=0px; display: none;'></div").appendTo("#virtualViewerMain"),$("#internalCallbackCenter").length||$("<div id='internalCallbackCenter' style='width=0px; height=0px; display: none;'></div").appendTo("#virtualViewerMain"),this.setInternalCallback("saveAsDocument",this.defaultSaveAsDocumentCallback),this.setInternalCallback("uploadDocument",this.defaultUploadDocumentCallback)},a.prototype.call=function(t,a){e[t]&&($("#internalCallbackCenter").trigger(t,a),$("#externalCallbackCenter").trigger(t,a))},a.prototype.callWithReturn=function(e,t){return n[e]&&"function"==typeof n[e]?n[e](t):null},a.prototype.setInternalCallback=function(e,t){return"function"==typeof t&&(!!r(e,t)||s(e,t))},a.prototype.setCallback=function(e,t){return"function"==typeof t&&(!!l(e,t)||s(e,t))},a.prototype.removeCallback=function(t,a){return!(!t||"string"!=typeof t||!n[t]&&!e[t])&&(!!i(t,a)||o(t))};var i=function(t,a){return!(!e[t]&&null!==e[t])&&($("#externalCallbackCenter").off(t),a&&$("#internalCallbackCenter").off(t),e[t]=null,!0)},o=function(e){return("function"==typeof n[e]||null===n[e])&&(n[e]=null,!0)},r=function(t,a){return!(null!==e[t]&&!e[t])&&(e[t]=!0,$("#internalCallbackCenter").on(t,function(e,t){a(t)}),!0)},s=function(e,t){return(null===n[e]||"function"==typeof n[e])&&(n[e]=t,!0)},l=function(t,a){return!(null!==e[t]&&!e[t])&&(e[t]=!0,$("#externalCallbackCenter").on(t,function(e,t){a(t)}),!0)};a.prototype.defaultSaveAsDocumentCallback=function(e){var a=virtualViewer.getStateForDocumentId(e.newDocumentId);if(a){if(!a.getClosedTab()){var n=a.getTabNumber();virtualViewer.closeTab(n,!0)}t.removeStateForDocumentId(a.documentId,a.currentPaneIndex),virtualViewer.removeFromRecentlyViewed({documentId:a.documentId})}virtualViewer.openInTab(e.newDocumentId),virtualViewer.requestDocumentList()},a.prototype.defaultUploadDocumentCallback=function(e){virtualViewer.openInTab(e.uploadedDocumentId),virtualViewer.requestDocumentList()}}return a}),define("webviewer",["require","vvUtility","vvWidgets","vvPoint","vvDocViewStateElement","vvDefines","vvBoundingBox","user-config/config","user-config/toolbar-config","vvAnnotationManager","vvStateManager","vvSearchManager","vvWatermarks","vvUserPreferences","vvThumbs","vvMagnifier","vvLayerManager","vvDocViewState","vvDocumentNotes","vvDocumentModel","vvDialogs","vvClickEventManager","vvBookmarks","vvStampManager","vvPreviewAnnotation","annotations","vvCallbackManager","vvPrintManager"],function(e,t,a,n,i,o,r,s,l,u,d,c){function g(){URI.escapeQuerySpace=!1,O=this,this.currentStamp=null,this.documentList=[],this.recentlyViewedList=[],this.newRecentlyViewedList=[],this.activeTab=0,this.tabs=[],this.shortTabNames=!1,this.viewerSessionID="",this.scrollingLocked=!1,this.imageBufferTop=[],this.redactionWarningShown=!1,this.pageManipulationsEnabled=!0,this.annotationsEnabled=!0,this.redactionsEnabled=!0,this.ocrEnabled=!1,this.disableUploadDocument=null,this.overrideLoggingLevel=!1,this.verticalGuide={locked:!1,visible:!1,value:0},this.horizontalGuide={locked:!1,visible:!1,value:0},this.currentPointArray=[],this.clientInstanceId=null}function v(){var e=null;return e=s.zoomLevels?s.zoomLevels:o.defaultZoomLevels}function p(e){for(var t=v(),a=0;a<t.length;a++){var n=t[a];if(n>e)return n}return t[t.length-1]}function h(e){for(var t=v(),a=t.length-1;a>-1;a--)if(candidateZoom=t[a],candidateZoom<e)return candidateZoom;return t[0]}function f(e){var t=["documentId","documentDisplayName","documentByteSize","pageCount","documentFormat"],a=$.inArray(e,t)>-1;return a}function m(e,t){var a,n;if("pageCount"===e)return t.getPageCount();if("documentDisplayName"===e)return t.getDisplayName();if("documentByteSize"===e){var i=t.getDocumentByteSize();return i&&(i=i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),i}if("documentId"===e)return t.getDocumentId();if("dpi"===e)return t.getDPIForPage(t.pageNumber);if("compressionType"===e){var o=t.getCompressionTypeForPage(t.pageNumber);return o||(o="N/A"),o}if("bitDepth"===e)return t.getBitDepthForPage(t.pageNumber);if("pageNumber"===e)return t.pageNumber+1;if("documentFormat"===e)return t.getFormatForPage(t.pageNumber);if(0===e.indexOf("tiffTag")){var r=t.getTiffTag(t.pageNumber,e);return r?y(e,r):"N/A"}if("imageSizePixels"===e)return a=t.getOriginalWidthForPage(t.pageNumber),n=t.getOriginalHeightForPage(t.pageNumber),""+a+" x "+n;if("imageSizeInches"===e){var s=t.getDPIForPage(t.pageNumber);a=t.getOriginalWidthForPage(t.pageNumber),n=t.getOriginalHeightForPage(t.pageNumber);var l=a/s,u=n/s;return""+l.toFixed(2)+" x "+u.toFixed(2)+" inches"}}function y(e,t){var a=o.tiffTagValueHash[e];if(a){var n=a[t];if(n)return n}return t}function b(e){var t=s.maxInfoFieldLength||128,a=""+e;return a.length<t?a:jQuery.trim(a).substring(0,t)+"..."}function A(e,a,n,i){if(!i){if(e.y<n.top&&a.y>n.bottom)return!0;if(e.y<n.bottom&&a.y>n.bottom&&e.x<n.right)return!0;if(a.y>n.top&&a.y<n.bottom&&e.y<n.top&&n.left<a.x)return!0}var o=new t.ImageRect(Math.min(e.x,a.x),Math.min(e.y,a.y),Math.max(e.x,a.x),Math.max(e.y,a.y));return o.intersects(n)}function P(e){""!==$.trim(e)&&($("#vvClipboardTextarea").html(e),$("#vvClipboard").modal("show"),$("#vvClipboard").focus(function(e){$("#vvClipboardTextarea").select()}))}function T(e,t,a,n){var i=.7,o=i,r=2,s=a.top-t.top,l=t.bottom-t.top,u=Math.floor(s/(l*o)),d=0;if(a.left<t.left&&(d=1),u=Math.max(u,d),u=Math.min(u,r),u!==1/0)for(var c=0;c<u;c++)e+="\n";return u>0&&(e=S(e,a,n)),e}function S(e,t,a){var n=.355,i=t.bottom-t.top,o=i*n,r=t.left,s=r-a,l=Math.round(s/o);if(o>0)for(var u=0;u<l;u++)e+=" ";return e}function w(e,t,a){var n=.1272,i=.355,o=a.top-t.top,r=a.bottom-t.bottom,s=t.bottom-t.top,l=a.bottom-a.top,u=Math.min(s,l),d=u*n,c=u*i,g=Math.floor(o/u),v=Math.floor(r/u);if(g>0&&v>0)return e;var p=t.right,h=a.left,f=h-p,m=0;if(c>0&&f>d){m=1;var y=Math.round((f-2.6*d)/c);m+=y}else m=0;for(var b=0;b<m;b++)e+=" ";return e}function I(e){if(!(virtualViewer.verticalGuide.locked&&virtualViewer.horizontalGuide.locked||(e||(e=window.event),se.getDragMode()!==o.dragModes.guides))){var t=d.getCurrentState(0),a=$(e.target).closest(".vvOuter");"vvSplit1Panel"===a.attr("id")&&(t=d.getCurrentState(1));var i=a.find(".vvCanvas").offset(),r=i.top,s=i.left,l=new n(e.clientX,e.clientY-r),u=Math.max(se.clickPageFinder(t,l,a),0);if(virtualViewer.verticalGuide.locked||(virtualViewer.verticalGuide.value=Math.max(e.clientX-s,1)),!virtualViewer.horizontalGuide.locked){var c=virtualViewer.getVisualPageTop({page:u,state:t}),g=l.getY()-c;virtualViewer.horizontalGuide.value=Math.max(g,1)}O.paintCanvases()}}function C(){var e=s.hotkeys;if(e){var t=function(e){for(var t=0;t<e.length;t++)!function(t){D(e[t].key,function(a){return a.preventDefault(),e[t].method(),!1})}(t)};t(e);var a=s.customHotKeys;if(a){var n=function(e){for(var t=0;t<e.length;t++)!function(t){D(e[t].key,function(a){return a.preventDefault(),e[t].method(),!1})}(t)};n(a)}}}function D(e,t){if(e)for(var a=e.split(","),n=0;n<a.length;n++){var i=a[n];_[i]===i&&alert(i+" has been detected as a duplicate keyboard shortcut"),_[i]=i;var o=B(i);if(N(i)&&!M(i)){var r=V(i);x(o,r,t)}else jQuery(document).bind(o,i,t)}}function x(e,t,a){$(document).bind(e,function(e){e.shiftKey&&e.ctrlKey&&L(t,e.keyCode)&&a(e)})}function M(e){var t=k(e);return!!o.specialKeys[t]}function N(e){return 0===e.indexOf("ctrl+shift")}function L(e,t){var a={187:61,189:173};return e===t||e===a[t]}function V(e){var t=k(e);if("="===t)return 61;if("plusKeypad"===t)return 107;if("minusKeypad"===t)return 109;if("-"===t)return 173;var a=t.charCodeAt(0)-32;return a}function k(e){var t=e.split("+"),a=t[t.length-1];return a}function B(e){return"keydown"}function R(){if(!s.hotkeys)return"";for(var e=[],a=0;a<Math.ceil(s.hotkeys.length/2);a++)e.push([s.hotkeys[a].key,t.getLocalizedValue(s.hotkeys[a].localizedValue,s.hotkeys[a].defaultValue)]);for(var n=[],i=Math.ceil(s.hotkeys.length/2);i<s.hotkeys.length;i++)n.push([s.hotkeys[i].key,t.getLocalizedValue(s.hotkeys[i].localizedValue,s.hotkeys[i].defaultValue)]);var o="";o+='<div class="vvKeyboardHintsContents">',o+='<table width=100% class="vvKeyboardHintsMasterTable"><tr><td valign=top>',o+='<table width=100% class="vvKeyboardHintsSubTable">';for(var r=null,l=null,u=null,d=0;d<e.length;d++)u=d%2===0?"vvKeyboardHintsOddRow":"vvKeyboardHintsEvenRow",r=e[d][0],l=e[d][1],r&&l&&(o+="<tr class='"+u+"'><td>"+E(r)+"</td><td>"+l+"</td></tr>");o+="</table></td>",o+='<td class="vvKeyboardHintsGap"></td>',o+='<td valign=top><table width=100% class="vvKeyboardHintsSubTable">';for(var c=0;c<n.length;c++)u=c%2===0?"vvKeyboardHintsOddRow":"vvKeyboardHintsEvenRow",r=n[c][0],l=n[c][1],r&&l&&(o+="<tr class='"+u+"'><td>"+E(r)+"</td><td>"+l+"</td></tr>");return o+="</table></td></tr>",o+="</table>",o+="</div>"}function F(e){var t=e,a=o.specialKeys[e];return a&&(t=a),t="<span class='keyboardkey'>"+t+"</span>"}function E(e){if(!e)return"N/A";e=e.replace("++","+plus");for(var t=e.split(","),a=t[0],n="",i=a.split("+"),o=0;o<i.length;o++){var r=i[o];n+=F(r),o!==i.length-1&&(n+=" ")}return n=n.replace("plus","+")}var O,_={},U=!1,W=0,z=null,H=0,Q=0,j=0,q=0,G=0,Y=null,X=null,Z=null,K=null,J=null,ee=null,te=null,ae=!1,ne=null,ie=null,oe=null,re=null,se=null,le=null,ue=null,de=null,ce=[],ge=!1,ve=!1,pe=0,he=0,fe=0,me=0,ye=0,be=null,Ae=null,Pe=!1,Te=null,Se="",we=s.guideLineWidth||2,Ie=s.activeGuideColor||"#000099",Ce=s.lockedGuideColor||"#990000",De=s.panIncrement||30;g.prototype.init=function(a){if(!ie||!re){window.addEventListener("message",Ne,!1),C(),$("[data-localize]").localize("vv",o.localizeOptions),$.views.converters("decodeUri",function(e){return decodeURIComponent(e)}),O.pageManipulationsEnabled=s.pageManipulations,this.initToolbar(),ie=e("vvUserPreferences"),ie.init(),xe(),W=this.getScrollbarWidth(),this.getServerConfig(),this.validateZoomLevels();var n=document.getElementById("vvOuterDiv");Modernizr.touchevents&&(s.imageScrollBars=!1,$(document).on("orientationchange",function(){e("vvThumbs").loadVisibleThumbs()}),Me()),$("[title]").each(function(e){var t=$(this).attr("title");t=$("<div />").html(t).text(),$(this).attr("title",t)}),t.enableTooltips(),$("#vvBookmarks").contextmenu(function(){return!1}),$e(),re=e("vvMagnifier"),re.initMagnifier(),O.checkPageManipulationsEnabled()&&(o.cacheBuster=!0),s.imageScrollBars===!0?n.style.overflow="auto":n.style.overflow="hidden",document.body.onmousedown=function(e){if(1===e.button)return!1},"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&(o.cacheBuster=!0),$("#vvNotesTab").click(function(){var e=O.getCurrentState();e&&!e.isVirtualDocument()&&$("#vvDocumentNotes").css("visibility","visible")}),oe=new(e("vvDocumentNotes")),ne=new(e("vvBookmarks")),se=e("vvClickEventManager"),le=new(e("vvCallbackManager")),ue=new(e("vvStampManager")),se.initEvents(),le.init(),_e(),ze(),He(),Ge(),c.prepareSearch(),Xe(),Ze(),Je(),et(),at(),Oe(),Ft(),Oa(),"Explorer"===BrowserDetect.browser&&BrowserDetect.version>8&&BrowserDetect.version<11?$("#vvImageCanvas").contextMenu("vvSelectTextContextMenu",nt):$("#vvDummyScroller").contextMenu("vvSelectTextContextMenu",nt),tt(),this.setDragMode(o.dragModes.pan),"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&$(n).on("dragstart",function(){return!1}),$("body").on("contextmenu",function(e){e.target&&"VIDEO"===e.target.tagName||e.preventDefault()}),$("body").click(function(e){var t,a=$("#vvNewDocumentDialog").data("bs.modal")&&$("#vvNewDocumentDialog").data("bs.modal").isShown;if(0===$(e.target).closest(".thumbPanel").length&&!a){if(!a){var n=d.getActivePaneState();n&&(t=n.getDocumentModel())}t&&t.clearPageSelection()}}),$("#vvAnnButtonContainer button").on("click",function(){var e=d.getCurrentState(0);if(e){var t=e.getDocumentModel();t&&t.clearPageSelection()}}),$("#vvPageThumbs").scroll(sa),$("#vvDocThumbs").scroll(sa),$("#vvSearchResults").scroll(sa),$("#vvDocumentNotes").scroll(sa),
this.viewerSessionID=t.vvGUID(),document.addEventListener("dragend",function(){virtualViewer.dragging=!1,ra()}),$(document).bind("drag",ra),document.addEventListener("drop",function(e){e.preventDefault(),ra()}),$(window).resize(O.processWindowResize),$("#vvOuterDiv").on("scroll",function(){var e=O.getCurrentState();e&&(O.paintCanvases(e),0===O.getActivePane()||virtualViewer.scrollingLocked||O.setActivePane(0))}),$("#vvOuterDiv").on("scroll",function(){var e=O.getCurrentState();if(e&&!virtualViewer.skipScrollEvent){var t=Zt(e);e.getPageNumber()!==t&&t<e.pageCount&&t>=0&&O.updatePage(t,e)}else virtualViewer.skipScrollEvent=!1}),$("#vvOuterDiv").on("scroll",function(){if(virtualViewer.scrollingLocked){var e=$("#Split1 .vvOuter");if(e.length){var t=$(this);be&&clearTimeout(be),be=setTimeout(function(){Ta(t,e)},5),Math.abs($(this).scrollTop()-me)>=100&&Ta(t,e)}}});var i=ue.processStampArray(s.initialStamps||[]);ue.addStampsToDropdown(i),s.showDocThumbnails!==!0&&s.showPageThumbnails!==!0||this.requestDocumentList(),a&&this.openInTab(O.getDocumentId(0)),s.unsavedChangesNotification&&$(window).bind("beforeunload",function(){for(var e=d.getAllStates(),a=0;a<e.length;a++){var n=e[a].getDocumentModel();if(n.getModifiedSinceInit())return t.getLocalizedValue("browserClose.message","You have unsaved changes in this session.")}}),$("#vvNavOptions").on("change",function(){if("redaction"===$("input[name='radio']:checked").val()){$("#vvAnnotationThumbsButton").prop("disabled",!0).addClass("disabled");var e=St(!0);0===e.length?xt():(Mt(),O.navigationButtonHandler(!0))}else{var t=O.pagesWithAnnotations();$("#vvAnnotationThumbsButton").prop("disabled",!1).removeClass("disabled");var a=St(!1);0===a.length?xt():t.length<=1?($("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled"),$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled")):(Mt(),O.navigationButtonHandler(!1))}}),$("#vvPrevAnnotationButton").on("click",function(e){O.navigationChangeHandler(e)}),$("#vvNextAnnotationButton").on("click",function(e){O.navigationChangeHandler(e)}),$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled")}},g.prototype.initViaURL=function(){var e=gt("documentId");e&&O.setDocumentId(decodeURIComponent(e)),"string"!=typeof this.getClientInstanceId()&&this.setClientInstanceId(this.parseClientInstanceId());var a=gt("openerHistoryBack");"true"===a&&window.opener.history.back(1),this.init(!0);var n=gt("pageNumber");n&&window.setTimeout(function(){virtualViewer.setPage(+n)},400),t.makeUnselectable(document.getElementById("vvToolbar")),t.makeUnselectable(document.getElementById("vvAnnToolbar")),t.makeUnselectable(document.getElementById("vvDummyScroller"))},g.prototype.initSpecifiedDocuments=function(e){for(var t=0;t<e.length;t++)this.documentList[t]={},e[t].documentId?(this.documentList[t].documentId=e[t].documentId,this.documentList[t].displayName=e[t].displayName):(this.documentList[t].documentId=e[t],this.documentList[t].displayName=null);var a=gt("openerHistoryBack");"true"===a&&window.opener.history.back(1),this.init(!1),this.documentList[0]&&this.openInTab(this.documentList[0].documentId)},g.prototype.openSpecifiedDocuments=function(e){for(var t=e||this.documentList,a=Math.min(t.length,o.maxNumberOfTabs),n=0;n<a;n+=1)t[n].documentId?this.openInTab(t[n].documentId):this.openInTab(t[n])};var xe=function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var a=t||0,n=this.length;a<n;a++)if(this[a]===e)return a;return-1})},Me=function(e){var t;t=e?e.find(".vvScroller")[0]:$("#vvDummyScroller")[0];var a=new Hammer(t);a.get("pinch").set({enable:!0}),a.on("doubletap",function(e){var t=virtualViewer.getCurrentAnnObject();t&&O.annPopUpHandler(null,t)}),a.get("press").set({enable:!0,threshold:4}),a.on("press",function(e){var t=virtualViewer.getCurrentAnnObject();t||$(e.target).trigger($.Event("contextmenu",{pageX:e.center.x,pageY:e.center.y,clientX:e.center.x,clientY:e.center.y}))}),a.on("pinchin",function(e){var t=e.pointers[0].clientX-e.pointers[1].clientX,a=e.pointers[0].clientY-e.pointers[1].clientY;se.previousPinchDistance=Math.sqrt(Math.pow(t,2)+Math.pow(a,2))}),a.on("pinchout",function(e){var t=e.pointers[0].clientX-e.pointers[1].clientX,a=e.pointers[0].clientY-e.pointers[1].clientY;se.previousPinchDistance=Math.sqrt(Math.pow(t,2)+Math.pow(a,2))}),a.on("pinchmove",function(e){var t=d.getActivePaneState(),a=t.getZoomDecimal(),n=e.pointers[0].clientX-e.pointers[1].clientX,i=e.pointers[0].clientY-e.pointers[1].clientY,o=Math.sqrt(Math.pow(n,2)+Math.pow(i,2)),r=o/se.previousPinchDistance;if(!(r>.98&&r<1.02)){se.previousPinchDistance=o;var s=r*a,l={clientX:e.center.x,clientY:e.center.y},u=se.clickPointConverter(l,t,!1);u.x=u.x*r,u.y=u.y*r,virtualViewer.zoomToLocation(100*s,u.x,u.y)}})},Ne=function(e){var a,n=t.getLocalizedValue("errors.malformedJsonInMessage","VirtualViewer received an invalid command.");try{a=JSON.parse(e.data)}catch(e){return console.error(n),Promise.resolve(e)}switch(a.method){case"openInTab":virtualViewer.openInTab(a.id||a.documentId);case"compareDocuments":virtualViewer.compareDocuments(a.firstDocumentId,a.secondDocumentId,a.options);default:return Promise.resolve(e)}};g.prototype.getOriginalPageDimensions=function(){if(!Za({state:!0}))return{};var e=O.getActivePaneState(),t=virtualViewer.scrollPageFinder(e),a=e.pageStates[t].originalHeight,n=e.pageStates[t].originalWidth;return{height:a,width:n}},g.prototype.splitScreen=function(a,n){if(!s.splitScreen)return void virtualViewer.displayExceptionMessage(t.getLocalizedValue("errors.splitScreenDisabled","Document Comparison has been disabled by the administrator."));n=n||"horizontal";var i=1,r=d.getOpenDocumentId(i),l=d.getCurrentState(0);if(!l)return void O.showSplitNotAllowedDialog();var u=O.getFromDocumentList(a);if(!u){var c=t.getLocalizedValue("errors.documentNotFound","Document not found: ")+a;return void O.displayExceptionMessage(c)}if(t.dumbVideoExtensionCheck(u.documentId)||t.dumbVideoExtensionCheck(l.documentId)||t.dumbVideoExtensionCheck(u.displayName)||t.dumbVideoExtensionCheck(l.getDisplayName()))return void virtualViewer.displayExceptionMessage(t.getLocalizedValue("errors.splitVideoError","Document comparison is unsupported for video files."));O.destroyInProgressAnnotation(),r&&(d.getStateForDocumentId(r,i).setClosedTab(!0),d.removeStateForDocumentId(r,i)),ve||(Le(n),"Explorer"===BrowserDetect.browser&&BrowserDetect.version>8&&BrowserDetect.version<=11?$("#vvSplitCanvas").contextMenu("vvSelectTextContextMenu",nt):$("#vvSplitScroller").contextMenu("vvSelectTextContextMenu",nt),$("#vvSplit1Panel").on("scroll",function(){var e=d.getCurrentState(1);e&&(O.paintCanvases(e),0!==O.getActivePane()||O.scrollingLocked||O.setActivePane(1))}),$("#vvSplit1Panel").on("scroll",function(){var e=d.getCurrentState(1);if(e&&!virtualViewer.skipScrollEvent){var t=Zt(e,!1,"#vvSplit1Panel");e.getPageNumber()!==t&&t<e.pageCount&&t>=0&&O.updatePage(t,e)}else virtualViewer.skipScrollEvent=!1}),$("#vvSplit1Panel").on("scroll",function(){if(virtualViewer.scrollingLocked){var e=$("#Split0 .vvOuter");if(e.length&&(e.scrollTop()!==$(this).scrollTop()||e.scrollLeft()!==$(this).scrollLeft())){var t=$(this);be&&clearTimeout(be),be=setTimeout(function(){Ta(t,e,!0)},5),Math.abs($(this).scrollTop()-he)>=100&&Ta(t,e,!0)}}}),se.initEvents($("#vvSplit1Panel")),"Explorer"===BrowserDetect.browser&&BrowserDetect.version>8&&BrowserDetect.version<=11?$("#vvSplitCanvas").bind("contextmenu",O.annPopUpHandler):$("#vvSplitScroller").bind("contextmenu",O.annPopUpHandler),Modernizr.touchevents&&Me($("#vvSplit1Panel")));var g=d.openNewState({documentId:a,pageNumber:0,tabNumber:this.tabs.length,zoomMode:ie.getDefaultZoomMode(),paneIndex:i,displayName:u.displayName});ve=!0,O.setActivePane(i),d.setDisplayedState(g,i),g.setClosedTab(!1),se.setDragMode(o.dragModes.pan),this.requestDocumentModel(g),s.multipleDocMode===o.multipleDocModes.viewedDocuments&&e("vvThumbs").loadVisibleThumbs($("#vvDocThumbs")),virtualViewer.paintCanvases(g),re.getMagnifierEnabled()&&(re.toggleMagnifier(),re.initMagnifier(),re.toggleMagnifier()),ie.applyZoomPreferences(g),virtualViewer.sizeScroller({state:d.getCurrentState(0)}),d.getCurrentState(0).isVideo()&&d.getCurrentState(0).getVideoManager().resizeVideo()};var Le=function(e){for(var a,n,i,o=s.screenSizes||[50,50],r=o.length,l=[],u=$("#vvSplitPaneDiv"),c=0;c<r;c++)a="#Split"+c,l.push(a);for(c=0;c<l.length;c++)n=$("<div></div>").attr("id",l[c].replace("#","")).addClass("split split-"+e+" vvActivePane"),u.append(n);if(0!==l.length){var g=Split(l,{sizes:s.screenSizes||[50,50],direction:e,onDrag:virtualViewer.paintCanvases});d.setSplit(g),$("#Split0").append($("#vvOuterDiv")),i=$("<div></div>").addClass("vvOuter"),i.attr("id","vv"+l[1].replace("#","")+"Panel"),$(i).width($("#Split1").width()),$(i).height($("#Split1").height()),$("#Split1").append(i);var v=$("<div></div>");$(v).attr("id","vvSplitScroller"),$(v).addClass("vvScroller"),$(i).append(v),s.imageScrollBars===!0?$(i).css({overflow:"auto"}):($(i).css({scroll:"hidden"}),$(i).css({overflow:"hidden"}));var p=$("<div></div>");$(p).attr("id","vvInnerSplitDiv"),$(p).addClass("vvInner"),$(i).append(p);var h=$("<canvas></canvas>");$(h).attr("id","vvSplitCanvas"),$(h).addClass("vvCanvas"),$(p).append(h);var f=$("<div id='vvSplitCloseButton'><button id='vvSplitCloseX' class='close'>&times;</button>&nbsp;</div>").append($("<span id='vvSplitCloseText'></span>").text(t.getLocalizedValue("closeSplitButton.buttonText","Close"))).on("click",function(){var e=d.getCurrentState(1);if(e){var t=e.documentModel;t.getModifiedSinceInit()?O.confirmCloseDialog(e):O.undoSplitScreen()}});f.appendTo(v)}};g.prototype.isInDocumentList=function(e){return!!virtualViewer.getFromDocumentList(e)},g.prototype.getFromDocumentList=function(e){for(var t=this.documentList,a=0;a<t.length;a++)if(t[a].documentId===e)return t[a];return null},g.prototype.isOnImage=function(e){var t=d.getActivePaneState(),a=t.getPageNumber(),n=t.pageStates[a].requestedWidth;return!(e.x<0||e.x>n)},g.prototype.showSplitNotAllowedDialog=function(){$("#vvSplitNotAllowedDialog").modal("show")},g.prototype.getSplitDocumentId=function(){return d.getOpenDocumentId(1)},g.prototype.getActivePane=function(){return pe},g.prototype.setActivePane=function(e){e=e||0,e=parseInt(e,10);var t=!1;return pe!==e&&(t=!0),pe=e,d.setActivePane(e),O.indicateActivePane(e),t&&Ve(e),t},g.prototype.getSplitObjects=function(){return d.splitInstance},g.prototype.getSplit=function(){return ve},g.prototype.getActivePaneState=function(){return d.getActivePaneState()},g.prototype.getActiveOuterDiv=function(){var e=O.getActivePane();return 1===e?$("#vvSplit1Panel"):$("#vvOuterDiv")},g.prototype.getOuterDivFromState=function(e){return d.getOuterDivFromState(e)};var Ve=function(e){1===e?($(".thumbTabs").addClass("disabled disabledTab"),$("#vvDocThumbsTab, #vvDocCompareTab").removeClass("disabled disabledTab"),$("#vvMagnifierButton").attr("aria-disabled",!0),$(".thumbTabs.active.disabled").length&&virtualViewer.openDefaultThumb()):$(".thumbTabs").hasClass("disabled disabledTab")&&($(".thumbTabs").removeClass("disabled disabledTab"),$("#vvMagnifierButton").attr("aria-disabled",!1))};g.prototype.indicateActivePane=function(e){if(!ve)return void $(".vvActivePane").removeClass("vvActivePane");var t=e;$(".vvActivePane").removeClass("vvActivePane"),$("#Split"+t).addClass("vvActivePane");var a=d.getActivePaneState();Sa(a)},g.prototype.undoSplitScreen=function(){if($("#vvDocCompare.active").length&&O.openDefaultThumb(),$("#vvDocCompare, #vvDocCompareTab").removeClass("active"),$("#vvDocCompareTab").hide().removeClass("vvAllowedTab"),Oa(),ve){var e=d.getCurrentState(1);if(Za({state:!0},e)){O.destroyInProgressAnnotation(),e.setClosedTab(!0),d.removeStateForDocumentId(e.getDocumentId(),1),$("#vvSplitPaneDiv").append($("#vvOuterDiv")),d.splitInstance.destroy(),$(".split").remove(),$("#vvOuterDiv").eq(0).css({height:"100%",width:"100%"}),Ve(0),ve=!1,O.setActivePane(0);var t=d.getCurrentState(0);O.lockScrolling(!1),O.clearCanvases(t),O.delayedPaintCanvases(t)}}};var $e=function(){$("#vvDummyScroller").bind("contextmenu",O.annPopUpHandler)},ke=function(){if("true"!==$(this).attr("aria-disabled")){if($(this).hasClass("selectedAnn"))return void virtualViewer.disableStickyAnnotationButton();if($(this).hasClass("vvHasSubDropdown")||$(this).parent("li").hasClass("vvHasSubDropdown"))return void $(this).parent("li").siblings("li.vvToolbarItem.vvHasSubDropdown").find("ul.dropdown-menu").hide();var e=$(this).data("button-id");if(!e)return void $(this).parent("li").find(".vvHasSubDropdown ul.dropdown-menu").hide();var t,a=l(virtualViewer);if(t=$(this).parent("li").hasClass("vvAdvancedSaveOptions")?Ee()[e]:a.imageToolbarButtons[e],t||(t=a.annotationToolbarButtons[e]),t&&(t.clickHandler||t.annType)){var n,i=t.clickHandler;if(!i&&t.annType&&(n=t.annType,i=function(){virtualViewer.turnOnAnnotationButton(n,$("."+e))}),!$("#vvImageAndThumbs:visible").length)return virtualViewer.toggleHamburgerMenu(),void i.call(virtualViewer);var o=$(this).parents(".dropdown");return o.length?void o.on("hidden.bs.dropdown",function(){$(this).off("hidden.bs.dropdown"),i.call(virtualViewer)}):void i.call(virtualViewer)}}},Be=function(e,a){for(var n in e)e[n]&&(e[n].localizeKey&&(e[n].name=t.getLocalizedValue(e[n].localizeKey)),e[n].annotationToolbar=a);e.vvSaveDocument&&s.enableAdvancedSaveMenu&&(e.vvSaveDocument.hasSubMenu=!0),e.vvAnnText&&s.enableTextRubberStamp&&(e.vvAnnText.hasSubMenu=!0),e.vvAnnImageRubberStamp&&(e.vvAnnImageRubberStamp.hasSubMenu=!0);for(var i=$($("#vvGenericToolbarItem").render(e)),o=0;o<i.length;o++){var r=$(i[o]).data("group");r&&l(g).toolbarButtonLogicalGroups[r]?$(i[o]).appendTo("."+r).hide().show():a?$(i[o]).appendTo($("#vvUncategorizedAnnToolbarItems")):$(i[o]).appendTo($("#vvUncategorizedToolbarItems")),a&&$(i[o]).clone().appendTo("#vvAnnToolbarHamburgerItems").addClass("hidden-sm hidden-md hidden-lg")}},Re=function(){$("#vvThumbToggleButton").on("click",virtualViewer.toggleThumbnailPanel),$("#vvToolbarHamburger").on("click",virtualViewer.toggleHamburgerMenu),$("a.vvToolbarItem").on("click",ke),$("a.vvToolbarItem").on("click",function(e){if(virtualViewer.getEventManager().dragging||"true"===$(this).attr("aria-disabled"))return void e.stopImmediatePropagation()}),$("form.vvJumpToPage").on("submit",function(e){return e.preventDefault(),$(this).blur(),!1}),$(".vvJumpToPageInput").bind("click",function(e){"true"!==$(".vvJumpToPage").attr("aria-disabled")&&$(this).select()}),"Explorer"===BrowserDetect.browser&&$(".vvJumpToPageInput").on("keypress",function(e){13===e.keyCode&&$(this).blur()}),$(".vvJumpToPageInput").on("change",function(e){if("true"!==$(".vvJumpToPage").attr("aria-disabled")){var t=parseInt($(this).val(),10);wa(t-1)&&($("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu(),O.setPage(t-1))}}),$("#vvMidSizeToolbarItems .vvHasSubDropdown, #vvMidSizeAnnToolbarItems .vvHasSubDropdown").on("click",function(e){$(this).find('a[data-toggle="dropdown"]').length&&($(this).find(".dropdown-menu").children().length>0&&$(this).find(".dropdown-menu").toggle(),e.stopPropagation(),e.preventDefault())}),$("#vvMidSizeAnnToolbarItems > .dropdown").on("click",function(){$(this).hasClass("selectedAnn")&&virtualViewer.disableStickyAnnotationButton()}),$("#vvAnnToolbar li.vvToolbarItem > a > .icon").data("placement","right"),$("a.vvToolbarItem, #vvToolbarHamburger, #vvThumbToggleButton, .vvToolbarButton, .vvDiffButton").mousedown(function(e){1===e.which&&$(this).addClass("mouseDown")}),$("a.vvToolbarItem, #vvToolbarHamburger, #vvThumbToggleButton, .vvToolbarButton, .vvDiffButton").mouseup(function(e){1===e.which&&$(this).removeClass("mouseDown")}),$("a.vvToolbarItem, #vvToolbarHamburger, #vvThumbToggleButton, .vvToolbarButton, .vvDiffButton").mouseleave(function(){$(this).removeClass("mouseDown")})};g.prototype.initToolbar=function(){var e=l(virtualViewer),a=e.toolbarButtonLogicalGroups;for(var n in a)a[n]&&a[n].localizeKey&&(a[n].groupTitle=t.getLocalizedValue(a[n].localizeKey));for(var i=$($("#vvGenericGroupItem").render(a)),o=0;o<i.length;o++){var r=$(i[o]);r.hasClass("vvMidAnnotationToolbarGroup")?$("#vvMidSizeAnnToolbarItems").append(r):r.hasClass("vvMidImageToolbarGroup")?$("#vvMidSizeToolbarItems").append(r):r.hasClass("vvImageToolbarGroup")?$("#vvMidSizeToolbarItems").before(r):r.hasClass("vvAnnotationToolbarGroup")&&$("#vvMidSizeAnnToolbarItems").before(r)}Be(e.imageToolbarButtons),Be(e.annotationToolbarButtons,!0),Fe(),$(".vvToolbarItem.vvEndSubGroup").after($("<span></span>").addClass("hidden-xs vvSubGroupSeparator")),Re(),$("#vvToolbarItems").addClass("overflowScroll")},g.prototype.toggleHamburgerMenu=function(e){e&&e.stopImmediatePropagation(),$("#vvToolbarItems").toggle(),"true"===$("#vvToolbarItems").attr("aria-expanded")?($("#vvImageAndThumbs").show(),$("#vvToolbarItems").attr("aria-expanded","false")):($("#vvImageAndThumbs").hide(),$("#vvToolbarItems").attr("aria-expanded","true"),virtualViewer.disableStickyAnnotationButton())};var Fe=function(){if(s.enableAdvancedSaveMenu){var e=Ee();for(var a in e)e[a]&&e[a].localizeKey&&(e[a].name=t.getLocalizedValue(e[a].localizeKey));var n=$($("#vvGenericToolbarItem").render(e)).addClass("vvAdvancedSaveOptions");n.appendTo("li.vvSaveDocument ul.dropdown-menu")}else $(".vvSaveDocument.vvHasSubDropdown, .vvSaveDocument.dropdown").removeClass("vvHasSubDropdown dropdown"),$("a.vvSaveDocument.dropdown-toggle").attr("data-toggle","")},Ee=function(){return{vvAdvancedSave:{clickHandler:virtualViewer.saveDocument,localizeKey:"utilityToolbar.saveDocument.saveMenuOption"},vvAdvancedSaveRedactions:{clickHandler:function(){var t=function(){virtualViewer.getDocumentModel().setPagesModifiedSinceInit(!0),virtualViewer.saveDocument(null,{burnRedactions:!0,includeRedactionTags:!0})};s.enableAdvancedSaveWarning?e("vvDialogs").permanentChangeDialog(t):t()},localizeKey:"utilityToolbar.saveDocument.saveWithRedactionsMenuOption"},vvAdvancedSaveRedactionsAnnotations:{clickHandler:function(){var t=function(){virtualViewer.getDocumentModel().setPagesModifiedSinceInit(!0),virtualViewer.saveDocument(null,{burnRedactions:!0,includeRedactionTags:!0,includeTextAnnotations:!0,includeNonTextAnnotations:!0,copyAnnotations:!1})};s.enableAdvancedSaveWarning?e("vvDialogs").permanentChangeDialog(t):t()},localizeKey:"utilityToolbar.saveDocument.saveWithRedactionsAnnotationsMenuOptions"}}};g.prototype.validateZoomLevels=function(){var e=!0;if(s.zoomLevels)for(var t=0;t<s.zoomLevels.length;t++){var a=s.zoomLevels[t];t>0&&a<=s.zoomLevels[t-1]&&(e=!1),a<=0&&(e=!1)}else e=!1;e||(s.zoomLevels=o.defaultZoomLevels)};var Oe=function(){$("#vvToggleDiffHighlightingBtn").on("click",function(){$(this).prop("disabled")||($(this).toggleClass("vvDiffHighlightVisible"),$(this).toggleClass("vvDiffHighlightNotVisible"),d.getCurrentDiff().showHighlights=!d.getCurrentDiff().showHighlights,virtualViewer.paintCanvases())}),$("#vvLockScrollingBtn").on("click",function(){$(this).prop("disabled")||virtualViewer.lockScrolling(!virtualViewer.scrollingLocked)}),$("#vvRefreshDiffBtn").on("click",function(){if(!$(this).prop("disabled")){var e=d.getCurrentDiff();if(!e||e.diffDisabled)return void virtualViewer.performDiff(!1,!0);e.startDiff(),za()}}),$("#vvDocCompareInternal").on("scroll",function(){var e=$("#fixedPageLabel").data("currentPage"),a=e||0,n=$(".diffPageContainer[pageNumber='"+a+"']"),i=n.position();if(n.hasClass("in")&&i.top<=0&&i.top+n.height()>0){if(t.getLocalizedValue("thumbPageLabel","Page ")+(a+1)===$("#fixedPageLabel").text())return;return $("#fixedPageLabel").text(t.getLocalizedValue("thumbPageLabel","Page ")+(a+1)),void $("#fixedPageLabel").data("currentPage",a)}var o=$(".diffPageContainer.collapse");if(n.position().top>0){for(var r=a-1;r>=0;r--)if(o.eq(r).hasClass("in")){if(i=o.eq(r).position(),i.top<=0&&i.top+o.eq(r).height()>0)return $("#fixedPageLabel").text(t.getLocalizedValue("thumbPageLabel","Page ")+(r+1)),void $("#fixedPageLabel").data("currentPage",r);if(i.top+o.eq(r).height()<0)return $("#fixedPageLabel").text(""),void $("#fixedPageLabel").data("currentPage",r)}return $("#fixedPageLabel").text(""),void $("#fixedPageLabel").data("currentPage",0)}for(var s=a+1;s<o.length;s++)if(o.eq(s).hasClass("in")){if(i=o.eq(s).position(),i.top<=0&&i.top+o.eq(s).height()>0)return $("#fixedPageLabel").text(t.getLocalizedValue("thumbPageLabel","Page ")+(s+1)),void $("#fixedPageLabel").data("currentPage",s);if(i.top>0)return $("#fixedPageLabel").text(""),void $("#fixedPageLabel").data("currentPage",a)}$("#fixedPageLabel").text(""),$("#fixedPageLabel").data("currentPage",0)})},_e=function(){e("vvDialogs").init(),$("#vvRedactionWarningDialogOKButton").text(t.getLocalizedValue("redactionWarningDialog.okButton","OK")),$("#vvRedactionWarningDialogOKButton").click(function(e){$("#vvRedactionWarningDialog").modal("hide")}),$("#vvRedactionWarningDialogText").append("<p><b>"+t.getLocalizedValue("redactionWarningDialog.redactedVersionTitle","Creating a Redacted Version")+"</b></p>"),$("#vvRedactionWarningDialogText").append("<p>"+t.getLocalizedValue("redactionWarningDialog.redactedVersionText","error")+"</p>"),$("#vvRedactionWarningDialogText").append("<p><b>"+t.getLocalizedValue("redactionWarningDialog.searchAndRedactTitle","Search and Redact")+"</b></p>"),$("#vvRedactionWarningDialogText").append("<p>"+t.getLocalizedValue("redactionWarningDialog.searchAndRedactText","error")+"</p>"),$("#vvRedactionWarningDialogText").append("<p><b>"+t.getLocalizedValue("redactionWarningDialog.visualVerificationTitle","Visual Verification")+"</b></p>"),$("#vvRedactionWarningDialogText").append("<p>"+t.getLocalizedValue("redactionWarningDialog.visualVerificationText","error")+"</p>"),$("#vvOverwriteDialogOverwriteButton").click(function(){var e=d.getActivePaneState(),t=e.getDocumentId();O.saveDocument(t,{skipOverwriteDialog:!0}),$("#vvOverwriteDialog").modal("hide")}),$("#vvOverwriteDialogSaveAsButton").click(function(){$("#vvOverwriteDialog").modal("hide"),O.saveDocumentAsDialog()}),$("#vvConfirmCropDialogOK").click(function(){if(virtualViewer.cropPageClient()){var e=d.getActivePaneState();O.updateTabName(e)}else virtualViewer.delayedPaintCanvases();$("#vvConfirmCropDialog").modal("toggle"),virtualViewer.cropDialogDisable=!0}),$("#vvConfirmCropDialogCancel").click(function(){d.getActivePaneState().removeCropOnPage(),virtualViewer.delayedPaintCanvases()}),$("#pictureControlsClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvPictureControlsDialogCancelButton,#pictureControlsClose").click(function(e){var t=d.getActivePaneState(),a=t.getDocumentModel().getModifiedSinceInit();t&&a&&(t.setContrastForPage(t.pageNumber,o.defaultContrastValue),t.setBrightnessForPage(t.pageNumber,o.defaultBrightnessValue),t.setGammaForPage(t.pageNumber,o.defaultGammaValue),$("#vvContrastSlider").slider("setValue",o.defaultContrastValue),$("#vvBrightnessSlider").slider("setValue",o.defaultBrightnessValue),$("#vvGammaSlider").slider("setValue",o.defaultGammaValue),$("#vvContrastSliderVal").html(o.defaultContrastValue),$("#vvBrightnessSliderVal").html(o.defaultBrightnessValue),$("#vvGammaSliderVal").html(o.defaultGammaValue),Xt(t))}),$("#imageInfoClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvImageInfoTitle").html(t.getLocalizedValue("imageInfo.dialogTitle","Document & Page Properties")),$("#vvImageInfoDialogOKButton").text(t.getLocalizedValue("aboutDialog.okButton","OK")),$("#aboutClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvAboutDialogText").html(t.getLocalizedValue("aboutDialog.text",o.aboutDialogTextContents)),$("#vvAboutDialogTitle").html(t.getLocalizedValue("aboutDialog.productName",o.productName)+" "+t.getLocalizedValue("aboutDialog.versionPrefix","v")+o.productVersion),$("#vvAboutDialogOKButton").text(t.getLocalizedValue("aboutDialog.okButton","OK")),$("#vvAboutDialogCancelButton").text(t.getLocalizedValue("aboutDialog.helpButton","Help")),$("#vvAboutDialogOKButton").click(function(e){$("#vvAboutDialog").modal("hide")}),$("#vvAboutDialogCancelButton").click(function(e){window.open(s.helpURL,s.helpWindowName,s.helpWindowParams),$("#vvAboutDialog").modal("hide")});var a=t.getLocalizedValue("clipboardDialog.clipboardTitleStart","Copy to clipboard"),n="Ctrl-C",i=navigator.platform.toUpperCase().indexOf("MAC")>=0;i&&(n="Command-C");var r=a+": "+n;$("#vvClipboardTitle").html(r),$("#vvKeyboardHintsText").html(R());var l=$("#vvExportUnsupportedFileDialog");l.find(".download-button").click(function(){O.downloadDocument(l.data().documentId),l.modal("hide")}),l.on("hidden.bs.modal",function(){var e=d.getStateForDocumentId(l.data().documentId);e&&(e.closedTab||O.closeTab(e.getTabNumber(),!0),d.removeStateForDocumentId(e.getDocumentId(),e.currentPaneIndex)),ae=!1});var u=$("#vvPasswordProtectedFileDialog");u.find(".download-button").click(function(){O.downloadDocument(u.data().documentId),u.modal("hide")}),u.on("hidden.bs.modal",function(){var e=d.getStateForDocumentId(u.data().documentId);e&&(e.closedTab||O.closeTab(e.getTabNumber(),!0),d.removeStateForDocumentId(e.getDocumentId(),e.currentPaneIndex)),ae=!1}),$("#bookmarksClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvBookmarkDialogOKButton").click(function(e){var t=virtualViewer.getCurrentState().documentModel,a=t.getSelectedPageNumbers()[0],n=$("#vvBookmarkDialogNoteInput").val();null===O.getBookmarks().editingBookmark?O.addBookmark(n,a):O.getBookmarks().saveEditedBookmark(n),$("#vvBookmarkDialogNoteInput").val(""),$("#vvBookmarkDialog").modal("hide")}),$("#vvBookmarkDialogCancelButton").click(function(e){$("#vvBookmarkDialogNoteInput").val(""),O.getBookmarks().editingBookmark=null}),$("#vvBookmarkDialog").on("hidden.bs.modal",function(e){$("#vvBookmarkDialogNoteInput").val(""),O.getBookmarks().editingBookmark=null}),$("#vvSplitNotAllowedOkButton").click(function(e){$("#vvSplitNotAllowedDialog").modal("hide")});var c,g=$("#vvUploadLocalFileForm");g.find(".file-clicker").click(function(e){$(this).attr("disabled")||(g.find("input[type=file]").click(),e.preventDefault())}),g.find("input[type=file]").change(function(){var e=$(this).val();c=e.substring(e.lastIndexOf("/")+1),c=c.substring(e.lastIndexOf("\\")+1),g.find(".upload-file-info").html(c)}),$("#vvUploadLocalFilesDialog").on("show.bs.modal",function(){$("#vvUploadLocalFilesDialog .btn").attr("disabled",!1),$("#vvUploadLocalFilesDialog .upload-file-info").html("")}),$("#vvUploadLocalFileDialogOK").click(function(e){if(!O.isUploadDocumentEnabled())return g[0].reset(),$("#vvUploadLocalFilesDialog").modal("hide"),void yt(t.getLocalizedValue("errors.uploadDisabled","Upload document has been disabled by the administrator."));if(g.find("input[type=file]").val()){var a=new FormData(g[0]);a.append("action","uploadDocument"),a.append("clientInstanceId",virtualViewer.getClientInstanceId()),a.append("filename",encodeURI(c)),$("#vvUploadLocalFilesDialog .btn").attr("disabled",!0),$.ajax({url:s.servletPath,type:"POST",cache:!1,contentType:!1,processData:!1,data:a,dataType:"json",success:function(e){$("#vvUploadLocalFilesDialog .btn").attr("disabled",!1),mt(e)!==!0&&(le.call("uploadDocument",{uploadedDocumentId:decodeURIComponent(e.documentIdToReload),clientInstanceId:O.getClientInstanceId()}),g[0].reset(),$("#vvUploadLocalFilesDialog").modal("hide"))},error:function(e){yt("Could not upload document."),$("#vvUploadLocalFilesDialog .btn").attr("disabled",!1)}})}}),Ba()},Ue=function(e){var t=e.getPageNumber(),a=e.getPageCount();$(".vvGoToFirstPage").attr("aria-disabled",t<=0||a<=1),$(".vvGoToPreviousPage").attr("aria-disabled",t<=0||a<=1),$(".vvGoToNextPage").attr("aria-disabled",a<=1||t+1===a),$(".vvGoToLastPage").attr("aria-disabled",a<=1||t+1===a)};g.prototype.applyToolbarButtonConfigurations=function(e){We(e)};var We=function(e){e=e||d.getActivePaneState(),O.disableUploadDocument?$(".vvFileUpload").remove():null!==O.disableUploadDocument&&ie.fileUploadVisible&&ie.imageControlToolbar[0].on?$(".vvFileUpload").show():$(".vvFileUpload").hide(),s.disableUserPreferences&&$(".vvUserPreferences").remove(),e&&!e.isVideo()&&e.pageStates?($(".vvJumpToPageInput").prop("disabled",!1),$(".vvToolbarItem").attr("aria-disabled","false").removeClass("disabled"),s.oneLayerPerAnnotation&&!e.imageLayers&&$(".vvLayerManager").attr("aria-disabled",!0).addClass("disabled"),virtualViewer.checkRedactionsEnabled()||$(".vvRedactionRect").attr("aria-disabled",!0).addClass("disabled"),Ue(e)):($(".vvJumpToPageInput").prop("disabled",!0),$(".vvToolbarItem").attr("aria-disabled","true").addClass("disabled"),$(".vvAbout, .vvUserPreferences, #vvThumbToggleButton, .vvFileUpload").attr("aria-disabled","false").removeClass("disabled"),$("#vvMidSizeToolbarItems > li > a.dropdown-toggle, #vvMidSizeAnnToolbarItems > li > a.dropdown-toggle").attr("aria-disabled","false").removeClass("disabled"));for(var t=$(".vvMidAnnotationToolbarGroup, .vvMidImageToolbarGroup"),a=0;a<t.length;a++){var n=$(t[a]).find("li.vvToolbarItem"),i=$(t[a]);n.length?n.not(".disabled").length?(i.attr("aria-disabled",!1).removeClass("disabled"),i.children(".dropdown-toggle").attr("aria-disabled",!1)):(i.attr("aria-disabled",!0).addClass("disabled"),i.children(".dropdown-toggle").attr("aria-disabled",!0)):i.remove(),n.hasClass("vvPreferenceDisabled")&&!n.hasClass("vvPreferenceEnabled")?i.hide():i.show()}};g.prototype.videoThumbPrep=function(e){return e&&e.isVideo()?($(".thumbTabs").addClass("disabledTab"),$("#vvDocThumbsTab").removeClass("disabledTab"),O.openDefaultThumb(o.thumbnailTabs.document),!0):($(".thumbTabs").removeClass("disabledTab"),!1)};var ze=function(){We()},He=function(){$("#vvThumbsTabs").css("visibility","visible"),$("#vvSearch").css("visibility","visible"),$("#vvNotesTab").css("visibility","visible"),$("#vvBookmarksTab").css("visibility","visible"),$("#vvUPToolbarConfigTab").css("visibility","visible"),$("#vvUPAnnotationPropTab").css("visibility","visible"),$("#vvUPCustomTextStampsTab").css("visibility","visible"),$("#vvUPNotesTemplateTab").css("visibility","visible"),$("#vvUPVideoTab").css("visibility","visible"),$("#vvUPGeneralTab").css("visibility","visible");var t=e("vvThumbs");if(s.showThumbnailPanel===!1||s.showPageThumbnails===!1&&s.showDocThumbnails===!1&&s.showSearch===!1?virtualViewer.toggleThumbnailPanel(!1):$("#vvThumbs").width()>$("#vvImageAndThumbs").width()/3?virtualViewer.toggleThumbnailPanel(!1):virtualViewer.toggleThumbnailPanel(!0),s.enableDocumentNotes===!1&&$("#vvNotesTab").hide().removeClass("vvAllowedTab"),s.showPageThumbnails===!1&&($("#vvPageThumbsTab").hide().removeClass("vvAllowedTab"),$("#vvThumbs li:eq(1) a").tab("show")),s.showDocThumbnails===!1&&$("#vvDocThumbsTab").hide().removeClass("vvAllowedTab"),s.showSearch===!1&&$("#vvSearchTab").hide().removeClass("vvAllowedTab"),s.showBookmarkThumbnails===!1&&$("#vvBookmarksTab").hide().removeClass("vvAllowedTab"),s.showAnnotationList===!1&&$("#vvAnnotationsListTab").hide().removeClass("vvAllowedTab"),s.showDocumentFilter){$("#vvDocThumbs").addClass("show-control-panel");var a=null,n=$("#vvDocThumbsSearch .displayNameSearch");n.addClear({symbolClass:"text_clear_symbol icon",onClear:function(){virtualViewer.filterDocumentThumbsByDisplayName()}}),n.keydown(function(){a&&clearTimeout(a),a=setTimeout(function(){virtualViewer.filterDocumentThumbsByDisplayName(n.val())},200)})}je(),$(".docTabs").on("shown.bs.tab",function(e){var t=$(".thumbTabs.active").index();O.tabs[t]&&O.activeTab!==t&&O.switchToTab(O.getStateForDocumentId(O.tabs[t]))}),$("#vvDocThumbsTab").on("click",function(e){setTimeout(function(e){t.loadVisibleThumbs($("#vvDocThumbs"))},200),s.showDocumentFilter&&setTimeout(function(e){$("#vvDocThumbsSearch").find(".form-control").first().focus()})}),$("#vvPageThumbsTab").on("shown.bs.tab",function(e){setTimeout(function(e){t.loadVisibleThumbs($("#vvPageThumbs"))},200),O.getActivePaneState()&&Qe();
}),$("#vvSearchTab").on("shown.bs.tab",function(){setTimeout(function(e){t.loadVisibleThumbs($("#vvSearchResults")),c.updateSearchButtons()},200),$("#vvSearchTermField").focus()}),$("#vvAnnotationsListTab").on("shown.bs.tab",function(){$("#vvAnnotationsList").find(".form-control").first().focus()}),$("#vvNotesTab").on("shown.bs.tab",function(){$("#vvDocumentNotes").find(".form-control").first().focus()})},Qe=function(){s.showAnnNavToggle?($("#vvAnnotationIndicatorToggle").show(),virtualViewer.showAnnotationNaviPanel($("#vvPageThumbs").hasClass("vvAnnotationNavigation"))):($("#vvAnnotationIndicatorToggle").hide(),$("#vvPageThumbs").removeClass("vvAnnotationNavigation vvAnnotationNavigationHidden"))},je=function(e){var t=$("#vvImageTabs"),a=t.innerHeight(),n=40;if(a>=n&&!O.shortTabNames)return O.shortTabNames=!0,void O.updateAllTabNames(!0);if(a<n&&O.shortTabNames&&!e){var i=200*O.tabs.length;if($("#vvImageTabs").width()>i)return O.shortTabNames=!1,void O.updateAllTabNames(!0)}if(a>=n)for(;a>n;){var o=t.children("li:not(:last-child)"),r=o.length;$(o[r-1]).prependTo("#collapsed"),a=t.innerHeight()}else for(var s=$("#collapsed").children("li"),l=0;l<s.length&&a<n;l+=1)$(s[l]).insertBefore(t.children("li:last-child")),a=t.innerHeight();$("#collapsed").children("li").length>0?$("#collapseTab").show():$("#collapseTab").hide().tooltip("hide"),a=t.innerHeight(),a>n&&je()},qe=function(e){if($("#vvNotesTab").removeClass("disabled"),e.isVirtualDocument()){$("#vvNotesTab").addClass("disabledTab"),$("#vvNotesTab").removeAttr("data-toggle");var a=t.getLocalizedValue("errors.virtualDocumentNotes","Notes are not yet supported for Virtual Documents.");$("#vvNotesTabSpan").attr("title",a),$("#vvBookmarksTab").addClass("disabledTab"),$("#vvBookmarksTab").removeAttr("data-toggle"),a=t.getLocalizedValue("errors.virtualDocumentBookmarks","Bookmarks are not yet supported for Virtual Documents."),$("#vvBookmarksTabSpan").attr("title",a)}},Ge=function(){if($(".vvAnnPopUpButton").each(function(){var e=$(this).val();$(this).val($("<div />").html(e).text())}),a.createColorPicker($("#vvAnnLineColorChoices"),Pa),a.createColorPicker($("#vvAnnFillColorChoices"),Pa),a.createColorPicker($("#vvAnnTextColorChoices"),Pa),s.annotationTags.length>0){$("#vvAddTagButton").html(t.getLocalizedValue("annotationTag.addButton","Add Tag")+"<div class='vvAnnTagInnerButton'>+</div>");for(var e=0;e<s.annotationTags.length;e++)$("#vvAnnTagList").append(ea(s.annotationTags[e]))}$(".vvTagOption").on("click",function(){var e=virtualViewer.getCurrentAnnObject(),t=!0,a=$(this).text();if(""===a)t=!1;else{0===e.annotationTags.length&&$("#vvAnnTagChosen").show();for(var n=0;n<e.annotationTags.length;n++)if(e.annotationTags[n]===a){t=!1;break}}if("vvRedaction"===e.layerName&&1===e.annotationTags.length&&t&&(e.annotationTags=[],$("#vvAnnTagChosen").children().remove()),t){e.annotationTags.push(a);var i=Jt(a);$("#vvAnnTagChosen").append(i),i.find(".vvAnnTagCloseButton").on("click",ta),e.markRevised(),u.markLayerWithAnnDirty(e),Kt(a)}});for(var n=0;n<o.fontNames.length;n+=1)$("#vvAnnTextFaceSelect").append("<option>"+o.fontNames[n]+"</option>");for(var i=0;i<o.fontSizes.length;i+=1)$("#vvAnnTextSizeSelect").append("<option>"+o.fontSizes[i]+"</option>");$("#vvAnnotationRevisionHistory").on("hide.bs.collapse",function(e){$("#vvAnnPopUpForm").removeClass("vvDisplayingRevisionHistory")}),$("#vvAnnotationRevisionHistory").on("show.bs.collapse",function(e){$("#vvAnnPopUpForm").addClass("vvDisplayingRevisionHistory")}),$("#vvAnnPopUp .vvAnnThicknessCell").click(function(){var e=$(this).children(".vvAnnThicknessElement").css("width");e=parseInt(e.replace(/px/i,""),10),$("#vvAnnPopUp .vvAnnThicknessCell").attr("aria-pressed","false"),$(this).attr("aria-pressed","true"),$("#vvAnnLineSizeValue").html(e);var t=d.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=u.getLayerWithAnn(a),i=t.getUndoObject(t.getPageNumber());i.referenceAnn=a,i.unchangedAnn=a.clone(),i.layer=n,a.setLineWidth(e,!0),i.modifiedAnn=a.clone(),i.type="modify",a&&a.markRevised(),i.modifiedAnn.isSameAs(i.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),i),t.resetUndoObject(),u.markLayerWithAnnDirty(a),virtualViewer.delayedPaintCanvases(t)}),$("#vvAnnTextFaceSelect").change(function(e){var t=d.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=u.getLayerWithAnn(a),i=t.getUndoObject(t.getPageNumber());i.referenceAnn=a,i.unchangedAnn=a.clone(),i.layer=n,a&&a.markRevised(),a.setFontName($(e.target).val()),a.wrappedTextIsStale=!0,a.fitBoxToText(),i.modifiedAnn=a.clone(),i.type="modify",i.modifiedAnn.isSameAs(i.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),i),t.resetUndoObject(),$("#vvAnnPopUpEditTextArea").css("font-family",a.getFontName()),u.markLayerWithAnnDirty(a),virtualViewer.delayedPaintCanvases(t)}),$("#vvAnnTextSizeSelect").change(function(e){var t=d.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=u.getLayerWithAnn(a),i=t.getUndoObject(t.getPageNumber());i.referenceAnn=a,i.unchangedAnn=a.clone(),i.layer=n,a&&a.markRevised();var r=1;a.docDPI>o.minimumAnnotationDPI&&t.getDPIForPage(a.page)&&t.getDPIForPage(a.page)<10&&(r=a.pageWidth/t.getOriginalWidthForPage(a.page)||1,90!==a.rotateAngle&&270!==a.rotateAngle||(r=a.pageHeight/t.getOriginalWidthForPage(a.page)||1)),a.setFontSize($(e.target).val()*r),a.wrappedTextIsStale=!0,a.fitBoxToText(),i.modifiedAnn=a.clone(),i.type="modify",i.modifiedAnn.isSameAs(i.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),i),t.resetUndoObject(),$("#vvAnnPopUpEditTextArea").css("font-size",$(e.target).val()+"px"),u.markLayerWithAnnDirty(a),virtualViewer.delayedPaintCanvases(t)}),$("#vvAnnTextStyle").change(function(e){var t=d.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=u.getLayerWithAnn(a);a.wrappedTextIsStale=!0;var i=t.getUndoObject(t.getPageNumber());i.referenceAnn=a,i.unchangedAnn=a.clone(),i.layer=n,$("#vvAnnTextStyleBold").is(":checked")?(a.fontBold=!0,$("#vvAnnPopUpEditTextArea").css("font-weight","bold")):(a.fontBold=!1,$("#vvAnnPopUpEditTextArea").css("font-weight","normal")),$("#vvAnnTextStyleItalic").is(":checked")?(a.fontItalic=!0,$("#vvAnnPopUpEditTextArea").css("font-style","italic")):(a.fontItalic=!1,$("#vvAnnPopUpEditTextArea").css("font-style","normal")),$("#vvAnnTextStyleUnderline").is(":checked")?(a.fontUnderline=!0,$("#vvAnnPopUpEditTextArea").css("text-decoration","underline")):(a.fontUnderline=!1,$("#vvAnnPopUpEditTextArea").css("text-decoration","none")),a.fitBoxToText(),i.modifiedAnn=a.clone(),i.type="modify",i.modifiedAnn.isSameAs(i.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),i),t.resetUndoObject(),a&&a.markRevised(),u.markLayerWithAnnDirty(a),virtualViewer.delayedPaintCanvases(t)}),$("#vvAnnPopUpEditTextArea").on("focus",function(){s.autoConfirmTextAnnotations||($("#vvAnnPopUpEditTextSaveBtn").show(),$("#vvAnnPopUpEditTextCancelBtn").show())}),$("#vvAnnPopUpEditTextArea").on("input",function(){if(s.autoConfirmTextAnnotations){var e=d.getActivePaneState(),t=virtualViewer.getCurrentAnnObject();t.setTextString($("#vvAnnPopUpEditTextArea").val()),t.wrappedTextIsStale=!0,t.fitBoxToText(),virtualViewer.delayedPaintCanvases(e),t.markRevised(),u.markLayerWithAnnDirty(t)}}),$("#vvAnnPopUpEditTextSaveBtn").on("click",function(){var e=d.getActivePaneState(),t=virtualViewer.getCurrentAnnObject();t.wrappedTextIsStale=!0,t.setTextString($("#vvAnnPopUpEditTextArea").val()),t.fitBoxToText(),t.markRevised(),u.markLayerWithAnnDirty(t),$("#vvAnnPopUpEditTextArea").blur(),$(this).hide(),$("#vvAnnPopUpEditTextCancelBtn").hide(),virtualViewer.delayedPaintCanvases(e)}),$("#vvAnnPopUpEditTextCancelBtn").on("click",function(){var e=d.getActivePaneState(),t=virtualViewer.getCurrentAnnObject();$("#vvAnnPopUpEditTextArea").val(t.getTextString()),t.fitBoxToText(),$("#vvAnnPopUpEditTextArea").blur(),$(this).hide(),$("#vvAnnPopUpEditTextSaveBtn").hide(),virtualViewer.delayedPaintCanvases(e)}),$("#vvAnnCopyButton").click(function(e){u.copyAnn(),virtualViewer.hideAnnPopUp()}),$("#vvAnnCutButton").click(function(e){u.cutAnn(),virtualViewer.hideAnnPopUp()}),$("#vvAnnDeleteButton").click(function(e){var t=d.getActivePaneState();$("#vvDeleteAnnotationDialog").modal("show"),$("#deleteAnnotationButtonConfirm").click(function(e){virtualViewer.hideAnnPopUp(),u.deleteAnn(t),$("#vvDeleteAnnotationDialog").modal("hide")})})},Ye=function(){var e=d.getActivePaneState(),t=e.pageNumber;e.getSVGableForPage(t)&&(e.setSVGableForPage(t,!1),e.imageManager.cleanPageFromBuffers(t),e.imageManager.getBestImageFromPage(t,!0))},Xe=function(){$("#vvBrightness .icon").attr("title",t.getLocalizedValue("pictureControls.brightnessIcon.title","Brightness (Icon)")),$("#vvContrast .icon").attr("title",t.getLocalizedValue("pictureControls.contrastIcon.title","Contrast (Icon)")),$("#vvGamma .icon").attr("title",t.getLocalizedValue("pictureControls.gammaIcon.title","Gamma (Icon)")),$("#vvBrightnessSliderVal").attr("title",t.getLocalizedValue("pictureControls.brightnessValue.title","Brightness (Value)")),$("#vvContrastSliderVal").attr("title",t.getLocalizedValue("pictureControls.contrastValue.title","Contrast (Value)")),$("#vvGammaSliderVal").attr("title",t.getLocalizedValue("pictureControls.gammaValue.title","Gamma (Value)"))},Ze=function(){$("#vvDocumentNoteAdderAuthor").html(t.encodeForHTML(oe.getUsername())),$("#vvDocumentNoteAddButton").click(function(){$("#vvDocumentNoteContentInput").val()&&(oe.addNewNote(),O.docHasNotes()&&$("#vvNotesTabSpan").addClass("docNotesExist"))}),$("#vvAnnotationNoteAddButton").click(function(){$("#vvAnnotationNoteContentInput").val()&&(virtualViewer.getCurrentAnnObject().addNewNote(),virtualViewer.getCurrentAnnObject().markRevised())})};g.prototype.docHasNotes=function(){var e=O.getDocNotes();if(e)return e.length>0},g.prototype.getDocNotes=function(){var e=O.getCurrentState();if(e){var t=e.getDocumentModel(),a=t.model.documentNotes.notes;return a}};var Ke=function(){oe.clearAllDocumentNotes(),$("#vvNotesTabSpan").removeClass("docNotesExist")},Je=function(){O.createNoteTemplateContextMenuList()};g.prototype.createNoteTemplateContextMenuList=function(){$("#vvNoteTemplateCMenuList").empty();for(var e=0;e<ie.noteTemplateArray.length;e+=1){var t=$("<li>"+O.encodeForHTML(ie.noteTemplateArray[e].templateName)+"</li>");$("#vvNoteTemplateCMenuList").append(t),t.click(function(){var e=this.parentElement,t=$(e).children().index(this);$("#vvDocumentNoteContentInput").val(ie.noteTemplateArray[t].templateString),$("#jqContextMenu").hide(),$("#jqContextMenuShadow").hide()})}$("#vvDocumentNoteTemplateButton").contextMenu("vvNoteTemplateContextMenu",{bindTarget:"click",onContextMenu:function(e){if(ie.noteTemplateArray.length>0)return!0},onShowMenu:function(e,t){if(ie.noteTemplateArray.length>0)return t}})};var et=function(){e("vvThumbs").prepareThumbPanels()};g.prototype.openDefaultThumb=function(t){t=t||ie.getDefaultTab(),(null===t||t<0)&&(t=s.defaultThumbnailTab);var a=d.getActivePaneState(),n=!!a&&pe<1&&!d.isVideoOpen()&&s.showPageThumbnails,i=!!a&&pe<1&&!a.isVirtualDocument()&&s.enableDocumentNotes,r=!!s.showDocThumbnails,l=!!s.showBookmarkThumbnails&&pe<1,u=!!s.showSearch&&pe<1,c=!!s.showAnnotationList&&pe<1&&!d.isVideoOpen(),g=!d.isVideoOpen()&&d.getCurrentDiff();switch(a&&d.isVideoOpen()&&(t=o.thumbnailTabs.document),(t===o.thumbnailTabs.page&&!n||t===o.thumbnailTabs.search&&!u||t===o.thumbnailTabs.note&&!i||t===o.thumbnailTabs.bookmark&&!l||t===o.thumbnailTabs.document&&!r||t===o.thumbnailTabs.annList&&!c||t===o.thumbnailTabs.docCompare&&!g)&&(t=r?o.thumbnailTabs.document:n?o.thumbnailTabs.page:u?o.thumbnailTabs.search:i?o.thumbnailTabs.note:l?o.thumbnailTabs.bookmark:c?o.thumbnailTabs.annList:g?o.thumbnailTabs.docCompare:null),$("#vvThumbs .active").removeClass("active"),t){case o.thumbnailTabs.page:$("#vvPageThumbsTab").addClass("active"),$("#vvPageThumbs").addClass("active"),e("vvThumbs").loadVisibleThumbs($("#vvPageThumbs"));break;case o.thumbnailTabs.document:$("#vvDocThumbsTab").addClass("active"),$("#vvDocThumbs").addClass("active"),e("vvThumbs").loadVisibleThumbs($("#vvDocThumbs"));break;case o.thumbnailTabs.search:$("#vvSearchTab").addClass("active"),$("#vvSearch").addClass("active");break;case o.thumbnailTabs.note:$("#vvNotesTab").addClass("active"),$("#vvDocumentNotes").addClass("active"),$("#vvDocumentNotes").css("visibility","visible");break;case o.thumbnailTabs.bookmark:$("#vvBookmarksTab").addClass("active"),$("#vvBookmarks").addClass("active");break;case o.thumbnailTabs.annList:$("#vvAnnotationsListTab").addClass("active"),$("#vvAnnotationsList").addClass("active");break;case o.thumbnailTabs.docCompare:$("#vvDocCompareTab").addClass("active"),$("#vvDocCompare").addClass("active")}};var tt=function(){$("#vvCopyTextContainer").length||$("<div></div>").attr("id","vvCopyTextContainer").appendTo("#virtualViewerMain").hide(),$("#vvSelectTextMenuCopy").on("click",virtualViewer.copyTextUserEventHandler)},at=function(){e("vvLayerManager").prepareLayerDialog()};g.prototype.docThumbContextMenu={bindings:{vvSplitImage:function(e){var t=$(e).data("thumbInfo").documentId,a=O.getCurrentState(1);if(a){var n=a.documentModel;n.getModifiedSinceInit()?O.confirmCloseDialog(a,t):O.splitScreen(t,"horizontal")}else O.splitScreen(t,"horizontal");O.performDiff()}},offsetHeight:10,onContextMenu:function(e){var a=$(e.currentTarget).data().thumbInfo.documentId,n=$(e.currentTarget).data().thumbInfo.displayName;return!(t.dumbVideoExtensionCheck(a)||t.dumbVideoExtensionCheck(n)||d.isVideoOpen())&&(!!s.splitScreen&&!($("#vvImagePanel").width()<2*$("#vvThumbs").width()&&Modernizr.touchevents))}};var nt={bindings:{vvOcrContextMenuOcr:function(){O.performOCR({force:!0})},vvSelectTextMenuPaste:function(){var e=O.getActivePaneState();e.isPageCropped(e.getPageNumber())?O.displayExceptionMessage(t.getLocalizedValue("errors.cropBlock","Cannot Annotate on Crop Preview. Save the crop then Annotate.")):u.pasteAnn()},vvUndoSplitPane:function(e){var t=d.getCurrentState(1);t.documentModel.getModifiedSinceInit()?O.confirmCloseDialog(t):O.undoSplitScreen()},vvSelectTextMenuCopy:function(e){},vvSelectTextMenuHighlight:function(e){O.createHighlightFromSelection()},vvSelectTextMenuRedact:function(e){O.createRedactionFromSelection()}},offsetHeight:100,onContextMenu:function(e){e||(e=window.event),Modernizr.touchevents&&(e=se.fixTouchEvent(e));var t=d.getActivePaneState();if(d.isVideoOpen()||!t)return!1;var a=se.clickPointConverter(e),n=u.isAnnotationAtPoint(a),i=se.annDragging,r=virtualViewer.isOnImage(a),s=virtualViewer.getSelectedTextRects(),l=virtualViewer.getEventManager().getDragMode();if(!r)return!1;if(n||i)return!1;var c={documentId:t.getDocumentId()};return!le.callWithReturn("disableTextContextMenu",c)&&(!(!O.ocrEnabled&&!ve)||!!(l===o.dragModes.selectText&&s&&s.length>0||null!==Ae&&void 0!==Ae))},onShowMenu:function(e,t){var a=virtualViewer.getEventManager().getDragMode(),n=virtualViewer.getSelectedTextRects();a===o.dragModes.selectText&&n&&n.length>0?virtualViewer.checkRedactionsEnabled()||$("#vvSelectTextMenuRedact",t).remove():($("#vvSelectTextMenuCopy",t).remove(),$("#vvSelectTextMenuHighlight",t).remove(),$("#vvSelectTextMenuRedact",t).remove()),null!==Ae&&void 0!==Ae||$("#vvSelectTextMenuPaste",t).remove(),ve||$("#vvUndoSplitPane",t).remove(),O.ocrEnabled||$("#vvOcrContextMenuOcr",t).remove();var i={documentId:virtualViewer.getActivePaneState().getDocumentId()};return le.call("onShowSelectTextContextMenu",i),t}};g.prototype.pageThumbContextMenuOptions={offsetHeight:400,bindings:{vvSelectPagesAll:function(e){O.selectAll()},vvSelectPagesNone:function(e){O.selectNone()},vvDeletePages:function(e){$("#vvPageThumbs").trigger("vvDeletePages")},vvCutPages:function(e){$("#vvPageThumbs").trigger("vvCutPages")},vvCopyPages:function(e){$("#vvPageThumbs").trigger("vvCopyPages")},vvInsertPagesBefore:function(e){$("#vvPageThumbs").trigger("vvPastePages",$(e).closest(".vvThumbBox").data("thumbInfo").pageNumber)},vvInsertPagesAfter:function(e){$("#vvPageThumbs").trigger("vvPastePages",$(e).closest(".vvThumbBox").data("thumbInfo").pageNumber+1)},vvCopyPagesToNewDocument:function(e){O.copyToNewDocument(!1)},vvCutPagesToNewDocument:function(e){O.copyToNewDocument(!0)},vvAddBookmark:function(e){$("#vvBookmarkDialog").modal("show");var a=t.getLocalizedValue("bookmarkDialog.title","Create New Bookmark");$("#vvBookmarkTitle").text(a);var n=virtualViewer.getCurrentState().documentModel,i=n.getSelectedPageNumbers()[0];ne.pageToAdd=i},vvPrintPages:function(e){var t=virtualViewer.getSelectedPageNumbers();O.printDocumentDialog(t)},vvExportPages:function(e){var t=virtualViewer.getSelectedPageNumbers();O.exportDocumentDialog(t)}},onContextMenu:function(e){return!("vvPageThumbs"===e.target.id&&O.getPageCount()>0)},onShowMenu:function(e,t){var a=virtualViewer.getDocumentModel(),n=$(e.target).closest(".vvThumbBox"),i=n.data("thumbInfo").pageNumber,o=d.getActivePaneState();a.isPageSelected(i)||e.ctrlKey||e.metaKey||e.shiftKey||(a.clearPageSelection(),a.addPageToSelection(i));var r=function(e){e&&e.model&&0!==e.model.length||($("#vvInsertPagesBefore",t).remove(),$("#vvInsertPagesAfter",t).remove())},l={documentId:o.getDocumentId()};return O.checkPageManipulationsEnabled()&&!le.callWithReturn("disablePageManipulationContextMenuOptions",l)||($("#vvCutPages",t).remove(),$("#vvCopyPages",t).remove(),$("#vvDeletePages",t).remove(),$("#vvInsertPagesBefore",t).remove(),$("#vvInsertPagesAfter",t).remove(),$("#vvCutPagesToNewDocument",t).remove(),$("#vvSelectPagesAll",t).remove(),$("#vvSelectPagesNone",t).remove()),0===a.getSelectedPageNumbers().length&&($("#vvCutPages",t).remove(),$("#vvCopyPages",t).remove(),$("#vvCopyPagesToNewDocument",t).remove(),$("#vvCutPagesToNewDocument",t).remove()),a.getSelectedPageNumbers().length>1&&$("#vvAddBookmark",t).remove(),o.isVirtualDocument()&&$("#vvAddBookmark",t).remove(),s.pageManipulationsNewDocumentMenu||($("#vvCopyPagesToNewDocument",t).remove(),$("#vvCutPagesToNewDocument",t).remove()),0===o.getPageCount()&&($("#vvCutPages",t).remove(),$("#vvCopyPages",t).remove(),$("#vvDeletePages",t).remove(),$("#vvSelectPagesAll",t).remove(),$("#vvSelectPagesNone",t).remove(),$("#vvInsertPagesBefore",t).remove(),$("#vvInsertPagesAfter",t).remove()),this.offsetHeight=t.height(),Da(r),t}},g.prototype.getServerConfig=function(){var e=new URI(s.servletPath);e.addQuery("action","getServerConfig");var t=e.query();e.query(""),$.ajax({url:e.toString(),type:"POST",data:t,dataType:"json",success:function(e){pt(e)},error:function(e){console.log("getServerConfig: error")}})};var it=function(e){e=e||virtualViewer.getActiveOuterDiv();var t;t=!s.imageScrollBars||W<10?20:2*W;var a=e.width()-t;return a<0&&(a=0),a};g.prototype.getOuterDivClientWidth=function(e){return it(e)};var ot=function(e){e=e||virtualViewer.getActiveOuterDiv();var t=e.height(),a=e.find(".vvInner"),n=Math.floor(a.offset().top)-Math.floor(e.offset().top);return t-=n,t-=W};g.prototype.getOuterDivClientHeight=function(e){return ot(e)},g.prototype.getScrollbarWidth=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var a=document.createElement("div");a.style.width="100%",e.appendChild(a);var n=a.offsetWidth;return e.parentNode.removeChild(e),t-n},g.prototype.copyToNewDocument=function(a){var n=O.getSelectedPageNumbers(),i=ne.copyBookmarksForPageRange(n);if(ne.bookmarkArray=i,a&&n.length>=virtualViewer.getPageCount())return yt(t.getLocalizedValue("errors.onePageLimit")),!1;if(K){var o=K(),r="TIFF",s=n[0];"PDF"===O.getCurrentState(0).getFormatForPage(s)&&(r="PDF");for(var l=[],u=0;u<n.length;u++)l[u]=n[u]+1;l=l.toString(),O.saveDocument(O.getDocumentId(0),{newDocumentId:o,newDisplayName:o,burnRedactions:!1,includeRedactionTags:!1,includeTextAnnotations:!1,includeNonTextAnnotations:!1,copyAnnotations:!0,includeDocumentNotes:!1,includeWatermarks:!1,saveAsFormat:r,pageRangeType:"complex",pageRangeValue:l,copyWatermarks:!0,useCut:a,pageNums:n})}else{var c=d.getActivePaneState(),g="pdf",v=O.getSaveAsDocumentNameGenerator(),p=v(c.getDocumentId(),c.getDisplayName(),g);O.copySelection(!1,function(){e("vvDialogs").copyToNewDialog(p,a,n)})}},g.prototype.createTextAnnContextMenuList=function(){if(l(virtualViewer).annotationToolbarButtons.vvAnnText){if($(".vvAnnText .dropdown-menu").empty(),!s.enableTextRubberStamp||!ie.customStampArray.length)return $(".vvAnnText.vvHasSubDropdown, .vvAnnText.dropdown").removeClass("vvHasSubDropdown dropdown"),void $("a.vvAnnText.dropdown-toggle").attr("data-toggle","");$("li.vvAnnText").addClass("vvHasSubDropdown dropdown"),$("a.vvAnnText.dropdown-toggle").attr("data-toggle","dropdown");var e=t.getLocalizedValue("textAnnContextMenu.newTextAnn","New Text Ann"),a=$.templates("#vvStampDropdownItemTemplate");$(a.render({displayName:e})).appendTo(".vvAnnText .dropdown-menu").on("click",function(){virtualViewer.currentStamp=null,virtualViewer.turnOnAnnotationButton(o.annotationTypes.SANN_EDIT,$(".vvAnnText")),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu()}),$(a.render(ie.customStampArray)).appendTo(".vvAnnText .dropdown-menu").on("click",function(){var e=$(this).data("stamp-row-index");virtualViewer.currentStamp=e,virtualViewer.turnOnAnnotationButton(o.annotationTypes.SANN_EDIT,$(".vvAnnText")),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu()})}},g.prototype.openInTab=function(e){if(e){var a=O.getStateForDocumentId(e,0),n=virtualViewer.getFromDocumentList(e)||{documentId:e,displayName:null};lt();for(var i=0;i<O.newRecentlyViewedList.length;i++)if(e===O.newRecentlyViewedList[i].documentId){n.displayName||(n.displayName=O.newRecentlyViewedList[i].displayName);break}this.addToRecentlyViewed(n),s.multipleDocMode===o.multipleDocModes.viewedDocuments&&this.requestDocumentList(),$("#vvImagePanel").width()<$("#vvThumbs").width()&&virtualViewer.toggleThumbnailPanel(!1);for(var r=null,l=!1,u=!1,c=!1,g=0;g<this.tabs.length;g+=1)if(O.tabs[g]===e){l=!0;break}if(O.tabs.length>=o.maxNumberOfTabs&&!l)return void this.displayExceptionMessage(t.getLocalizedValue("errors.tabTooManyOpen","Too many open tabs."));a?(r=a.getTabNumber(),u=a.getClosedTab()):(c=!0,a=d.openNewState({documentId:e,pageNumber:0,tabNumber:this.tabs.length,zoomMode:ie.getDefaultZoomMode(),paneIndex:0,displayName:n.displayName}),a.setZoom(ie.getDefaultZoomLevel()),O.displayWaitIndicator(!0,a)),u&&(a.setZoomMode(ie.getDefaultZoomMode()),a.setZoom(ie.getDefaultZoomLevel()));var v=c||l===!1||u===!0;if(v){r=O.tabs.length,O.tabs[r]=e;var p=this.getStateForDocumentId(this.tabs[r],0),h=p.getDisplayName()||e,f="<li class='docTabs nav' data-toggle='tab' ><a data-toggle='tooltip' data-placement='bottom' data-title='";f+=h,f+="' href='#vvOuterDiv' class='singleDocTab'><span class='vvTabTextSpan'></span><button class='close rightFloat vvTabCloseButton' type='button' >&times;</button></a></li>";var m,y=$("#vvImageTabs .docTabs:last");m=y.length?$(f).insertAfter(y):$(f).prependTo("#vvImageTabs");var b=m.find(".vvTabTextSpan"),A=m.find(".singleDocTab");this.shortTabNames?(b.text(h.substring(0,16)),h.length>16&&(b.addClass("shortenTab shortenTabSixteen"),A.tooltip({trigger:"hover",show:!1,hide:!1}))):(b.text(h.substring(0,24)),h.length>24&&(b.addClass("shortenTab"),A.tooltip({trigger:"hover",show:!1,hide:!1}))),m.data("vvDocState",p),m.on("drop",ia),m.on("dragover",oa),m.on("dragstart",function(e){e.preventDefault()}),A.click(function(){var e=$(this.parentElement).data("vvDocState");if(e){var t=e.getTabNumber();if(!O.tabs[t])return;O.activeTab!==t&&O.switchToTab(e)}}),je(),rt(),a&&(a.setTabNumber(r),a.setClosedTab(!1))}else r=a.getTabNumber();this.switchToTab(a,!0),window.setTimeout(ba,200)}},g.prototype.selectTab=function(e){var a=e.getTabNumber();if(a<0||a>this.tabs.length)return void this.displayExceptionMessage(t.getLocalizedValue("errors.tabIndexOutOfBounds","Tab index out of bounds."));var n=$("#vvImageTabs .docTabs");n.removeClass("active"),n.eq(a).tab("show"),this.activeTab=a},g.prototype.switchToTab=function(a,n){if(a){ve&&O.setActivePane(0);var i=O.getDocumentId(0),r=O.getStateForDocumentId(i,0);We(a),this.setPreviousAnnObject(this.getCurrentAnnObject()),this.destroyInProgressAnnotation(),this.hideAnnPopUp(),O.clearCanvases(a,$("#vvImageCanvas")[0]);var l=e("vvThumbs"),u=null;if(l.removeThumbs($("#vvPageThumbs")),$(".thumbTabs").removeClass("disabledTab"),c.handleSearchOnTabSwitch(a,r),$("#vvThumbs li:eq(0) a").tab("show"),qe(a),Qe(),r&&(u=r.getZoom(),r.documentModel&&r.isVideo()&&r.getVideoManager().hideVideoDiv(),ut(r)),d.setDisplayedState(a,0),ne.switchTabs(r,a),this.requestDocumentModel(a,!1),s.fitLastBetweenDocuments&&u&&(a.setZoomMode(o.zoomModes.fitCustom),a.setZoom(u)),this.determineEffectiveZoom(a.pageNumber,a),ba(a),this.sizeScroller({state:a}),l.highlightActiveThumbnail(),Sa(),Lt(a),this.resetGuides(),t.cursorNormal(),this.setDragMode(o.dragModes.pan),$("#vvDocumentNoteContentInput").val(""),a.isVideo()){this.videoThumbPrep(a);var g=a.getVideoManager();g.showVideoDiv(),g.resizeVideo()}this.setPageCore(a.pageNumber,a),this.selectTab(a),s.positionLastBetweenDocuments&&r?n?dt(a,r):(ct(a,r),a.clearCachedScroll()):ct(a),O.openDefaultThumb(),re.getMagnifierEnabled()&&re.getMagnifiedImage(a),s.collapseStickiesByDefault&&O.collapseAllStickyNotes(!0),s.enableDocumentNotes&&a.documentModel&&a.documentModel.model.documentNotes&&oe.loadDocumentNotes(),virtualViewer.fillAnnotationList();var v={documentId:a.documentId};le.call("switchToTab",v),r&&(v={currentTabDocumentId:a.documentId,previousTabDocumentId:r.documentId},le.call("switchBetweenTabs",v))}},g.prototype.onDocumentModelLoad=function(t){if(t&&!t.closedTab){if(e("vvWatermarks").loadWatermarks(t),ba(t),this.sizeScroller({state:t}),t.isVideo())return void t.getVideoManager().getVideo();if(d.displayedDocuments[t.currentPaneIndex]===t.getDocumentId()){0===t.currentPaneIndex&&(oe.loadDocumentNotes(),ce=O.pagesWithAnnotations(),ge&&O.showThumbsWithAnnotations());var a=d.getCurrentDiff();ve&&(!a||a.diffDisabled||a.diffDisabledUntilSave?a?za():this.performDiff():this.performDiff(!1,!0))}}},g.prototype.closeLastTab=function(t){t=t||O.getActivePaneState(),(s.splitScreen||ve)&&O.undoSplitScreen(),s.showAnnNavToggle&&($("#vvPageThumbs").hasClass("vvAnnotationNavigation")&&virtualViewer.showAnnotationNaviPanel(!1),$("#vvAnnotationIndicatorToggle").hide()),O.clearCanvases(t,$("#vvImageCanvas")[0]),$("#vvDummyScroller").height(0),O.removeFromRecentlyViewed(t.getDocumentId()),e("vvThumbs").removeThumbs($("#vvPageThumbs")),t.isVideo()&&t.getVideoManager().hideVideoDiv(),O.openDefaultThumb()},g.prototype.closeDocument=function(e,t,a,n){var i=d.getStateForDocumentId(e,t);i&&i.currentPaneIndex===t&&(t>0?a?this.splitScreen(a):this.undoSplitScreen():this.closeTab(e,n),We(),d.removeStateForDocumentId(e,t))},g.prototype.closeTab=function(e){var a,n=typeof e;if("number"===n&&(a=e),"string"===n&&(a=O.tabs.indexOf(e)),(a<0||a>=this.tabs.length)&&!ae)return void this.displayExceptionMessage(t.getLocalizedValue("errors.tabIndexOutOfBounds","Tab index out of bounds."));1===this.tabs.length&&0===a&&(O.closeLastTab(O.getActivePaneState()),ne.bookmarkArray.length>0&&ne.clearAllBookmarks(),O.getDocNotes().length>0&&Ke(),re.getMagnifierEnabled()&&re.toggleMagnifier());var i=$("#vvImageTabs .docTabs").eq(a).remove(),o=this.tabs[a],r=i.attr("aria-controls");$("#"+r).remove();var s=O.getStateForDocumentId(o);if(Za({state:!0},s)){s.setTabNumber(null),s.setClosedTab(!0),this.tabs.splice(a,1);for(var l=a;l<this.tabs.length;l+=1)s=O.getStateForDocumentId(this.tabs[l]),s.setTabNumber(l);this.activeTab>=a&&(this.activeTab-=1,this.activeTab<0&&(this.activeTab=0),s=O.getStateForDocumentId(O.tabs[O.activeTab]),s?this.switchToTab(s):d.removeStateForDocumentId(o)),je();var u={closedDocumentId:o};le.call("afterTabClosed",u)}},g.prototype.confirmCloseDialog=function(t,a){if(!t||!t.documentModel.getModifiedSinceInit())return void We();var n=function(){t.closedTab=!0,O.saveDocument(t.getDocumentId(),{documentPaneIndex:t.currentPaneIndex,skipOverwriteDialog:!0}),O.closeDocument(t.getDocumentId(),t.currentPaneIndex,a)},i=function(){O.closeDocument(t.getDocumentId(),t.currentPaneIndex,a)},o=t.getDisplayName()||t.getDocumentId();e("vvDialogs").confirmChangesDialog(n,i,o,this.willSavingOverwriteCurrentFormat(t))},g.prototype.updateTabName=function(e,t){if(e||(e=virtualViewer.getCurrentState()),e&&e.getDocumentModel()){var a=e.getTabNumber(),n=e.getDisplayName()||e.getDocumentId(),i=e.getDocumentModel(),o=$("#vvImageTabs a").eq(a);o.hasClass("shortenTab")&&o.tooltip("destroy");var r=n,s=o.find(".vvTabTextSpan");i.getModifiedSinceInit()&&(n="*"+n),this.shortTabNames&&n.length>16?(n=n.substring(0,16),s.addClass("shortenTab shortenTabSixteen"),setTimeout(function(){o.tooltip({title:r,trigger:"hover",show:!1,hide:!1})},10)):n.length>24?(n=n.substring(0,24),s.addClass("shortenTab"),s.removeClass("shortenTabSixteen"),setTimeout(function(){o.tooltip({title:r,trigger:"hover",show:!1,hide:!1})},10)):s.removeClass("shortenTab shortenTabSixteen"),s.text()!==n&&(s.text(n),t||je())}},g.prototype.updateAllTabNames=function(e){for(var t=0;t<this.tabs.length;t++){var a=d.getStateForDocumentId(this.tabs[t],0);a&&this.updateTabName(a,!0)}je(e)};var rt=function(){$(".vvTabCloseButton").unbind().click(function(e){e.preventDefault();var t=this.parentElement.parentElement,a=$(t).data("vvDocState");if(a){var n=a.getDocumentId();if(s.unsavedChangesNotification){var i=a.getDocumentModel();i.getModifiedSinceInit()?O.confirmCloseDialog(a):O.closeDocument(n,0)}else O.closeDocument(n,0)}})};g.prototype.getActiveTab=function(){return this.activeTab},g.prototype.addToRecentlyViewed=function(e){this.removeFromRecentlyViewed(e),O.newRecentlyViewedList.length===o.mostRecentlyViewedListLength&&O.newRecentlyViewedList.pop(),O.newRecentlyViewedList.unshift(e),st()},g.prototype.removeFromRecentlyViewed=function(e){for(var t=0;t<O.newRecentlyViewedList.length;t+=1){var a=O.newRecentlyViewedList[t].documentId;if(a===e.documentId){O.newRecentlyViewedList.splice(t,1);break}}st()};var st=function(){var e=new Date;e.setDate(e.getDate()+365);var t=JSON.stringify(O.newRecentlyViewedList);t&&(document.cookie="newRecentlyViewedList="+encodeURIComponent(t)+";expires="+e.toGMTString())},lt=function(){if(document.cookie.length>0){var e="newRecentlyViewedList",t=document.cookie.indexOf(e+"="),a=-1;if(t!==-1){t+=e.length+1,a=document.cookie.indexOf(";",t),a===-1&&(a=document.cookie.length);var n=decodeURIComponent(document.cookie.substring(t,a));if(!n.startsWith("[{"))return!1;for(var i=JSON.parse(n),o=0;o<i.length;o+=1)O.newRecentlyViewedList[o]={},O.newRecentlyViewedList[o].documentId=i[o].documentId,O.newRecentlyViewedList[o].displayName=i[o].displayName,O.newRecentlyViewedList[o]||O.newRecentlyViewedList.splice(o,1);return!0}if(e="recentlyViewedList",t=document.cookie.indexOf(e+"="),t!==-1){t+=e.length+1,a=document.cookie.indexOf(";",t),a===-1&&(a=document.cookie.length),this.recentlyViewedList=decodeURIComponent(document.cookie.substring(t,a)).split(",");for(var r=0;r<this.recentlyViewedList.length;r+=1)O.newRecentlyViewedList[r]={},O.newRecentlyViewedList[r].documentId=decodeURIComponent(this.recentlyViewedList[r]),O.newRecentlyViewedList[r]||O.newRecentlyViewedList.splice(r,1);return!0}return!1}return!1};g.prototype.clearSpecifiedState=function(e){var t=O.tabs[e];d.removeStateForDocumentId(t,0)},g.prototype.resetGuides=function(){this.horizontalGuide.visible=!1,this.horizontalGuide.locked=!1,this.verticalGuide.visible=!1,this.verticalGuide.locked=!1};var ut=function(e){if(e=e||O.getActivePaneState(),e&&!e.isVideo()){var t=d.getOuterDivFromState(e);e.setCachedScrollLeft(t.scrollLeft()),e.setCachedScrollTop(t.scrollTop())}},dt=function(e,t){e=e||d.getActivePaneState(),t&&(e.setCachedScrollLeft(t.getCachedScrollLeft()),e.setCachedScrollTop(t.getCachedScrollTop()))},ct=function(e,t){e=e||d.getActivePaneState(),t=t||e;var a=d.getOuterDivFromState(e),n=t.getCachedScrollLeft(),i=t.getCachedScrollTop();
if("number"!=typeof n||"number"!=typeof i)return!1;var o=it(a);return o<=n&&O.sizeScroller({state:e}),a.scrollLeft(n),a.scrollTop(i),!0};g.prototype.parseClientInstanceId=function(){var e="clientInstanceId",t=document.cookie.indexOf(e+"="),a=null;if(t!==-1){t=t+e.length+1;var n=document.cookie.indexOf(";",t);n===-1&&(n=document.cookie.length),a=decodeURIComponent(document.cookie.substring(t,n))}return a||(a=gt("clientInstanceId")),a},g.prototype.getClientInstanceId=function(){return"string"!=typeof this.clientInstanceId&&this.setClientInstanceId(this.parseClientInstanceId()),this.clientInstanceId},g.prototype.setClientInstanceId=function(e){this.clientInstanceId=e},g.prototype.requestDocumentModel=function(t,a,n){var i=new URI(s.servletPath);i.addQuery("action","getDocumentModel"),i.addQuery("documentId",t.getDocumentId()),i.addQuery("clientInstanceId",O.getClientInstanceId()),o.cacheBuster===!0&&i.addQuery("cacheBuster",Math.random()),i.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var r=i.query();return i.query(""),t.getDocumentModel()&&!a?void O.processDocumentModel(t,a):void $.ajax({url:i.toString(),type:"POST",data:r,dataType:"json",success:function(i){if(mt(i,t.documentId,t.currentPaneIndex)!==!0){var o=new(e("vvDocumentModel"))(i);o.init(),t.setDocumentModel(o),O.processDocumentModel(t,a),t.getDisplayName()&&(o.model.displayName=encodeURIComponent(t.getDisplayName())),e("vvWatermarks").loadWatermarks(t),0===t.currentPaneIndex&&ne.loadBookmarks(t),t.isVideo()&&(O.videoThumbPrep(t),t.getVideoManager().fixVideoDivs(t)),virtualViewer.onDocumentModelLoad(t),n&&n(t),le.call("onDocumentLoad",{documentId:t.documentId})}else{var r={documentId:t.documentId,exceptionMessage:i.exceptionMessage,statusText:i.statusText};if(le.call("requestDocumentModelError",r),O.closeDocument(t.getDocumentId(),t.currentPaneIndex,null,!0),0===t.currentPaneIndex){var s=t.getTabNumber();if(s>0){var l=O.tabs[0],u=d.getStateForDocumentId(l,0);u&&O.switchToTab(u)}}}},error:function(e){console.log("requestDocumentModel: "+e.statusText);var a={documentId:t.documentId,exceptionMessage:e.exceptionMessage,statusText:e.statusText};le.call("requestDocumentModelError",a)}})},g.prototype.requestDocumentList=function(){var t=e("vvThumbs"),a=new URI(s.servletPath);a.addQuery("action","getDocumentList"),a.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),o.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var n=a.query();a.query(""),s.multipleDocMode===o.multipleDocModes.availableDocuments?$.ajax({url:a.toString(),type:"POST",data:n,dataType:"json",success:function(e){if(mt(e)!==!0){if(e.documentList){O.documentList=[];for(var a=0;a<e.documentList.length;a+=1)O.documentList[a]=decodeURIComponent(e.documentList[a]),O.documentList[a]={},O.documentList[a].documentId=decodeURIComponent(e.documentList[a].documentId),e.documentList[a].displayName&&(O.documentList[a].displayName=decodeURIComponent(e.documentList[a].displayName))}else O.documentList=[];t.fillDocThumbs(O.documentList),t.ensureDocThumbIsVisible(),t.loadVisibleThumbs($("#vvDocThumbs"))}},error:function(e){console.log("requestDocumentList: "+e.statusText)}}):s.multipleDocMode===o.multipleDocModes.specifiedDocuments?(t.fillDocThumbs(O.documentList),t.loadVisibleThumbs($("#vvDocThumbs"))):s.multipleDocMode===o.multipleDocModes.viewedDocuments&&(lt()&&(this.documentList=O.newRecentlyViewedList.slice()),t.fillDocThumbs(this.documentList),t.loadVisibleThumbs($("#vvDocThumbs")))};var gt=function(e){var t;return t=vt(window.location.href,e)},vt=function(e,t){var a,n=e.match(new RegExp(t,"i")),i=e.indexOf(n+"=");return i===-1?null:(a=e.substring(i+t.length+1),i=a.indexOf("&"),i>-1&&(a=a.slice(0,i)),a)};g.prototype.reloadDocumentModel=function(t,a,n){var i=this.getStateForDocumentId(t,a);i=i||this.getActivePaneState(),Za({state:!0},i)&&(e("vvThumbs").removeThumbs($("#vvPageThumbs")),this.requestDocumentModel(i,!0,n))},g.prototype.processDocumentModel=function(t,a){var n=t.getDocumentModel();n.lastSelectedPageNumber=t.pageNumber;var i=n.getDocumentLength();t.setPageCount(i),t.initPageStatesArray(i,s.defaultZoomMode||o.zoomModes.fitWindow),Sa();var r=e("vvThumbs");0!==t.currentPaneIndex&&0!==O.getActivePane()||(r.fillPageThumbs(t),r.ensurePageThumbIsVisible(t)),Ht(t),0!==t.currentPaneIndex&&0!==O.getActivePane()||(r.loadVisibleThumbs($("#vvPageThumbs")),r.loadVisibleThumbs($("#vvDocThumbs"))),virtualViewer.requestAnnotations(t,a)};var pt=function(e){$a(e.disableUploadDocument),O.ocrEnabled=e.ocrEnabled,s.enableCacheObfuscation=e.cacheObfuscationEnabled},ht=function(t,a){if(a){var n=null,i=null,r=null,l=null,u=null,d=null,c=null,g=null,v=null,p=null,h=null,f=(e("vvThumbs"),a.getDocumentId()),m=a.getPageNumber();if(t){if(mt(t)===!0)return;n=t.imageWidth,i=t.imageHeight,r=t.imageDPI,l=t.imageBitDepth,u=t.compressionType,d=t.imageFormat,p=t.customerMetadataKeys,h=t.customerMetadataValues,c=t.tiffTagDataValues,g=t.tiffTagDataLabels,v=t.isSearchable,m=t.documentPageNumber,a.setDocumentByteSize(t.documentByteSize);var y=a.getDocFormat();null!==y&&""!==y||a.setDocFormat(t.fileExtension),a.pageStates[m].imageInfoLoaded=!0;var b=!!s.preferServerDisplayName;if(a.isVirtualDocument()){if(!a.getDisplayName()){var A=a.getVirtualDocumentComponents();t.documentId===A[0]&&(t.displayName?virtualViewer.setDisplayName(decodeURIComponent(t.displayName),t.documentId):virtualViewer.setDisplayName(t.documentId))}}else if((s.multipleDocMode===o.multipleDocModes.specifiedDocuments||s.multipleDocMode===o.multipleDocModes.viewedDocuments)&&virtualViewer.documentList.length>0){for(var P=0;P<virtualViewer.documentList.length;P+=1)if(virtualViewer.documentList[P].documentId===f){a.getDisplayName()&&!b||(virtualViewer.documentList[P].displayName&&!b?virtualViewer.setDisplayName(virtualViewer.documentList[P].displayName):t.displayName&&(virtualViewer.documentList[P].displayName=t.displayName,virtualViewer.setDisplayName(decodeURIComponent(t.displayName),t.documentId)));break}}else t.documentId!==f||!t.displayName||a.getDisplayName()&&!b||virtualViewer.setDisplayName(decodeURIComponent(t.displayName),t.documentId);var T=a.getIsSearchable();a.setIsSearchable(v),0===O.getActivePane()&&(qe(a),O.updateTabName(a)),(!s.enableSVGSupportForIE&&"Explorer"===BrowserDetect.browser||!s.enableSVGSupportForEdge&&"Edge"===BrowserDetect.browser)&&(t.isSVGable=!1),a.setDPIForPage(m,r),a.setBitDepthForPage(m,l),a.setCompressionTypeForPage(m,u),a.setSVGableForPage(m,t.isSVGable),a.setOriginalWidthForPage(m,n),a.setOriginalHeightForPage(m,i),a.setImageLayers(t.imageLayerNames),a.setFormatForPage(m,d);for(var S={},w=0;w<g.length;w++)S[g[w]]=c[w];var I={};if(p){for(var C=0;C<p.length;C++)I[p[C]]=h[C];a.setDocumentModelPropertyHash(I)}a.setTiffTagHashForPage(m,S),virtualViewer.determineEffectiveZoom(m,a)}else O.updateTabName(a),virtualViewer.determineEffectiveZoom(m,a);We(a),virtualViewer.delayedPaintCanvases(a);for(var D=0;D<O.newRecentlyViewedList.length;D+=1)if(a.getDocumentId()===O.newRecentlyViewedList[D].documentId){O.newRecentlyViewedList[D].displayName=a.getDisplayName(),st();break}ft(T)}},ft=function(e){if(d.getCurrentDiff()&&null===e){var t=d.getCurrentDiff();t.diffDisabled||t.diffDisabledUntilSave||null!==t.oldDocument.state.getIsSearchable()&&null!==t.newDocument.state.getIsSearchable()&&virtualViewer.performDiff(!1,!0)}};g.prototype.checkServerException=function(e){mt(e)};var mt=function(e,a,n){var i=e.exceptionMessage;if(i&&!te){Se=i,i=decodeURIComponent(i),a=a||virtualViewer.getDocumentId(n);var o={documentId:a,displayName:null};return virtualViewer.removeFromRecentlyViewed(o),i.includes("Format not supported")?O.exportUnsupportedFile(a):i.includes("Encrypted or Password Protected File")||i.includes("Password Protected Document")?O.passwordProtectedFile(a):(i.includes("A document by this name already exists.")&&(i=t.getLocalizedValue("uploadExistingDocument","A document by this name already exists. Please rename the file and try again")),yt(i),O.displayWaitIndicator(!1),O.displaySaveIndicator(!1)),!0}return i===Se};g.prototype.displayExceptionMessage=function(e){yt(e)};var yt=function(e){te=$("#vvCurrentExceptionDialog"),$("#vvCurrentExceptionDialog").modal("show"),$("#vvCurrentExceptionText").text(e),$("#vvCurrentExceptionOKButton").click(function(e){te=null})};g.prototype.exportUnsupportedFile=function(t){ae=!0,e("vvThumbs").removeThumbs($("#vvPageThumbs")),O.displayWaitIndicator(!1),O.displaySaveIndicator(!1);var a=$("#vvExportUnsupportedFileDialog");a.data().documentId=t,a.modal("show")},g.prototype.passwordProtectedFile=function(t){ae=!0,e("vvThumbs").removeThumbs($("#vvPageThumbs")),O.displayWaitIndicator(!1),O.displaySaveIndicator(!1);var a=$("#vvPasswordProtectedFileDialog");a.data().documentId=t,a.modal("show")},g.prototype.requestAnnotations=function(e,t){var a=e.getDocumentModel(),n=e.getPageNumber();if(a){var i=null;if(e&&(t&&e.clearAllLayers(),i=e.getLayersForPage(n)),!i){var r=new URI(s.servletPath);r.addQuery("action","getAnnotationModel"),r.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),r.addQuery("modelJSON",JSON.stringify(a.model)),o.cacheBuster===!0&&r.addQuery("cacheBuster",Math.random()),r.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var l=r.query();r.query("");var d=a.model.layerManager.layers.length;$.ajax({url:r.toString(),type:"POST",data:l,dataType:"json",success:function(t){for(var n=t,i=0;i<d;i+=1){var o=a.model.layerManager.layers[i],r=n[o.annotationId];if(!r)return;for(var s=0;s<r.length;s+=1){var l=r[s];if(l)u.parseLayer($.parseXML(l),e,s);else{var c=u.createAnnotationLayer(o.annotationId,s,e.pageStates[s]);c.isRedaction=o.isRedaction,c.permissionLevel=o.permissionLevel,e.addLayerToPage(s,c)}}}0===O.pagesWithAnnotations().length&&virtualViewer.showAnnotationNaviPanel(!1),virtualViewer.showAllAnnotationIndicators(),$("#vvImageCanvas")&&virtualViewer.delayedPaintCanvases(e),virtualViewer.fillAnnotationList()},error:function(e){console.log("requestAnnotations: "+e.statusText)}})}}},g.prototype.getPagePropertyByFieldId=function(e){if(Za({state:!0}))return m(e,O.getActivePaneState())},g.prototype.getPagePropertyByCaption=function(e){if(Za({state:!0}))for(var t=0;t<s.imageInfoFields.length;t++){var a=s.imageInfoFields[t].fieldCaption;if(a===e){var n=s.imageInfoFields[t].fieldId;return m(n,O.getCurrentState())}}},g.prototype.getPageProperties=function(){if(Za({state:!0,notVideo:!0})){retVal=[];for(var e,a,n,i,o=0;o<s.imageInfoFields.length;o++){e=s.imageInfoFields[o].fieldId;var r=s.imageInfoFields[o].fieldCaption;a=t.getLocalizedValue("imageInfo."+e,r),n=m(e,d.getActivePaneState()),n||(n="N/A"),i=b(n),retVal[o]={},retVal[o].fieldId=e,retVal[o].fieldValue=i,retVal[o].fieldCaption=a}return retVal}},g.prototype.pageHasText=function(){if(Za({state:!0,documentModel:!0,notVideo:!0})){var e=d.getActivePaneState(),t=e.getPageText(e.getPageNumber());return!!t&&t.wordRects.length>0}},g.prototype.getIsAnnButtonSticky=function(){return Pe},g.prototype.undoAnnotation=function(){if(Za({state:!0,documentModel:!0,notVideo:!0})){virtualViewer.hideAnnPopUp();var e=d.getActivePaneState(),t=e.getUndoObjectArray(e.getPageNumber()),a=e.getUndoIndex(e.getPageNumber());if(!(a<0)&&t[a]){var n=t[a],i=n.referenceAnn,o=n.layer;if("modify"===n.type)n.unchangedAnn&&i&&(i.copyFrom(n.unchangedAnn),u.markLayerDirty(o),virtualViewer.delayedPaintCanvases(e),O.pageContainsAnnotations(O.getPageNumber())&&!O.pageHasIndicator(e.getPageNumber())&&(virtualViewer.showAnnotationIndicator(e.getPageNumber()),O.addToPagesWithAnnotations(e.getPageNumber())));else if(o.anns.length>0){u.markLayerDirty(o);var r=o.anns.pop();e.pushPoppedObject(e.getPageNumber(),r),virtualViewer.setPreviousAnnObject(virtualViewer.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null),virtualViewer.delayedPaintCanvases(e),!O.pageContainsAnnotations(e.getPageNumber())&&O.pageHasIndicator(e.getPageNumber())&&(virtualViewer.removeAnnotationIndicators(e.getPageNumber()),O.removeFromPagesWithAnnotations(e.getPageNumber()))}a>=0&&(a--,e.setUndoIndex(e.getPageNumber(),a))}}},g.prototype.redoAnnotation=function(){if(Za({state:!0,documentModel:!0,notVideo:!0})){var e=d.getActivePaneState(),t=e.getUndoObjectArray(e.getPageNumber()),a=e.getUndoIndex(e.getPageNumber())+1;if(t[a]){var n=t[a],i=n.referenceAnn,o=n.layer;if("modify"===n.type)n.modifiedAnn&&i&&(i.copyFrom(n.modifiedAnn),u.markLayerDirty(o),virtualViewer.delayedPaintCanvases(e),!O.pageContainsAnnotations(e.getPageNumber())&&O.pageHasIndicator(e.getPageNumber())&&(virtualViewer.removeAnnotationIndicators(e.getPageNumber()),O.removeFromPagesWithAnnotations(e.getPageNumber())));else if(e.getPoppedObjectArray(e.getPageNumber()).length>0){var r=e.popPoppedObject(e.getPageNumber());o.anns.push(r),u.markLayerDirty(o),virtualViewer.clearCanvases(e),virtualViewer.delayedPaintCanvases(e),O.pageContainsAnnotations(e.getPageNumber())&&!O.pageHasIndicator(e.getPageNumber())&&(virtualViewer.showAnnotationIndicator(e.getPageNumber()),O.addToPagesWithAnnotations(e.getPageNumber()))}(0===a||a<t.length-1)&&e.setUndoIndex(e.getPageNumber(),a)}}},g.prototype.getAnnClipboard=function(){return Ae},g.prototype.setAnnClipboard=function(e){Ae=e};var bt=function(){return s.autoLayerPrefix},At=function(){return s.autoLayerSuffix},Pt=function(e,a){var n,i=bt(),r=At(),s=o.autoLayerName;if(a=a||O.getActivePaneState(),!a.autoLayerCounter){a.autoLayerCounter=0;for(var l=a.getLayerNames(),u=0;u<l.length;u++)for(var d=l[u],c=d.split("-"),g=0;g<c.length;g++)if(c[g]===o.autoLayerName&&c[g+1]){var v=parseInt(c[g+1],10);a.autoLayerCounter=Math.max(v,a.autoLayerCounter);break}a.autoLayerCounter++}var p=a.autoLayerCounter;return n=e?o.redactionLayerPrefix+"-"+t.vvGUID():i&&r?i+"-"+s+"-"+p+"."+r:i&&!r?i+"-"+s+"-"+p:!i&&r?s+"-"+p+"."+r:s+"-"+p,a.autoLayerCounter++,n};g.prototype.createAutoLayer=function(e){return Tt(e)};var Tt=function(e){var t=virtualViewer.getActivePaneState(),a=Pt(e,t);return u.createLayer(a)};g.prototype.consolidateAnnotationLayers=function(){if(Za({state:!0,documentModel:!0,notVideo:!0})&&s.enableConsolidateAnnotationLayer&&!s.oneLayerPerAnnotation){var e=d.getActivePaneState(),a=e.getLayerNames(),n=s.consolidateLayerName||"Master Layer";if(!a.length)return void yt(t.getLocalizedValue("errors.noLayersExist","No Layers Exist."));if(a.indexOf(n)>-1)return void yt(t.getLocalizedValue("errors.masterLayerExists","Please delete your current Master Layer to create another."));u.createLayer(n),O.updateTabName(e);for(var i=0;i<e.getPageCount();i++)for(var o=e.getLayersForPage(i),r=o[n],l=Object.keys(o),c=0;c<l.length;c++){var g=o[l[c]];if(g&&g.layerName!==n)for(var v=0;v<g.anns.length;v++){var p=g.anns[v].clone();p.setLayerName(n),e.getOriginalWidthForPage(i)||r.pageWidth||(r.pageWidth=p.pageWidth,r.pageHeight=p.pageHeight,r.docDPI=p.docDPI),r.anns.push(p),e.setViewedForPage(i,!0)}}}};var St=function(e){var a=d.getActivePaneState(),n=a.getLayerNames(),i=[],o=[];if(!n)return[];for(var r=0;r<a.getPageCount();r++){var s=a.getLayersForPage(r);if(s)for(var l=Object.keys(s),u=0;u<l.length;u++){var c=s[l[u]];if(c)for(var g=c.anns,v=0;v<g.length;v++){var p=g[v];i.indexOf(p)!==-1||p.annDelete||(t.isRedactionLayer(c)?e&&o.push(p):i.push(p))}}}return e?o:i};g.prototype.getRedactionsFromLayers=function(){return St(!0)},g.prototype.getAnnotationCount=function(){return St(!1).length},g.prototype.getRedactionCount=function(){return St(!0).length},g.prototype.getRedactionPages=function(){for(var e=St(!0),t=[],a=0;a<e.length;a++)t.indexOf(e[a].page)===-1&&t.push(e[a].page);return t};var wt=function(t){O.setPage(t.page),O.setCurrentAnnObject(t),O.getActiveOuterDiv().scrollTop(O.getScrollSpeed()*t.page+t.getAdjustedTop()),e("vvThumbs").highlightActiveThumbnail()},It=function(e,t){for(var a,n=0;n<t.length;n++)if(t[n].page===e){a=t[n];break}return a},Ct=function(e,a){e||(e=O.getRedactionPages()),a||(a=St(!0));var n;if(O.getCurrentAnnObject()&&t.isRedactionLayer(u.getLayerWithAnn(O.getCurrentAnnObject()))){var i=a.indexOf(O.getCurrentAnnObject())-1;a[i]&&(n=a[i])}if(!O.getCurrentAnnObject()||!t.isRedactionLayer(u.getLayerWithAnn(O.getCurrentAnnObject()))){var o=O.getCurrentState().getPageNumber();if(e.indexOf(o)>-1)n=It(o,a);else{var r=O.closestLowest(o,e);n=It(r,a)}}return n};g.prototype.goToPreviousRedaction=function(){var e,t=St(!0),a=O.getRedactionPages(),n=a[0];!a||O.getCurrentState().getPageNumber()<n||(e=Ct(a,t),e&&"true"!==$("#vvPrevAnnotationButton").prop("disabled")&&(wt(e),Nt(e,t)))};var Dt=function(e,a){e||(e=O.getRedactionPages()),a||(a=St(!0));var n;if(O.getCurrentAnnObject()&&t.isRedactionLayer(u.getLayerWithAnn(O.getCurrentAnnObject()))){var i=a.indexOf(O.getCurrentAnnObject())+1;a[i]&&(n=a[i])}if(!O.getCurrentAnnObject()||!t.isRedactionLayer(u.getLayerWithAnn(O.getCurrentAnnObject()))){var o=O.getCurrentState().getPageNumber();if(e.indexOf(o)>-1)n=It(o,a);else{var r=O.closestHighest(o,e);n=It(r,a)}}return n};g.prototype.goToNextRedaction=function(){var e,t=St(!0),a=O.getRedactionPages(),n=a[a.length-1];!a||O.getCurrentState().page>n||(e=Dt(a,t),e&&(wt(e),Nt(e,t)))};var xt=function(){$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide"),$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide"),$("#vvAnnotationThumbsButton").prop("disabled",!0).addClass("disabled").tooltip("hide")},Mt=function(){$("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled")},Nt=function(e,t){$("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled"),e===t[t.length-1]?$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide"):e===t[0]&&$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide")};g.prototype.toggleAnnotationVisibility=function(e){if(Za({state:!0,documentModel:!0,notVideo:!0})){var t=d.getActivePaneState();t.getLayerManager().toggleAllAnnotationLayersVisibility(e,t)}},g.prototype.event=function(e,t,a){if(s.enableEventNotification!==!1){e||(e=d.getActivePaneState());var n=new URI(s.servletPath),i={action:"eventNotification",KEY_EVENT:t,KEY_DOCUMENT_ID:e.getDocumentId(),clientInstanceId:virtualViewer.getClientInstanceId(),overrideLoggingLevel:virtualViewer.loggingOverride()};i=$.extend(i,a),o.cacheBuster&&(i.cacheBuster=Math.random()),$.ajax({url:n.toString(),type:"POST",data:i,dataType:"json",success:function(e){mt(e)===!0},error:function(e){mt(e)===!0}})}};var Lt=function(e){O.event(e,"VALUE_EVENT_PAGE_REQUESTED",{KEY_EVENT_PAGE_REQUESTED_NUMBER:e.pageNumber})},Vt=function(){for(var e=d.getActivePaneState(),t={KEY_EVENT_PAGE_REQUESTED_NUMBER:e.pageNumber},a=e.getLayerNames(),n=0;n<a.length;n+=1)t["KEY_EVENT_SAVE_ANNOTATION_LAYER_NAME"+n]=a[n];O.event(e,"VALUE_EVENT_SAVE_ANNOTATION",t)},$t=function(e,t){for(var a=d.getActivePaneState(),n={KEY_EVENT_ROTATE_PAGE:e,VALUE_EVENT_ROTATE_DEGREES:t},i=0;i<e.length;i+=1)n["KEY_EVENT_ROTATE_PAGE"+i]=e[i];O.event(a,"VALUE_EVENT_ROTATE_PAGE",n)};g.prototype.createPreviewAnnotation=function(e,t,a){return kt(e,t,a)};var kt=function(t,a,n){n=n||d.getActivePaneState();var i,l,c,g,v,p;if(a||0===a||(a=n.getPageNumber()),se.dragMode===o.dragModes.crop&&(X=o.annotationTypes.SANN_RECTANGLE),X===o.annotationTypes.SANN_BITMAP&&s.enableSingleClickImageRubberStamp){var h=ue.stampArray[ue.currentImageRubberStamp],f=n.getZoom();i=h.stampWidth*(f/100),l=h.stampHeight*(f/100),se.dragStartLeft+i>n.pageStates[a].requestedWidth&&(se.dragStartLeft=n.pageStates[a].requestedWidth-i),se.dragStartTop+l>n.pageStates[a].requestedHeight&&(se.dragStartTop=n.pageStates[a].requestedHeight-l)}else i=se.dragStopLeft-se.dragStartLeft,l=se.dragStopTop-se.dragStartTop;var m=new r(se.dragStartLeft,se.dragStartTop,i,l),y=X;null===y&&null!==virtualViewer.currentAnnType&&(y=virtualViewer.currentAnnType),t===!0||X!==o.annotationTypes.SANN_BUBBLE&&X!==o.annotationTypes.SANN_CLOUD_EDIT&&X!==o.annotationTypes.SANN_EDIT&&(X!==o.annotationTypes.SANN_BITMAP||s.enableSingleClickImageRubberStamp)||(y=o.annotationTypes.SANN_RECTANGLE);var b=ie.getAnnotationPreference(X);c=b.lineWidth,g=b.lineColor,v=b.fillColor,p=s.annotationDefaults.highlightOpacity,X!==o.annotationTypes.SANN_FILLED_RECT&&X!==o.annotationTypes.SANN_HIGHLIGHT_RECT&&X!==o.annotationTypes.SANN_FILLED_ELLIPSE&&X!==o.annotationTypes.SANN_FILLED_POLYGON&&X!==o.annotationTypes.SANN_CIRCLE||(g=null,v=b.fillColor),t||X!==o.annotationTypes.SANN_POSTIT&&X!==o.annotationTypes.SANN_EDIT||(c=1);var A,P=n.getCurrentLayerOnPage(a);P?A=P.docDPI:n.getDPIForPage(a),null!==P&&void 0!==P||(P=u.createAnnotationLayer("temp",a,n.pageStates[a])),P.isIDM&&(A=200),X===o.annotationTypes.SANN_REDACTION_RECT&&(g=null,v=s.annotationDefaults.redactionFillColor,p=s.annotationDefaults.redactionOpacity);var T=P.doubleByte;s.oneLayerPerAnnotation&&(T=s.base64EncodeAnnotations);var S=new(e("vvPreviewAnnotation"));if(S.initPreview(y,m,g,v,c,p,O.currentPointArray,T,A,P.isIDM,a,P),S.getType()===o.annotationTypes.SANN_REDACTION_RECT&&(S.setFillColorRGB(s.annotationDefaults.redactionFillColor),S.setOpacity(s.annotationDefaults.redactionOpacity)),t===!1){S.setPageWidth(n.pageStates[a].originalWidth),S.setPageHeight(n.pageStates[a].originalHeight);var w=S.getFontSize()||b.fontSize,I=S.getLineWidth();S.setPageWidth(n.pageStates[a].requestedWidth),S.setPageHeight(n.pageStates[a].requestedHeight),S.setFontSize(w),S.setLineWidth(I)}if(P.isFilenet&&(S.isFilenet=!0),P.isDaeja&&(S.isDaeja=!0),P.isIDM&&(S.isIDM=!0,S.getType()===o.annotationTypes.SANN_POSTIT?S.setFontSize(200,!0):S.getType()===o.annotationTypes.SANN_EDIT),S.getType()===o.annotationTypes.SANN_BITMAP&&(S.bitmapData=ue.getCurrentStamp().stampData),void 0!==O.currentStamp&&null!==O.currentStamp&&O.currentStamp>-1){var C=ie.customStampArray[O.currentStamp];C.textString&&S.setTextString(C.textString),C.fontFace&&S.setFontName(C.fontFace),C.fontSize&&S.setFontSize(C.fontSize),C.fontBold&&(S.fontBold=C.fontBold),C.fontItalic&&(S.fontItalic=C.fontItalic),C.fontStrike&&(S.fontStrike=C.fontStrike),C.fontUnderline&&(S.fontUnderline=C.fontUnderline),C.fontColor&&(S.fontColor=C.fontColor)}return S},Bt=function(e){return"string"!=typeof e&&(e=$("#vvAnnotationsListFilter input").val()),e?void $(".vvAnnotationItem").each(function(){var t=$(this),a=t.find(".vvAnnotationListInfoCreated .vvAnnotationListInfoUser div").text().toLowerCase(),n=t.find(".vvAnnotationListInfoModified .vvAnnotationListInfoUser div").text().toLowerCase();return e=e.toLowerCase(),a.indexOf(e)!==-1||n.indexOf(e)!==-1?void t.show():void t.hide()}):void $(".vvAnnotationItem").show()},Rt=function(e){e.preventDefault();var t=$(this).text().trim();Bt(t),$("#vvAnnotationsListFilter input").val(t)};g.prototype.updateAnnotationListItem=function(e){if(s.showAnnotationList){var t=virtualViewer.getListItemFromAnnotation(e);if(t&&t.length){if(e.getDelete())return void t.remove();e.getTextString()&&t.find(".vvAnnotationListInfoText").text(e.getTextString()),t.find(".vvAnnotationListInfoModified .vvAnnotationListInfoUser .vvAnnInfoEntry").text(e.getMostRecentModifyUser()),t.find(".vvAnnotationListInfoModified .vvAnnotationListInfoDate .vvAnnInfoEntry").text(e.getMostRecentModifyDateFormatted()),Bt()}}};var Ft=function(){var e=$("#vvAnnotationsListFilter input");e.on("keypress",Bt);var a=null;e.addClear({symbolClass:"text_clear_symbol icon",onClear:function(){Bt("")}}),e.keydown(function(){a&&clearTimeout(a),a=setTimeout(function(){Bt(e.val())},200)}),e.prop("placeholder",t.getLocalizedValue("annotationInfoList.filterByUser","Filter by User")),$("#vvFilterOptionsDropdownOptions li a").on("click",function(t){t.preventDefault(),Bt(""),e.val("")})};g.prototype.getListItemFromAnnotation=function(e){if(!e)return $();var t=$(".vvAnnPage"+e.page);if(!t||!t.length)return $();var a=t.find(".vvAnnotationItem").filter(function(){var t=$(this);return t.data("layername")===e.layerName&&t.data("ordinal")===e.ordinal});return a};var Et=function(e){var t=$(this),a=t.data("layername");if(a){for(var n,i=t.data("ordinal"),o=t.data("type"),r=d.getCurrentState(),s=r.getLayerFromPage(t.data("pagenumber"),a)||{anns:[]},l=s.anns,u=0;u<l.length;u++)if(l[u].ordinal===i&&l[u].type===o){n=l[u];break}n&&wt(n)}};g.prototype.addUsersToDropDown=function(e,t){var a=$("#vvFilterOptionsDropdownOptions .vvAnnotationListUserOption a").filter(function(){var a=$(this).text().trim();if(a===e||a===t)return!0}),n={};e&&a.eq(0).text().trim()!==e&&a.eq(1).text().trim()!==e&&(n[e]=!0),t&&a.eq(0).text().trim()!==t&&a.eq(1).text().trim()!==t&&(n[t]=!0);var i=$($("#vvAnnotationListUserOptionTemplate").render(n));i.appendTo($("#vvFilterOptionsDropdownOptions")),i.on("click",Rt)},g.prototype.addSingleAnnotationListItem=function(e){if(s.showAnnotationList&&!this.getListItemFromAnnotation(e).length){var t=$($("#annotationListItemTemplate").render(e));t.on("click",Et),this.addUsersToDropDown(e.getMostRecentModifyUser(),e.createUser);var a=this.pagesWithAnnotationsCore(d.getCurrentState()),n=a.indexOf(e.page);if(n!==-1){var i=$(".vvAnnotationListPageDiv.vvAnnPage"+e.page);if(i.length&&i.data("pagenumber")===e.page)return void i.append(t);var o=$("<div></div>").addClass("vvAnnotationListPageDiv vvAnnPage"+e.page).data("pagenumber",e.page).append(t);if(i.length)return void i.before(o);$("#vvAnnotationsListInternal").append(o),Bt()}}},g.prototype.fillAnnotationList=function(){var e=d.getCurrentState();if(s.showAnnotationList&&e){var t=$("#vvAnnotationsListInternal");t.empty();for(var a=$("#annotationListItemTemplate"),n={},i=0;i<e.getPageCount();i++){for(var o=$("<div></div>").addClass("vvAnnotationListPageDiv vvAnnPage"+i).data("pagenumber",i),r=e.getAnnotationsForPage(i,!0)||[],l=0;l<r.length;l++){var u=$(a.render(r[l]));u.on("click",Et),o.append(u);var c=r[l].getMostRecentModifyUser(),g=r[l].createUser;n[c]=!0,n[g]=!0}r.length&&t.append(o)}n[ie.getUsername()]=!0,$("#vvFilterOptionsDropdownOptions .vvAnnotationListUserOption").remove();var v=$($("#vvAnnotationListUserOptionTemplate").render(n));v.appendTo($("#vvFilterOptionsDropdownOptions")),v.on("click",Rt)}},g.prototype.thumbsWithAnnotations=function(){var e=O.getCurrentState();if(Za({state:!0,documentModel:!0,notVideo:!0},e)){for(var t=[],a=$("#vvPageThumbs .vvThumbBox"),n=0;n<e.getPageCount();n+=1)O.pageContainsAnnotations(n)&&t.push(a.eq(n));return t}},g.prototype.showThumbsWithAnnotations=function(){var a=O.getCurrentState();if(ge||$("#vvRedactionNavigationOption")[0].checked)$("#vvRedactionNavigationOption")[0].checked||($("#vvAnnotationThumbsButton").removeClass("ann-filter-on"),$("#vvPageThumbs .vvThumbBox").show(),O.showAllAnnotationIndicators(),ge=!1,$("#vvAnnotationThumbsButton").attr("title",t.getLocalizedValue("annotationNavigation.showThumbsWithAnnotationsOn","Turn Filter On")));else{$("#vvAnnotationThumbsButton").addClass("ann-filter-on");for(var n=0;n<a.getPageCount();n++)O.pageHasAnnotation(n)?O.removeAnnotationIndicators(n):$("#vvPageThumbs .vvThumbBox:eq("+n+")").hide();ge=!0,$("#vvAnnotationThumbsButton").attr("title",t.getLocalizedValue("annotationNavigation.showThumbsWithAnnotationsOff","Turn Filter Off")),e("vvThumbs").loadVisibleThumbs()}},g.prototype.showAnnotationIndicator=function(e){if(Za({state:!0,documentModel:!0,notVideo:!0})&&s.showAnnIndicators&&!this.pageHasIndicator(e)){var t=$("#vvPageThumbs .vvThumbBox").eq(e);$("<div></div>",{class:"vvAnnotationIndicatorCheckmark icon"}).prependTo(t)}},g.prototype.removeAnnotationIndicators=function(e){Za({})&&s.showAnnIndicators&&"number"==typeof e&&$("#vvPageThumbs .vvThumbBox:eq("+e+") .vvAnnotationIndicatorCheckmark").remove()},g.prototype.removeAllAnnotationIndicators=function(){Za({})&&$("#vvPageThumbs").find(".vvAnnotationIndicatorCheckmark").remove()},g.prototype.showAllAnnotationIndicators=function(){if(Za({state:!0,documentModel:!0,notVideo:!0})&&s.showAnnIndicators){var e=this.getCurrentState();if(e.isVirtualDocument())for(var t=0;t<e.getPageCount();t++)this.pageHasAnnotation(t)&&this.showAnnotationIndicator(t);else{var a=this.pagesWithAnnotations();ce=a;for(var n=0;n<a.length;n+=1)this.showAnnotationIndicator(a[n])}}},g.prototype.pageHasAnnotation=function(e){var t=O.getCurrentState();if(e>=t.getPageCount())return!1;for(var a=t.pageStates[e].annotationLayers||{},n=Object.keys(a),i=0;i<n.length;i++){var o=n[i];if(a[o]){var r=a[o];if(0!==r.anns.length)return!0}}return!1},g.prototype.closestHighest=function(e,t){for(var a=t.length-1,n=t[a],i=0;i<t.length;i++)t[i]>e&&t[i]<n&&(n=t[i]);return n};var Ot=function(e,t){var a,n=t.indexOf(e);return a=n===-1?O.closestHighest(e,t):t[n+1]};g.prototype.goToNextPageWithAnn=function(){var t=O.pagesWithAnnotations(),a=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0})){var n,i=a.pageNumber,o=t[t.length-1];if($("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled"),!t.length||i>=o)return void $("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide");n=Ot(i,t),virtualViewer.setPage(n),e("vvThumbs").highlightActiveThumbnail()}},g.prototype.closestLowest=function(e,t){for(var a=t[0],n=0;n<t.length;n++)t[n]<e&&t[n]>a&&(a=t[n]);return a};var _t=function(e,t){var a,n=t.indexOf(e);return a=n===-1?O.closestLowest(e,t):t[n-1]};g.prototype.goToPrevPageWithAnn=function(){var t=O.pagesWithAnnotations(),a=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0})){var n,i=a.pageNumber;if($("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),!i||!t.length||i<=t[0])return void $("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide");n=_t(i,t),virtualViewer.setPage(n),e("vvThumbs").highlightActiveThumbnail()}};var Ut=function(e,t){var a=t.length-1;t.length<=1?($("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled"),$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled")):e===t[0]?($("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled")):e>=t[a]?($("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled")):($("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled"))};g.prototype.navigationButtonHandler=function(e){if(e){var t=St(!0),a=Dt(),n=Ct();a&&Nt(a,t),n&&Nt(a,t)}else{var i=O.pagesWithAnnotations(),o=O.getActivePaneState().getPageNumber(),r=_t(o,i);r&&Ut(r,i);var s=Ot(o,i);s&&Ut(s,i)}},g.prototype.showAnnotationNaviPanel=function(e){var t=$("#vvPageThumbs");if(!Za({state:!0,documentModel:!0,notVideo:!0}))return t.removeClass("vvAnnotationNavigation"),void t.addClass("vvAnnotationNavigationHidden");var a=O.pagesWithAnnotations();return t.hasClass("vvAnnotationNavigation")&&!e||e===!1?(t.removeClass("vvAnnotationNavigation"),void t.addClass("vvAnnotationNavigationHidden")):(t.addClass("vvAnnotationNavigation"),t.removeClass("vvAnnotationNavigationHidden"),O.createNavigationOptionsLabels(),void(a.length<=1&&($("#vvPrevAnnotationButton").attr("aria-disabled",!0),$("#vvNextAnnotationButton").attr("aria-disabled",!0))))},g.prototype.navigationChangeHandler=function(e){"redaction"===$("input[name='radio']:checked").val()&&"vvNextAnnotationButton"===e.target.id?O.goToNextRedaction():"vvNextAnnotationButton"===e.target.id&&O.goToNextPageWithAnn(),"redaction"===$("input[name='radio']:checked").val()&&"vvPrevAnnotationButton"===e.target.id?O.goToPreviousRedaction():"vvPrevAnnotationButton"===e.target.id&&O.goToPrevPageWithAnn()},g.prototype.createNavigationOptionsLabels=function(){var e=O.getAnnotationCount(),t=O.getRedactionCount();$("#vvAnnotationNavigationOptionLabel").html("Annotations: "+e),$("#vvRedactionNavigationOptionLabel").html("Redactions: "+t);
},g.prototype.pageHasIndicator=function(e){var t=$("#vvPageThumbs .vvThumbBox:eq("+e+") .vvAnnotationIndicatorCheckmark");return!!t.length},g.prototype.pagesWithAnnotations=function(){return this.pagesWithAnnotationsCore()},g.prototype.pagesWithAnnotationsCore=function(e){var t=[];if(e=e||d.getCurrentState(),!Za({state:!0,documentModel:!0,notVideo:!0},e))return[];if(e)for(var a=0;a<e.getPageCount();a+=1)O.pageHasAnnotation(a)&&t.push(a);return t},g.prototype.removeFromPagesWithAnnotations=function(e){var t=ce.indexOf(e);t>-1&&ce.splice(t,1)},g.prototype.addToPagesWithAnnotations=function(e){return ce.indexOf(e)===-1&&(ce.push(e),ce.sort()),ce},g.prototype.getVisibleAnnotationPages=function(){return ce},g.prototype.getDragMode=function(){return se.getDragMode()},g.prototype.setDragMode=function(e){se.setDragMode(e)},g.prototype.findPos=function(e){return Wt(e)};var Wt=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);var n=virtualViewer.getActiveOuterDiv();return a-=n.scrollTop(),t-=n.scrollLeft(),[t,a]},zt=function(e,t){return q&&clearTimeout(q),e||t?void(q=setTimeout(function(){Ht(e,t)},50)):void(q=setTimeout(function(){Ht(d.getCurrentState(0),!1),Ht(d.getCurrentState(1),!1)},50))},Ht=function(e,t){if(!e||!e.getDocumentId()||!e.pageStates)return null;var a=e.getPageNumber(),n=a-s.continuousScrollBufferBeforeSize,i=a+s.continuousScrollBufferAfterSize;n||0===n||(n=a-1),i||0===i||(i=a+3);var r=[];t&&(e.clearImageBuffer(),e.getImageManager().nukeBuffers());for(var l=n;l<=i;l++)l<0||l>=e.getPageCount()||e.pageStates[l].imageInfoRequested||r.push(l);if(r.length>0){for(var u=0;u<r.length;u++)if(!e.pageStates[r[u]].imageInfoRequested){e.pageStates[r[u]].imageInfoRequested=!0;var d=new URI(s.servletPath);d.addQuery("action","getImageInfo"),d.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.addQuery("imageInfoFields",JSON.stringify(s.imageInfoFields));var c=da(r[u],e),g=ca(r[u],e);d.addQuery("documentId",c),d.addQuery("pageNumber",g),d.addQuery("documentPageNumber",r[u]),o.cacheBuster&&d.addQuery("cacheBuster",Math.random()),d.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var v=d.query();d.query(""),function(){var t=u;$.ajax({url:d.toString(),type:"POST",data:v,dataType:"json",success:function(t){ht(t,e)},error:function(a){e.pageStates[r[t]].imageInfoRequested=!1,console.log("requestImageInfo: "+a.statusText)}})}()}}else ht(null,e)};g.prototype.validImageObject=function(e){return!(!e||!e.src||""===e.src||e.src.indexOf("data:")===-1)||!(!e||!e.src||e.src.indexOf(o.bogusImageURL)!==-1)},g.prototype.resetSVGSupport=function(e){var t=d.getActivePaneState();t.resetSVGSupport(e)};var Qt=function(e,t,a,n){if(e=e||d.getActivePaneState()){a=a||O.getOuterDivFromState(e),n=n||a.find(".vvScroller"),t=t||a.find(".vvCanvas");var i=!1,o=ot(a),r=it(a);return Math.abs(t[0].width-r)>1&&(t[0].width=r,i=!0),Math.abs(t[0].height-o)>1&&(t[0].height=o,i=!0),i}};g.prototype.positionCanvases=function(e,t,a,n){return Qt(e,t,a,n)},g.prototype.getTransformedPageLeft=function(e){var t=$.extend({},e),a=t.state||d.getActivePaneState(),n=t.page;n||0===n||(n=a.pageNumber);var i=t.pageHeight||a.pageStates[n].requestedHeight,o=t.pageWidth||a.pageStates[n].requestedWidth,r=t.rotateAngle;r||0===r||(r=a.getRotationForPage(n));var s=t.outerDiv||virtualViewer.getOuterDivFromState(a),l=t.dummyScroller||s.find(".vvScroller"),u=t.canvas||s.find(".vvCanvas"),c=$(l).width()-$(s).width();c<0&&(c=0);var g,v=($(u).width()+c)/2-$(s).scrollLeft();return g=90===r?v+i/2:270===r?v-i/2:180===r?v+o/2:v-o/2},g.prototype.getVisualPageLeft=function(e){var t=$.extend({},e),a=t.state||d.getActivePaneState(),n=a.validatePageNumber(t.page);if(n<0)return 0;var i=t.pageHeight||a.pageStates[n].requestedHeight,o=t.pageWidth||a.pageStates[n].requestedWidth,r=t.rotateAngle;r||0===r||(r=a.getRotationForPage(n));var s=t.outerDiv||virtualViewer.getOuterDivFromState(a),l=t.dummyScroller||s.find(".vvScroller"),u=t.canvas||s.find(".vvCanvas"),c=l.width()-s.width();c<0&&(c=0);var g,v=($(u).width()+c)/2-s.scrollLeft();return 90===r||270===r?g=v-i/2:180!==r&&0!==r||(g=v-o/2),g},g.prototype.getVisualPageTop=function(e){var t=$.extend({},e),a=t.state||d.getActivePaneState(),n=a.validatePageNumber(t.page);if(n<0)return 0;var i=t.pageHeight||a.pageStates[n].requestedHeight,o=t.pageWidth||a.pageStates[n].requestedWidth,r=t.rotateAngle;r||0===r||(r=a.getRotationForPage(n));var s=t.currentTransformedTop;return s||0===s||(s=virtualViewer.getTransformedPageTop(t)),0===r||90===r?s:180===r?s-i:270===r?s-o:s},g.prototype.getTransformedPageTop=function(e){var t=$.extend({},e),a=t.state||d.getActivePaneState(),n=t.outerDiv||virtualViewer.getOuterDivFromState(a),i=t.dummyScroller||n.find(".vvScroller"),r=(t.canvas||n.find(".vvCanvas"),t.page);r||0===r||(r=a.pageNumber),a=a||d.getActivePaneState();var s=t.pageHeight||a.pageStates[r].requestedHeight,l=t.pageWidth||a.pageStates[r].requestedWidth,u=t.rotateAngle;u||0===u||(u=a.getRotationForPage(r));var c,g=t.currentZeroPage||Zt(a,n,i),v=-virtualViewer.scrollerToPaint(a,g,n,i);if(r<g)for(var p=g-1;p>=r;p--)c=a.getRotationForPage(p),v-=90===c||270===c?a.pageStates[p].originalWidth*a.getZoomDecimal():a.pageStates[p].originalHeight*a.getZoomDecimal(),v-=o.spaceBetweenPages;else if(r>g)for(var h=g+1;h<=r;h++)c=a.getRotationForPage(h-1),v+=90===c||270===c?a.pageStates[h-1].originalWidth*a.getZoomDecimal():a.pageStates[h-1].originalHeight*a.getZoomDecimal(),v+=o.spaceBetweenPages;return 180===u?v+s:270===u?v+l:v},g.prototype.clearCanvases=function(e,t){e||(e=d.getActivePaneState()),t||(t=e.currentPaneIndex>0&&O.getActivePane()>0?$("#vvSplitCanvas")[0]:$("#vvImageCanvas")[0]);var a=t.getContext("2d");a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,t.width,t.height),a.restore(),$(".vvAnnSelected").removeClass("vvAnnSelected")},g.prototype.delayedPaintCanvases=function(e,t){j&&window.clearTimeout(j);var a=t||50;j=window.setTimeout(O.paintCanvases,a,e)},g.prototype.paintCanvases=function(e){if(e||(e=d.getActivePaneState()),!s.splitScreen||!ve)return void jt(d.getCurrentState(0));for(var t=0;t<d.displayedDocuments.length;t++)jt(d.getCurrentState(t))};var jt=function(a){if(a=a||d.getActivePaneState(),a&&Za({state:!0,documentModel:!0},a)){var n=virtualViewer.getOuterDivFromState(a),i=n.find(".vvCanvas"),o=n.find(".vvScroller"),r=n.find(".vvInner"),l=(a.getPageCount(),virtualViewer.positionCanvases(a,i,n,o));l||virtualViewer.clearCanvases(a,i[0]),$("#vvAnnPopUp:visible").length&&l&&aa(),l&&ve&&re.adjustForWindowResize();var g=n.parents(".split");n.width(g.width()),n.height(g.height()),r.css("position","fixed");var v=n.offset();r.css("left",v.left+10),r.css("top",v.top+20),i=i[0];var p=i.getContext("2d"),h=n.width(),f=a.getImageManager(),m=o.width()-h,y=Zt(a,n,o),b=y+s.continuousScrollBufferAfterSize;b||0===b||(b=y+3);var A,P,T,S,w;if(b>=a.getPageCount()&&(b=a.getPageCount()-1),m<0&&(m=0),a.isVideo())return void a.getVideoManager().resizeVideo();if(a.pageStates){for(var I=y;I<=b;I++)if(!(I<0||I>=a.getPageCount())&&f&&a.pageStates[I]){T=a.getRotationForPage(I);var C=a.pageStates[I].requestedWidth,D=a.pageStates[I].requestedHeight,x={page:I,state:a,pageWidth:C,pageHeight:D,rotateAngle:T,dummyScroller:o,outerDiv:n,canvas:i,currentZeroPage:y};A=virtualViewer.getTransformedPageLeft(x),P=virtualViewer.getTransformedPageTop(x),x.currentTransformedTop=P;var M=virtualViewer.getVisualPageTop(x);if(M>n[0].offsetHeight)break;p.save(),S=Math.sin(t.degreesToRadians(T)),w=Math.cos(t.degreesToRadians(T)),p.setTransform(w,S,-S,w,A,P),qt(a,i,p,I),a&&a.watermarks&&a.watermarks.length>0&&e("vvWatermarks").paintPageWatermarks(I,a,p),a.documentId===d.getActivePaneState().documentId&&0===O.getActivePane()&&c.paintDocumentSearchResults(a,i,p,I),a.isPageCropped(I)||(I===a.pageNumber&&O.getActivePane()===a.currentPaneIndex&&ja(i,p,a),Ha(a.currentPaneIndex,I,i,p)),p.restore(),u.paintAnnotations(a,i,p,I);var N=virtualViewer.currentPreviewAnnObject;N&&a.documentId===d.getActivePaneState().documentId&&N.page===I&&u.paintAnnotation(a,i,p,N),p.save(),p.setTransform(w,S,-S,w,A,P),Gt(a,I,p),p.restore(),virtualViewer.horizontalGuide&&virtualViewer.horizontalGuide.visible&&(p.save(),p.translate(virtualViewer.getVisualPageLeft(x),M),Ga(i,p,a,I),p.restore())}Ya(i,p),re.getMagnifierEnabled()&&re.paintMagnifierCanvas(),virtualViewer.createNavigationOptionsLabels()}}};g.prototype.getScrollSpeed=function(e){e=e||d.getActivePaneState();var t=s.scrollSpeed||30,a=e.getZoomDecimal();a<0&&(a=0);var n=100,i=t*n*Math.sqrt(a),r="Explorer"===BrowserDetect.browser||"Edge"===BrowserDetect.browser,l="Firefox"===BrowserDetect.browser;if(r||l){var u=i*e.getPageCount(),c=r?o.maxHtmlHeightMicrosoft||15e5:o.maxHtmlHeightFirefox||17e6;u>c&&(i=c/e.getPageCount())}return i},g.prototype.sizeScroller=function(e){e||(e={});var t=e.state||d.getActivePaneState(),a=e.outerDiv||O.getOuterDivFromState(t),n=e.scroller||a.find(".vvScroller"),i=e.canvas||a.find(".vvCanvas");if(t){var o=ot(a),r=it(a),s=virtualViewer.getScrollSpeed(t),l=t.pageCount*s+a[0].offsetHeight;1===t.getPageCount()&&t.pageStates[0].requestedWidth&&!t.isVideo()?(0===t.getRotationForPage(0)||180===t.getRotationForPage(0))&&t.pageStates[0].requestedHeight<o?l=o:(90===t.getRotationForPage(0)||270===t.getRotationForPage(0))&&t.pageStates[0].requestedWidth<o&&(l=o):t.isVideo()&&(l=20),$(n).height(l);for(var u,c=r,g=0;g<t.getPageCount();g++)u=t.getRotationForPage(g),90===u||270===u?c<t.pageStates[g].requestedHeight&&(c=t.pageStates[g].requestedHeight):c<t.pageStates[g].requestedWidth&&(c=t.pageStates[g].requestedWidth);$(n).width(c-W/2),e.applyAndResetCachedScroll&&(ct(t),t.clearCachedScroll()),Qt(t,i,a,n)}};var qt=function(e,t,a,n){var i=e.getImageManager(),o=i.getBestImageFromPage(n);if(i.checkIsImageComplete(o)){var r=e.getRequestedWidthForPage(n),s=e.getRequestedHeightForPage(n);if(0===r||0===s){if(!e.pageStates[n].imageInfoLoaded)return;virtualViewer.determineEffectiveZoom(n,e)}if(a.save(),e.getHorizontalFlipForPage()&&(a.translate(r,0),a.scale(-1,1)),e.getVerticalFlipForPage()&&(a.translate(0,s),a.scale(1,-1)),e.documentModel.model.pageData[n].cropTop>=0){var l=e.pageStates[n].originalWidth/r,u=e.documentModel.model.pageData[n].cropTop,d=e.documentModel.model.pageData[n].cropLeft,c=e.documentModel.model.pageData[n].cropWidth,g=e.documentModel.model.pageData[n].cropHeight,v=Math.ceil(u/l),p=Math.ceil(d/l),h=Math.ceil(c/l),f=Math.ceil(g/l);try{a.drawImage(o,d,u,c,g,p,v,h,f)}catch(e){console.log("Error drawing cropped image: "+e)}finally{a.restore()}}else try{a.drawImage(o,0,0,r,s)}catch(e){console.log("Error drawing full image: "+e)}finally{a.restore()}}},Gt=function(e,t,a){if(e&&e.getImageManager()){var n=e.getImageManager(),i=n.getOverlayOffsetForPage(t);if(i&&n.checkIsImageComplete(n.overlayImage)){var o,r,s,l=e.getRequestedWidthForPage(t),u=e.getRequestedHeightForPage(t),d=n.overlayImage,c=l/d.width,g=u/d.height;c<g?(o=l,r=d.height*c,s=c):(o=d.width*g,r=u,s=g);try{n.stripWhite(d),a.drawImage(d,i.offsetX*s,i.offsetY*s,o,r)}catch(e){console.log("exception: "+e)}}}},Yt=function(e){var t,a,n;if(e||(e=d.getActivePaneState()),e.pageCount){a=d.getOuterDivFromState(e),n=a.find(".vvScroller"),t=a.find(".vvCanvas");var i=e.pageNumber,o=a.width();if(e.pageStates[i].requestedWidth>o){var r=n.width()-o;r<0&&(r=0);var s=r/2;a.scrollLeft(s)}}},Xt=function(e,t){zt(e,t)};g.prototype.scrollPageFinder=function(e,t,a){return Zt(e,t,a)};var Zt=function(e,t,a){e=e||d.getActivePaneState(),t=t||O.getOuterDivFromState(e),a=a||t.find(".vvScroller");var n=$(t).scrollTop(),i=virtualViewer.getScrollSpeed(e),o=Math.floor(n/i);return o>=e.pageCount&&(o=e.pageCount-1),o};g.prototype.scrollerToPaint=function(e,t,a,n){e=e||d.getActivePaneState(),a=a||O.getOuterDivFromState(e),n=n||a.find(".vvScroller"),null!==t&&void 0!==t||(t=e.pageNumber);var i=$(a).scrollTop(),o=virtualViewer.getScrollSpeed(e),r=i%o/o,s=e.pageStates[t].requestedHeight,l=e.getRotationForPage(t);return 90!==l&&270!==l||(s=e.pageStates[t].requestedWidth),t===e.getPageCount()-1&&i/o-1>=t&&(r+=1),r*s},g.prototype.emailDocument=function(t){if(Za({state:!0,documentModel:!0,notVideo:!0})){var a=d.getActivePaneState(),n=a.getDocumentId();e("vvWatermarks").saveWatermarks(a);var i=a.getDocumentModel(),o=new URI(s.servletPath);t=t||{};var r={action:"emailDocument",format:t.format,pageRangeType:t.pageRangeType||"all",pageRangeValue:t.pageRangeValue,pageCount:i.getDocumentLength(),includeTextAnnotations:t.includeTextAnnotations,includeNonTextAnnotations:t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,fromAddress:"string"==typeof t.fromAddress?t.fromAddress:s.emailDefaults.prepopulateFrom,toAddresses:"string"==typeof t.toAddresses?t.toAddresses:s.emailDefaults.prepopulateTo,ccAddresses:"string"==typeof t.ccAddresses?t.ccAddresses:s.emailDefaults.prepopulateCC,bccAddresses:"string"==typeof t.bccAddresses?t.bccAddresses:s.emailDefaults.prepopulateBCC,subject:t.subject,emailBody:t.emailBody,documentId:n,clientInstanceId:this.getClientInstanceId(),cacheBuster:Math.random(),overrideLoggingLevel:virtualViewer.loggingOverride(),modelJSON:JSON.stringify(i.model),annotations:JSON.stringify(a.getAnnotationLayers(!0,!1,!1,t.burnRedactions,t.includeTextAnnotations,t.includeNonTextAnnotations,"PDF"===t.format))};return z?r.smtpServer=z:s.emailDefaults.smtpServerOverride&&(r.smtpServer=s.emailDefaults.smtpServerOverride),null!==O.getOverlayPath()&&(r.overlayPath=O.getOverlayPath()),$.ajax({url:o.toString(),type:"POST",dataType:"json",data:r,success:function(e){mt(e),Aa(!1)},error:function(e){mt(e),Aa(!1)}}),!0}},g.prototype.setSmtpServerOverride=function(e){z=e},g.prototype.getSmtpServerOverride=function(){return z},g.prototype.exportDocument=function(e){return O.exportDocumentCore(e)},g.prototype.exportDocumentCore=function(t,a){if(a=a||d.getActivePaneState(),t=t||{},Za({state:!0,notVideo:!0},a)){var n={action:"newExport",format:t.exportFormat,includeTextAnnotations:t.includeTextAnnotations,includeNonTextAnnotations:t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,pageRangeType:t.pageRangeType,pageRangeValue:t.pageRangeValue,annotations:JSON.stringify(a.getAnnotationLayers(!0,!1,!1,t.burnRedactions,t.includeTextAnnotations,t.includeNonTextAnnotations,"PDF"===t.exportFormat)),clientInstanceId:O.getClientInstanceId()};J&&(n.exportFileName=encodeURIComponent(J(t.fileExtension)));var i;a.getDocumentModel()?(e("vvWatermarks").saveWatermarks(a),i=a.getDocumentModel().model):i={documentId:a.documentId},n.modelJSON=JSON.stringify(i);var o=a.getPageCount();o||(o=1),n.pageCount=o;var r=$("#autoFormTemplate").render({action:s.servletPath,data:n}),l=$(r);l.appendTo($("body")),BrowserDetect.OS&&"i"===BrowserDetect.OS[0]&&l.attr("target","_blank");var u=$("#vvDownloadFrame");return u.on("load",function(){var e=u.contents().find("body").text().substr(0,1e3);try{var t=JSON.parse(e);mt(t)}catch(e){yt("Error while exporting document. Unable to display detailed error.")}u.off("load")}),l.submit(),l.remove(),!0}},g.prototype.downloadDocument=function(t){var a=t.indexOf("."),n=t.substring(a+1),i=virtualViewer.getStateForDocumentId(t);i||(i=new(e("vvDocViewState"))(t)),O.exportDocumentCore({exportFormat:"Original",fileExtension:n,includeTextAnnotations:!1,includeNonTextAnnotations:!1,burnRedactions:!1,includeRedactionTags:!1,includeDocumentNotes:!1,includeWatermarks:!1,pageRangeType:"all",pageRangeValue:"undefined"},i)},g.prototype.determineEffectiveZoom=function(e,t,a,n){if(t=t||d.getActivePaneState(),t&&t.pageStates&&t.pageStates.length){e||0===e||(e=t.getPageNumber()),a=a||virtualViewer.getActiveOuterDiv(),n=n||a.find(".vvScroller");var i=t.getZoomMode();i||0===i||(i=s.defaultZoomMode||o.zoomModes.fitWindow);var r=t.getZoom();r||(r=100);var l=t.pageStates[e].originalHeight,u=t.pageStates[e].originalWidth;if(u&&l){var c=!1;if(0!==e||U||(U=1),n.width()>a.width()&&0===a.scrollLeft()&&1===U&&(c=!0,U=!0),U){var g,v,p=it(),h=ot(),f=t.getRotationForPage(e),m=p/u,y=h/l,b=r/100,A=h/u,P=p/l,T=i===o.zoomModes.fitWidth,S=i===o.zoomModes.fitHeight;i!==o.zoomModes.fitHeight&&i!==o.zoomModes.fitWidth&&i!==o.zoomModes.fitWindow||(u&&l&&i===o.zoomModes.fitWindow&&(m>=y?S=!0:T=!0),T&&(b=90===f||270===f?P:m),S&&(b=90===f||270===f?A:y),e===t.pageNumber&&t.setZoomMode(o.zoomModes.fitCustom),t.setZoomDecimal(b),O.sizeScroller({state:t,outerDiv:a,scroller:n})),g=u*b,v=l*b,t.pageStates[e].requestedWidth=Math.round(g),t.pageStates[e].requestedHeight=Math.round(v),c&&Yt(t)}}}},g.prototype.collapsedStickySize=function(e){e=e||this.getActivePaneState().getZoomDecimal();var t=s.collapseStickiesSize||50,a=t*e;return a<5&&(a=5),Modernizr.touch&&(a*=2),a},g.prototype.findPagePosition=function(e,t){t||(t=virtualViewer.getCurrentState()),null!==e&&void 0!==e||(e=t.pageNumber);var a=virtualViewer.getScrollSpeed(t);return Math.ceil(a*e)};var Kt=function(e){var t=s.annotationTags.indexOf(e);if(t!==-1){var a=$("#vvAnnTagList .vvTagOption").eq(t),n=O.isRedaction(O.getCurrentAnnObject()),i=$("<div></div>").text(e).text();a.length&&a.text()===i&&(n&&$("#vvAnnTagList .vvTagOption").removeClass("disabled"),a.toggleClass("disabled",!a.hasClass("disabled")))}},Jt=function(e){var t=$("<div></div>").addClass("vvAnnTagChosenBox"),a=$("<span></span>").addClass("vvAnnTagCloseButton vvAnnTagInnerButton").data("tagname",e).text("x").on("click",ta),n=$("<span></span>").addClass("vvAnnTagContent").text(e);return t.append(a).append(n),t},ea=function(e){var t=$("<li></li>").addClass("vvTagOption dropdown-item"),a=$("<a></a>").text(e);return t.append(a),t},ta=function(){var e=virtualViewer.getCurrentAnnObject(),t=$(this).data("tagname");Kt(t);for(var a=0;a<e.annotationTags.length;a++)if(e.annotationTags[a]===t){e.annotationTags.splice(a,1);break}$(this).parent().remove(),e.markRevised(),u.markLayerWithAnnDirty(e)};g.prototype.hideAnnTagsPopUp=function(e){if(s.annotationTags.length>0){if(e)return void $("#vvAnnTag").hide();$("#vvAnnTag").show()}};var aa=function(e,t,a){var i,r,s=$("#vvImagePanel").height(),l=$("#vvImagePanel").width(),u=$("#vvAnnPopUp").height(),c=$("#vvAnnPopUp").width(),g=15;e&&e.x&&e.y?(i=e.x,r=e.y):(i=0,r=0),t=t||virtualViewer.getCurrentAnnObject(),a=a||d.getActivePaneState();var v=!1,p=se.localPosToGlobalPos(new n(t.getAdjustedLeft(),t.getAdjustedTop()),t.page,a),h=p.x+t.getAdjustedWidth();i?i<p.x+t.getAdjustedWidth()/2&&(v=!0):t.getType()!==o.annotationTypes.SANN_EDIT&&t.getType()!==o.annotationTypes.SANN_POSTIT||(v=!0),i=!v&&l-h>c?h+g:p.x-c-g,r||(r=p.y),i+$("#vvAnnPopUp").width()>l&&(i=l-$("#vvAnnPopUp").width()),i<0&&(i=0),r+u>s&&(r=s-u),r<0&&(r=0);var f=s-r-$("#vvAnnPopUp .btn-group-wrap").height()-15;$("#vvAnnPopUpForm").css("max-height",f+"px"),$("#vvAnnPopUp").css("top",r),$("#vvAnnPopUp").css("left",i)};g.prototype.annPopUpHandler=function(e,i,r){if(r=r||d.getActivePaneState(),d.isVideoOpen())return!1;var s,l=0,c=0;if(e){Modernizr.touchevents&&(e=se.fixTouchEvent(e)),e.preventDefault(),e.stopPropagation(),l=e.clientX,c=e.clientY;var g=se.clickPointConverter(e);s=u.getAnnotationAtPoint(g,r)}if(i&&(s=i),u.checkLayerPermission(u.getCurrentLayer(),o.permissionLevels.PERM_EDIT)===!1)return void alert(t.getLocalizedValue("errors.editAnnOnLayerPermission","You do not have permission to edit annotations on this layer."));var v=se.dragging;return!s||v?(virtualViewer.hideAnnPopUp(),void virtualViewer.delayedPaintCanvases(r)):(O.setCurrentAnnObject(s),void(s.collapsed||($("#vvAnnPopUpForm").removeClass(),$("#vvAnnotationNotesArea").collapse("hide"),$("#vvAnnotationRevisionHistory").collapse("hide"),a.shrinkColorPicker($("#vvAnnLineColorChoices")),a.shrinkColorPicker($("#vvAnnFillColorChoices")),a.shrinkColorPicker($("#vvAnnTextColorChoices")),$("#vvAnnPopUp").show(),na(s),aa(new n(l,c),s,r),$("#jqContextMenu").hide(),$("#jqContextMenuShadow").hide(),virtualViewer.delayedPaintCanvases())))};var na=function(e){var n,i=u.getLayerWithAnn(e)||u.getCurrentLayer();t.isRedactionLayer(i)||e.getType()===o.annotationTypes.SANN_BITMAP||$("#vvAnnPopUpForm").addClass("vvAnnHasColor"),$("#vvAnnPopUpEditTextSaveBtn").hide(),$("#vvAnnPopUpEditTextCancelBtn").hide();var r=e.getLineWidth(!0);$("#vvAnnPopUp .vvAnnThicknessCell").attr("aria-pressed","false"),$("#vvAnnThicknessCell-"+r).attr("aria-pressed","true"),$("#vvAnnLineSizeValue").html(r);var l=$("#vvAnnPopUpEditTextArea");if(l.blur(),e.getFontColor()?($("#vvAnnPopUpForm").addClass("vvAnnHasText"),$("#vvAnnTextSizeLabel").height()>$("#vvAnnTextFaceLabel").height()?$("#vvAnnTextFaceLabel").height($("#vvAnnTextSizeLabel").height()):$("#vvAnnTextSizeLabel").height($("#vvAnnTextFaceLabel").height()),e.getType()===o.annotationTypes.SANN_POSTIT&&($("#vvAnnPopUpForm").addClass("vvAnnHasFill"),n=e.getFillColorRGB(),a.setColorPickerColor($("#vvAnnFillColorChoices"),n),l.css("color","#"+n)),n=e.getFontColor()):e.getFillColor()?($("#vvAnnPopUpForm").addClass("vvAnnHasFill"),n=e.getFillColorRGB(),a.setColorPickerColor($("#vvAnnFillColorChoices"),n)):e.getLineColor()&&($("#vvAnnPopUpForm").addClass("vvAnnHasLine"),n=e.getLineColorRGB(),a.setColorPickerColor($("#vvAnnLineColorChoices"),n)),e.getTextString()&&(l.val(e.getTextString()),a.setColorPickerColor($("#vvAnnTextColorChoices"),n)),n&&l.css("color","#"+n),s.enableAnnotationCommenting&&($("#vvAnnPopUpForm").addClass("vvAnnHasNotes"),$("#vvAnnotationNotesInternal").children().remove(),e.noteArray&&e.loadAnnotationNotes()),$("#vvAnnTagChosen").empty(),s.annotationTags.length>0&&$("#vvAnnPopUpForm").addClass("vvAnnTags"),$("#vvAnnTagList .vvTagOption").removeClass("disabled"),e.annotationTags.length>0){$("#vvAnnPopUpForm").addClass("vvAnnTags");for(var d=0;d<e.annotationTags.length;d++){var c=Jt(e.annotationTags[d]);$("#vvAnnTagChosen").append(c),Kt(e.annotationTags[d])}}if(e.getFontName()&&($("#vvAnnTextFaceSelect").val(t.toTitleCase(e.getFontName())),l.css("font-family",e.getFontName())),e.getFontSize()){var g=1,v=virtualViewer.getActivePaneState();e.docDPI>o.minimumAnnotationDPI&&v.getDPIForPage(e.page)&&v.getDPIForPage(e.page)<10&&(g=e.pageWidth/v.getOriginalWidthForPage(e.page)||1,90!==e.rotateAngle&&270!==e.rotateAngle||(g=e.pageHeight/v.getOriginalWidthForPage(e.page)||1));var p=t.findClosestFontSize(e.getFontSize()/g);$("#vvAnnTextSizeSelect").val(p),l.css("font-size",p+"px")}e.getFontBold()===!0?($("#vvAnnTextStyleBold").prop("checked",!0),l.css("font-weight","bold")):($("#vvAnnTextStyleBold").prop("checked",!1),l.css("font-weight","normal")),e.getFontItalic()===!0?($("#vvAnnTextStyleItalic").prop("checked",!0),l.css("font-style","italic")):($("#vvAnnTextStyleItalic").prop("checked",!1),l.css("font-style","normal")),e.getFontUnderline()===!0?($("#vvAnnTextStyleUnderline").prop("checked",!0),l.css("text-decoration","underline")):($("#vvAnnTextStyleUnderline").prop("checked",!1),l.css("text-decoration","none")),e.getType()===o.annotationTypes.SANN_BITMAP&&$("#vvAnnPopUpForm").removeClass("vvAnnHasLine vvAnnHasFill vvAnnHasText vvAnnHasColor"),e&&e.loadAnnotationInformation()};g.prototype.hideAnnPopUp=function(){var e=this.getCurrentAnnObject();e&&(e.editing=!1),$("#vvAnnPopUp").hide()};var ia=function(e){var t=$(e.target);"LI"===e.target.tagName&&(t=t.find(".singleDocTab"));var a=t.text();"*"===a[0]&&(a=a.substring(1,a.length)),""===a[a.length-1]&&(a=a.substring(0,a.length-1));for(var n=0;n<virtualViewer.newRecentlyViewedList.length;n++)if(virtualViewer.newRecentlyViewedList[n].displayName===a){a=virtualViewer.newRecentlyViewedList[n].documentId;break}var i=virtualViewer.getStateForDocumentId(a);if(i&&(!O.checkPageManipulationsEnabled(!1,i)||!O.checkPageManipulationsEnabled(!1)||i.isVideo()))return void ra();var o=JSON.parse(e.originalEvent.dataTransfer.getData("text"));Ma(o),i&&o&&(virtualViewer.switchToTab(i),virtualViewer.pasteClip(o,i,0)),e.preventDefault()},oa=function(e){e.preventDefault();for(var t=$("#vvImageTabs").children(),a=0;a<t.length;a++)$(t[a].children[0]).removeClass("dragOverTab");$(e.target).addClass("dragOverTab")},ra=function(e){$(".vvThumbDivider").remove(),$("#vvImageTabs .dragOverTab").removeClass("dragOverTab")};g.prototype.cleanupDrag=ra,$.event.special.vvDeletePages={_default:function(e){O.cutSelection(!0)}},$.event.special.vvCutPages={_default:function(e){O.cutSelection(!1)}},$.event.special.vvCopyPages={_default:function(e){O.copySelection()}},$.event.special.vvPastePages={_default:function(e,t){O.pasteSelection(t)}};var sa=function(t){t||(t=window.event),H&&clearTimeout(H),H=setTimeout(e("vvThumbs").loadVisibleThumbs,200)};g.prototype.processWindowResize=function(e){e||(e=window.event),la(!0)};var la=function(t){for(var a=d.getActivePaneState(),n=$(".vvOuter"),i=0;i<n.length;i++){var o=$(n[i]).find(".vvCanvas");o[0].width=it($(n[i])),o[0].height=ot($(n[i])),"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&(o.children().width(outerDiv.width()),o.children().height(outerDiv.width()))}e("vvThumbs").loadVisibleThumbs(),je(),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu(),a&&virtualViewer.sizeScroller({state:a}),t&&(virtualViewer.determineEffectiveZoom(),ya(a)),a&&a.isVideo()&&a.getVideoManager().resizeVideo(),re.adjustForWindowResize(),ua()},ua=function(){var e=l(virtualViewer),t=30*(Object.keys(e.imageToolbarButtons).length+2);t+=30*Object.keys(e.toolbarButtonLogicalGroups).length,e.imageToolbarButtons.vvJumpToPage&&(t+=120);var a=30*Object.keys(e.annotationToolbarButtons).length;a+=16*Object.keys(e.toolbarButtonLogicalGroups).length,a+=50;var n=768,i=$("#virtualViewerMain"),o=i.width(),r=i.height();return o<n?($("#vvToolbar").removeClass("vvLargeSize vvMediumSize"),$("#vvAnnToolbar").removeClass("vvLargeSize vvMediumSize"),void $("#vvImageAndThumbs").css("left","15px")):(r<a?($("#vvAnnToolbar").removeClass("vvLargeSize").addClass("vvMediumSize").width(32),$("#vvToolbar").addClass("vvPushOverForAnnToolbar"),$("#vvImageAndThumbs").css("left","44px")):($("#vvAnnToolbar").addClass("vvLargeSize").removeClass("vvMediumSize").width(28),$("#vvToolbar").removeClass("vvPushOverForAnnToolbar"),$("#vvImageAndThumbs").css("left","28px")),void(o<t?$("#vvToolbar").hasClass("vvMediumSize")||$("#vvToolbar").removeClass("vvLargeSize").addClass("vvMediumSize"):$("#vvToolbar").addClass("vvLargeSize").removeClass("vvMediumSize")))};g.prototype.getUserPreferences=function(){return ie},g.prototype.getDocumentNotes=function(){return oe},g.prototype.getDocumentId=function(e){return d.getOpenDocumentId(e)},g.prototype.getCurrentState=function(e){return d.getCurrentState(e)},g.prototype.setDocumentId=function(e){d.displayedDocuments[0]=e},g.prototype.setUsername=function(e){var t=virtualViewer.getUserPreferences();t.saveUsername(e)},g.prototype.getUsername=function(){return virtualViewer.getUserPreferences().getUsername()},g.prototype.setDisplayName=function(t,a){if(t=t||"",a=a||d.getOpenDocumentId(),!a)return null;var n=d.getStateForDocumentId(a);if(this.removeFromRecentlyViewed({documentId:a}),this.addToRecentlyViewed({documentId:a,displayName:t}),e("vvThumbs").updateDocumentDisplayName(a,t),n)return n.setDisplayName(t),virtualViewer.updateTabName(n),n.getDisplayName();for(var i=0;i<this.documentList.length;i++)if(this.documentList[i].documentId===a)return this.documentList[i].displayName=t,t;return null},g.prototype.getDisplayName=function(){return Za({state:!0})?d.getActivePaneState().getDisplayName():null},g.prototype.getStateForDocumentId=function(e,t){return d.getStateForDocumentId(e,t)},g.prototype.getDocumentIdForPage=function(e,t){return da(e,t)};var da=function(e,t){var a=t.getDocumentId(),n=t.getDocumentModel();return t.getDocumentId()?(n&&(a=decodeURIComponent(n.model.pageData[e].documentId)),a):null};g.prototype.getPageIndexForPage=function(e,t){return ca(e,t)};var ca=function(e,t){var a=e;t=t||virtualViewer.getActivePaneState();var n=virtualViewer.getDocumentModel(t);return t?(n&&(a=n.model.pageData[e].pageIndex),a):null};g.prototype.exportDocumentDialog=function(t){Za({state:!0,notVideo:!0})&&e("vvDialogs").exportDialog(t)},g.prototype.showCropDialog=function(e,a,n,i,o,r){if($("#vvConfirmCropDialog").modal("toggle"),null!==r&&void 0!==r||(r=d.getActivePaneState()),r.isVirtualDocument()){var s=$("#vvConfirmCropDialogText").text();$("#vvConfirmCropDialogText").text(s+" "+t.getLocalizedValue("errors.virtualDocumentSaving","You can't save to original on Virtual Documents. Use Export or Save As."))}},g.prototype.cropPageClient=function(e,t,a,n,i){var o=d.getActivePaneState();if(!Za({state:!0,documentModel:!0,notVideo:!0}))return!1;if(!s.enableCrop&&void 0!==s.enableCrop)return!1;if(o.isPageCropped(i)&&o.removeCropOnPage(i),void 0===e){if(null===se.dragStartTop||null===se.dragStopTop||null===se.dragStartLeft||null===se.dragStopLeft)return!1;e=se.dragStartTop,t=se.dragStartLeft,a=se.dragStopTop,n=se.dragStopLeft,i=o.pageNumber}var r=Math.abs(e-a),l=Math.abs(t-n);e>a&&(e=a),t>n&&(t=n);var u=o.pageStates[i].originalWidth/o.pageStates[i].requestedWidth;return o.deleteAllAnnsOnPage(i),o.resetSVGSupport(!1),null!==i&&void 0!==i||(i=o.pageNumber),o.documentModel.model.pageData[i].cropTop>=0?(o.documentModel.model.pageData[i].cropTop+=Math.floor(e*u),o.documentModel.model.pageData[i].cropLeft+=Math.floor(t*u),o.documentModel.model.pageData[i].cropWidth=Math.floor(l*u),o.documentModel.model.pageData[i].cropHeight=Math.floor(r*u)):(o.documentModel.model.pageData[i].cropTop=Math.floor(e*u),o.documentModel.model.pageData[i].cropLeft=Math.floor(t*u),o.documentModel.model.pageData[i].cropWidth=Math.floor(l*u),o.documentModel.model.pageData[i].cropHeight=Math.floor(r*u)),se.clean(),o.setIsSearchable(!1),virtualViewer.delayedPaintCanvases(o),o.documentModel.setPagesModifiedSinceInit(!0,i),d.getCurrentDiff()&&(d.getCurrentDiff().diffDisabledUntilSave=!0,za()),!0},g.prototype.cropPageHandler=function(e){return e},g.prototype.cropPageButton=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&(s.enableCrop?(t.cursorAnnotate(),X=o.annotationTypes.SANN_RECTANGLE,O.currentPointArray=[],virtualViewer.setDragMode(o.dragModes.crop)):alert(t.getLocalizedValue("errors.cropDisabled","Crop has been disabled by the administrator.")))},g.prototype.removeCropOnPage=function(e){if(Za({state:!0,documentModel:!0,notVideo:!0})){var t=d.getActivePaneState();t.removeCropOnPage(e),virtualViewer.delayedPaintCanvases()}},g.prototype.removeAllCrop=function(){if(Za({state:!0,documentModel:!0,notVideo:!0}))for(var e=d.getActivePaneState(),t=0;t<e.pageCount;t++)virtualViewer.removeCropOnPage(t)};var ga=function(e,t){return e.includeRedactionTags!==!1&&(e.includeRedactionTags=!0),"current"===e.pageRangeType&&"number"!=typeof e.pageRangeValue&&(e.pageRangeValue=t.getPageNumber()),e.newDocumentId||("undefined"==typeof e.copyAnnotations&&(e.copyAnnotations=!0),"undefined"==typeof e.copyWatermarks&&(e.copyWatermarks=!0)),e};g.prototype.saveDocument=function(a,n){var i,o;if(n=n||{},o=n.documentPaneIndex,a){if(!d.getStateForDocumentId(a,o))return;i=d.getStateForDocumentId(a,o)}else i=d.getActivePaneState(),a=i.getDocumentId();if(Za({state:!0,documentModel:!0,notVideo:!0},i)){if(n=ga(n,i),s.enableSaveOverwriteWarning!==!1&&!n.skipOverwriteDialog&&!n.newDocumentId&&this.willSavingOverwriteCurrentFormat(i))return void $("#vvOverwriteDialog").modal("show");O.displaySaveIndicator(!0),o=i.currentPaneIndex,i.resetDocFormat();var r=i.getDocumentModel();e("vvWatermarks").saveWatermarks(i),ne.saveBookmarks(),i.getImageManager().cleanBuffers(),this.updateAnnotationForNewDimensions();var l=[];if(n.newDocumentId||r.getModifiedSinceInit()){if(i.isDocumentCropped())for(var u=0;u<i.pageCount;u++)i.isPageCropped(u)&&l.push(u);var c=new URI(s.servletPath);c.addQuery("action","saveDocumentModel"),c.addQuery("clientInstanceId",O.getClientInstanceId()),c.addQuery("cacheBuster",Math.random()),
c.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),c.addQuery("includeRedactions",n.burnRedactions),c.addQuery("includeTextAnnotations",n.includeTextAnnotations),c.addQuery("includeNonTextAnnotations",n.includeNonTextAnnotations);var g=r.model;if(n.newDocumentId){g=t.deepObjCopy(r.model),g.documentId=encodeURIComponent(n.newDocumentId),n.newDisplayName?g.displayName=encodeURIComponent(n.newDisplayName):g.displayName=encodeURIComponent(n.newDocumentId),g.pagesModifiedSinceInit=!0;var v=n.createNew;v&&delete g.documentNotes,c.addQuery("pageRangeType",n.pageRangeType),c.addQuery("pageRangeValue",n.pageRangeValue),c.addQuery("copyAnnotations",n.copyAnnotations),c.addQuery("copyWatermarks",n.copyWatermarks),c.addQuery("format",n.saveAsFormat),c.addQuery("documentId",encodeURIComponent(n.newDocumentId)),c.addQuery("oldDocumentId",encodeURIComponent(a))}else g.bookmarks&&0===ne.bookmarkArray.length&&delete g.bookmarks,c.addQuery("copyAnnotations",n.copyAnnotations),c.addQuery("copyWatermarks",n.copyWatermarks),c.addQuery("documentId",a);c.addQuery("includeRedactionTags",n.includeRedactionTags),c.addQuery("includeWatermarks",n.includeWatermarks),c.addQuery("modelJSON",JSON.stringify(g));var p=i.getAnnotationLayers(!0,!0,n.newDocumentId,n.burnRedactions,n.includeTextAnnotations,n.includeNonTextAnnotations,"PDF"===n.saveAsFormat);c.addQuery("annotations",JSON.stringify(p)),null!==O.getOverlayPath()&&c.addQuery("overlayPath",O.getOverlayPath());var h=c.query();c.query(""),$.ajax({url:c.toString(),type:"POST",dataType:"json",data:h,async:!1,success:function(e){var t=null,i=null;if(Vt(),mt(e)===!0){O.displaySaveIndicator(!1);var u={documentId:a,saveAsDocumentId:n.newDocumentId,exceptionMessage:e.exceptionMessage,statusText:e.statusText};return void le.call("saveDocumentError",u)}if(e.documentIdToReload&&(i=decodeURIComponent(e.documentIdToReload)),n.newDocumentId){if(n.useCut){var c=O.getStateForDocumentId(a);O.deleteSelection({pageNums:n.pageNums},c)}return le.call("saveAsDocument",{oldDocumentId:a,newDocumentId:i,clientInstanceId:O.getClientInstanceId()}),void O.displaySaveIndicator(!1)}if(le.call("saveDocument",{documentId:a,clientInstanceId:O.getClientInstanceId(),documentIdToReload:i}),le.call("saveAnnotations",{documentId:a,clientInstanceId:O.getClientInstanceId(),documentIdToReload:i}),s.reloadDocumentOnSave===!0){var g=i,v=a;g&&"undefined"!==g||(g=v),t=d.getStateForDocumentId(v,o),t.documentId=g;var p=t.getDisplayName();p||(p=v),t.setDisplayName(p),d.removeStateForDocumentId(v,o),d.setStateForDocumentId(g,t,o),d.setDisplayedState(t,o);var h={documentId:v,displayName:t.getDisplayName()},f=O.getStateForDocumentId(g),m={documentId:g,displayName:f.getDisplayName()};O.removeFromRecentlyViewed(h),O.addToRecentlyViewed(m);for(var y=0;y<O.tabs.length;y+=1)if(O.tabs[y]===v){O.tabs[y]=g;break}t.getDocumentModel().cleanAfterSave(g),t.clearImageBuffer(),O.requestDocumentList(),t.clearAllLayers();var b=function(e){va(e,l)};O.reloadDocumentModel(g,o,b)}else t=d.getStateForDocumentId(a,o),r.cleanAfterSave(a,t),va(t,l)},error:function(e){console.log("saveDocument: "+e.statusText),O.displaySaveIndicator(!1),yt(t.getLocalizedValue("errors.saveDocumentRequestFailed","Error saving document"));var i={documentId:a,saveAsDocumentId:n.newDocumentId,exceptionMessage:e.exceptionMessage,statusText:e.statusText};le.call("saveDocumentError",i)}})}else i=d.getActivePaneState(),i.saveAnnotationLayers(),O.updateTabName(i)}};var va=function(e,t){if(e.resetAfterSave(),Ht(e),re.getMagnifiedImage(e,e.pageNumber),t.length>0)for(var a=0;a<t.length;a++)e.removePageText(t[a]);if(c.rerunCurrentSearch(),O.displaySaveIndicator(!1),O.updateTabName(e),d.getCurrentDiff()){var n=1-e.currentPaneIndex;d.getCurrentState(n).getDocumentModel().getPagesModifiedSinceInit()||(d.getCurrentDiff().diffDisabledUntilSave=!1,O.performDiff())}};g.prototype.saveAllDocuments=function(){for(var e=0;e<O.tabs.length;e++)this.saveDocument(O.tabs[e])},g.prototype.updateAnnotationForNewDimensions=function(){for(var e=this.getActivePaneState(),t=0;t<e.pageCount;t++)for(var a=e.pageStates[t],n=a.annotationLayers||{},i=e.layerNames,o=0;o<i.length;o++){var r=n[i[o]];if(r)for(var s=r.pageHeight,l=r.pageWidth,u=0;u<r.anns.length;u++){var d=r.anns[u],c=d.pageHeight,g=d.pageWidth,v=d.getRotationAngle();if(90!=v&&270!=v||(c=d.pageWidth,g=d.pageHeight),s!=c||l!=g){var p=(s/c).toFixed(2),h=(l/g).toFixed(2);if(p!=h)continue;var f=s/c;d.scaleAnn(f),d.setPageHeight(s),d.setPageWidth(l)}}}},g.prototype.rotateClock=function(){O.rotateImageBy(90)},g.prototype.rotateCounter=function(){O.rotateImageBy(-90)},g.prototype.rotateImageBy=function(e){var t=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},t)){var a=t.getPageNumber();O.rotatePageBy(a,e)}},g.prototype.rotateAllPagesBy=function(e){var t=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},t)){for(var a=0;a<t.getPageCount();a+=1)O.rotatePageBy(a,e);virtualViewer.setPage(0),O.updateTabName(t)}},g.prototype.rotateSelectedPagesBy=function(e,t){var a=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},a)){if(!pa(t))throw"Invalid degree entry";for(var n=0;n<e.length;n+=1){if(!ha(e[n],a))throw"Invalid page entry";O.rotatePageBy(e[n],t)}O.updateTabName(a)}},g.prototype.rotateImageTo=function(e){if(pa(e)){var t=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},t)){e===-90?e=270:e===-180?e=180:e===-270&&(e=90);var a=t.getPageNumber(),n=t.getRotationForPage(a);t.setRotationForPage(a,0),t.setRotationForPage(a,e),virtualViewer.determineEffectiveZoom(a,t),ya(t,a),$t(a,e),n=(n-e)%360,le.call("rotation",{documentId:t.documentId,page:a,degrees:e,rotatedTo:e,rotatedBy:n})}}},g.prototype.rotatePageTo=function(e,t){var a=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},a)){if(!pa(t))throw"Invalid degree entry";if(!ha(e,a))throw"Invalid page entry";t===-90?t=270:t===-180?t=180:t===-270&&(t=90);var n=a.getRotationForPage(e);return a.setRotationForPage(e,0),a.setRotationForPage(e,t),O.updateTabName(a),virtualViewer.determineEffectiveZoom(e,a),ya(a,e),virtualViewer.sizeScroller({state:a}),$t(e,t),n=(n-t)%360,le.call("rotation",{page:e,degrees:t,rotatedTo:t,rotatedBy:n}),!0}},g.prototype.rotatePageBy=function(e,t){var a=d.getActivePaneState();if(!pa(t))throw"Invalid degree entry";if(!ha(e,a))throw"Invalid page entry";if(!Za({state:!0,documentModel:!0,notVideo:!0},a))return!1;var n=a.getRotationForPage(e);return n+=t,n<0&&(n+=360),n>=360&&(n-=360),a.setRotationForPage(e,n),O.updateTabName(a),virtualViewer.determineEffectiveZoom(e,a),ya(a,e),$t(e,t),virtualViewer.sizeScroller({state:a}),le.call("rotation",{documentId:a.documentId,page:e,degrees:t,rotatedTo:n,rotatedBy:t}),s.rotateTextAnnotations||u.staleAnnTextWrapping(a,e),!0};var pa=function(e){return 0===Math.abs(e)||90===Math.abs(e)||180===Math.abs(e)||270===Math.abs(e)},ha=function(e,t){var a=t.getPageCount();return"number"==typeof e&&(e===parseInt(e,10)&&(!(e<0)&&!(e>=a)))},fa=function(e){e=e||d.getActivePaneState();var t=e.getPageNumber(),a=O.getOuterDivFromState(e),n=a.scrollTop()-virtualViewer.findPagePosition(t,e);n/=virtualViewer.getScrollSpeed(e);var i=a.find(".vvScroller").width()-a.width();i<0&&(i=0);var o=(a.find(".vvCanvas").width()+i)/2,r=o-e.getRequestedWidthForPage(t)/2,s=a.scrollLeft(),l=s+r;return{zoom:e.getZoom(),page:t,yPositionOnPage:n,pageLeftPosition:l,centered:r>=0||Math.floor(i/2)===s}},ma=function(e,t){t=t||d.getActivePaneState();var a=d.getOuterDivFromState(t),n=virtualViewer.findPagePosition(e.page,t);if(n+=e.yPositionOnPage*virtualViewer.getScrollSpeed(t),a.scrollTop(n),e.pageLeftPosition<=0||e.centered)Yt(t);else{var i=e.pageLeftPosition*t.getZoom()/e.zoom,o=Math.max(a.find(".vvScroller").width()-a.width(),0),r=(a.find(".vvCanvas").width()+o)/2,s=r-t.getRequestedWidthForPage(e.page)/2;a.scrollLeft(s+i)}};g.prototype.getNextZoomLevelDown=function(e){return h(e)},g.prototype.zoomIn=function(e){var t=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},t)){var a=fa(t),n=O.getActiveOuterDiv();if(e||(e=a.zoom,e=p(e)),e>(s.maxZoomPercent||500))return void(e=s.maxZoomPercent||500);t.setZoomMode(o.zoomModes.fitCustom),t.setZoom(e);for(var i=0;i<t.pageCount;i++)virtualViewer.determineEffectiveZoom(i,t,n);var r=t.getImageManager();return r.scaleDocumentByPercentage(t.getZoomDecimal()),ya(t),virtualViewer.sizeScroller({state:t}),ma(a,t),t.getZoom()}},g.prototype.zoomOut=function(e){var t=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},t)){var a=fa(t),n=O.getActiveOuterDiv();e||(e=a.zoom,e=h(e)),t.setZoomMode(o.zoomModes.fitCustom),t.setZoom(e);for(var i=0;i<t.pageCount;i++)virtualViewer.determineEffectiveZoom(i,t,n);var r=t.getImageManager();return r.scaleDocumentByPercentage(t.getZoomDecimal()),ya(t),virtualViewer.sizeScroller({state:t}),ma(a,t),t.getZoom()}},g.prototype.setZoomPercent=function(e){Za({state:!0,documentModel:!0,notVideo:!0})&&this.setZoomPercentCore(e)},g.prototype.setZoomPercentCore=function(e,t){t=t||d.getActivePaneState();var a=e||s.zoomLevels[0];if(a&&Za({state:!0,notVideo:!0},t)){a>(s.maxZoomPercent||500)?a=s.maxZoomPercent||500:a<s.zoomLevels[0]&&(a=s.zoomLevels[0]);var n=t.pageNumber;t.setZoomMode(o.zoomModes.fitCustom),t.setZoom(a),Za({documentModel:!0},t)&&(ba(t),virtualViewer.setPageCore(n,t),virtualViewer.sizeScroller({state:t}),Yt(t))}},g.prototype.zoomToLocation=function(e,t,a){var n=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},n)&&e&&(t||0===t)&&(a||0===a)){O.setZoomPercentCore(e,n);var i=virtualViewer.findPagePosition(n.pageNumber,n),o=O.getActiveOuterDiv();o.scrollLeft(t),o.scrollTop(i+a),O.delayedPaintCanvases(n)}},g.prototype.zoomCore=function(e,t){return ya(e,t)};var ya=function(e,t){if(e=e||d.getActivePaneState(),e&&!d.isVideoOpen()){var a=e.getImageManager();t||0===t||(t=e.pageNumber);var n=a.getOriginalFromPage(t);"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9||Modernizr.touchevents||(virtualViewer.hideAnnPopUp(),O.setPreviousAnnObject(O.getCurrentAnnObject()),O.setCurrentAnnObject(null)),O.validImageObject(n)?(O.delayedPaintCanvases(e),Xt()):Xt()}};g.prototype.flipX=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e)){var t=!e.getHorizontalFlipForPage();e.setHorizontalFlipForPage(null,t),O.delayedPaintCanvases(e)}},g.prototype.flipY=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e)){var t=!e.getVerticalFlipForPage();e.setVerticalFlipForPage(null,t),O.delayedPaintCanvases(e)}},g.prototype.textSelectionAllowed=function(){var e=d.getActivePaneState(),t=e.getHorizontalFlipForPage()===!1&&e.getVerticalFlipForPage()===!1&&!e.isDocumentCropped();return t},g.prototype.getStampManager=function(){return ue},g.prototype.clearImageStamps=function(){ue.clearStampDropdown()},g.prototype.createImageStamp=function(e,t,a){var n=ue.createStampImage(e,t,a);ue.addStampsToDropdown(n)},g.prototype.createImageStampArray=function(e){var t=[];t=ue.processStampArray(e),ue.addStampsToDropdown(t)},g.prototype.createImageStampArrayFromFunction=function(e){virtualViewer.createImageStampArray(e())},g.prototype.invertImage=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e)){var t=e.getPageNumber(),a=e.getInvertImageForPage(t);a=!a,a?e.setSVGableForPage(t,!1):e.setSVGableForPage(t,!0),e.setInvertImageForPage(t,a),O.delayedPaintCanvases(e)}},g.prototype.despeckleImage=function(){var e=d.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0},e)&&(e.setDespeckleForPage(e.pageNumber),Xt(e))},g.prototype.setAntiAliasOff=function(e){var t=virtualViewer.getStateForDocumentId(O.getDocumentId());t.setAntiAliasOffForPage(t.pageNumber,e),Xt(t)},g.prototype.setBrightness=function(e){var t=d.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0},t)&&(t.setBrightnessForPage(t.getPageNumber(),e),Xt(t,!0))},g.prototype.setContrast=function(e){var t=d.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0},t)&&(t.setContrastForPage(t.getPageNumber(),e),$("#vvContrastDisplay").html(e),Xt(t,!0))},g.prototype.setGamma=function(e){var t=d.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0},t)&&(t.setGammaForPage(t.getPageNumber(),e),$("#vvGammaDisplay").html(e),Xt(t,!0))},g.prototype.getBrightness=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e))return e.getBrightnessForPage()},g.prototype.getContrast=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e))return e.getContrastForPage()},g.prototype.getGamma=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e))return e.getGammaForPage()};var ba=function(e){if(e=e||d.getActivePaneState()){var t=e.pageNumber;virtualViewer.determineEffectiveZoom(t,e);var a=e.getImageManager();a.scaleDocumentByPercentage(e.getZoomDecimal());for(var n=0;n<e.pageCount;n++)n!==t&&0!==e.pageStates[n].originalWidth&&(virtualViewer.determineEffectiveZoom(n,e),ya(e,n));virtualViewer.delayedPaintCanvases(e),Yt(e);var i=d.getOuterDivFromState(e);i.scrollTop(virtualViewer.findPagePosition(t,e)),virtualViewer.delayedPaintCanvases(e)}};g.prototype.fitWidth=function(){this.fitWidthCore()},g.prototype.fitWidthCore=function(e){if(e=e||d.getActivePaneState(),Za({state:!0,notVideo:!0},e)){var t=e.pageNumber;if(e.setZoomMode(o.zoomModes.fitWidth),Za({documentModel:!0},e)){ba(e),virtualViewer.setPageCore(t,e),virtualViewer.sizeScroller({state:e});var a=d.getOuterDivFromState(e);a.scrollTop(virtualViewer.findPagePosition(t,e)),Yt(e),virtualViewer.delayedPaintCanvases(e)}}},g.prototype.fitHeight=function(){this.fitHeightCore()},g.prototype.fitHeightCore=function(e){if(e=e||d.getActivePaneState(),Za({state:!0,notVideo:!0},e)){var t=e.pageNumber;if(e.setZoomMode(o.zoomModes.fitHeight),Za({documentModel:!0},e)){ba(e),virtualViewer.setPageCore(t,e),virtualViewer.sizeScroller({state:e});var a=d.getOuterDivFromState(e);a.scrollTop(virtualViewer.findPagePosition(t,e)),Yt(e),virtualViewer.delayedPaintCanvases(e)}}},g.prototype.fitWindow=function(){this.fitWindowCore()},g.prototype.fitWindowCore=function(e){if(e=e||d.getActivePaneState(),Za({state:!0,notVideo:!0},e)){var t=e.pageNumber;if(e.setZoomMode(o.zoomModes.fitWindow),Za({documentModel:!0},e)){ba(e),virtualViewer.setPageCore(t,e),virtualViewer.sizeScroller({state:e});var a=d.getOuterDivFromState(e);a.scrollTop(virtualViewer.findPagePosition(t,e)),Yt(e)}}},g.prototype.scrollDownByNPercent=function(e){var t=document.getElementById("vvOuterDiv"),a=t.scrollTop,n=t.scrollHeight*e/100;t.scrollTop=a+n},g.prototype.scrollUpByNPercent=function(e){var t=document.getElementById("vvOuterDiv"),a=t.scrollTop,n=t.scrollHeight*e/100;t.scrollTop=a-n},g.prototype.getPageCount=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e))return e.pageCount},g.prototype.firstPage=function(){var e=d.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0},e)&&"true"!==$(".vvGoToFirstPage").attr("aria-disabled")&&0!==e.getPageNumber()&&O.setPage(0)},g.prototype.nextPage=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e)&&!("true"===$(".vvGoToNextPage").attr("aria-disabled")||e.getPageNumber()+1>=e.getPageCount())){var t=e.getPageNumber();O.setPage(t+1)}},g.prototype.previousPage=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e)&&"true"!==$(".vvGoToPreviousPage").attr("aria-disabled")&&0!==e.getPageNumber()){var t=e.getPageNumber();O.setPage(t-1)}},g.prototype.lastPage=function(){var e=d.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0},e)&&("true"===$(".vvGoToLastPage").attr("aria-disabled")||e.getPageNumber()+1>=e.getPageCount()||O.setPage(e.getPageCount()-1))},g.prototype.panUp=function(){var e=document.getElementById("vvOuterDiv");e.scrollTop-=De},g.prototype.panDown=function(){var e=document.getElementById("vvOuterDiv");e.scrollTop+=De},g.prototype.panLeft=function(){var e=document.getElementById("vvOuterDiv");e.scrollLeft-=De},g.prototype.panRight=function(){var e=document.getElementById("vvOuterDiv");e.scrollLeft+=De},g.prototype.thumbPageDown=function(){vvPageThumbs.scrollTop+=$("#vvPageThumbs").height()},g.prototype.thumbPageUp=function(){vvPageThumbs.scrollTop-=$("#vvPageThumbs").height()},g.prototype.updatePage=function(t,a){if(a=a||d.getActivePaneState(),!a||!a.pageStates||a.pageStates.length<1)return!1;if(!wa(t))return!1;virtualViewer.deselectAllText(a),this.hideAnnPopUp(),O.setPreviousAnnObject(O.getCurrentAnnObject()),O.setCurrentAnnObject(null),s.collapseStickiesByDefault&&O.collapseAllStickyNotes(!0),a.setPageNumber(t),Sa(a);var n=e("vvThumbs");return 0===O.getActivePane()&&(n.highlightActiveThumbnail(a),n.ensurePageThumbIsVisible(a),n.ensureSearchThumbIsVisible(a)),ya(a),le.call("pageChange",{page:t}),!0},g.prototype.setPage=function(e){return O.setPageCore(e)},g.prototype.setPageCore=function(e,t){if(t=t||d.getActivePaneState(),Za({state:!0,documentModel:!0,notVideo:!0},t)&&virtualViewer.updatePage(e,t)){if(s.showAnnIndicators){var a=O.pagesWithAnnotations();$("#vvRedactionNavigationOption")[0].checked||Ut(e,a)}Ht(t),Lt(t),c.updateSearchButtons(),ya(t),t.imageManager.cacheImages(e),virtualViewer.skipScrollEvent=!0;var n=O.getOuterDivFromState(t);n.scrollTop(virtualViewer.findPagePosition(e,t))}},g.prototype.displayWaitIndicator=function(e,t){G&&clearTimeout(G);var a=!1;if(t=t||d.getActivePaneState(),t&&(a=t.isVideo()),e){$("#waitIndicatorProgressBar").hide();var n=s.waitDialogTimeout||1e3;G=setTimeout(function(){a?$("#vvVideoWaitIndicator").modal("show"):te||$("#vvWaitIndicator").modal("show")},n)}else $("#vvWaitIndicator").modal("hide"),$("#vvVideoWaitIndicator").modal("hide")},g.prototype.displaySaveIndicator=function(e){s.enableSaveNotification&&(e?$("#vvSaveDocumentIndicator").show():$("#vvSaveDocumentIndicator").hide())},g.prototype.displayOcrWaitIndicator=function(e){e?$("#vvOcrIndicator").modal("show"):$("#vvOcrIndicator").modal("hide")};var Aa=function(e){e?$("#vvEmailIndicator").modal("show"):$("#vvEmailIndicator").modal("hide")};g.prototype.saveDocumentAsDialog=function(){var t=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},t)){var a="pdf",n=O.getSaveAsDocumentNameGenerator(),i=n(t.getDocumentId(),t.getDisplayName(),a);e("vvDialogs").saveAsDialog({documentName:{documentName:i}})}},g.prototype.willSavingOverwriteCurrentFormat=function(e){if(e=e||d.getActivePaneState(),!Za({state:!0,documentModel:!0,notVideo:!0},e))return!1;var t="tif"===e.getDocFormat()||"pdf"===e.getDocFormat(),a=e.documentModel.model.isCompoundDocument,n=e.documentModel.getPagesModifiedSinceInit();return!(t&&!a||!n||e.isVirtualDocument())},g.prototype.printDocumentDialog=function(t){Za({state:!0,documentModel:!0,notVideo:!0})&&e("vvDialogs").printDialog(t)};g.prototype.printDocument=function(t){var a;t&&t.documentId&&(a=d.getStateForDocumentId(t.documentId)),Za({state:!0,documentModel:!0,notVideo:!0},a)&&e("vvPrintManager").printDocument(t)};var Pa=function(e,t){var a,n=d.getActivePaneState(),i=O.getCurrentAnnObject(),o=u.getLayerWithAnn(i),r=n.getUndoObject(n.getPageNumber());r.referenceAnn=i,r.unchangedAnn=i.clone(),r.layer=o,i&&i.markRevised(),"vvAnnTextColorChoices"===e[0].id&&(a=i.getFontColor(),i.setFontColor(t),$("#vvAnnPopUpEditTextArea").css("color","#"+t)),"vvAnnFillColorChoices"===e[0].id&&(a=i.getFillColor(),i.setFillColor(t)),"vvAnnLineColorChoices"===e[0].id&&(a=i.getLineColor(),i.setLineColor(t)),r.modifiedAnn=i.clone(),r.type="modify",r.modifiedAnn.isSameAs(r.unchangedAnn)||n.pushUndoObject(n.getPageNumber(),r),n.resetUndoObject(),u.markLayerWithAnnDirty(i),virtualViewer.delayedPaintCanvases(n)};g.prototype.showRedactionWarningDialog=function(){"true"!==localStorage.ne7owv6art3itt5ild7ed3oick9jiz1go5huec9eav7fups5ew&&O.annotationsEnabled&&s.disableRedactionWarningDialog!==!0&&(O.redactionWarningShown||($("#vvRedactionWarningDialog").modal("show"),O.redactionWarningShown=!0))},g.prototype.createHighlightFromSelection=function(){var e=O.mergeTextRects(virtualViewer.getSelectedTextRects()),a=O.getCurrentState(),n=a.getPageNumber();if(O.checkAnnotationsEnabled(!0)){var i=u.getCurrentLayer();if(i||s.oneLayerPerAnnotation||(i=u.createDefaultLayer(a)),i&&t.isRedactionLayer(i)&&(i=a.getLayerFromPage(n,"Default"),i||(i=u.createDefaultLayer(a))),e.length>0)for(var r=0;r<e.length;r+=1)s.oneLayerPerAnnotation===!0&&(Tt(),i=u.getCurrentLayer()),O.createAnnotationFromRect(e[r],o.annotationTypes.SANN_HIGHLIGHT_RECT,i,n,!0);O.delayedPaintCanvases(a),O.pageContainsAnnotations(O.getPageNumber())&&!O.pageHasIndicator(a.getPageNumber())&&(virtualViewer.showAnnotationIndicator(a.getPageNumber()),O.addToPagesWithAnnotations(a.getPageNumber())),virtualViewer.createNavigationOptionsLabels()}},g.prototype.createRedactionFromSelection=function(){var e=O.mergeTextRects(virtualViewer.getSelectedTextRects()),t=O.getCurrentState(),a=t.getPageNumber();if(e.length>0)for(var n=0;n<e.length;n+=1){var i=u.getRedactionLayer(a);O.createRedactionFromRect(e[n],i,a,!0)}O.delayedPaintCanvases(t),O.pageContainsAnnotations(O.getPageNumber())&&!O.pageHasIndicator(t.getPageNumber())&&(virtualViewer.showAnnotationIndicator(t.getPageNumber()),O.addToPagesWithAnnotations(t.getPageNumber())),virtualViewer.createNavigationOptionsLabels()},g.prototype.createRedactionFromRect=function(e,t,a,n,i){O.getCurrentState();if(O.checkRedactionsEnabled(!0))return t||(t=u.getRedactionLayer(a)),O.showRedactionWarningDialog(),O.createAnnotationFromRect(e,o.annotationTypes.SANN_REDACTION_RECT,t,a,n,i)},g.prototype.createAnnotationFromRect=function(a,i,o,l,d,c){var g,v,p,h,f=this.getActivePaneState(),m=ie.getAnnotationPreference(i),y=a.left,b=a.top,A=a.right,P=a.bottom,T=a.width(),S=a.height(),w=new r(y,b,T,S),I=i;m&&(v=m.lineWidth,p=m.lineColor,h=m.fillColor),o||(o=u.getCurrentLayer(l),f.getLayersForPage(l)&&o||(o=u.createDefaultLayer(f)));var C=f.getDPIForPage(l),D=f.getOriginalWidthForPage(l),x=f.getOriginalHeightForPage(l);C||(C=f.getDPIForPage(0),f.setDPIForPage(l,C)),o.dpi||(o.dpi=C),D||(D=f.getOriginalWidthForPage(0),f.setOriginalWidthForPage(l,D)),o.pageWidth||(o.pageWidth=D),x||(x=f.getOriginalHeightForPage(0),f.setOriginalHeightForPage(l,x)),o.pageHeight||(o.pageHeight=x);var M=[new n(y,b),new n(A,P)],N=new(e("vvPreviewAnnotation"));N.initPreview(I,w,p,h,v,s.annotationDefaults.highlightOpacity,M,o.doubleByte,C,o.isIDM),t.isRedactionLayer(o)&&(N.setFillColorRGB(s.annotationDefaults.redactionFillColor),N.setOpacity(s.annotationDefaults.redactionOpacity));var L=N.getFontSize(),V=N.getLineWidth();if(N.setPageWidth(o.pageWidth),N.setPageHeight(o.pageHeight),N.setFontSize(L),N.setLineWidth(V),N.page=l,N.setPreview(!1),this.currentPreviewAnnObject=null,this.currentPointArray=[],g=u.addAnnotation(N,l,o,!0,c),!g)return null;var $=f.getUndoObject(l);return $.modifiedAnn=void 0,$.layer=o,$.type="add",f.pushUndoObject(l,$),d||this.delayedPaintCanvases(f),this.createNavigationOptionsLabels(),g},g.prototype.destroyInProgressAnnotation=function(){this.setCurrentAnnObject(null),this.currentPreviewAnnObject=null,this.disableStickyAnnotationButton(),se.dragging=!1,this.currentPointArray=[],X=null,this.delayedPaintCanvases()},g.prototype.turnOnAnnotationButton=function(e,a,n){if(O.checkAnnotationsEnabled(!0)&&a&&"true"!==a.attr("aria-disabled")){var i=d.getActivePaneState();if(i&&!i.isVideo()){if(O.getCurrentAnnObject()||O.currentPreviewAnnObject||O.getDragMode()===o.dragModes.annotate){if(O.setCurrentAnnObject(null),O.currentPreviewAnnObject=null,O.hideAnnPopUp(),O.delayedPaintCanvases(i),e===X&&O.getDragMode()===o.dragModes.annotate)return void O.disableStickyAnnotationButton();O.disableStickyAnnotationButton()}if(e===o.annotationTypes.SANN_REDACTION_RECT){if(!O.checkRedactionsEnabled(!0))return;O.showRedactionWarningDialog()}var r=s.stickyAnnButtons[e];r&&(de=e),r&&Pe&&O.getCurrentAnnType()===e&&!n||(X=e,O.currentPointArray=[],X===o.annotationTypes.SANN_EDIT&&0===ie.customStampArray.length&&(O.currentStamp=null),this.hideAnnPopUp(),t.cursorAnnotate(),i.getLayersForPage()||s.oneLayerPerAnnotation||u.createDefaultLayer(i),$(".selectedAnn").removeClass("selectedAnn"),a.addClass("selectedAnn"),a.parents("li").addClass("selectedAnn"),r&&(Pe=!0),this.setDragMode(o.dragModes.pan),this.setDragMode(o.dragModes.annotate))}}},g.prototype.disableStickyAnnotationButton=function(){$(".selectedAnn").removeClass("selectedAnn"),Pe=!1,t.cursorNormal(),O.currentPointArray=[],se.endPoint=0,this.setDragMode(o.dragModes.pan)},g.prototype.toggleLayerManager=function(){var e=this.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e)){if("true"===$("#vvLayerManagerButton").attr("aria-disabled")||$("#vvLayerManagerDiv:visible").length)return void $("#vvLayerManagerDiv").modal("hide");var t=e.getLayerManager();t.showLayerDialog(e)}},g.prototype.showWatermarksManager=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&e("vvDialogs").watermarksDialog()},g.prototype.removeWatermarkFromPage=function(t){var a=d.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0},a)&&(t=t||a.getPageNumber(),e("vvWatermarks").removeWatermarksFromPage(t),O.delayedPaintCanvases(a))},g.prototype.sendDocument=function(t){var a;if(t?a=d.getStateForDocumentId(t):(a=d.getActivePaneState(),t=a.getDocumentId()),Za({state:!0,documentModel:!0,notVideo:!0},a)){var n=new URI(s.servletPath);n.addQuery("action","sendDocument"),e("vvWatermarks").saveWatermarks(a);var i=a.getDocumentModel().model;n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),n.addQuery("modelJSON",JSON.stringify(i)),n.addQuery("annotations",JSON.stringify(a.getAnnotationLayers(!0,!0,!0,s.sendDocumentWithAnnotations))),n.addQuery("includeTextAnnotations",s.sendDocumentWithAnnotations),n.addQuery("includeNonTextAnnotations",s.sendDocumentWithAnnotations),n.addQuery("includeRedactions",s.sendDocumentWithAnnotations),n.addQuery("includeWatermarks",s.sendDocumentWithWatermarks),n.addQuery("includeDocumentNotes",s.sendDocumentWithNotes),n.addQuery("stampStatus",""),null!==O.getOverlayPath()&&n.addQuery("overlayPath",O.getOverlayPath()),o.cacheBuster===!0&&n.addQuery("cacheBuster",Math.random()),n.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var r=n.query();n.query(""),$.ajax({url:n.toString(),type:"POST",data:r,dataType:"json",success:function(e){mt(e)!==!0&&le.call("sendDocument")},error:function(e){mt(e)===!0}})}},g.prototype.lockScrolling=function(e){ve?this.scrollingLocked=!!e:this.scrollingLocked=!1;var t=$("#vvLockScrollingBtn");this.scrollingLocked?(t.removeClass("vvDiffScrollingUnlocked"),t.addClass("vvDiffScrollingLocked")):(t.removeClass("vvDiffScrollingLocked"),t.addClass("vvDiffScrollingUnlocked"))};var Ta=function(e,t,a){var n=$(e).scrollTop(),i=$(e).scrollLeft();if($(t).scrollTop()!==n||$(t).scrollLeft()!==i){var o=me,r=ye;a&&(o=he,r=fe),he=n,fe=i,me=n,ye=i,o!==n&&$(t).scrollTop(n),r!==i&&$(t).scrollLeft(i)}},Sa=function(e){var t,a;e||(e=d.getActivePaneState()),e&&(a=e.getPageNumber(),t=e.getPageCount(),Ue(e)),$(".vvJumpToPageInput").val(a+1),0!==t?(t>999&&$(".vvJumpToPageLabel").width(45),$(".vvJumpToPageTotal").html(t)):$(".vvJumpToPageTotal").html(1)},wa=function(e){if(!e&&0!==e)return Ia(!0),!1;var t=d.getActivePaneState(),a=t.getPageCount();return e<0||a>0&&e>=a?(Ia(!0),!1):(Ia(!1),!0)},Ia=function(e){return e?void $(".vvJumpToPageInput").attr("aria-invalid",!0):void $(".vvJumpToPageInput").attr("aria-invalid",!1)};g.prototype.getPageNumber=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e))return e?e.getPageNumber():void 0},g.prototype.getOriginalWidth=function(){return originalWidth},g.prototype.setOriginalWidth=function(e){originalWidth=e},g.prototype.getDocumentModel=function(e){return e||(e=d.getActivePaneState()),e?e.getDocumentModel():null},g.prototype.setDocumentModel=function(e){var t=d.getActivePaneState();t.setDocumentModel(e)},g.prototype.getZoomPercent=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e))return e.getZoomDecimal()},g.prototype.getCurrentAnnObject=function(){return Y},g.prototype.setCurrentAnnObject=function(e){Y=e},g.prototype.getPreviousAnnObject=function(){return Z},g.prototype.setPreviousAnnObject=function(e){Z=e},g.prototype.collapseAllStickyNotes=function(e,t){var a=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},a)){var n=a.getLayersForPage(O.getPageNumber());if(n){var i=Object.keys(n);if(i&&n)for(var r=0;r<i.length;r+=1)for(var s=n[i[r]],l=s.anns,u=0;u<l.length;u+=1){var c=l[u];c.getType()===o.annotationTypes.SANN_POSTIT&&(c.collapsed=e,c.editing=!1)}t&&virtualViewer.delayedPaintCanvases()}}},g.prototype.zoomRubberband=function(){var e=d.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0},e)&&(X=o.annotationTypes.SANN_RECTANGLE,O.currentPointArray=[],se.endPoint=0,O.setDragMode(o.dragModes.zoom))};var Ca=function(e,t){virtualViewer.localClipboard=e;var a=encodeURIComponent(JSON.stringify(e)),n=function(e){t&&(virtualViewer.localClipboard?t():displayErrorIndicator(!0,e))},i=localforage.setItem("vvClipboard",a);t?i.then(t,n):i.then(function(){},n)},Da=function(e){var t=function(t){var a=null;try{a=JSON.parse(decodeURIComponent(t))}catch(e){a=null}var n=virtualViewer.localClipboard;n&&(!a||a.timestamp>n.timestamp)&&(a=n),a?(Ma(a),e(a)):e(null)},a=function(){e(virtualViewer.localClipboard?virtualViewer.localClipboard:null)},n=localforage.getItem("vvClipboard");n.then(t,a)};g.prototype.createClipObject=function(){var t={},a=virtualViewer.getDocumentModel(),n=virtualViewer.getCurrentState(),i=n.getImageManager(),o=a.getSelectedPageNumbers();return 0!==o.length&&(t.pageNums=o,t.pageState=n.copyPages(o,0),t.layerNames=n.getLayerNames(),t.model=a.copySelection(),t.bookmarks=ne.copyBookmarksForPageRange(o),t.watermarks=e("vvWatermarks").copyWatermarksForPageRange(n,o),t.imageManager=i.copyPages(o),t.timestamp=Date.now(),t.sessionGUID=virtualViewer.viewerSessionID,t)},g.prototype.copySelection=function(e,t){if(Za({state:!0,documentModel:!0,notVideo:!0})){var a={};if(O.checkPageManipulationsEnabled(e)){if(a=virtualViewer.createClipObject()){Ca(a,t);var n={pages:a.pageNums,documentId:d.getActivePaneState().documentId};return le.call("pageCopied",n),!0}return!1}return!1}},g.prototype.deleteSelection=function(a,n){n=n||virtualViewer.getCurrentState();var i,o=n.getDocumentModel();i=a.pageNums?a.pageNums:o.getSelectedPageNumbers();var r=n.getImageManager();if(0===i.length)return!1;if(i.length>=n.getPageCount())return yt(t.getLocalizedValue("errors.onePageLimit")),!1;O.removeAllAnnotationIndicators();for(var s=0,l=0;l<i.length;l+=1)O.removeFromPagesWithAnnotations(i[l]),s++;n.getDocumentModel().setPagesModifiedSinceInit(!0,n),o.cutSelection(i),n.cutPages(i,0),r.cutPages(i);for(var u=0;u<i.length;u++)ne.deleteBookmark(null,i[u],!0);ne.shiftBookmarks(i[0],i,!1),e("vvWatermarks").removePages(n,i);var c=e("vvThumbs");c.fillPageThumbs(n);for(var g=O.pagesWithAnnotations(),v=0;v<g.length;v+=1)virtualViewer.showAnnotationIndicator(g[v]);return Ht(n,!0),n.getPageCount()>0&&c.loadVisibleThumbs($("#vvPageThumbs")),le.call("pageDeleted",{pages:i}),O.updateTabName(n),d.getCurrentDiff()&&virtualViewer.performDiff(!0,!0),n.pageNumber>=n.pageCount&&(n.pageNumber=n.pageCount),virtualViewer.fillAnnotationList(),!0},g.prototype.cutSelection=function(e,t,a){if(!Za({state:!0,documentModel:!0,notVideo:!0}))return!1;var n={};return!!O.checkPageManipulationsEnabled(t)&&(e!==!0&&(n=virtualViewer.createClipObject(),Ca(n,a)),virtualViewer.deleteSelection(n),c.handleSearchOnPageManipulation(),!0)},g.prototype.pasteClip=function(t,a,n,i){a=a||d.getActivePaneState(),n=n||0;var o=a.getDocumentModel();o.setPagesModifiedSinceInit(!0,a),La(t,a),o.paste(t.model,n),a.pastePages(t.pageState,n),a.setPageCount(o.getDocumentLength()),a.fixAnnPages();var r=a.getImageManager();
r.getPastedPages(t.imageManager.length,n),ne.shiftBookmarks(n,t.pageNums,!0);for(var s=0;s<t.bookmarks.length;s++){var l=t.bookmarks[s];l.page=n+s,O.addBookmark(l.note,l.page)}e("vvWatermarks").pastePagesWithWatermarks(a,t,n);var u=e("vvThumbs");u.fillPageThumbs(a);for(var s=0;s<t.imageManager.length;s++)virtualViewer.pageContainsAnnotations(n+s)&&virtualViewer.addToPagesWithAnnotations(n+s);virtualViewer.removeAllAnnotationIndicators(),i||(u.loadVisibleThumbs($("#vvPageThumbs")),virtualViewer.setPage(n));for(var g=n;g<a.pageStates.length&&a.pageStates[g].imageInfoRequested;g++)a.pageStates[g].imageInfoRequested=!1;c.handleSearchOnPageManipulation(),d.getCurrentDiff()&&virtualViewer.performDiff(!0,!0),Ht(a,!0),virtualViewer.showAllAnnotationIndicators(),virtualViewer.fillAnnotationList(),O.updateTabName(a),le.call("pagePasted",{pages:t.pageNums})};var xa=function(e){var t=e&&e.model[0]&&e.pageState[0];return t};g.prototype.clipIsVVObject=xa;var Ma=function(e){for(var t=[],a=0;a<e.pageState.length;a++){var n=e.pageState[a],o=e.model[a],r=new i;r.initPageStateFromObject(n);for(var s=e.layerNames,l=0;l<s.length;l++){var d=n.annotationLayers[s[l]];if(d){var c=u.createAnnotationLayer(d.layerName,o.pageIndex,r);c.isIDM=d.isIdm,c.doubleByte=d.doubleByte;for(var g=0;g<d.anns.length;g++){var v=d.anns[g];c.anns[g]=Va(v,c)}r.annotationLayers[s[l]]=c}}t.push(r)}e.pageState=t};g.prototype.fixClipState=Ma;var Na=function(e){for(var t=0;t<e.pageState.length;t++)if(e.pageState[t]&&e.pageState[t].annotationLayers)for(var a=Object.keys(e.pageState[t].annotationLayers),n=0;n<a.length;n++){var i=a[n];if(e.pageState[t].annotationLayers[i])for(var o=e.pageState[t].annotationLayers[i],r=0;r<o.anns.length;r++)o.anns[r].markRevised()}},La=function(e,a){var n=a.layerNames,i=[];if(!s.oneLayerPerAnnotation){for(var o=0;o<e.layerNames.length;o++){var r=e.layerNames[o];n.includes(r)||i.push(r)}return a.layerNames=i.concat(n),void Na(e)}for(var l=0;l<e.pageState.length;l++){for(var d={},c=0;c<e.layerNames.length;c++)for(var g=e.layerNames[c],v=e.pageState[l].annotationLayers[g],p=0;p<v.anns.length;p++){var h=Pt(t.isRedactionLayer(v)),f=u.createAnnotationLayer(h,null,e.pageState[l]);f.permissionLevel=v.permissionLevel,i.push(f.layerName);var m=v.anns[p];m.layerName=f.layerName,f.anns.push(m),d[f.layerName]=f}e.pageState[l].annotationLayers=d}Na(e),e.layerNames=i,a.layerNames=i.concat(n)},Va=function(t,a){var n=new(e("annotations"));return n.init(null,t,t.page,t.pageWidth,t.pageHeight,t.layerName,a.doubleByte,t.index,t.docDPI,a.isIDM),n};g.prototype.pasteSelection=function(e,a,n){Za({state:!0,documentModel:!0,notVideo:!0})&&Da(function(i){return e=e||0,i?void(O.checkPageManipulationsEnabled(n)&&virtualViewer.pasteClip(i,null,e,a)):void alert(t.getLocalizedValue("errors.clipboardEmpty","There are no pages on the clipboard."))})},g.prototype.selectPage=function(e,t){if(O.checkPageManipulationsEnabled(t)){var a=O.getDocumentModel();a.addPageToSelection(e)}},g.prototype.deselectPage=function(e,t){if(O.checkPageManipulationsEnabled(t)){var a=O.getDocumentModel();a.removePageFromSelection(e)}},g.prototype.selectRange=function(e,t){if(O.checkPageManipulationsEnabled(t)){var a=O.getDocumentModel();a.selectRange(e)}},g.prototype.selectAll=function(e){if(O.checkPageManipulationsEnabled(e)){var t=O.getDocumentModel();t.selectAll()}},g.prototype.selectNone=function(e){if(O.checkPageManipulationsEnabled(e)){var t=O.getDocumentModel();t.clearPageSelection()}},g.prototype.isPageSelected=function(e,t){if(O.checkPageManipulationsEnabled(t)){var a=O.getDocumentModel();return a.isPageSelected(e)}},g.prototype.getSelectedPageNumbers=function(e){if(O.checkPageManipulationsEnabled(e)){var t=O.getDocumentModel();return t.getSelectedPageNumbers()}},g.prototype.showAboutDialog=function(){$("#vvAboutDialog").modal("show")};var $a=function(e){O.disableUploadDocument=!!e,O.disableUploadDocument?$(".vvFileUpload").remove():$(".vvFileUpload").show()};g.prototype.isUploadDocumentEnabled=function(){return!this.disableUploadDocument},g.prototype.disableUploadDocumentForSession=function(){$a(!0)},g.prototype.showUploadLocalFileDialog=function(){return this.isUploadDocumentEnabled()?void $("#vvUploadLocalFilesDialog").modal("show"):void this.displayExceptionMessage(t.getLocalizedValue("errors.uploadDisabled","Upload document has been disabled by the administrator."))},g.prototype.showUserPreferencesDialog=function(){s.disableUserPreferences||(ie.updateDialog(),$("#vvUserPreferencesDialog").modal("show"))},g.prototype.showPictureControlsDialog=function(){var e=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},e)){if($("#vvPictureControlsDialog").modal("show"),$("#vvBrightnessSlider").slider(),$("#vvContrastSlider").slider(),$("#vvGammaSlider").slider(),$("#vvBrightness .slider").attr("title",t.getLocalizedValue("pictureControls.brightnessSlider.title","Brightness (Slider)")),$("#vvContrast .slider").attr("title",t.getLocalizedValue("pictureControls.contrastSlider.title","Contrast (Slider)")),$("#vvGamma .slider").attr("title",t.getLocalizedValue("pictureControls.gammaSlider.title","Gamma (Slider)")),!e)return void $("#vvPictureControlsDialogOKButton").prop("disabled",!0);$("#vvPictureControlsDialogOKButton").prop("disabled",!1);var a=e.getBrightnessForPage(e.pageNumber);$("#vvBrightnessSliderVal").text(a),$("#vvBrightnessSlider").slider("setValue",a),$("#vvBrightnessSlider").slider().on("slideStop slide",function(t){$("#vvBrightnessSliderVal").text(t.value),Ye();var a=t.value,n=s.pictureControlsTimeout||200;Q&&clearTimeout(Q),Q=setTimeout(function(t){e.setBrightnessForPage(e.getPageNumber(),a),O.updateTabName(e)},n)});var n=e.getContrastForPage(e.pageNumber);$("#vvContrastSliderVal").text(n),$("#vvContrastSlider").slider("setValue",n),$("#vvContrastSlider").slider().on("slideStop slide",function(t){$("#vvContrastSliderVal").text(t.value),Ye();var a=t.value,n=s.pictureControlsTimeout||200;Q&&clearTimeout(Q),Q=setTimeout(function(t){e.setContrastForPage(e.getPageNumber(),a),O.updateTabName(e)},n)});var i=e.getGammaForPage(e.pageNumber);$("#vvGammaSliderVal").text(i),$("#vvGammaSlider").slider("setValue",i),$("#vvGammaSlider").slider().on("slideStop slide",function(t,a){$("#vvGammaSliderVal").text(t.value),Ye();var n=t.value,i=s.pictureControlsTimeout||200;Q&&clearTimeout(Q),Q=setTimeout(function(t){e.setGammaForPage(e.getPageNumber(),n),O.updateTabName(e)},i)})}},g.prototype.emailDocumentDialog=function(){var t=d.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0},t)&&e("vvDialogs").emailDialog({displayName:t.getDisplayName(),prepopulateFrom:s.emailDefaults.prepopulateFrom,prepopulateTo:s.emailDefaults.prepopulateTo,prepopulateCC:s.emailDefaults.prepopulateCC,prepopulateBCC:s.emailDefaults.prepopulateBCC})},g.prototype.setProperty=function(e,t){var a=O.getActivePaneState();Za({state:!0,documentModel:!0,notVideo:!0})&&a.setDocumentModelProperty(e,t)},g.prototype.getProperty=function(e){var t=O.getCurrentState();if(Za({state:!0,documentModel:!0,notVideo:!0},t))return t.getDocumentModelProperty(e)},g.prototype.showImageInfo=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&(this.updateImageInfoDialog(),$("#vvImageInfoDialog").modal("show"))},g.prototype.hideImageInfo=function(){$("#vvImageInfoDialog").modal("hide")},g.prototype.toggleImageInfo=function(){var e=$("#vvImageInfoDialog").data("bs.modal")&&$("#vvImageInfoDialog").data("bs.modal").isShown;return!Za({state:!0,documentModel:!0,notVideo:!0})||e?void this.hideImageInfo():void this.showImageInfo()},g.prototype.updateImageInfoDialog=function(){if(!s.imageInfoFields)return $("#vvImageInfoText").html("No Image Info Available");var e=d.getActivePaneState(),a="<div class='vvImageInfoContents'>";a+="<div class='vvImageInfoHeader'>"+t.getLocalizedValue("imageInfo.documentInfoHeader","Document Info")+"</div>",a+='<table class="vvImageInfoTable" width=100%>';for(var n,i,o,r,l,u=null,c=0;c<s.imageInfoFields.length;c++)n=s.imageInfoFields[c].fieldId,o=s.imageInfoFields[c].fieldCaption,i=t.getLocalizedValue("imageInfo."+n,o),u=c%2===0?"vvImageInfoOddRow":"vvImageInfoEvenRow",f(n)&&(a+="<tr class='"+u+"'><td width=50%>",r=m(n,e),r||(r="N/A"),l=b(r),a+=i+'</td><td title="'+r+'">'+l,a+="</td></tr>");a+="<tr><td class='vvImageInfoPageHeader'><div class='vvImageInfoPageHeader'>"+t.getLocalizedValue("imageInfo.pageInfoHeader","Page Info")+"</div></td></tr>";for(var g=0;g<s.imageInfoFields.length;g++)n=s.imageInfoFields[g].fieldId,o=s.imageInfoFields[g].fieldCaption,i=t.getLocalizedValue("imageInfo."+n,o),u=g%2===0?"vvImageInfoOddRow":"vvImageInfoEvenRow",f(n)||(a+="<tr class='"+u+"'><td width=50%>",r=m(n,e),r||(r="N/A"),l=b(r),a+=i+'</td><td title="'+r+'">'+l,a+="</td></tr>");a+="</table>",a+="</div>",$("#vvImageInfoText").html(a)},g.prototype.toggleKeyboardHints=function(){var e=$("#vvKeyboardHints").data("bs.modal")&&$("#vvKeyboardHints").data("bs.modal").isShown;e?this.hideKeyboardHints():this.showKeyboardHints()},g.prototype.hideKeyboardHints=function(){$("#vvKeyboardHints").modal("hide")},g.prototype.showKeyboardHints=function(){$("#vvKeyboardHints").modal("show")},g.prototype.pageContainsAnnotations=function(e){var t,a=d.getActivePaneState();if(Za({state:!0,documentModel:!0,notVideo:!0},a))return t=a.getDocumentModel(),t.pageContainsAnnotations(e)},g.prototype.toggleThumbnailPanel=function(t){var a=e("vvThumbs");return $("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu(),t===!0||t===!1?(a.setThumbPanelVisibility(t),void Oa()):void a.setThumbPanelVisibility($("#vvImagePanel").hasClass("noThumbs"))},g.prototype.setDocumentIdGenerator=function(e){K=e},g.prototype.setExportDocumentNameGenerator=function(e){J=e},g.prototype.setSaveAsDocumentNameGenerator=function(e){ee=e},g.prototype.getSaveAsDocumentNameGenerator=function(){return ee||virtualViewer.defaultSaveAsDocumentNameGenerator},g.prototype.defaultSaveAsDocumentNameGenerator=function(e,t,a){var n="",i="pdf"===a;return n=t?t:e,n="Copy-"+n,n+=i?".pdf":".tif"},g.prototype.removeCallback=function(e,t){return le.removeCallback(e,t)},g.prototype.setCallback=function(e,t){return le.setCallback(e,t)},g.prototype.getCallbackManager=function(){return le},g.prototype.setPageChangeCompletedHandler=function(e){le.setCallback("pageChange",e)},g.prototype.setRotationCompletedHandler=function(e){le.setCallback("rotation",e)},g.prototype.setTextSelectHandler=function(e){le.setCallback("textSelect",e)},g.prototype.setSaveDocumentCompletedHandler=function(e){le.setCallback("saveDocument",e)},g.prototype.setSaveAsDocumentCompletedHandler=function(e){le.setCallback("saveAsDocument",e)},g.prototype.setUploadDocumentCompletedHandler=function(e){le.setCallback("uploadDocument",e)},g.prototype.setSendDocumentCompletedHandler=function(e){le.setCallback("sendDocument",e)},g.prototype.setSaveAnnotationsCompletedHandler=function(e){le.setCallback("saveAnnotations",e)},g.prototype.setImageLoadCompletedHandler=function(e){le.setCallback("imageLoadCompleted",e)},g.prototype.setImageLoadRequestedHandler=function(e){le.setCallback("imageLoadRequested",e)},g.prototype.searchText=function(e,t,a,n){if(Za({state:!0,documentModel:!0,notVideo:!0}))return c.searchDocumentText(e,t,a,n)},g.prototype.searchAnnotationText=function(e){if(Za({state:!0,documentModel:!0,notVideo:!0}))return c.searchAnnotationText(e)},g.prototype.getCurrentSearchResults=function(){return c.getCurrentSearchResults()},g.prototype.clearSearchResults=function(){if(Za({state:!0,documentModel:!0,notVideo:!0}))return c.clearSearchResults()},g.prototype.getAllTextForDocument=function(e){e=e||virtualViewer.getActivePaneState(),setTimeout(function(){for(var t=0;t<e.getPageCount();t++)virtualViewer.getAllText(t,e)},0)},g.prototype.getAllText=function(e,t){s.enableTextExtraction&&(t||(t=d.getActivePaneState()),e=t.validatePageNumber(e),null===t.getPageText(e)&&Ra(e,t))},g.prototype.cancelCurrentSearch=function(){c.cancelCurrentSearch()},g.prototype.isDocumentSearchable=function(){var e=d.getActivePaneState();return Za({state:!0,notVideo:!0})?e.getIsSearchable():null},g.prototype.nextSearchResult=function(){c.nextSearchResult()},g.prototype.previousSearchResult=function(){c.previousSearchResult()},g.prototype.redactSearchMatch=function(e,a){var n=d.getCurrentState();if(n){for(var i=u.getRedactionLayer(a),o=[],r=this.mergeTextRects(e.rectangles),s=0;s<r.length;s+=1){var l=r[s],c=new t.ImageRect(l.left/1e3,l.top/1e3,l.right/1e3,l.bottom/1e3);o.push(this.createRedactionFromRect(c,i,a,!0))}return this.pageHasIndicator(a)||(this.showAnnotationIndicator(a),this.addToPagesWithAnnotations(a)),this.delayedPaintCanvases(n),this.createNavigationOptionsLabels(),o}};var ka=function(e){var t;return void 0===e||""===e?t=!1:(t=!0,$("#redactAllTagError").is(":visible")&&$("#redactAllTagError").hide()),t},Ba=function(){$("#tagAllRedactionsOKButton").click(function(){var e=$("#vvAnnTagSearchSelect").children(":selected").text(),t=ka(e);t?(O.addRedactionTagsToSearch(c.getSearchedRedactions(),e,t),$("#vvTagAllRedactionsDialog").hide()):$("#redactAllTagError").show()}),$("#tagAllRedactionsCancelButton").click(function(e){$("select").each(function(){this.selectedIndex=0}),$("#vvTagAllRedactionsDialog").hide()})};g.prototype.showTagAllRedactionsDialog=function(){if(Za({state:!0,documentModel:!0,notVideo:!0})&&($("#vvTagAllRedactionsDialog").show(),$("#redactAllTagError").hide(),!s.annotationTags.length>0))throw"Please add tags for the redactions"},g.prototype.addRedactionTagsToSearch=function(e,t,a){var n,i=e;a||(a=!0);for(var o=0;o<i.length;o++){n=i[o];for(var r=0;r<n.annotationTags.length;r++)if(n.annotationTags[r]===t){a=!1;break}n.layerName.includes("vvRedaction")&&1===n.annotationTags.length&&n.annotationTags[0]!==t&&n.annotationTags.splice(0,1),a&&(n.annotationTags.push(t),n.markRevised(),u.markLayerWithAnnDirty(n))}var s=virtualViewer.getCurrentAnnObject();s&&$("#vvAnnPopUp:visible").length&&virtualViewer.annPopUpHandler(null,s)},g.prototype.enterGuideMode=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&(t.cursorGuides(),this.setDragMode(o.dragModes.guides))},g.prototype.enterPanMode=function(){this.setDragMode(o.dragModes.pan)},g.prototype.enterSelectTextMode=function(){if(Za({state:!0,documentModel:!0,notVideo:!0})){if(!this.pageHasText())return void alert(t.getLocalizedValue("errors.noText","No selectable text on this page"));t.cursorSelectText(),this.setDragMode(o.dragModes.selectText)}},g.prototype.toggleSelectTextMode=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&(se.getDragMode()!==o.dragModes.selectText?this.pageHasText()?this.setDragMode(o.dragModes.selectText):alert(t.getLocalizedValue("errors.noText","No selectable text on this page")):this.setDragMode(o.dragModes.pan))},g.prototype.toggleHGuide=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&this.toggleGuide(this.horizontalGuide,this.verticalGuide)},g.prototype.toggleVGuide=function(e,t){Za({state:!0,documentModel:!0,notVideo:!0})&&this.toggleGuide(this.verticalGuide,this.horizontalGuide)},g.prototype.toggleGuide=function(e,a){if(Za({state:!0,documentModel:!0,notVideo:!0})){var n=se.getDragMode();n!==o.dragModes.guides?(e.locked=!1,e.visible=!0):a.visible?(a.visible=!1,e.visible=!0):e.visible=!e.visible,a.locked=!1,e.locked=!1,a.visible||e.visible?this.setDragMode(o.dragModes.guides):(t.cursorNormal(),this.setDragMode(o.dragModes.pan)),O.delayedPaintCanvases()}},g.prototype.toggleCrosshairGuide=function(){var e=this.verticalGuide.visible||this.horizontalGuide.visible;Za({state:!0,documentModel:!0,notVideo:!0})&&(this.resetGuides(),e?(t.cursorNormal(),this.setDragMode(o.dragModes.pan)):(this.setDragMode(o.dragModes.guides),this.verticalGuide.visible=this.horizontalGuide.visible=!0),this.delayedPaintCanvases())},g.prototype.toggleBothGuidesVisibility=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&(this.verticalGuide=this.verticalGuide||{},this.horizontalGuide=this.horizontalGuide||{},this.verticalGuide.visible=!this.verticalGuide.visible,this.horizontalGuide.visible=!this.horizontalGuide.visible,this.delayedPaintCanvases())},g.prototype.toggleVGuideVisibility=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&(this.verticalGuide=this.verticalGuide||{},this.verticalGuide.visible=!this.verticalGuide.visible,this.delayedPaintCanvases())},g.prototype.toggleHGuideVisibility=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&(this.horizontalGuide=this.horizontalGuide||{},this.horizontalGuide.visible=!this.horizontalGuide.visible,this.delayedPaintCanvases())},g.prototype.getWidthRatio=function(){var e=O.getCurrentState(),t=e.pageStates[e.pageNumber].originalWidth,a=e.getRotationForPage(e.getPageNumber());return 90!==a&&270!==a||e.pageStates[e.currentPage]&&(t=e.pageStates[e.currentPage].originalWidth),$("#vvDummyScroller").width()/t},g.prototype.getHeightRatio=function(){var e=O.getCurrentState(),t=e.pageStates[e.pageNumber].originalHeight,a=e.getRotationForPage(e.getPageNumber());90!==a&&270!==a||e.pageStates[e.currentPage]&&(t=e.pageStates[e.currentPage].originalHeight);var n=o.spaceBetweenPages*e.getPageCount();return($("#vvDummyScroller").height()-n)/t},g.prototype.getPageHeightRatio=function(e){return O.getHeightRatio()/O.getPageCount()};var Ra=function(e,t){if(t||(t=d.getActivePaneState()),t.getIsSearchable()){var a=new URI(s.servletPath);a.addQuery("action","getAllTextForPage"),a.addQuery("pageIndex",ca(e,t)),a.addQuery("documentId",da(e,t)),a.addQuery("clientInstanceId",O.getClientInstanceId()),a.addQuery("pageCount",t.getPageCount()),o.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),null!==O.getOverlayPath()&&a.addQuery("overlayPath",O.getOverlayPath());var n=t.getDocumentId(),i=t.currentPaneIndex,r=a.query();a.query(""),$.ajax({url:a.toString(),type:"POST",dataType:"json",data:r,success:function(t){Fa(t,e,n,i),virtualViewer.deselectAllText()},error:function(e){console.log("getAllTextForPage"+e.statusText)}})}},Fa=function(e,t,a,n){var i=e.wordRects;if(i){i.sort(function(e,t){var a=e.bottom-e.top;return e.top>=t.top&&e.bottom<=t.bottom?e.left-t.left===0?e.right-t.right:e.left-t.left:e.bottom-.2*a<=t.top?e.top-t.top:e.top<t.top&&e.bottom<t.bottom?e.top-t.top:t.bottom-.2*a<=e.top?e.top-t.top:t.top<e.top&&t.bottom<e.bottom?e.top-t.top:e.left-t.left});var o=d.getStateForDocumentId(a,n);o.addPageText(e,t);var r=d.getCurrentDiff();r&&(r.processPageTextForDiff(t),r.diffPage(t),za(t))}};g.prototype.getDocumentCompareData=function(e){var t=d.getCurrentDiff();return t?t.changeObjects[e]?t.allChangeObjectsToRects(e):(this.getAllText(e,t.oldDocument.state),this.getAllText(e,t.newDocument.state),[]):[]},g.prototype.getDocumentCompareReport=function(e){if(Za({state:!0,documentModel:!0,notVideo:!0})){var t=d.getCurrentDiff();return t.diffIsComplete?e?void e(t.getChangeReport()):t.getChangeReport():(t.diffReportCallback=e,this.getAllTextForDocument(t.oldDocument.state),this.getAllTextForDocument(t.newDocument.state),e?void 0:t.getChangeReport())}},g.prototype.compareDocuments=function(e,t,a){if(a=a||{},e&&t){O.openInTab(e);var n=O.getCurrentState(1);if(n){var i=n.documentModel;i.getModifiedSinceInit()?O.confirmCloseDialog(n,t):O.splitScreen(t,a.splitScreenDirection||"horizontal")}else O.splitScreen(t,a.splitScreenDirection||"horizontal");O.performDiff(a.skipOcrPrompt,!0)}},g.prototype.performDiff=function(t,a){var n=d.getCurrentDiff();if(n&&!a)return void za();var i=new(e("vvDiffManager"));if($("#vvDocCompareInternal").empty(),i.init(d.getCurrentState(0),d.getCurrentState(1)),d.setDiff(i),!(d.getCurrentState(0).getIsSearchable()!==!1&&d.getCurrentState(1).getIsSearchable()!==!1||O.ocrEnabled))return _a(),i.setDiffDisabled(!0),void za();if((d.getCurrentState(0).getIsSearchable()===!1||d.getCurrentState(1).getIsSearchable()===!1)&&null!==d.getCurrentState(0).getIsSearchable()&&null!==d.getCurrentState(1).getIsSearchable()){var o=function(){d.getCurrentState(0).getIsSearchable()===!1&&virtualViewer.performOCR(d.getCurrentState(0)),d.getCurrentState(1).getIsSearchable()===!1&&virtualViewer.performOCR(d.getCurrentState(1))};if(!t)return void e("vvDialogs").ocrDialog(function(){setTimeout(o,0)},function(){i.setDiffDisabled(!0),za()});o()}Ea()};var Ea=function(){var e=d.getCurrentDiff();e.startDiff(),_a(),za()},Oa=function(){$("#vvThumbsTabs").removeClass("vvShrinkTabsToFitSevenThumbs vvShrinkTabsToFitSixThumbs vvFiveThumbs");var e=$(".thumbTabs.vvAllowedTab").length;7===e?$("#vvThumbsTabs").addClass("vvShrinkTabsToFitSevenThumbs"):6===e?$("#vvThumbsTabs").addClass("vvShrinkTabsToFitSixThumbs"):5===e&&$("#vvThumbsTabs").addClass("vvFiveThumbs")},_a=function(){$("#vvDocCompareTab").show().addClass("vvAllowedTab"),Oa(),$("#vvThumbs .active").removeClass("active"),$("#vvDocCompareTab, #vvDocCompare").addClass("active")};g.prototype.performOCR=function(e){var t=$.extend({},e);this.displayOcrWaitIndicator(!0),t.state=t.state||d.getActivePaneState();var a=new URI(s.servletPath);a.escapeQuerySpace(!1),a.addQuery("action","performOCR"),a.addQuery("documentId",t.state.getDocumentId()),a.addQuery("clientInstanceId",O.getClientInstanceId()),a.addQuery("forceOcr",t.force),null!==O.getOverlayPath()&&a.addQuery("overlayPath",O.getOverlayPath()),o.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var n=a.query();a.query("");var i=t.state.getDocumentId(),r=t.state.currentPaneIndex;$.ajax({url:a.toString(),dataType:"json",data:n}).done(function(e){if(!mt(e)&&"OK"===e.status&&e.ocrWasPerformed){var a=d.getStateForDocumentId(i,r);a.setIsSearchable(!0);for(var n=a.getPageNumber(),o=Math.max(n-s.continuousScrollBufferBeforeSize,0),l=Math.min(n+s.continuousScrollBufferAfterSize,a.getPageCount()-1),u=o;u<=l;u++)virtualViewer.getAllText(u,a);t.onCompleteCallback&&t.onCompleteCallback()}}).always(function(){virtualViewer.displayOcrWaitIndicator(!1)})},g.prototype.toggleColumnSelectionMode=function(){this.columnSelectionMode=!this.columnSelectionMode},g.prototype.enableColumnSelectionMode=function(){this.columnSelectionMode=!0},g.prototype.disableColumnSelectionMode=function(){this.columnSelectionMode=!1},g.prototype.getColorBlobSize=function(){return Modernizr.touchevents?o.annColorBlobSizeTouch:o.annColorBlobSize},g.prototype.selectAllText=function(){var e=d.getActivePaneState(),t=e.pageNumber;Za({state:!0,documentModel:!0,notVideo:!0},e)&&(this.selectTextStartPoint=new n(0,0),this.selectTextEndPoint=new n(e.getOriginalWidthForPage(),e.getOriginalHeightForPage(t)),this.delayedPaintCanvases(e))},g.prototype.deselectAllText=function(){Za({state:!0})&&(this.selectTextStartPoint=new n(0,0),this.selectTextEndPoint=new n(0,0),virtualViewer.delayedPaintCanvases())},g.prototype.copyAllText=function(){var e=d.getActivePaneState(),t=e.pageNumber;Za({state:!0,documentModel:!0,notVideo:!0},e)&&(this.selectTextStartPoint=new n(0,0),this.selectTextEndPoint=new n(e.getOriginalWidthForPage(t),e.getOriginalHeightForPage(t)),se.getDragMode()===o.dragModes.selectText&&this.delayedPaintCanvases(e),this.copySelectedText())},g.prototype.getSelectedTextRects=function(){var e=d.getActivePaneState();if(!this.selectTextStartPoint||!this.selectTextEndPoint||null===this.selectTextStartPoint||null===this.selectTextEndPoint)return[];var t=e.getPageText(e.pageNumber);if(t){var a=t.wordRects,i=[],o=new n(this.selectTextStartPoint.x,this.selectTextStartPoint.y),r=new n(this.selectTextEndPoint.x,this.selectTextEndPoint.y);if(r.y<o.y){var s=r;r=o,o=s}for(var l=0;l<a.length;l++)A(o,r,a[l],this.columnSelectionMode)&&i.push(a[l]);return i}};var Ua=function(e){return e.diffDisabled||e.diffDisabledUntilSave?virtualViewer.ocrEnabled&&!e.diffDisabledUntilSave?($(".vvDiffButton").attr("aria-disabled","false").prop("disabled",!1).removeClass("disabled"),void $("#vvToggleDiffHighlightingBtn").attr("aria-disabled","true").prop("disabled",!0).addClass("disabled")):($(".vvDiffButton").attr("aria-disabled","true").prop("disabled",!0).addClass("disabled"),void $("#vvLockScrollingBtn").attr("aria-disabled","false").prop("disabled",!1).removeClass("disabled")):void $(".vvDiffButton").attr("aria-disabled","false").prop("disabled",!1).removeClass("disabled")},Wa=function(){var e,t=d.getCurrentDiff(),a=parseInt($(this).closest(".diffPageContainer").attr("pageNumber"),10);e=$(this).hasClass("vvChangeRemoved")?t.oldDocument.state:t.newDocument.state,virtualViewer.setActivePane(e.currentPaneIndex);var n=t.focusOnChange(a,parseInt($(this).data("changeIndex"),10));if(n&&n.length){var i=n[0];if(virtualViewer.setPageCore(a,e),e.getOriginalHeightForPage(a)){var o=i.top/e.getOriginalHeightForPage(a)*virtualViewer.getScrollSpeed(e),r=O.getOuterDivFromState(e),s=r.find(".vvScroller").width()-r.width();s<0&&(s=0);var l=(r.find(".vvCanvas").width()+s)/2,u=l-e.getRequestedWidthForPage(a)/2,c=u+i.left*e.getZoomDecimal();r.scrollLeft(c),r.scrollTop(o+virtualViewer.findPagePosition(a,e))}virtualViewer.paintCanvases()}},za=function(e){var a=d.getCurrentDiff();Ua(a);var n=a.fillDiffPane(e,Wa);if(!(n||$("#vvLoadMoreButton").length||a.diffDisabled||a.diffDisabledUntilSave)){var i=$("<button></button>").attr({id:"vvLoadMoreButton",type:"button"}).addClass("btn btn-secondary");i.append($("<img />").attr("src","resources/loader.gif")),i.append($("<span></span>").text(t.getLocalizedValue("documentCompare.loadMore","Load More"))),i.appendTo("#vvDocCompareInternal"),i.on("click",function(){var e,t=d.getCurrentState(0).pageNumber;e=$(".diffPageLoading[pageNumber='"+t+"']").length?t:$(".diffPageContainer").last().hasClass("diffPageLoading")?parseInt($(".diffPageContainer").last().attr("pageNumber"),10):parseInt($(".diffPageLoading").first().attr("pageNumber"),10);for(var a=s.continuousScrollBufferAfterSize||1,n=e+a,i=e;i<n;i++)i<d.getCurrentState(0).getPageCount()&&virtualViewer.getAllText(i,d.getCurrentState(0)),i<d.getCurrentState(1).getPageCount()&&virtualViewer.getAllText(i,d.getCurrentState(1))})}};g.prototype.mergeTextRects=function(e){for(var a=[],n=null,i=null,o=0;o<e.length;o++){var r=e[o],s=new t.ImageRect(r.left,r.top,r.right,r.bottom);if(null===n&&(n=s),null!==i){if(s.top===i.top){n.right=s.right,i=s;continue}a.push(n),n=s}i=s}return null!==n&&a.push(n),a},g.prototype.getSelectedText=function(){var e=this.getSelectedTextRects();if(e&&e.length){var t,a="",n=null,i=1e6;for(t=0;t<e.length;t++){var o=e[t];o.left<i&&(i=o.left)}for(t=0;t<e.length;t++){var r=e[t],s=r.word.indexOf(";");s!==-1&&(r.word=r.word.slice(0,s+1)),0===t&&(a=S(a,r,i)),null!==n&&(a=T(a,n,r,i),a=w(a,n,r)),0!==r.word.indexOf("%%%%EOT")&&(a+=r.word.indexOf(";")===-1?"&#"+r.word.charCodeAt(0)+";":r.word),n=r}return a}},g.prototype.getUserFriendlySelectedText=function(){var e=virtualViewer.getSelectedText(),t=$("#vvCopyTextContainer").html(e).text();return $("#vvCopyTextContainer").empty(),t},g.prototype.copyTextUserEventHandler=function(){var e=virtualViewer.getSelectedText();if(e&&s.copySelectedText){$("#vvCopyTextContainer").html(e).show();try{window.getSelection().selectAllChildren(document.getElementById("vvCopyTextContainer"));var t=document.execCommand("copy");t||virtualViewer.copySelectedText()}catch(e){virtualViewer.copySelectedText()}finally{$("#vvCopyTextContainer").hide()}}},g.prototype.copySelectedText=function(){if(s.copySelectedText){var e=virtualViewer.getSelectedText();P(e)}};var Ha=function(e,t,a,n){var i=d.getCurrentDiff();if(i&&i.showHighlights){var o,r,s,l;0===e?(o=i.getOldDocHighlightRects(t),r="rgba(238, 41, 77, 0.2)",i.changeInFocus.removed.page===t&&i.changeInFocus.removed.rects&&i.changeInFocus.removed.rects.length&&(s=i.changeInFocus.removed.rects,l="rgba(238, 41, 77, 0.4)")):(o=i.getNewDocHighlightRects(t),r="rgba(93, 223, 134, 0.2)",i.changeInFocus.added.page===t&&i.changeInFocus.added.rects&&i.changeInFocus.added.rects.length&&(s=i.changeInFocus.added.rects,l="rgba(93, 223, 134, 0.4)"));var u=d.getCurrentState(e);Qa(o,n,r,u),s&&Qa(s,n,l,u)}},Qa=function(e,t,a,n){for(var i=0;i<e.length;i++){e[i].length||O.highlightImageRect(e[i],t,a,n);for(var o=0;o<e[i].length;o++)O.highlightImageRect(e[i][o],t,a,n)}},ja=function(e,t,a){if(se.dragMode===o.dragModes.selectText&&O.textSelectionAllowed()){t.lineWidth=2;var n=O.getSelectedTextRects();if(n){var i=O.mergeTextRects(n);0!==i.length&&qa(i,e,t,o.selectedTextColor,a)}}},qa=function(e,t,a,n,i){if(e&&e.length){O.highlightImageRect(e[0],a,n,i);var o=new r(0,0,0,0);if(e.length>2)for(o.top=1e6,o.bottom=0,o.left=1e6,o.right=0,vIndex=1;vIndex<e.length-1;vIndex++){var s=e[vIndex];o.top=Math.min(s.top,o.top),o.bottom=Math.max(s.bottom,o.bottom),o.left=Math.min(s.left,o.left),o.right=Math.max(s.right,o.right),O.highlightImageRect(s,a,n,i)}if(e.length>1){var l=e[e.length-1];O.highlightImageRect(l,a,n,i)}}};g.prototype.highlightImageRect=function(e,t,a,n){n=n||O.getActivePaneState();var i=n.getZoom()/100,o=e.top*i,s=e.bottom*i,l=e.left*i,u=e.right*i,d=new r(l,o,u-l,s-o);t.strokeStyle=a,t.fillStyle=a,t.beginPath(),t.moveTo(d.getX1(),d.getY1()),t.lineTo(d.getX2(),d.getY1()),t.lineTo(d.getX2(),d.getY2()),t.lineTo(d.getX1(),d.getY2()),t.closePath(),t.fill()},g.prototype.updateGuidePositions=function(e){return I(e)};var Ga=function(e,t,a,n){if(virtualViewer.horizontalGuide&&virtualViewer.horizontalGuide.visible&&e&&t){t.save();var i=a.getRequestedWidthForPage(n),o=a.getRequestedHeightForPage(n);90!==a.getRotationForPage(n)&&270!==a.getRotationForPage(n)||(i=o,o=a.getRequestedWidthForPage(n));var r=0,s=Math.max(virtualViewer.horizontalGuide.value,1);s=Math.min(s,o);var l=i,u=s;virtualViewer.horizontalGuide.locked?t.strokeStyle=Ce:t.strokeStyle=Ie,t.beginPath(),t.moveTo(r,s),t.lineTo(l,u),t.lineWidth=we,t.stroke(),t.restore()}},Ya=function(e,t){if(t.save(),virtualViewer.verticalGuide&&virtualViewer.verticalGuide.visible&&e&&t){var a=Math.max(virtualViewer.verticalGuide.value,1),n=0,i=a,o=e.height;virtualViewer.verticalGuide.locked?t.strokeStyle=Ce:t.strokeStyle=Ie,t.beginPath(),t.moveTo(a,n),t.lineTo(i,o),t.lineWidth=we,t.stroke(),t.restore()}};g.prototype.countPagesForDocument=function(e,t){var a=-1,n=new URI(s.servletPath);n.addQuery("action","countPages"),n.addQuery("documentId",e),n.addQuery("clientInstanceId",t);var i=n.query();return n.query(""),$.ajax({url:n.toString(),async:!1,type:"POST",data:i,dataType:"json",success:function(e){a=e.pageCount}}),a},g.prototype.addPageToSelection=function(e){var t=O.getCurrentState();if(Za({state:!0,documentModel:!0,notVideo:!0},t)){var a=t.getDocumentModel();a.addPageToSelection(e)}},g.prototype.removePageFromSelection=function(e){var t=O.getCurrentState();if(Za({state:!0,documentModel:!0,notVideo:!0},t)){var a=t.getDocumentModel();a.removePageFromSelection(e)}},g.prototype.disabledToolbarOptionDialog=function(e,t){var a,n,i=e;switch(i){case"save":n=t?t:"Saving this Document is not allowed.",a="Cannot Save Document";break;case"export":n=t?t:"Exporting this Document is not allowed.",a="Cannot Export Document";break;case"send":n=t?t:"Sending this Document is not allowed.",a="Cannot Send Document";break;case"print":n=t?t:"Printing this Document is not allowed.",a="Cannot Print Document"}$("#vvDisableToolbarDialogText").html(n),$("#vvDisableToolbarDialogTitle").html(a),$("#vvDisableToolbarDialog").modal("show")},g.prototype.setOverlayPath=function(e){Te=e},g.prototype.getOverlayPath=function(){return Te},g.prototype.checkPageManipulationsEnabled=function(e,a){var n=null,i=!0;if(O.pageManipulationsEnabled){if(O.getDocumentModel()&&O.getDocumentModel().hasRedactions())n=t.getLocalizedValue("pageManipulations.redactions","Page Manipulations are currently not supported in documents containing redactions."),i=!1;else if(c.searchInProgress())n=t.getLocalizedValue("pageManipulations.searchInProgress","Page Manipulations are disabled while a document search is in progress."),i=!1;else if(a||(a=d.getActivePaneState()),a)for(var o,r,l=0;l<s.restrictedPageManipulationFormats.length;l++)a.getFormatForPage(a.getPageNumber())&&(o=a.getFormatForPage(a.getPageNumber()).toUpperCase()),
r=s.restrictedPageManipulationFormats[l].toUpperCase(),o===r&&(n=t.getLocalizedValue("pageManipulations.restrictedFormat","Page Manipulations are disabled for this document format."),i=!1)}else n=t.getLocalizedValue("pageManipulations.disabled","Page Manipulations have been disabled by the administrator in the configuration."),i=!1;return e&&!i&&yt(n),i},g.prototype.setPageManipulationsEnabled=function(e){return O.pageManipulationsEnabled=e,O.pageManipulationsEnabled},g.prototype.setAnnotationsEnabled=function(e){return O.annotationsEnabled=e,O.annotationsEnabled},g.prototype.setRedactionsEnabled=function(e){return O.redactionsEnabled=e,We(),O.redactionsEnabled},g.prototype.checkAnnotationsEnabled=function(e){var a=null;return O.annotationsEnabled||(a=t.getLocalizedValue("errors.annotationsDisabled","Annotations have been disabled by the administrator in the configuration.")),e&&!O.annotationsEnabled&&alert(a),O.annotationsEnabled},g.prototype.checkRedactionsEnabled=function(e){var a=null;return O.redactionsEnabled||(a=t.getLocalizedValue("errors.redactionsDisabled","Redactions have been disabled by the administrator in the configuration."),$("#vvRedactionRectButton").attr("aria-disabled",!0)),e&&!O.redactionsEnabled&&alert(a),O.redactionsEnabled},g.prototype.toggleMagnifier=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&(re.setMagnifierEnabled(!re.getMagnifierEnabled()),re.magnifierHandler())},g.prototype.showMagnifierWindow=function(){d.isVideoOpen()||(re.setMagnifierEnabled(!0),re.magnifierHandler())},g.prototype.hideMagnifierWindow=function(){d.isVideoOpen()||(re.setMagnifierEnabled(!1),re.magnifierHandler())},g.prototype.setMagnifierPosition=function(e,t){if(Za({state:!0,notVideo:!0})){var a=$("#vvMagnifierCanvas");a.css("left",e),a.css("top",t),re.paintMagnifierCanvas()}},g.prototype.addBookmark=function(e,t){return!!Za({state:!0,documentModel:!0,notVideo:!0})&&ne.addBookmark(e,t,!1,!1)},g.prototype.deleteBookmark=function(e){return!!Za({state:!0,documentModel:!0,notVideo:!0})&&(null!==e&&void 0!==e&&(ne.deleteBookmark(null,e,!1),!0))},g.prototype.editBookmark=function(e){return!!Za({state:!0,documentModel:!0,notVideo:!0})&&(null!==e&&void 0!==e&&ne.editBookmark(e))},g.prototype.getVideoPlayer=function(){var e=virtualViewer.getActivePaneState();return Za({state:!0,yesVideo:!0},e)?e.getVideoManager().videoPlayer:null},g.prototype.playVideo=function(){var e=virtualViewer.getActivePaneState();return!!Za({state:!0,yesVideo:!0},e)&&(e.getVideoManager().videoPlayer.play(),!0)},g.prototype.pauseVideo=function(){var e=virtualViewer.getActivePaneState();return!!Za({state:!0,yesVideo:!0},e)&&(e.getVideoManager().videoPlayer.pause(),!0)},g.prototype.setVideoPlaybackSpeed=function(e){var t=virtualViewer.getActivePaneState();if(!Za({state:!0,yesVideo:!0},t))return!1;var a=t.getVideoManager().videoPlayer;return e=e||1,a.playbackRate=e,!0},g.prototype.fastForwardVideo=function(){var e=virtualViewer.getActivePaneState();return!!Za({state:!0,yesVideo:!0},e)&&(e.getVideoManager().videoPlayer.playbackRate=2,!0)},g.prototype.setVideoTime=function(e){var t=virtualViewer.getActivePaneState();if(!Za({state:!0,yesVideo:!0},t))return null;var a=t.getVideoManager().videoPlayer;return e=e||0,a.currentTime=e,e},g.prototype.getBookmarks=function(){return ne},g.prototype.getEventManager=function(){return se},g.prototype.getCurrentAnnType=function(){return X},g.prototype.setCurrentAnnType=function(e){X=e},g.prototype.getCurrentStickyAnnType=function(){return de},g.prototype.removeDocumentFromCache=function(e,t){var a=new URI(s.servletPath);a.addQuery("action","removeDocumentFromCache"),a.addQuery("documentId",e),void 0!==t?a.addQuery("clientInstanceId",t):a.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),o.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var n=a.query();a.query(""),$.ajax({url:a.toString(),type:"POST",data:n,dataType:"json",success:function(e){mt(e)===!0},error:function(e){mt(e)===!0}})},g.prototype.seedCache=function(e,t,a){if(!e)return!1;var n=new URI(s.servletPath);n.addQuery("action","seedCache"),n.addQuery("documentId",e),void 0!==a?n.addQuery("clientInstanceId",a):n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),t||(t=[]),n.addQuery("pages",t.toString());var i=n.query();n.query(""),$.ajax({url:n.toString(),type:"POST",data:i,dataType:"json",success:function(e){mt(e)===!0},error:function(e){mt(e)===!0}})},g.prototype.enterOverlayDragMode=function(){Za({state:!0,documentModel:!0,notVideo:!0})&&this.setDragMode(o.dragModes.overlay)},g.prototype.exitOverlayDragMode=function(){this.setDragMode(o.dragModes.pan)},g.prototype.moveOverlayImagesTogether=function(e){var t=d.getActivePaneState();if(Za({state:!0,notVideo:!0},t)){var a=t.getImageManager();a.pageLockOverlayOffset.locked=!!e}},g.prototype.removeOverlayFromPage=function(e){var t=d.getActivePaneState();if(Za({state:!0,notVideo:!0},t)&&t.getImageManager().overlayImage&&e===t.validatePageNumber(e)){var a=t.getImageManager();return a.overlayDataArray[e]=null,this.delayedPaintCanvases(),e}},g.prototype.addOverlayToPage=function(e,t){var a=d.getActivePaneState();if(Za({state:!0,notVideo:!0},a)&&e===a.validatePageNumber(e)){var n=a.getImageManager();return n.overlayImage&&t===n.overlayDocumentId?(null===n.overlayDataArray[e]&&(n.overlayDataArray[e]=void 0),this.delayedPaintCanvases(),e):this.getOverlayImage(t,{pages:[e]})}},g.prototype.clearOverlayImage=function(){var e=d.getActivePaneState();if(Za({state:!0,notVideo:!0},e)){var t=e.getImageManager();t.cleanOverlayOffset(),t.overlayImage=null,t.overlayDocumentId=null,t.overlayImageStripped=!1,this.delayedPaintCanvases()}},g.prototype.getOverlayImage=function(e,t){"use strict";var a=d.getActivePaneState();if(Za({state:!0,notVideo:!0},a)&&e){var n=a.getImageManager();if(t=t||{},t.lockOverlayMovement===!1?n.pageLockOverlayOffset.locked=!1:n.cleanOverlayOffset(),n.overlayDocumentId===e)return Xa(n,t.pages,a),void this.delayedPaintCanvases();n.requestOverlayImage(e,a),Xa(n,t.pages,a)}};var Xa=function(e,t,a){"use strict";if(!t)return void(e.overlayDataArray=[]);t.sort(function(e,t){return e||0===e?e-t:1});for(var n=0,i=0;i<a.getPageCount();i++)t[n]===i?(e.overlayDataArray[i]=void 0,n++):e.overlayDataArray[i]=null},Za=function(e,t){return t=t||d.getActivePaneState(),!!(!e.state&&!e.documentModel||t&&t.getImageManager())&&(t=t||{},!!(!e.documentModel||t.pageStates&&t.getDocumentModel())&&((!e.notVideo||!t.isVideo())&&((!e.notSplit||!ve)&&!!(!e.yesVideo||t.isVideo()&&t.getVideoManager()))))};g.prototype.encodeForHTML=function(e){return String(e).replace(/[&<> \/"'`=]/g,function(e){return Ka[e]})};var Ka={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"," ":"&nbsp;"};return g.prototype.filterDocumentThumbsByDisplayName=function(t){e("vvThumbs").filterDocumentThumbsByDisplayName(t)},g.prototype.loggingOverride=function(e){return"undefined"!=typeof e&&(this.overrideLoggingLevel=!!e),this.overrideLoggingLevel},g.prototype.isRedaction=function(e){var a=u.getLayerWithAnn(e);return!!t.isRedactionLayer(a)},g.prototype.lockViewBetweenDocuments=function(){s.previousBetweenDocumentSettings={fitLast:s.fitLastBetweenDocuments,positionLast:s.positionLastBetweenDocuments},s.fitLastBetweenDocuments=!0,s.positionLastBetweenDocuments=!0},g.prototype.unlockViewBetweenDocuments=function(){var e=s.previousBetweenDocumentSettings;e?(s.fitLastBetweenDocuments=e.fitLast,s.positionLastBetweenDocuments=e.positionLast):(s.fitLastBetweenDocuments=!1,s.positionLastBetweenDocuments=!1)},g});var virtualViewer,myFlexSnap,vvConfig;requirejs.config({baseUrl:"js",paths:{"user-config":"../user-config"}}),requirejs(["3rdparty/domReady!","webviewer","user-config/config"],function(e,t){if(vvConfig=require("user-config/config"),virtualViewer=new t,myFlexSnap=virtualViewer,beforeVirtualViewerInit){var a=beforeVirtualViewerInit();if(!a)return}virtualViewer.initViaURL(),afterVirtualViewerInit&&afterVirtualViewerInit()}),define("virtualviewer-main",function(){}),define("virtualviewer-built",function(){});